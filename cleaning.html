<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 2 Data Cleaning | A Taxonomy of Data Synthesis: A Tutorial</title>
  <meta name="description" content="This is a minimal example of using the bookdown package to write a book. The output format for this example is bookdown::gitbook." />
  <meta name="generator" content="bookdown 0.37 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 2 Data Cleaning | A Taxonomy of Data Synthesis: A Tutorial" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="This is a minimal example of using the bookdown package to write a book. The output format for this example is bookdown::gitbook." />
  <meta name="github-repo" content="emoriebeck/data-synthesis-tutorial" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 2 Data Cleaning | A Taxonomy of Data Synthesis: A Tutorial" />
  
  <meta name="twitter:description" content="This is a minimal example of using the bookdown package to write a book. The output format for this example is bookdown::gitbook." />
  



<meta name="date" content="2024-05-16" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="index.html"/>
<link rel="next" href="runmodels.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">A Minimal Book Example</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Workspace</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#packages"><i class="fa fa-check"></i><b>1.1</b> Packages</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#directory-path"><i class="fa fa-check"></i><b>1.2</b> Directory Path</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#introduction"><i class="fa fa-check"></i><b>1.3</b> Introduction</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#codebook"><i class="fa fa-check"></i><b>1.4</b> Codebook</a></li>
<li class="chapter" data-level="1.5" data-path="index.html"><a href="index.html#navigating-this-tutorial"><i class="fa fa-check"></i><b>1.5</b> Navigating This Tutorial</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="cleaning.html"><a href="cleaning.html"><i class="fa fa-check"></i><b>2</b> Data Cleaning</a>
<ul>
<li class="chapter" data-level="2.1" data-path="cleaning.html"><a href="cleaning.html#berlin-aging-study-base-i"><i class="fa fa-check"></i><b>2.1</b> Berlin Aging Study (BASE-I)</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="cleaning.html"><a href="cleaning.html#load-data"><i class="fa fa-check"></i><b>2.1.1</b> Load Data</a></li>
<li class="chapter" data-level="2.1.2" data-path="cleaning.html"><a href="cleaning.html#recoding-reverse-scoring"><i class="fa fa-check"></i><b>2.1.2</b> Recoding &amp; Reverse Scoring</a></li>
<li class="chapter" data-level="2.1.3" data-path="cleaning.html"><a href="cleaning.html#covariates"><i class="fa fa-check"></i><b>2.1.3</b> Covariates</a></li>
<li class="chapter" data-level="2.1.4" data-path="cleaning.html"><a href="cleaning.html#personality-variables"><i class="fa fa-check"></i><b>2.1.4</b> Personality Variables</a></li>
<li class="chapter" data-level="2.1.5" data-path="cleaning.html"><a href="cleaning.html#outcome-variables"><i class="fa fa-check"></i><b>2.1.5</b> Outcome Variables</a></li>
<li class="chapter" data-level="2.1.6" data-path="cleaning.html"><a href="cleaning.html#combine-data"><i class="fa fa-check"></i><b>2.1.6</b> Combine Data</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="cleaning.html"><a href="cleaning.html#einstein-aging-study-eas"><i class="fa fa-check"></i><b>2.2</b> Einstein Aging Study (EAS)</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="cleaning.html"><a href="cleaning.html#load-data-1"><i class="fa fa-check"></i><b>2.2.1</b> Load Data</a></li>
<li class="chapter" data-level="2.2.2" data-path="cleaning.html"><a href="cleaning.html#recoding-reverse-scoring-1"><i class="fa fa-check"></i><b>2.2.2</b> Recoding &amp; Reverse Scoring</a></li>
<li class="chapter" data-level="2.2.3" data-path="cleaning.html"><a href="cleaning.html#covariates-1"><i class="fa fa-check"></i><b>2.2.3</b> Covariates</a></li>
<li class="chapter" data-level="2.2.4" data-path="cleaning.html"><a href="cleaning.html#personality-variables-1"><i class="fa fa-check"></i><b>2.2.4</b> Personality Variables</a></li>
<li class="chapter" data-level="2.2.5" data-path="cleaning.html"><a href="cleaning.html#outcome-variables-1"><i class="fa fa-check"></i><b>2.2.5</b> Outcome Variables</a></li>
<li class="chapter" data-level="2.2.6" data-path="cleaning.html"><a href="cleaning.html#combine-data-1"><i class="fa fa-check"></i><b>2.2.6</b> Combine Data</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="cleaning.html"><a href="cleaning.html#german-socioeconomic-panel-gsoep"><i class="fa fa-check"></i><b>2.3</b> German Socioeconomic Panel (GSOEP)</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="cleaning.html"><a href="cleaning.html#load-data-2"><i class="fa fa-check"></i><b>2.3.1</b> Load Data</a></li>
<li class="chapter" data-level="2.3.2" data-path="cleaning.html"><a href="cleaning.html#recoding-reverse-scoring-2"><i class="fa fa-check"></i><b>2.3.2</b> Recoding &amp; Reverse Scoring</a></li>
<li class="chapter" data-level="2.3.3" data-path="cleaning.html"><a href="cleaning.html#covariates-2"><i class="fa fa-check"></i><b>2.3.3</b> Covariates</a></li>
<li class="chapter" data-level="2.3.4" data-path="cleaning.html"><a href="cleaning.html#personality-variables-2"><i class="fa fa-check"></i><b>2.3.4</b> Personality Variables</a></li>
<li class="chapter" data-level="2.3.5" data-path="cleaning.html"><a href="cleaning.html#outcome-variables-2"><i class="fa fa-check"></i><b>2.3.5</b> Outcome Variables</a></li>
<li class="chapter" data-level="2.3.6" data-path="cleaning.html"><a href="cleaning.html#combine-data-2"><i class="fa fa-check"></i><b>2.3.6</b> Combine Data</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="cleaning.html"><a href="cleaning.html#household-income-and-labour-dynamics-in-australia-hilda"><i class="fa fa-check"></i><b>2.4</b> Household, Income, and Labour Dynamics in Australia (HILDA)</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="cleaning.html"><a href="cleaning.html#load-data-3"><i class="fa fa-check"></i><b>2.4.1</b> Load Data</a></li>
<li class="chapter" data-level="2.4.2" data-path="cleaning.html"><a href="cleaning.html#recoding-reverse-scoring-3"><i class="fa fa-check"></i><b>2.4.2</b> Recoding &amp; Reverse Scoring</a></li>
<li class="chapter" data-level="2.4.3" data-path="cleaning.html"><a href="cleaning.html#covariates-3"><i class="fa fa-check"></i><b>2.4.3</b> Covariates</a></li>
<li class="chapter" data-level="2.4.4" data-path="cleaning.html"><a href="cleaning.html#personality-variables-3"><i class="fa fa-check"></i><b>2.4.4</b> Personality Variables</a></li>
<li class="chapter" data-level="2.4.5" data-path="cleaning.html"><a href="cleaning.html#outcome-variables-3"><i class="fa fa-check"></i><b>2.4.5</b> Outcome Variables</a></li>
<li class="chapter" data-level="2.4.6" data-path="cleaning.html"><a href="cleaning.html#combine-data-3"><i class="fa fa-check"></i><b>2.4.6</b> Combine Data</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="cleaning.html"><a href="cleaning.html#health-and-retirement-study-hrs"><i class="fa fa-check"></i><b>2.5</b> Health and Retirement Study (HRS)</a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="cleaning.html"><a href="cleaning.html#load-data-4"><i class="fa fa-check"></i><b>2.5.1</b> Load Data</a></li>
<li class="chapter" data-level="2.5.2" data-path="cleaning.html"><a href="cleaning.html#recoding-reverse-scoring-4"><i class="fa fa-check"></i><b>2.5.2</b> Recoding &amp; Reverse Scoring</a></li>
<li class="chapter" data-level="2.5.3" data-path="cleaning.html"><a href="cleaning.html#covariates-4"><i class="fa fa-check"></i><b>2.5.3</b> Covariates</a></li>
<li class="chapter" data-level="2.5.4" data-path="cleaning.html"><a href="cleaning.html#personality-variables-4"><i class="fa fa-check"></i><b>2.5.4</b> Personality Variables</a></li>
<li class="chapter" data-level="2.5.5" data-path="cleaning.html"><a href="cleaning.html#outcome-variables-4"><i class="fa fa-check"></i><b>2.5.5</b> Outcome Variables</a></li>
<li class="chapter" data-level="2.5.6" data-path="cleaning.html"><a href="cleaning.html#combine-data-4"><i class="fa fa-check"></i><b>2.5.6</b> Combine Data</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="cleaning.html"><a href="cleaning.html#longitudinal-aging-study-amsterdam-lasa"><i class="fa fa-check"></i><b>2.6</b> Longitudinal Aging Study Amsterdam (LASA)</a>
<ul>
<li class="chapter" data-level="2.6.1" data-path="cleaning.html"><a href="cleaning.html#load-data-5"><i class="fa fa-check"></i><b>2.6.1</b> Load Data</a></li>
<li class="chapter" data-level="2.6.2" data-path="cleaning.html"><a href="cleaning.html#recoding-reverse-scoring-5"><i class="fa fa-check"></i><b>2.6.2</b> Recoding &amp; Reverse Scoring</a></li>
<li class="chapter" data-level="2.6.3" data-path="cleaning.html"><a href="cleaning.html#covariates-5"><i class="fa fa-check"></i><b>2.6.3</b> Covariates</a></li>
<li class="chapter" data-level="2.6.4" data-path="cleaning.html"><a href="cleaning.html#personality-variables-5"><i class="fa fa-check"></i><b>2.6.4</b> Personality Variables</a></li>
<li class="chapter" data-level="2.6.5" data-path="cleaning.html"><a href="cleaning.html#outcome-variables-5"><i class="fa fa-check"></i><b>2.6.5</b> Outcome Variables</a></li>
<li class="chapter" data-level="2.6.6" data-path="cleaning.html"><a href="cleaning.html#combine-data-5"><i class="fa fa-check"></i><b>2.6.6</b> Combine Data</a></li>
</ul></li>
<li class="chapter" data-level="2.7" data-path="cleaning.html"><a href="cleaning.html#map"><i class="fa fa-check"></i><b>2.7</b> MAP</a>
<ul>
<li class="chapter" data-level="2.7.1" data-path="cleaning.html"><a href="cleaning.html#load-data-6"><i class="fa fa-check"></i><b>2.7.1</b> Load Data</a></li>
<li class="chapter" data-level="2.7.2" data-path="cleaning.html"><a href="cleaning.html#recoding-reverse-scoring-6"><i class="fa fa-check"></i><b>2.7.2</b> Recoding &amp; Reverse Scoring</a></li>
<li class="chapter" data-level="2.7.3" data-path="cleaning.html"><a href="cleaning.html#covariates-6"><i class="fa fa-check"></i><b>2.7.3</b> Covariates</a></li>
<li class="chapter" data-level="2.7.4" data-path="cleaning.html"><a href="cleaning.html#personality-variables-6"><i class="fa fa-check"></i><b>2.7.4</b> Personality Variables</a></li>
<li class="chapter" data-level="2.7.5" data-path="cleaning.html"><a href="cleaning.html#outcome-variables-6"><i class="fa fa-check"></i><b>2.7.5</b> Outcome Variables</a></li>
<li class="chapter" data-level="2.7.6" data-path="cleaning.html"><a href="cleaning.html#combine-data-6"><i class="fa fa-check"></i><b>2.7.6</b> Combine Data</a></li>
</ul></li>
<li class="chapter" data-level="2.8" data-path="cleaning.html"><a href="cleaning.html#mars"><i class="fa fa-check"></i><b>2.8</b> MARS</a>
<ul>
<li class="chapter" data-level="2.8.1" data-path="cleaning.html"><a href="cleaning.html#recoding-reverse-scoring-7"><i class="fa fa-check"></i><b>2.8.1</b> Recoding &amp; Reverse Scoring</a></li>
<li class="chapter" data-level="2.8.2" data-path="cleaning.html"><a href="cleaning.html#covariates-7"><i class="fa fa-check"></i><b>2.8.2</b> Covariates</a></li>
<li class="chapter" data-level="2.8.3" data-path="cleaning.html"><a href="cleaning.html#personality-variables-7"><i class="fa fa-check"></i><b>2.8.3</b> Personality Variables</a></li>
<li class="chapter" data-level="2.8.4" data-path="cleaning.html"><a href="cleaning.html#outcome-variables-7"><i class="fa fa-check"></i><b>2.8.4</b> Outcome Variables</a></li>
<li class="chapter" data-level="2.8.5" data-path="cleaning.html"><a href="cleaning.html#combine-data-7"><i class="fa fa-check"></i><b>2.8.5</b> Combine Data</a></li>
</ul></li>
<li class="chapter" data-level="2.9" data-path="cleaning.html"><a href="cleaning.html#ros"><i class="fa fa-check"></i><b>2.9</b> ROS</a>
<ul>
<li class="chapter" data-level="2.9.1" data-path="cleaning.html"><a href="cleaning.html#load-data-7"><i class="fa fa-check"></i><b>2.9.1</b> Load Data</a></li>
<li class="chapter" data-level="2.9.2" data-path="cleaning.html"><a href="cleaning.html#recoding-reverse-scoring-8"><i class="fa fa-check"></i><b>2.9.2</b> Recoding &amp; Reverse Scoring</a></li>
<li class="chapter" data-level="2.9.3" data-path="cleaning.html"><a href="cleaning.html#covariates-8"><i class="fa fa-check"></i><b>2.9.3</b> Covariates</a></li>
<li class="chapter" data-level="2.9.4" data-path="cleaning.html"><a href="cleaning.html#personality-variables-8"><i class="fa fa-check"></i><b>2.9.4</b> Personality Variables</a></li>
<li class="chapter" data-level="2.9.5" data-path="cleaning.html"><a href="cleaning.html#outcome-variables-8"><i class="fa fa-check"></i><b>2.9.5</b> Outcome Variables</a></li>
<li class="chapter" data-level="2.9.6" data-path="cleaning.html"><a href="cleaning.html#combine-data-8"><i class="fa fa-check"></i><b>2.9.6</b> Combine Data</a></li>
</ul></li>
<li class="chapter" data-level="2.10" data-path="cleaning.html"><a href="cleaning.html#origins-of-the-variances-of-the-oldest-old-octogenarian-twins-octo-twin"><i class="fa fa-check"></i><b>2.10</b> Origins of the Variances of the Oldest-Old: Octogenarian Twins (OCTO-TWIN)</a>
<ul>
<li class="chapter" data-level="2.10.1" data-path="cleaning.html"><a href="cleaning.html#load-data-8"><i class="fa fa-check"></i><b>2.10.1</b> Load Data</a></li>
<li class="chapter" data-level="2.10.2" data-path="cleaning.html"><a href="cleaning.html#recoding-reverse-scoring-9"><i class="fa fa-check"></i><b>2.10.2</b> Recoding &amp; Reverse Scoring</a></li>
<li class="chapter" data-level="2.10.3" data-path="cleaning.html"><a href="cleaning.html#covariates-9"><i class="fa fa-check"></i><b>2.10.3</b> Covariates</a></li>
<li class="chapter" data-level="2.10.4" data-path="cleaning.html"><a href="cleaning.html#personality-variables-9"><i class="fa fa-check"></i><b>2.10.4</b> Personality Variables</a></li>
<li class="chapter" data-level="2.10.5" data-path="cleaning.html"><a href="cleaning.html#outcome-variables-9"><i class="fa fa-check"></i><b>2.10.5</b> Outcome Variables</a></li>
<li class="chapter" data-level="2.10.6" data-path="cleaning.html"><a href="cleaning.html#combine-data-9"><i class="fa fa-check"></i><b>2.10.6</b> Combine Data</a></li>
</ul></li>
<li class="chapter" data-level="2.11" data-path="cleaning.html"><a href="cleaning.html#swedish-adoption-twin-study-of-aging-satsa"><i class="fa fa-check"></i><b>2.11</b> Swedish Adoption Twin Study of Aging (SATSA)</a>
<ul>
<li class="chapter" data-level="2.11.1" data-path="cleaning.html"><a href="cleaning.html#load-data-9"><i class="fa fa-check"></i><b>2.11.1</b> Load Data</a></li>
<li class="chapter" data-level="2.11.2" data-path="cleaning.html"><a href="cleaning.html#recoding-reverse-scoring-10"><i class="fa fa-check"></i><b>2.11.2</b> Recoding &amp; Reverse Scoring</a></li>
<li class="chapter" data-level="2.11.3" data-path="cleaning.html"><a href="cleaning.html#covariates-10"><i class="fa fa-check"></i><b>2.11.3</b> Covariates</a></li>
<li class="chapter" data-level="2.11.4" data-path="cleaning.html"><a href="cleaning.html#personality-variables-10"><i class="fa fa-check"></i><b>2.11.4</b> Personality Variables</a></li>
<li class="chapter" data-level="2.11.5" data-path="cleaning.html"><a href="cleaning.html#outcome-variables-10"><i class="fa fa-check"></i><b>2.11.5</b> Outcome Variables</a></li>
<li class="chapter" data-level="2.11.6" data-path="cleaning.html"><a href="cleaning.html#combine-data-10"><i class="fa fa-check"></i><b>2.11.6</b> Combine Data</a></li>
</ul></li>
<li class="chapter" data-level="2.12" data-path="cleaning.html"><a href="cleaning.html#seattle-longitudinal-study-sls"><i class="fa fa-check"></i><b>2.12</b> Seattle Longitudinal Study (SLS)</a></li>
<li class="chapter" data-level="2.13" data-path="cleaning.html"><a href="cleaning.html#descriptives-of-all-studies"><i class="fa fa-check"></i><b>2.13</b> Descriptives of All Studies</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="runmodels.html"><a href="runmodels.html"><i class="fa fa-check"></i><b>3</b> Method 1: Pooled One Stage Models without Study-Specific Effects</a>
<ul>
<li class="chapter" data-level="3.1" data-path="runmodels.html"><a href="runmodels.html#step-1-combine-data"><i class="fa fa-check"></i><b>3.1</b> Step 1: Combine Data</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="runmodels.html"><a href="runmodels.html#study-level-moderators"><i class="fa fa-check"></i><b>3.1.1</b> Study-Level Moderators</a></li>
<li class="chapter" data-level="3.1.2" data-path="runmodels.html"><a href="runmodels.html#harmonize-data"><i class="fa fa-check"></i><b>3.1.2</b> Harmonize Data</a></li>
<li class="chapter" data-level="3.1.3" data-path="runmodels.html"><a href="runmodels.html#save-data-files"><i class="fa fa-check"></i><b>3.1.3</b> Save Data Files</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="runmodels.html"><a href="runmodels.html#step-2-run-models-and-extract-results"><i class="fa fa-check"></i><b>3.2</b> Step 2: Run Models and Extract Results</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="runmodels.html"><a href="runmodels.html#method-1a-linear-regression"><i class="fa fa-check"></i><b>3.2.1</b> Method 1A: Linear Regression</a></li>
<li class="chapter" data-level="3.2.2" data-path="runmodels.html"><a href="runmodels.html#part-1b-pooled-linear-regression-with-cluster-robust-standard-errors"><i class="fa fa-check"></i><b>3.2.2</b> Part 1B: Pooled Linear Regression with Cluster Robust Standard Errors</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="method-2-pooled-one-stage-models-with-study-specific-effects.html"><a href="method-2-pooled-one-stage-models-with-study-specific-effects.html"><i class="fa fa-check"></i><b>4</b> Method 2: Pooled One Stage Models with Study-Specific Effects</a>
<ul>
<li class="chapter" data-level="4.1" data-path="method-2-pooled-one-stage-models-with-study-specific-effects.html"><a href="method-2-pooled-one-stage-models-with-study-specific-effects.html#step-1-combine-data-1"><i class="fa fa-check"></i><b>4.1</b> Step 1: Combine Data</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="method-2-pooled-one-stage-models-with-study-specific-effects.html"><a href="method-2-pooled-one-stage-models-with-study-specific-effects.html#study-level-moderators-1"><i class="fa fa-check"></i><b>4.1.1</b> Study-Level Moderators</a></li>
<li class="chapter" data-level="4.1.2" data-path="method-2-pooled-one-stage-models-with-study-specific-effects.html"><a href="method-2-pooled-one-stage-models-with-study-specific-effects.html#harmonize-data-1"><i class="fa fa-check"></i><b>4.1.2</b> Harmonize Data</a></li>
<li class="chapter" data-level="4.1.3" data-path="method-2-pooled-one-stage-models-with-study-specific-effects.html"><a href="method-2-pooled-one-stage-models-with-study-specific-effects.html#save-data-files-1"><i class="fa fa-check"></i><b>4.1.3</b> Save Data Files</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="method-2-pooled-one-stage-models-with-study-specific-effects.html"><a href="method-2-pooled-one-stage-models-with-study-specific-effects.html#step-2-run-models-and-extract-results-1"><i class="fa fa-check"></i><b>4.2</b> Step 2: Run Models and Extract Results</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="method-2-pooled-one-stage-models-with-study-specific-effects.html"><a href="method-2-pooled-one-stage-models-with-study-specific-effects.html#method-2a-pooled-one-stage-models-with-dummy-codes"><i class="fa fa-check"></i><b>4.2.1</b> Method 2A: Pooled One Stage Models with Dummy Codes</a></li>
<li class="chapter" data-level="4.2.2" data-path="method-2-pooled-one-stage-models-with-study-specific-effects.html"><a href="method-2-pooled-one-stage-models-with-study-specific-effects.html#method-2b-pooled-one-stage-models-with-random-effects"><i class="fa fa-check"></i><b>4.2.2</b> Method 2B: Pooled One Stage Models with Random Effects</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="method-3-two-stage-individual-participant-meta-analysis.html"><a href="method-3-two-stage-individual-participant-meta-analysis.html"><i class="fa fa-check"></i><b>5</b> Method 3: Two-Stage Individual Participant Meta-Analysis</a>
<ul>
<li class="chapter" data-level="5.1" data-path="method-3-two-stage-individual-participant-meta-analysis.html"><a href="method-3-two-stage-individual-participant-meta-analysis.html#analytic-plan-4"><i class="fa fa-check"></i><b>5.1</b> Analytic Plan</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="method-3-two-stage-individual-participant-meta-analysis.html"><a href="method-3-two-stage-individual-participant-meta-analysis.html#sample-specific-statistical-modeling"><i class="fa fa-check"></i><b>5.1.1</b> 1. Sample-Specific Statistical Modeling</a></li>
<li class="chapter" data-level="5.1.2" data-path="method-3-two-stage-individual-participant-meta-analysis.html"><a href="method-3-two-stage-individual-participant-meta-analysis.html#results-pooling-using-meta-analysis"><i class="fa fa-check"></i><b>5.1.2</b> 2. Results Pooling Using Meta-Analysis</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="method-3-two-stage-individual-participant-meta-analysis.html"><a href="method-3-two-stage-individual-participant-meta-analysis.html#step-1-combine-data-2"><i class="fa fa-check"></i><b>5.2</b> Step 1: Combine Data</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="method-3-two-stage-individual-participant-meta-analysis.html"><a href="method-3-two-stage-individual-participant-meta-analysis.html#study-level-moderators-2"><i class="fa fa-check"></i><b>5.2.1</b> Study-Level Moderators</a></li>
<li class="chapter" data-level="5.2.2" data-path="method-3-two-stage-individual-participant-meta-analysis.html"><a href="method-3-two-stage-individual-participant-meta-analysis.html#harmonize-data-2"><i class="fa fa-check"></i><b>5.2.2</b> Harmonize Data</a></li>
<li class="chapter" data-level="5.2.3" data-path="method-3-two-stage-individual-participant-meta-analysis.html"><a href="method-3-two-stage-individual-participant-meta-analysis.html#save-data-files-2"><i class="fa fa-check"></i><b>5.2.3</b> Save Data Files</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="method-3-two-stage-individual-participant-meta-analysis.html"><a href="method-3-two-stage-individual-participant-meta-analysis.html#step-2-run-models-for-each-study"><i class="fa fa-check"></i><b>5.3</b> Step 2: Run Models for Each Study</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="method-3-two-stage-individual-participant-meta-analysis.html"><a href="method-3-two-stage-individual-participant-meta-analysis.html#functions"><i class="fa fa-check"></i><b>5.3.1</b> Functions</a></li>
<li class="chapter" data-level="5.3.2" data-path="method-3-two-stage-individual-participant-meta-analysis.html"><a href="method-3-two-stage-individual-participant-meta-analysis.html#run-models"><i class="fa fa-check"></i><b>5.3.2</b> Run Models</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="method-3-two-stage-individual-participant-meta-analysis.html"><a href="method-3-two-stage-individual-participant-meta-analysis.html#step-3-meta-analyze-results"><i class="fa fa-check"></i><b>5.4</b> Step 3: Meta-Analyze Results</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="method-3-two-stage-individual-participant-meta-analysis.html"><a href="method-3-two-stage-individual-participant-meta-analysis.html#functions-1"><i class="fa fa-check"></i><b>5.4.1</b> Functions</a></li>
<li class="chapter" data-level="5.4.2" data-path="method-3-two-stage-individual-participant-meta-analysis.html"><a href="method-3-two-stage-individual-participant-meta-analysis.html#run-meta-analysis-and-meta-regression-models"><i class="fa fa-check"></i><b>5.4.2</b> Run Meta-Analysis and Meta-Regression Models</a></li>
<li class="chapter" data-level="5.4.3" data-path="method-3-two-stage-individual-participant-meta-analysis.html"><a href="method-3-two-stage-individual-participant-meta-analysis.html#compile-results-4"><i class="fa fa-check"></i><b>5.4.3</b> Compile Results</a></li>
<li class="chapter" data-level="5.4.4" data-path="method-3-two-stage-individual-participant-meta-analysis.html"><a href="method-3-two-stage-individual-participant-meta-analysis.html#figures-4"><i class="fa fa-check"></i><b>5.4.4</b> Figures</a></li>
<li class="chapter" data-level="5.4.5" data-path="method-3-two-stage-individual-participant-meta-analysis.html"><a href="method-3-two-stage-individual-participant-meta-analysis.html#table-meta-analytic-heterogeneity"><i class="fa fa-check"></i><b>5.4.5</b> Table Meta-Analytic Heterogeneity</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="method-3-two-stage-individual-participant-meta-analysis.html"><a href="method-3-two-stage-individual-participant-meta-analysis.html#sample-results-section-4"><i class="fa fa-check"></i><b>5.5</b> Sample Results Section</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="method-3-one-stage-individual-participant-analyses-reported-together.html"><a href="method-3-one-stage-individual-participant-analyses-reported-together.html"><i class="fa fa-check"></i><b>6</b> Method 3: One-Stage Individual Participant Analyses Reported Together</a>
<ul>
<li class="chapter" data-level="6.1" data-path="method-3-one-stage-individual-participant-analyses-reported-together.html"><a href="method-3-one-stage-individual-participant-analyses-reported-together.html#analytic-plan-5"><i class="fa fa-check"></i><b>6.1</b> Analytic Plan</a></li>
<li class="chapter" data-level="6.2" data-path="method-3-one-stage-individual-participant-analyses-reported-together.html"><a href="method-3-one-stage-individual-participant-analyses-reported-together.html#step-1-combine-data-3"><i class="fa fa-check"></i><b>6.2</b> Step 1: Combine Data</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="method-3-one-stage-individual-participant-analyses-reported-together.html"><a href="method-3-one-stage-individual-participant-analyses-reported-together.html#harmonize-data-3"><i class="fa fa-check"></i><b>6.2.1</b> Harmonize Data</a></li>
<li class="chapter" data-level="6.2.2" data-path="method-3-one-stage-individual-participant-analyses-reported-together.html"><a href="method-3-one-stage-individual-participant-analyses-reported-together.html#save-data-files-3"><i class="fa fa-check"></i><b>6.2.2</b> Save Data Files</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="method-3-one-stage-individual-participant-analyses-reported-together.html"><a href="method-3-one-stage-individual-participant-analyses-reported-together.html#step-2-run-models-for-each-study-1"><i class="fa fa-check"></i><b>6.3</b> Step 2: Run Models for Each Study</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="method-3-one-stage-individual-participant-analyses-reported-together.html"><a href="method-3-one-stage-individual-participant-analyses-reported-together.html#functions-2"><i class="fa fa-check"></i><b>6.3.1</b> Functions</a></li>
<li class="chapter" data-level="6.3.2" data-path="method-3-one-stage-individual-participant-analyses-reported-together.html"><a href="method-3-one-stage-individual-participant-analyses-reported-together.html#run-models-1"><i class="fa fa-check"></i><b>6.3.2</b> Run Models</a></li>
<li class="chapter" data-level="6.3.3" data-path="method-3-one-stage-individual-participant-analyses-reported-together.html"><a href="method-3-one-stage-individual-participant-analyses-reported-together.html#compile-results-5"><i class="fa fa-check"></i><b>6.3.3</b> Compile Results</a></li>
<li class="chapter" data-level="6.3.4" data-path="method-3-one-stage-individual-participant-analyses-reported-together.html"><a href="method-3-one-stage-individual-participant-analyses-reported-together.html#figures-5"><i class="fa fa-check"></i><b>6.3.4</b> Figures</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="method-3-one-stage-individual-participant-analyses-reported-together.html"><a href="method-3-one-stage-individual-participant-analyses-reported-together.html#sample-results-section-5"><i class="fa fa-check"></i><b>6.4</b> Sample Results Section</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="method-3-one-stage-individual-participant-analyses-reported-together-1.html"><a href="method-3-one-stage-individual-participant-analyses-reported-together-1.html"><i class="fa fa-check"></i><b>7</b> Method 3: One-Stage Individual Participant Analyses Reported Together</a>
<ul>
<li class="chapter" data-level="7.1" data-path="method-3-one-stage-individual-participant-analyses-reported-together-1.html"><a href="method-3-one-stage-individual-participant-analyses-reported-together-1.html#comparisons-across-the-taxonomy"><i class="fa fa-check"></i><b>7.1</b> Comparisons Across the Taxonomy</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="method-3-one-stage-individual-participant-analyses-reported-together-1.html"><a href="method-3-one-stage-individual-participant-analyses-reported-together-1.html#tables-6"><i class="fa fa-check"></i><b>7.1.1</b> Tables</a></li>
<li class="chapter" data-level="7.1.2" data-path="method-3-one-stage-individual-participant-analyses-reported-together-1.html"><a href="method-3-one-stage-individual-participant-analyses-reported-together-1.html#figures-6"><i class="fa fa-check"></i><b>7.1.2</b> Figures</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="method-3-one-stage-individual-participant-analyses-reported-together-1.html"><a href="method-3-one-stage-individual-participant-analyses-reported-together-1.html#comparisons-across-methods-bayesian-versus-frequentist"><i class="fa fa-check"></i><b>7.2</b> Comparisons Across Methods: Bayesian versus Frequentist</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="method-3-one-stage-individual-participant-analyses-reported-together-1.html"><a href="method-3-one-stage-individual-participant-analyses-reported-together-1.html#tables-7"><i class="fa fa-check"></i><b>7.2.1</b> Tables</a></li>
<li class="chapter" data-level="7.2.2" data-path="method-3-one-stage-individual-participant-analyses-reported-together-1.html"><a href="method-3-one-stage-individual-participant-analyses-reported-together-1.html#figures-7"><i class="fa fa-check"></i><b>7.2.2</b> Figures</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">A Taxonomy of Data Synthesis: A Tutorial</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="cleaning" class="section level1 hasAnchor" number="2">
<h1><span class="header-section-number">Chapter 2</span> Data Cleaning<a href="cleaning.html#cleaning" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="cleaning.html#cb17-1" tabindex="-1"></a>Mode <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb17-2"><a href="cleaning.html#cb17-2" tabindex="-1"></a>  ux <span class="ot">&lt;-</span> <span class="fu">unique</span>(x)</span>
<span id="cb17-3"><a href="cleaning.html#cb17-3" tabindex="-1"></a>  ux <span class="ot">&lt;-</span> ux[<span class="sc">!</span><span class="fu">is.na</span>(ux)]</span>
<span id="cb17-4"><a href="cleaning.html#cb17-4" tabindex="-1"></a>  ux[<span class="fu">which.max</span>(<span class="fu">tabulate</span>(<span class="fu">match</span>(x, ux)))]</span>
<span id="cb17-5"><a href="cleaning.html#cb17-5" tabindex="-1"></a>}</span></code></pre></div>
<p>The data preparation procedure across samples and methods was nearly identical, with the exception of whether data were pooled across samples (Methods 1A-2B) or kept separate (Methods 3 and 4). First, before preregistration, data preparation began by cataloging the available data in each sample in a comprehensive codebook, with the goal of compiling all of the information necessary for harmonizing across samples. For each sample, we compiled information on (1) the original variable name in the raw data, (2) the question text, (3) the scale (e.g., numeric, Likert-like scale points, labels for nominal variables), and (4) the available waves or years for each of the target variables. We also included information (5) categorizing the variable (e.g., personality, outcome), (6) a higher order variable name construct (e.g., Agreeableness, crystallized cognitive ability) that matched across samples, (7) a lower order variable name that indexed unique items (e.g., friendly, WAIS Information), (8) a note on whether an item was reverse scored along with its (9) minimum and (10) maximum, (11) a string of R code for recoding scales (e.g., recoding missing values as NA, changing levels of nominal variables to harmonize across samples), and two rules for how composites were to be created, either (12) within a wave (e.g., compositing a personality or cognitive scale) or (13) longitudinally across them (e.g., for covariates to index participants’ highest level of education prior to baseline).</p>
<p>Second, once the codebook was created and all the data were received, the codebook and data files were sequentially loaded into R, and data were renamed, reverse-scored, and rescaled as documented in the codebook. Then, for each of the categories of data (covariates, personality, and cognitive ability), data were composited as documented in Table 2. Finally, these three sources of data were combined into a single data set within each sample separately. The full data cleaning procedure can be seen in Chapter 1 (Data Cleaning) in the online materials.</p>
<p>Third, data from each sample was combined into a single data set with harmonized labels and scales for Methods 1 (A and B) and 2 (A and B). For methods that include sample-level moderators (Methods 1A, 2B, and 3), this also includes combining the personality, cognitive, and covariate data with sample-level data. In Methods 1A and 2B, this happens in the initial step, while in Method 3, these are added after estimating the models for each sample separately (see online materials).</p>
<p>Fourth, we harmonized the continuous personality and cognitive ability measures using POMP scoring (range 0-10). Continuous variables with easily harmonized scales (i.e. age and years of education) were centered, with age centered at 60 and education centered at 12 years. Nominal variables were harmonized during the earlier data cleaning steps such that 0 = “male” and 1 = “female” for gender.</p>
<div id="berlin-aging-study-base-i" class="section level2 hasAnchor" number="2.1">
<h2><span class="header-section-number">2.1</span> Berlin Aging Study (BASE-I)<a href="cleaning.html#berlin-aging-study-base-i" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The Berlin Aging Study (I) is a longitudinal interdisciplinary study of aging that began in 1990. The data are available, by application, from <a href="https://www.base-berlin.mpg.de/en/system/files/media/pdf/a97295f241d06bf496b5eeae4251a34e/base-data-transfer_form_online.pdf" class="uri">https://www.base-berlin.mpg.de/en/system/files/media/pdf/a97295f241d06bf496b5eeae4251a34e/base-data-transfer_form_online.pdf</a>.</p>
<p>Participants included 516 individuals over 70, stratified on age and gender, recruited from a sample of the Berlin City Registry. To date, most participants are deceased, with most attrition from the study due to mortality or severe health complications. Since 1990, there have been seven follow-up measurement occasions (8 total).</p>
<p>Sample sizes vary over time, from 516 (T1) to 23 (T8). To ensure adequate sample sizes, the present study will use data up to the fourth wave, which included 164 participants with full data. This provides 99% power to detect a correlation effect size of ~.32, two-tailed alpha at .05.</p>
<div id="load-data" class="section level3 hasAnchor" number="2.1.1">
<h3><span class="header-section-number">2.1.1</span> Load Data<a href="cleaning.html#load-data" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="cleaning.html#cb18-1" tabindex="-1"></a>(basei_codebook <span class="ot">&lt;-</span> (codebook <span class="sc">%&gt;%</span> <span class="fu">filter</span>(study <span class="sc">==</span> <span class="st">&quot;BASE-I&quot;</span>))<span class="sc">$</span>codebook[[<span class="dv">1</span>]] <span class="sc">%&gt;%</span></span>
<span id="cb18-2"><a href="cleaning.html#cb18-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">orig_itemname =</span> <span class="fu">str_to_lower</span>(orig_itemname)))</span></code></pre></div>
<pre><code>## # A tibble: 138 × 17
##    study  dataset   category name  itemname  wave  year stem  orig_itemname description scale reverse_code recode  mini  maxi
##    &lt;chr&gt;  &lt;chr&gt;     &lt;chr&gt;    &lt;chr&gt; &lt;chr&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;         &lt;chr&gt;       &lt;chr&gt; &lt;chr&gt;        &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt;
##  1 base-i social    covaria… educ… eduYears     1  1990 &lt;NA&gt;  s1kon28       Years of E… &quot;int… &lt;NA&gt;         ifels…    NA    NA
##  2 base-i social    covaria… educ… eduYears     1  1990 &lt;NA&gt;  z1e10         General ed… &quot;1 =… &lt;NA&gt;         ifels…    NA    NA
##  3 base-i demograp… covaria… gend… sex          1  1990 esex  z1esex        Sex of par…  &lt;NA&gt; &lt;NA&gt;         ifels…    NA    NA
##  4 base-i demograp… covaria… gend… sex          2  1993 esex  z2esex        Sex of par…  &lt;NA&gt; &lt;NA&gt;         ifels…    NA    NA
##  5 base-i demograp… covaria… gend… sex          3  1995 esex  z3esex        Sex of par…  &lt;NA&gt; &lt;NA&gt;         ifels…    NA    NA
##  6 base-i demograp… covaria… gend… sex          4  1997 esex  z4esex        Sex of par…  &lt;NA&gt; &lt;NA&gt;         ifels…    NA    NA
##  7 base-i demograp… covaria… gend… sex          5  2000 esex  z5esex        Sex of par…  &lt;NA&gt; &lt;NA&gt;         ifels…    NA    NA
##  8 base-i demograp… covaria… gend… sex          6  2004 esex  z6esex        Sex of par…  &lt;NA&gt; &lt;NA&gt;         ifels…    NA    NA
##  9 base-i demograp… covaria… gend… sex          7  2005 esex  z7esex        Sex of par…  &lt;NA&gt; &lt;NA&gt;         ifels…    NA    NA
## 10 base-i demograp… covaria… SRhe… SRhealth     1  1990 E13X… z1e13x1r      How would … &quot;1 =… yes          ifels…     1     5
## # ℹ 128 more rows
## # ℹ 2 more variables: comp_rule &lt;chr&gt;, long_rule &lt;chr&gt;</code></pre>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="cleaning.html#cb20-1" tabindex="-1"></a>basei <span class="ot">&lt;-</span> <span class="fu">sprintf</span>(<span class="st">&quot;%s/base-i/Beck_202010.sav&quot;</span>, data_path) <span class="sc">%&gt;%</span> <span class="fu">read_sav</span>() <span class="sc">%&gt;%</span></span>
<span id="cb20-2"><a href="cleaning.html#cb20-2" tabindex="-1"></a>  <span class="fu">full_join</span>(<span class="fu">sprintf</span>(<span class="st">&quot;%s/base-i/Beck_202010_2.sav&quot;</span>, data_path) <span class="sc">%&gt;%</span> <span class="fu">read_sav</span>())</span></code></pre></div>
</div>
<div id="recoding-reverse-scoring" class="section level3 hasAnchor" number="2.1.2">
<h3><span class="header-section-number">2.1.2</span> Recoding &amp; Reverse Scoring<a href="cleaning.html#recoding-reverse-scoring" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="cleaning.html#cb21-1" tabindex="-1"></a>rename_fun <span class="ot">&lt;-</span> <span class="cf">function</span>(cb, var){</span>
<span id="cb21-2"><a href="cleaning.html#cb21-2" tabindex="-1"></a>  old.names <span class="ot">&lt;-</span> <span class="fu">unique</span>((basei_codebook <span class="sc">%&gt;%</span> <span class="fu">filter</span>(name <span class="sc">==</span> var))<span class="sc">$</span>orig_itemname)</span>
<span id="cb21-3"><a href="cleaning.html#cb21-3" tabindex="-1"></a>  df <span class="ot">&lt;-</span> basei <span class="sc">%&gt;%</span> </span>
<span id="cb21-4"><a href="cleaning.html#cb21-4" tabindex="-1"></a>    <span class="fu">select</span>(<span class="at">SID =</span> id, <span class="fu">one_of</span>(old.names)) <span class="sc">%&gt;%</span></span>
<span id="cb21-5"><a href="cleaning.html#cb21-5" tabindex="-1"></a>    <span class="fu">gather</span>(<span class="at">key =</span> orig_itemname, <span class="at">value =</span> value, <span class="sc">-</span>SID, <span class="at">na.rm=</span>T)</span>
<span id="cb21-6"><a href="cleaning.html#cb21-6" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">length</span>(old.names) <span class="sc">&gt;</span> <span class="dv">1</span>){</span>
<span id="cb21-7"><a href="cleaning.html#cb21-7" tabindex="-1"></a>      df <span class="sc">%&gt;%</span> <span class="fu">left_join</span>(cb <span class="sc">%&gt;%</span> <span class="fu">select</span>(itemname, wave, orig_itemname, reverse_code<span class="sc">:</span>long_rule))</span>
<span id="cb21-8"><a href="cleaning.html#cb21-8" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb21-9"><a href="cleaning.html#cb21-9" tabindex="-1"></a>    df <span class="sc">%&gt;%</span> <span class="fu">left_join</span>(cb <span class="sc">%&gt;%</span> <span class="fu">select</span>(itemname, orig_itemname, reverse_code<span class="sc">:</span>long_rule) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>()) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">wave =</span> <span class="st">&quot;0&quot;</span>)</span>
<span id="cb21-10"><a href="cleaning.html#cb21-10" tabindex="-1"></a>  }</span>
<span id="cb21-11"><a href="cleaning.html#cb21-11" tabindex="-1"></a>}</span>
<span id="cb21-12"><a href="cleaning.html#cb21-12" tabindex="-1"></a></span>
<span id="cb21-13"><a href="cleaning.html#cb21-13" tabindex="-1"></a><span class="st">`</span></span>
<span id="cb21-14"><a href="cleaning.html#cb21-14" tabindex="-1"></a><span class="at"># join data with recoding info </span></span>
<span id="cb21-15"><a href="cleaning.html#cb21-15" tabindex="-1"></a><span class="at">basei_recode &lt;- basei_codebook %&gt;%</span></span>
<span id="cb21-16"><a href="cleaning.html#cb21-16" tabindex="-1"></a><span class="at">  select(category, name, itemname, wave, orig_itemname, reverse_code:long_rule) %&gt;%</span></span>
<span id="cb21-17"><a href="cleaning.html#cb21-17" tabindex="-1"></a><span class="at">  filter(category %in% c(&quot;pers&quot;, &quot;outcome&quot;, &quot;covariates&quot;)) %&gt;%</span></span>
<span id="cb21-18"><a href="cleaning.html#cb21-18" tabindex="-1"></a><span class="at">  group_by(category, name) %&gt;%</span></span>
<span id="cb21-19"><a href="cleaning.html#cb21-19" tabindex="-1"></a><span class="at">  nest() %&gt;% </span></span>
<span id="cb21-20"><a href="cleaning.html#cb21-20" tabindex="-1"></a><span class="at">  ungroup() %&gt;%</span></span>
<span id="cb21-21"><a href="cleaning.html#cb21-21" tabindex="-1"></a><span class="at">  mutate(data = map2(data, name, rename_fun))</span></span>
<span id="cb21-22"><a href="cleaning.html#cb21-22" tabindex="-1"></a></span>
<span id="cb21-23"><a href="cleaning.html#cb21-23" tabindex="-1"></a><span class="at"># recode </span></span>
<span id="cb21-24"><a href="cleaning.html#cb21-24" tabindex="-1"></a><span class="at">recode_fun &lt;- function(rule, y, year){</span></span>
<span id="cb21-25"><a href="cleaning.html#cb21-25" tabindex="-1"></a><span class="at">  x &lt;- y$value</span></span>
<span id="cb21-26"><a href="cleaning.html#cb21-26" tabindex="-1"></a><span class="at">  if(!is.na(rule)){y$value &lt;- eval(parse(text = rule))}</span></span>
<span id="cb21-27"><a href="cleaning.html#cb21-27" tabindex="-1"></a><span class="at">  return(y)</span></span>
<span id="cb21-28"><a href="cleaning.html#cb21-28" tabindex="-1"></a><span class="at">}</span></span>
<span id="cb21-29"><a href="cleaning.html#cb21-29" tabindex="-1"></a></span>
<span id="cb21-30"><a href="cleaning.html#cb21-30" tabindex="-1"></a><span class="at">basei_recode &lt;- basei_recode %&gt;% </span></span>
<span id="cb21-31"><a href="cleaning.html#cb21-31" tabindex="-1"></a><span class="at">  mutate(data = map(data, ~(.) %&gt;% </span></span>
<span id="cb21-32"><a href="cleaning.html#cb21-32" tabindex="-1"></a><span class="at">    mutate(wave = as.numeric(wave)) %&gt;%</span></span>
<span id="cb21-33"><a href="cleaning.html#cb21-33" tabindex="-1"></a><span class="at">    group_by(recode, wave) %&gt;%</span></span>
<span id="cb21-34"><a href="cleaning.html#cb21-34" tabindex="-1"></a><span class="at">    nest() %&gt;%</span></span>
<span id="cb21-35"><a href="cleaning.html#cb21-35" tabindex="-1"></a><span class="at">    ungroup() %&gt;%</span></span>
<span id="cb21-36"><a href="cleaning.html#cb21-36" tabindex="-1"></a><span class="at">    mutate(data = pmap(list(recode, data, wave), recode_fun)) %&gt;%</span></span>
<span id="cb21-37"><a href="cleaning.html#cb21-37" tabindex="-1"></a><span class="at">    unnest(data) %&gt;%</span></span>
<span id="cb21-38"><a href="cleaning.html#cb21-38" tabindex="-1"></a><span class="at">    mutate(value = ifelse(value &lt; 0 | is.nan(value) | is.infinite(value), NA, value))))</span></span>
<span id="cb21-39"><a href="cleaning.html#cb21-39" tabindex="-1"></a></span>
<span id="cb21-40"><a href="cleaning.html#cb21-40" tabindex="-1"></a></span>
<span id="cb21-41"><a href="cleaning.html#cb21-41" tabindex="-1"></a><span class="at"># reverse code </span></span>
<span id="cb21-42"><a href="cleaning.html#cb21-42" tabindex="-1"></a><span class="at">basei_recode &lt;- basei_recode %&gt;%</span></span>
<span id="cb21-43"><a href="cleaning.html#cb21-43" tabindex="-1"></a><span class="at">  mutate(data = map(data, ~(.) %&gt;%</span></span>
<span id="cb21-44"><a href="cleaning.html#cb21-44" tabindex="-1"></a><span class="at">    mutate(value = ifelse(reverse_code == &quot;no&quot; | is.na(reverse_code), value, </span></span>
<span id="cb21-45"><a href="cleaning.html#cb21-45" tabindex="-1"></a><span class="at">                        reverse.code(-1, value, mini = mini, maxi = maxi)))))</span></span>
<span id="cb21-46"><a href="cleaning.html#cb21-46" tabindex="-1"></a></span>
<span id="cb21-47"><a href="cleaning.html#cb21-47" tabindex="-1"></a><span class="at">fun_call &lt;- function(x, rule){</span></span>
<span id="cb21-48"><a href="cleaning.html#cb21-48" tabindex="-1"></a><span class="at">    switch(rule,</span></span>
<span id="cb21-49"><a href="cleaning.html#cb21-49" tabindex="-1"></a><span class="at">           average = mean(x, na.rm = T),</span></span>
<span id="cb21-50"><a href="cleaning.html#cb21-50" tabindex="-1"></a><span class="at">           mode = Mode(x)[1],</span></span>
<span id="cb21-51"><a href="cleaning.html#cb21-51" tabindex="-1"></a><span class="at">           sum = sum(x, na.rm = T),</span></span>
<span id="cb21-52"><a href="cleaning.html#cb21-52" tabindex="-1"></a><span class="at">           skip = unique(x)[1],</span></span>
<span id="cb21-53"><a href="cleaning.html#cb21-53" tabindex="-1"></a><span class="at">           select = unique(x)[1],</span></span>
<span id="cb21-54"><a href="cleaning.html#cb21-54" tabindex="-1"></a><span class="at">           max = max(x, na.rm = T),</span></span>
<span id="cb21-55"><a href="cleaning.html#cb21-55" tabindex="-1"></a><span class="at">           min = min(x, na.rm = T))</span></span>
<span id="cb21-56"><a href="cleaning.html#cb21-56" tabindex="-1"></a><span class="at">}</span></span></code></pre></div>
</div>
<div id="covariates" class="section level3 hasAnchor" number="2.1.3">
<h3><span class="header-section-number">2.1.3</span> Covariates<a href="cleaning.html#covariates" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="cleaning.html#cb22-1" tabindex="-1"></a><span class="co"># composite WITHIN years </span></span>
<span id="cb22-2"><a href="cleaning.html#cb22-2" tabindex="-1"></a>basei_cov <span class="ot">&lt;-</span> basei_recode <span class="sc">%&gt;%</span></span>
<span id="cb22-3"><a href="cleaning.html#cb22-3" tabindex="-1"></a>  <span class="fu">filter</span>(category <span class="sc">==</span> <span class="st">&quot;covariates&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb22-4"><a href="cleaning.html#cb22-4" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>category) <span class="sc">%&gt;%</span></span>
<span id="cb22-5"><a href="cleaning.html#cb22-5" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">map</span>(data, <span class="sc">~</span>(.) <span class="sc">%&gt;%</span> </span>
<span id="cb22-6"><a href="cleaning.html#cb22-6" tabindex="-1"></a>      <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(value)) <span class="sc">%&gt;%</span></span>
<span id="cb22-7"><a href="cleaning.html#cb22-7" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">comp_rule =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(comp_rule), <span class="st">&quot;skip&quot;</span>, comp_rule)) <span class="sc">%&gt;%</span></span>
<span id="cb22-8"><a href="cleaning.html#cb22-8" tabindex="-1"></a>      <span class="fu">group_by</span>(comp_rule, SID, wave, long_rule) <span class="sc">%&gt;%</span></span>
<span id="cb22-9"><a href="cleaning.html#cb22-9" tabindex="-1"></a>      <span class="fu">nest</span>() <span class="sc">%&gt;%</span></span>
<span id="cb22-10"><a href="cleaning.html#cb22-10" tabindex="-1"></a>      <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb22-11"><a href="cleaning.html#cb22-11" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">map2</span>(data, comp_rule, <span class="sc">~</span><span class="fu">fun_call</span>((.x)<span class="sc">$</span>value, .y))) <span class="sc">%&gt;%</span></span>
<span id="cb22-12"><a href="cleaning.html#cb22-12" tabindex="-1"></a>      <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb22-13"><a href="cleaning.html#cb22-13" tabindex="-1"></a>      <span class="fu">filter</span>(wave <span class="sc">&lt;=</span> <span class="dv">1</span>)</span>
<span id="cb22-14"><a href="cleaning.html#cb22-14" tabindex="-1"></a>      ))</span>
<span id="cb22-15"><a href="cleaning.html#cb22-15" tabindex="-1"></a></span>
<span id="cb22-16"><a href="cleaning.html#cb22-16" tabindex="-1"></a>comp_fun <span class="ot">&lt;-</span> <span class="cf">function</span>(d, rule){</span>
<span id="cb22-17"><a href="cleaning.html#cb22-17" tabindex="-1"></a>  d <span class="sc">%&gt;%</span></span>
<span id="cb22-18"><a href="cleaning.html#cb22-18" tabindex="-1"></a>    <span class="fu">group_by</span>(SID, name) <span class="sc">%&gt;%</span></span>
<span id="cb22-19"><a href="cleaning.html#cb22-19" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">value =</span> <span class="fu">fun_call</span>(data, rule)) <span class="sc">%&gt;%</span></span>
<span id="cb22-20"><a href="cleaning.html#cb22-20" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb22-21"><a href="cleaning.html#cb22-21" tabindex="-1"></a>    <span class="fu">distinct</span>()</span>
<span id="cb22-22"><a href="cleaning.html#cb22-22" tabindex="-1"></a>}</span>
<span id="cb22-23"><a href="cleaning.html#cb22-23" tabindex="-1"></a></span>
<span id="cb22-24"><a href="cleaning.html#cb22-24" tabindex="-1"></a><span class="co"># composite ACROSS years</span></span>
<span id="cb22-25"><a href="cleaning.html#cb22-25" tabindex="-1"></a>basei_cov <span class="ot">&lt;-</span> basei_cov <span class="sc">%&gt;%</span></span>
<span id="cb22-26"><a href="cleaning.html#cb22-26" tabindex="-1"></a>  <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb22-27"><a href="cleaning.html#cb22-27" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">long_rule =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(long_rule), <span class="st">&quot;skip&quot;</span>, long_rule)) <span class="sc">%&gt;%</span></span>
<span id="cb22-28"><a href="cleaning.html#cb22-28" tabindex="-1"></a>  <span class="fu">group_by</span>(long_rule) <span class="sc">%&gt;%</span></span>
<span id="cb22-29"><a href="cleaning.html#cb22-29" tabindex="-1"></a>  <span class="fu">nest</span>() <span class="sc">%&gt;%</span></span>
<span id="cb22-30"><a href="cleaning.html#cb22-30" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb22-31"><a href="cleaning.html#cb22-31" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">pmap</span>(<span class="fu">list</span>(data, long_rule), comp_fun)) <span class="sc">%&gt;%</span></span>
<span id="cb22-32"><a href="cleaning.html#cb22-32" tabindex="-1"></a>  <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb22-33"><a href="cleaning.html#cb22-33" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">ifelse</span>(<span class="fu">is.infinite</span>(value) <span class="sc">|</span> <span class="fu">is.nan</span>(value), <span class="cn">NA</span>, value)) <span class="sc">%&gt;%</span></span>
<span id="cb22-34"><a href="cleaning.html#cb22-34" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>long_rule) <span class="sc">%&gt;%</span></span>
<span id="cb22-35"><a href="cleaning.html#cb22-35" tabindex="-1"></a>  <span class="fu">spread</span>(name, value) <span class="sc">%&gt;%</span></span>
<span id="cb22-36"><a href="cleaning.html#cb22-36" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(SID))</span></code></pre></div>
</div>
<div id="personality-variables" class="section level3 hasAnchor" number="2.1.4">
<h3><span class="header-section-number">2.1.4</span> Personality Variables<a href="cleaning.html#personality-variables" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="cleaning.html#cb23-1" tabindex="-1"></a>basei_pers <span class="ot">&lt;-</span> basei_recode <span class="sc">%&gt;%</span></span>
<span id="cb23-2"><a href="cleaning.html#cb23-2" tabindex="-1"></a>  <span class="fu">filter</span>(category <span class="sc">==</span> <span class="st">&quot;pers&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb23-3"><a href="cleaning.html#cb23-3" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>category) <span class="sc">%&gt;%</span> </span>
<span id="cb23-4"><a href="cleaning.html#cb23-4" tabindex="-1"></a>  <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb23-5"><a href="cleaning.html#cb23-5" tabindex="-1"></a>  <span class="fu">filter</span>(wave <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(value)) <span class="sc">%&gt;%</span></span>
<span id="cb23-6"><a href="cleaning.html#cb23-6" tabindex="-1"></a>  <span class="fu">group_by</span>(SID, wave, name, itemname, comp_rule) <span class="sc">%&gt;%</span></span>
<span id="cb23-7"><a href="cleaning.html#cb23-7" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">value =</span> <span class="fu">mean</span>(value, <span class="at">na.rm =</span> T)) <span class="sc">%&gt;%</span></span>
<span id="cb23-8"><a href="cleaning.html#cb23-8" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb23-9"><a href="cleaning.html#cb23-9" tabindex="-1"></a></span>
<span id="cb23-10"><a href="cleaning.html#cb23-10" tabindex="-1"></a><span class="co"># alpha&#39;s</span></span>
<span id="cb23-11"><a href="cleaning.html#cb23-11" tabindex="-1"></a>basei_alpha <span class="ot">&lt;-</span> basei_pers <span class="sc">%&gt;%</span></span>
<span id="cb23-12"><a href="cleaning.html#cb23-12" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(value)) <span class="sc">%&gt;%</span></span>
<span id="cb23-13"><a href="cleaning.html#cb23-13" tabindex="-1"></a>  <span class="fu">select</span>(name, itemname, wave, SID, value) <span class="sc">%&gt;%</span></span>
<span id="cb23-14"><a href="cleaning.html#cb23-14" tabindex="-1"></a>  <span class="fu">group_by</span>(name, wave) <span class="sc">%&gt;%</span></span>
<span id="cb23-15"><a href="cleaning.html#cb23-15" tabindex="-1"></a>  <span class="fu">nest</span>() <span class="sc">%&gt;%</span></span>
<span id="cb23-16"><a href="cleaning.html#cb23-16" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">map</span>(data, <span class="sc">~</span>(.) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>() <span class="sc">%&gt;%</span> <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> itemname, <span class="at">values_from =</span> value, <span class="at">values_fn =</span> <span class="fu">list</span>(mean))),</span>
<span id="cb23-17"><a href="cleaning.html#cb23-17" tabindex="-1"></a>         <span class="at">alpha =</span> <span class="fu">map</span>(data, <span class="fu">possibly</span>(<span class="sc">~</span>psych<span class="sc">::</span><span class="fu">alpha</span>((.) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>SID), <span class="at">check.keys =</span> T), <span class="cn">NA_real_</span>)))</span>
<span id="cb23-18"><a href="cleaning.html#cb23-18" tabindex="-1"></a></span>
<span id="cb23-19"><a href="cleaning.html#cb23-19" tabindex="-1"></a>comp_fun <span class="ot">&lt;-</span> <span class="cf">function</span>(df, rule){</span>
<span id="cb23-20"><a href="cleaning.html#cb23-20" tabindex="-1"></a>  df <span class="sc">%&gt;%</span></span>
<span id="cb23-21"><a href="cleaning.html#cb23-21" tabindex="-1"></a>    <span class="fu">group_by</span>(SID) <span class="sc">%&gt;%</span></span>
<span id="cb23-22"><a href="cleaning.html#cb23-22" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">value =</span> <span class="fu">fun_call</span>(value, rule)) <span class="sc">%&gt;%</span></span>
<span id="cb23-23"><a href="cleaning.html#cb23-23" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb23-24"><a href="cleaning.html#cb23-24" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">ifelse</span>(<span class="fu">is.infinite</span>(value) <span class="sc">|</span> <span class="fu">is.nan</span>(value), <span class="cn">NA</span>, value))</span>
<span id="cb23-25"><a href="cleaning.html#cb23-25" tabindex="-1"></a>}</span>
<span id="cb23-26"><a href="cleaning.html#cb23-26" tabindex="-1"></a></span>
<span id="cb23-27"><a href="cleaning.html#cb23-27" tabindex="-1"></a><span class="co"># create composites</span></span>
<span id="cb23-28"><a href="cleaning.html#cb23-28" tabindex="-1"></a>basei_pers <span class="ot">&lt;-</span> basei_pers <span class="sc">%&gt;%</span></span>
<span id="cb23-29"><a href="cleaning.html#cb23-29" tabindex="-1"></a>  <span class="fu">group_by</span>(name, comp_rule, wave) <span class="sc">%&gt;%</span></span>
<span id="cb23-30"><a href="cleaning.html#cb23-30" tabindex="-1"></a>  <span class="fu">nest</span>() <span class="sc">%&gt;%</span></span>
<span id="cb23-31"><a href="cleaning.html#cb23-31" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb23-32"><a href="cleaning.html#cb23-32" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">map2</span>(data, comp_rule, comp_fun)) <span class="sc">%&gt;%</span></span>
<span id="cb23-33"><a href="cleaning.html#cb23-33" tabindex="-1"></a>  <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb23-34"><a href="cleaning.html#cb23-34" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>comp_rule)</span></code></pre></div>
</div>
<div id="outcome-variables" class="section level3 hasAnchor" number="2.1.5">
<h3><span class="header-section-number">2.1.5</span> Outcome Variables<a href="cleaning.html#outcome-variables" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="cleaning.html#cb24-1" tabindex="-1"></a>basei_cog_waves <span class="ot">&lt;-</span> basei_recode <span class="sc">%&gt;%</span></span>
<span id="cb24-2"><a href="cleaning.html#cb24-2" tabindex="-1"></a>  <span class="fu">filter</span>(category <span class="sc">==</span> <span class="st">&quot;outcome&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb24-3"><a href="cleaning.html#cb24-3" tabindex="-1"></a>  <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb24-4"><a href="cleaning.html#cb24-4" tabindex="-1"></a>  <span class="fu">group_by</span>(SID, name) <span class="sc">%&gt;%</span></span>
<span id="cb24-5"><a href="cleaning.html#cb24-5" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">o_year =</span> <span class="fu">max</span>(wave)) <span class="sc">%&gt;%</span></span>
<span id="cb24-6"><a href="cleaning.html#cb24-6" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb24-7"><a href="cleaning.html#cb24-7" tabindex="-1"></a></span>
<span id="cb24-8"><a href="cleaning.html#cb24-8" tabindex="-1"></a><span class="co"># composite within years</span></span>
<span id="cb24-9"><a href="cleaning.html#cb24-9" tabindex="-1"></a>basei_out <span class="ot">&lt;-</span> basei_recode <span class="sc">%&gt;%</span></span>
<span id="cb24-10"><a href="cleaning.html#cb24-10" tabindex="-1"></a>  <span class="fu">filter</span>(category <span class="sc">==</span> <span class="st">&quot;outcome&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb24-11"><a href="cleaning.html#cb24-11" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>category) <span class="sc">%&gt;%</span></span>
<span id="cb24-12"><a href="cleaning.html#cb24-12" tabindex="-1"></a>  <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb24-13"><a href="cleaning.html#cb24-13" tabindex="-1"></a>  <span class="fu">right_join</span>(basei_cog_waves) <span class="sc">%&gt;%</span></span>
<span id="cb24-14"><a href="cleaning.html#cb24-14" tabindex="-1"></a>  <span class="fu">filter</span>(wave <span class="sc">==</span> o_year <span class="sc">&amp;</span> wave <span class="sc">&gt;</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb24-15"><a href="cleaning.html#cb24-15" tabindex="-1"></a>  <span class="fu">group_by</span>(name, wave, SID) <span class="sc">%&gt;%</span></span>
<span id="cb24-16"><a href="cleaning.html#cb24-16" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">value =</span> <span class="fu">sum</span>(value, <span class="at">na.rm =</span> T)) <span class="sc">%&gt;%</span></span>
<span id="cb24-17"><a href="cleaning.html#cb24-17" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code></pre></div>
</div>
<div id="combine-data" class="section level3 hasAnchor" number="2.1.6">
<h3><span class="header-section-number">2.1.6</span> Combine Data<a href="cleaning.html#combine-data" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="cleaning.html#cb25-1" tabindex="-1"></a>basei_combined <span class="ot">&lt;-</span> basei_pers <span class="sc">%&gt;%</span> </span>
<span id="cb25-2"><a href="cleaning.html#cb25-2" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Trait =</span> name, <span class="at">p_value =</span> value, <span class="at">p_year =</span> wave) <span class="sc">%&gt;%</span></span>
<span id="cb25-3"><a href="cleaning.html#cb25-3" tabindex="-1"></a>  <span class="fu">full_join</span>(</span>
<span id="cb25-4"><a href="cleaning.html#cb25-4" tabindex="-1"></a>    basei_out <span class="sc">%&gt;%</span> </span>
<span id="cb25-5"><a href="cleaning.html#cb25-5" tabindex="-1"></a>      <span class="fu">rename</span>(<span class="at">Outcome =</span> name, <span class="at">o_value =</span> value, <span class="at">o_year =</span> wave)</span>
<span id="cb25-6"><a href="cleaning.html#cb25-6" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> <span class="fu">full_join</span>(basei_cov) <span class="sc">%&gt;%</span></span>
<span id="cb25-7"><a href="cleaning.html#cb25-7" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(p_value) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(o_value))</span></code></pre></div>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="cleaning.html#cb26-1" tabindex="-1"></a><span class="fu">save</span>(basei_cov, basei_alpha, basei_pers, basei_out, basei_combined,</span>
<span id="cb26-2"><a href="cleaning.html#cb26-2" tabindex="-1"></a>     <span class="at">file =</span> <span class="fu">sprintf</span>(<span class="st">&quot;%s/data/clean/base-i_cleaned.RData&quot;</span>, local_path))</span></code></pre></div>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="cleaning.html#cb27-1" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span><span class="fu">ls</span>()[<span class="fu">grepl</span>(<span class="st">&quot;basei&quot;</span>, <span class="fu">ls</span>())])</span></code></pre></div>
</div>
</div>
<div id="einstein-aging-study-eas" class="section level2 hasAnchor" number="2.2">
<h2><span class="header-section-number">2.2</span> Einstein Aging Study (EAS)<a href="cleaning.html#einstein-aging-study-eas" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The Einstein Aging Study is an ongoing longitudinal study of older adults in the United States that began in 1980. The data are available on a project-by-project basis by submitting a concept proposal at <a href="https://www.einstein.yu.edu/departments/neurology/clinical-research-program/eas/data-sharing.aspx" class="uri">https://www.einstein.yu.edu/departments/neurology/clinical-research-program/eas/data-sharing.aspx</a>.</p>
<p>Since 1993, the EAS has systematically recruited a representative aging sample in the Bronx, New York. As of 2017, 2,600 participants were enrolled in the study. As of 2010, approximately 200 of the enrolled participants had autopsy data. More information on the study can be found at <a href="http://www.einstein.yu.edu/departments/neurology/clinical-research-program/EAS/" class="uri">http://www.einstein.yu.edu/departments/neurology/clinical-research-program/EAS/</a>.</p>
<p>Sample sizes vary over time, with ranges across waves not publicly available. However, we suspect approximately 2,000 participants to have basic personality and cognitive ability data. This yields 99% power to detect a zero-order correlation effect size of .10, two-tailed at alpha .05.</p>
<div id="load-data-1" class="section level3 hasAnchor" number="2.2.1">
<h3><span class="header-section-number">2.2.1</span> Load Data<a href="cleaning.html#load-data-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="cleaning.html#cb28-1" tabindex="-1"></a>(eas_codebook <span class="ot">&lt;-</span> (codebook <span class="sc">%&gt;%</span> <span class="fu">filter</span>(study <span class="sc">==</span> <span class="st">&quot;EAS&quot;</span>))<span class="sc">$</span>codebook[[<span class="dv">1</span>]])</span></code></pre></div>
<pre><code>## # A tibble: 16 × 15
##    study dataset category name       itemname year  orig_itemname description scale reverse_code recode mini  maxi  comp_rule
##    &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;    &lt;chr&gt;      &lt;chr&gt;    &lt;chr&gt; &lt;chr&gt;         &lt;chr&gt;       &lt;chr&gt; &lt;lgl&gt;        &lt;chr&gt;  &lt;lgl&gt; &lt;lgl&gt; &lt;chr&gt;    
##  1 EAS   &lt;NA&gt;    match    education  educati… base… Educyrs       Education   &lt;NA&gt;  NA           &lt;NA&gt;   NA    NA    skip     
##  2 EAS   &lt;NA&gt;    match    gender     gender   annu… Gender        Gender      &lt;NA&gt;  NA           ifels… NA    NA    skip     
##  3 EAS   &lt;NA&gt;    match    SRhealth   SRhealth annu… &lt;NA&gt;          Self-rated… &lt;NA&gt;  NA           code … NA    NA    skip     
##  4 EAS   &lt;NA&gt;    match    age        age      long… AgeAtWave     Raw age     inte… NA           ifels… NA    NA    skip     
##  5 EAS   &lt;NA&gt;    outcome  crystalli… BosNami… annu… BostonFree    Word Fluen… inte… NA           ifels… NA    NA    sum      
##  6 EAS   &lt;NA&gt;    outcome  crystalli… waisInfo annu… Infraw        WAIS III: … inte… NA           ifels… NA    NA    sum      
##  7 EAS   dataset pers     A          ipipApos 1     Agreeablenes… IPIP NEO A  5 to… NA           ifels… NA    NA    average  
##  8 EAS   dataset pers     C          ipipCpos 1     Conscientiou… IPIP NEO C  5 to… NA           ifels… NA    NA    average  
##  9 EAS   dataset pers     E          ipipEpos 1     Extraversion… IPIP NEO E  5 to… NA           ifels… NA    NA    average  
## 10 EAS   dataset pers     N          ipipNpos 1     NeuroticismP… IPIP NEO N  5 to… NA           ifels… NA    NA    average  
## 11 EAS   dataset pers     O          ipipOpos 1     OpenToExperi… IPIP NEO O  5 to… NA           ifels… NA    NA    average  
## 12 EAS   dataset pers     A          ipipAneg 1     Agreeablenes… IPIP NEO A  5 to… NA           ifels… NA    NA    average  
## 13 EAS   dataset pers     C          ipipCneg 1     Conscientiou… IPIP NEO C  5 to… NA           ifels… NA    NA    average  
## 14 EAS   dataset pers     E          ipipEneg 1     Extraversion… IPIP NEO E  5 to… NA           ifels… NA    NA    average  
## 15 EAS   dataset pers     N          ipipNneg 1     NeuroticismN… IPIP NEO N  5 to… NA           ifels… NA    NA    average  
## 16 EAS   dataset pers     O          ipipOneg 1     OpenToExperi… IPIP NEO O  5 to… NA           ifels… NA    NA    average  
## # ℹ 1 more variable: long_rule &lt;chr&gt;</code></pre>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="cleaning.html#cb30-1" tabindex="-1"></a><span class="co"># old.names1 &lt;- unique((eas_codebook %&gt;% filter(dataset == &quot;jrp&quot;))$orig_itemname)</span></span>
<span id="cb30-2"><a href="cleaning.html#cb30-2" tabindex="-1"></a><span class="co"># old.names2 &lt;- unique((eas_codebook %&gt;% filter(dataset == &quot;dataset&quot;))$orig_itemname)</span></span>
<span id="cb30-3"><a href="cleaning.html#cb30-3" tabindex="-1"></a>old.names <span class="ot">&lt;-</span> <span class="fu">unique</span>(eas_codebook<span class="sc">$</span>orig_itemname)</span>
<span id="cb30-4"><a href="cleaning.html#cb30-4" tabindex="-1"></a>eas <span class="ot">&lt;-</span> <span class="fu">sprintf</span>(<span class="st">&quot;%s/eas/Behavior_with_Master_Data_2021_09_24.xlsx&quot;</span>, data_path) <span class="sc">%&gt;%</span> </span>
<span id="cb30-5"><a href="cleaning.html#cb30-5" tabindex="-1"></a>  <span class="fu">read_excel</span>(.) <span class="sc">%&gt;%</span> </span>
<span id="cb30-6"><a href="cleaning.html#cb30-6" tabindex="-1"></a>  <span class="fu">select</span>(<span class="at">SID =</span> Id, <span class="at">wave =</span> Wave, <span class="at">year =</span> BehaviorDate, <span class="fu">one_of</span>(old.names)) <span class="sc">%&gt;%</span></span>
<span id="cb30-7"><a href="cleaning.html#cb30-7" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> lubridate<span class="sc">::</span><span class="fu">year</span>(year)</span>
<span id="cb30-8"><a href="cleaning.html#cb30-8" tabindex="-1"></a>        , <span class="at">Gender =</span> <span class="fu">as.numeric</span>(<span class="fu">mapvalues</span>(Gender, <span class="fu">c</span>(<span class="st">&quot;M&quot;</span>, <span class="st">&quot;F&quot;</span>), <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>))))</span>
<span id="cb30-9"><a href="cleaning.html#cb30-9" tabindex="-1"></a>  <span class="co"># full_join(</span></span>
<span id="cb30-10"><a href="cleaning.html#cb30-10" tabindex="-1"></a>  <span class="co">#   sprintf(&quot;%s/eas/dataset.xlsx&quot;, data_path) %&gt;% </span></span>
<span id="cb30-11"><a href="cleaning.html#cb30-11" tabindex="-1"></a>  <span class="co">#     read_excel(.) %&gt;% </span></span>
<span id="cb30-12"><a href="cleaning.html#cb30-12" tabindex="-1"></a>  <span class="co">#     select(SID = id, one_of(old.names2))</span></span>
<span id="cb30-13"><a href="cleaning.html#cb30-13" tabindex="-1"></a>  <span class="co"># )</span></span>
<span id="cb30-14"><a href="cleaning.html#cb30-14" tabindex="-1"></a></span>
<span id="cb30-15"><a href="cleaning.html#cb30-15" tabindex="-1"></a>eas_long <span class="ot">&lt;-</span> eas <span class="sc">%&gt;%</span></span>
<span id="cb30-16"><a href="cleaning.html#cb30-16" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">values_to =</span> <span class="st">&quot;value&quot;</span></span>
<span id="cb30-17"><a href="cleaning.html#cb30-17" tabindex="-1"></a>               , <span class="at">names_to =</span> <span class="st">&quot;orig_itemname&quot;</span></span>
<span id="cb30-18"><a href="cleaning.html#cb30-18" tabindex="-1"></a>               , <span class="at">cols =</span> <span class="fu">c</span>(<span class="sc">-</span>SID, <span class="sc">-</span>wave, <span class="sc">-</span>year)</span>
<span id="cb30-19"><a href="cleaning.html#cb30-19" tabindex="-1"></a>               , <span class="at">values_drop_na =</span> T)</span></code></pre></div>
</div>
<div id="recoding-reverse-scoring-1" class="section level3 hasAnchor" number="2.2.2">
<h3><span class="header-section-number">2.2.2</span> Recoding &amp; Reverse Scoring<a href="cleaning.html#recoding-reverse-scoring-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="cleaning.html#cb31-1" tabindex="-1"></a><span class="co"># join data with recoding info </span></span>
<span id="cb31-2"><a href="cleaning.html#cb31-2" tabindex="-1"></a>eas_recode <span class="ot">&lt;-</span> eas_codebook <span class="sc">%&gt;%</span></span>
<span id="cb31-3"><a href="cleaning.html#cb31-3" tabindex="-1"></a>  <span class="fu">filter</span>(category <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;pers&quot;</span>, <span class="st">&quot;outcome&quot;</span>, <span class="st">&quot;covariates&quot;</span>) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(orig_itemname)) <span class="sc">%&gt;%</span></span>
<span id="cb31-4"><a href="cleaning.html#cb31-4" tabindex="-1"></a>  <span class="fu">select</span>(category, name, itemname, orig_itemname, reverse_code<span class="sc">:</span>long_rule) <span class="sc">%&gt;%</span></span>
<span id="cb31-5"><a href="cleaning.html#cb31-5" tabindex="-1"></a>  <span class="fu">group_by</span>(category, name) <span class="sc">%&gt;%</span> </span>
<span id="cb31-6"><a href="cleaning.html#cb31-6" tabindex="-1"></a>  <span class="fu">nest</span>() <span class="sc">%&gt;%</span></span>
<span id="cb31-7"><a href="cleaning.html#cb31-7" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb31-8"><a href="cleaning.html#cb31-8" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">map</span>(data, <span class="sc">~</span>(.) <span class="sc">%&gt;%</span> <span class="fu">left_join</span>(eas_long))) </span>
<span id="cb31-9"><a href="cleaning.html#cb31-9" tabindex="-1"></a></span>
<span id="cb31-10"><a href="cleaning.html#cb31-10" tabindex="-1"></a><span class="co"># recode </span></span>
<span id="cb31-11"><a href="cleaning.html#cb31-11" tabindex="-1"></a>recode_fun <span class="ot">&lt;-</span> <span class="cf">function</span>(rule, y, year){</span>
<span id="cb31-12"><a href="cleaning.html#cb31-12" tabindex="-1"></a>  x <span class="ot">&lt;-</span> y<span class="sc">$</span>value</span>
<span id="cb31-13"><a href="cleaning.html#cb31-13" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.na</span>(rule)){y<span class="sc">$</span>value <span class="ot">&lt;-</span> <span class="fu">eval</span>(<span class="fu">parse</span>(<span class="at">text =</span> rule))}</span>
<span id="cb31-14"><a href="cleaning.html#cb31-14" tabindex="-1"></a>  <span class="fu">return</span>(y)</span>
<span id="cb31-15"><a href="cleaning.html#cb31-15" tabindex="-1"></a>}</span>
<span id="cb31-16"><a href="cleaning.html#cb31-16" tabindex="-1"></a></span>
<span id="cb31-17"><a href="cleaning.html#cb31-17" tabindex="-1"></a>eas_recode <span class="ot">&lt;-</span> eas_recode <span class="sc">%&gt;%</span> </span>
<span id="cb31-18"><a href="cleaning.html#cb31-18" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">map</span>(data, <span class="sc">~</span>(.) <span class="sc">%&gt;%</span> </span>
<span id="cb31-19"><a href="cleaning.html#cb31-19" tabindex="-1"></a>    <span class="fu">group_by</span>(recode, year) <span class="sc">%&gt;%</span></span>
<span id="cb31-20"><a href="cleaning.html#cb31-20" tabindex="-1"></a>    <span class="fu">nest</span>() <span class="sc">%&gt;%</span></span>
<span id="cb31-21"><a href="cleaning.html#cb31-21" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb31-22"><a href="cleaning.html#cb31-22" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">pmap</span>(<span class="fu">list</span>(recode, data, year), recode_fun)) <span class="sc">%&gt;%</span></span>
<span id="cb31-23"><a href="cleaning.html#cb31-23" tabindex="-1"></a>    <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb31-24"><a href="cleaning.html#cb31-24" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">ifelse</span>(value <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">|</span> <span class="fu">is.nan</span>(value) <span class="sc">|</span> <span class="fu">is.infinite</span>(value), <span class="cn">NA</span>, value))))</span>
<span id="cb31-25"><a href="cleaning.html#cb31-25" tabindex="-1"></a></span>
<span id="cb31-26"><a href="cleaning.html#cb31-26" tabindex="-1"></a></span>
<span id="cb31-27"><a href="cleaning.html#cb31-27" tabindex="-1"></a><span class="co"># reverse code </span></span>
<span id="cb31-28"><a href="cleaning.html#cb31-28" tabindex="-1"></a>eas_recode <span class="ot">&lt;-</span> eas_recode <span class="sc">%&gt;%</span></span>
<span id="cb31-29"><a href="cleaning.html#cb31-29" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">map</span>(data, <span class="sc">~</span>(.) <span class="sc">%&gt;%</span></span>
<span id="cb31-30"><a href="cleaning.html#cb31-30" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">ifelse</span>(reverse_code <span class="sc">==</span> <span class="st">&quot;no&quot;</span> <span class="sc">|</span> <span class="fu">is.na</span>(reverse_code), value, </span>
<span id="cb31-31"><a href="cleaning.html#cb31-31" tabindex="-1"></a>                        <span class="fu">reverse.code</span>(<span class="sc">-</span><span class="dv">1</span>, value, <span class="at">mini =</span> mini, <span class="at">maxi =</span> maxi)))))</span>
<span id="cb31-32"><a href="cleaning.html#cb31-32" tabindex="-1"></a></span>
<span id="cb31-33"><a href="cleaning.html#cb31-33" tabindex="-1"></a>fun_call <span class="ot">&lt;-</span> <span class="cf">function</span>(x, rule){</span>
<span id="cb31-34"><a href="cleaning.html#cb31-34" tabindex="-1"></a>    <span class="cf">switch</span>(rule,</span>
<span id="cb31-35"><a href="cleaning.html#cb31-35" tabindex="-1"></a>           <span class="at">average =</span> <span class="fu">mean</span>(x, <span class="at">na.rm =</span> T),</span>
<span id="cb31-36"><a href="cleaning.html#cb31-36" tabindex="-1"></a>           <span class="at">mode =</span> <span class="fu">Mode</span>(x)[<span class="dv">1</span>],</span>
<span id="cb31-37"><a href="cleaning.html#cb31-37" tabindex="-1"></a>           <span class="at">sum =</span> <span class="fu">sum</span>(x, <span class="at">na.rm =</span> T),</span>
<span id="cb31-38"><a href="cleaning.html#cb31-38" tabindex="-1"></a>           <span class="at">skip =</span> <span class="fu">unique</span>(x)[<span class="dv">1</span>],</span>
<span id="cb31-39"><a href="cleaning.html#cb31-39" tabindex="-1"></a>           <span class="at">select =</span> <span class="fu">unique</span>(x)[<span class="dv">1</span>],</span>
<span id="cb31-40"><a href="cleaning.html#cb31-40" tabindex="-1"></a>           <span class="at">max =</span> <span class="fu">max</span>(x, <span class="at">na.rm =</span> T),</span>
<span id="cb31-41"><a href="cleaning.html#cb31-41" tabindex="-1"></a>           <span class="at">min =</span> <span class="fu">min</span>(x, <span class="at">na.rm =</span> T))</span>
<span id="cb31-42"><a href="cleaning.html#cb31-42" tabindex="-1"></a>  }</span></code></pre></div>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="cleaning.html#cb32-1" tabindex="-1"></a>eas_waves <span class="ot">&lt;-</span> eas_recode <span class="sc">%&gt;%</span> </span>
<span id="cb32-2"><a href="cleaning.html#cb32-2" tabindex="-1"></a>  <span class="fu">filter</span>(category <span class="sc">==</span> <span class="st">&quot;pers&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb32-3"><a href="cleaning.html#cb32-3" tabindex="-1"></a>  <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span> </span>
<span id="cb32-4"><a href="cleaning.html#cb32-4" tabindex="-1"></a>  <span class="fu">select</span>(SID, <span class="at">p_year =</span> year) <span class="sc">%&gt;%</span></span>
<span id="cb32-5"><a href="cleaning.html#cb32-5" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">%&gt;%</span></span>
<span id="cb32-6"><a href="cleaning.html#cb32-6" tabindex="-1"></a>  <span class="fu">group_by</span>(SID) <span class="sc">%&gt;%</span></span>
<span id="cb32-7"><a href="cleaning.html#cb32-7" tabindex="-1"></a>  <span class="fu">filter</span>(p_year <span class="sc">==</span> <span class="fu">min</span>(p_year)) <span class="sc">%&gt;%</span></span>
<span id="cb32-8"><a href="cleaning.html#cb32-8" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code></pre></div>
</div>
<div id="covariates-1" class="section level3 hasAnchor" number="2.2.3">
<h3><span class="header-section-number">2.2.3</span> Covariates<a href="cleaning.html#covariates-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="cleaning.html#cb33-1" tabindex="-1"></a><span class="co"># composite WITHIN years </span></span>
<span id="cb33-2"><a href="cleaning.html#cb33-2" tabindex="-1"></a>eas_cov <span class="ot">&lt;-</span> eas_recode <span class="sc">%&gt;%</span></span>
<span id="cb33-3"><a href="cleaning.html#cb33-3" tabindex="-1"></a>  <span class="fu">filter</span>(category <span class="sc">==</span> <span class="st">&quot;covariates&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb33-4"><a href="cleaning.html#cb33-4" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>category) <span class="sc">%&gt;%</span></span>
<span id="cb33-5"><a href="cleaning.html#cb33-5" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">map</span>(data, <span class="sc">~</span>(.) <span class="sc">%&gt;%</span> </span>
<span id="cb33-6"><a href="cleaning.html#cb33-6" tabindex="-1"></a>      <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(value)) <span class="sc">%&gt;%</span></span>
<span id="cb33-7"><a href="cleaning.html#cb33-7" tabindex="-1"></a>      <span class="fu">left_join</span>(eas_waves) <span class="sc">%&gt;%</span></span>
<span id="cb33-8"><a href="cleaning.html#cb33-8" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">comp_rule =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(comp_rule), <span class="st">&quot;skip&quot;</span>, comp_rule)) <span class="sc">%&gt;%</span></span>
<span id="cb33-9"><a href="cleaning.html#cb33-9" tabindex="-1"></a>      <span class="fu">group_by</span>(comp_rule, SID, year, p_year, long_rule) <span class="sc">%&gt;%</span></span>
<span id="cb33-10"><a href="cleaning.html#cb33-10" tabindex="-1"></a>      <span class="fu">nest</span>() <span class="sc">%&gt;%</span></span>
<span id="cb33-11"><a href="cleaning.html#cb33-11" tabindex="-1"></a>      <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb33-12"><a href="cleaning.html#cb33-12" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">map2</span>(data, comp_rule, <span class="sc">~</span><span class="fu">fun_call</span>((.x)<span class="sc">$</span>value, .y))) <span class="sc">%&gt;%</span></span>
<span id="cb33-13"><a href="cleaning.html#cb33-13" tabindex="-1"></a>      <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb33-14"><a href="cleaning.html#cb33-14" tabindex="-1"></a>      <span class="fu">filter</span>(year <span class="sc">&lt;=</span> p_year)</span>
<span id="cb33-15"><a href="cleaning.html#cb33-15" tabindex="-1"></a>      <span class="co"># summarize(value = fun_call(value, comp_rule)) %&gt;%</span></span>
<span id="cb33-16"><a href="cleaning.html#cb33-16" tabindex="-1"></a>      <span class="co"># ungroup() %&gt;% </span></span>
<span id="cb33-17"><a href="cleaning.html#cb33-17" tabindex="-1"></a>      <span class="co"># mutate(value = ifelse(is.infinite(value) | is.nan(value), NA, value))</span></span>
<span id="cb33-18"><a href="cleaning.html#cb33-18" tabindex="-1"></a>      ))</span>
<span id="cb33-19"><a href="cleaning.html#cb33-19" tabindex="-1"></a></span>
<span id="cb33-20"><a href="cleaning.html#cb33-20" tabindex="-1"></a>comp_fun <span class="ot">&lt;-</span> <span class="cf">function</span>(d, rule, p_year){</span>
<span id="cb33-21"><a href="cleaning.html#cb33-21" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">paste</span>(rule, p_year))</span>
<span id="cb33-22"><a href="cleaning.html#cb33-22" tabindex="-1"></a>  d <span class="sc">%&gt;%</span></span>
<span id="cb33-23"><a href="cleaning.html#cb33-23" tabindex="-1"></a>    <span class="fu">group_by</span>(SID, name) <span class="sc">%&gt;%</span></span>
<span id="cb33-24"><a href="cleaning.html#cb33-24" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">value =</span> <span class="fu">fun_call</span>(data, rule)) <span class="sc">%&gt;%</span></span>
<span id="cb33-25"><a href="cleaning.html#cb33-25" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb33-26"><a href="cleaning.html#cb33-26" tabindex="-1"></a>    <span class="fu">distinct</span>()</span>
<span id="cb33-27"><a href="cleaning.html#cb33-27" tabindex="-1"></a>}</span>
<span id="cb33-28"><a href="cleaning.html#cb33-28" tabindex="-1"></a></span>
<span id="cb33-29"><a href="cleaning.html#cb33-29" tabindex="-1"></a><span class="co"># composite ACROSS years</span></span>
<span id="cb33-30"><a href="cleaning.html#cb33-30" tabindex="-1"></a>eas_cov <span class="ot">&lt;-</span> eas_cov <span class="sc">%&gt;%</span></span>
<span id="cb33-31"><a href="cleaning.html#cb33-31" tabindex="-1"></a>  <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb33-32"><a href="cleaning.html#cb33-32" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">long_rule =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(long_rule), <span class="st">&quot;skip&quot;</span>, long_rule)) <span class="sc">%&gt;%</span></span>
<span id="cb33-33"><a href="cleaning.html#cb33-33" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">&lt;=</span> p_year) <span class="sc">%&gt;%</span></span>
<span id="cb33-34"><a href="cleaning.html#cb33-34" tabindex="-1"></a>  <span class="fu">group_by</span>(p_year, long_rule) <span class="sc">%&gt;%</span></span>
<span id="cb33-35"><a href="cleaning.html#cb33-35" tabindex="-1"></a>  <span class="fu">nest</span>() <span class="sc">%&gt;%</span></span>
<span id="cb33-36"><a href="cleaning.html#cb33-36" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb33-37"><a href="cleaning.html#cb33-37" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">pmap</span>(<span class="fu">list</span>(data, long_rule, p_year), comp_fun)) <span class="sc">%&gt;%</span></span>
<span id="cb33-38"><a href="cleaning.html#cb33-38" tabindex="-1"></a>  <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb33-39"><a href="cleaning.html#cb33-39" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">ifelse</span>(<span class="fu">is.infinite</span>(value) <span class="sc">|</span> <span class="fu">is.nan</span>(value), <span class="cn">NA</span>, value)) <span class="sc">%&gt;%</span></span>
<span id="cb33-40"><a href="cleaning.html#cb33-40" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>long_rule) <span class="sc">%&gt;%</span></span>
<span id="cb33-41"><a href="cleaning.html#cb33-41" tabindex="-1"></a>  <span class="fu">spread</span>(name, value) <span class="sc">%&gt;%</span></span>
<span id="cb33-42"><a href="cleaning.html#cb33-42" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(SID))</span></code></pre></div>
</div>
<div id="personality-variables-1" class="section level3 hasAnchor" number="2.2.4">
<h3><span class="header-section-number">2.2.4</span> Personality Variables<a href="cleaning.html#personality-variables-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="cleaning.html#cb34-1" tabindex="-1"></a>eas_pers <span class="ot">&lt;-</span> eas_recode <span class="sc">%&gt;%</span></span>
<span id="cb34-2"><a href="cleaning.html#cb34-2" tabindex="-1"></a>  <span class="fu">filter</span>(category <span class="sc">==</span> <span class="st">&quot;pers&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb34-3"><a href="cleaning.html#cb34-3" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>category) <span class="sc">%&gt;%</span> </span>
<span id="cb34-4"><a href="cleaning.html#cb34-4" tabindex="-1"></a>  <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb34-5"><a href="cleaning.html#cb34-5" tabindex="-1"></a>  <span class="fu">left_join</span>(eas_waves) <span class="sc">%&gt;%</span></span>
<span id="cb34-6"><a href="cleaning.html#cb34-6" tabindex="-1"></a>  <span class="fu">group_by</span>(SID, p_year, year, name, itemname, comp_rule) <span class="sc">%&gt;%</span></span>
<span id="cb34-7"><a href="cleaning.html#cb34-7" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">value =</span> <span class="fu">mean</span>(value, <span class="at">na.rm =</span> T)) <span class="sc">%&gt;%</span></span>
<span id="cb34-8"><a href="cleaning.html#cb34-8" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb34-9"><a href="cleaning.html#cb34-9" tabindex="-1"></a></span>
<span id="cb34-10"><a href="cleaning.html#cb34-10" tabindex="-1"></a><span class="co"># alpha&#39;s</span></span>
<span id="cb34-11"><a href="cleaning.html#cb34-11" tabindex="-1"></a>eas_alpha <span class="ot">&lt;-</span> eas_pers <span class="sc">%&gt;%</span></span>
<span id="cb34-12"><a href="cleaning.html#cb34-12" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(value)) <span class="sc">%&gt;%</span></span>
<span id="cb34-13"><a href="cleaning.html#cb34-13" tabindex="-1"></a>  <span class="fu">select</span>(name, itemname, year, SID, value) <span class="sc">%&gt;%</span></span>
<span id="cb34-14"><a href="cleaning.html#cb34-14" tabindex="-1"></a>  <span class="fu">group_by</span>(name, year) <span class="sc">%&gt;%</span></span>
<span id="cb34-15"><a href="cleaning.html#cb34-15" tabindex="-1"></a>  <span class="fu">nest</span>() <span class="sc">%&gt;%</span></span>
<span id="cb34-16"><a href="cleaning.html#cb34-16" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">map</span>(data, <span class="sc">~</span>(.) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>() <span class="sc">%&gt;%</span> <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> itemname, <span class="at">values_from =</span> value, <span class="at">values_fn =</span> <span class="fu">list</span>(mean))),</span>
<span id="cb34-17"><a href="cleaning.html#cb34-17" tabindex="-1"></a>         <span class="at">alpha =</span> <span class="fu">map</span>(data, <span class="fu">possibly</span>(<span class="sc">~</span>psych<span class="sc">::</span><span class="fu">alpha</span>((.) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>SID)), <span class="cn">NA_real_</span>)))</span>
<span id="cb34-18"><a href="cleaning.html#cb34-18" tabindex="-1"></a></span>
<span id="cb34-19"><a href="cleaning.html#cb34-19" tabindex="-1"></a>comp_fun <span class="ot">&lt;-</span> <span class="cf">function</span>(df, rule){</span>
<span id="cb34-20"><a href="cleaning.html#cb34-20" tabindex="-1"></a>  df <span class="sc">%&gt;%</span></span>
<span id="cb34-21"><a href="cleaning.html#cb34-21" tabindex="-1"></a>    <span class="fu">group_by</span>(SID) <span class="sc">%&gt;%</span></span>
<span id="cb34-22"><a href="cleaning.html#cb34-22" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">value =</span> <span class="fu">fun_call</span>(value, rule)) <span class="sc">%&gt;%</span></span>
<span id="cb34-23"><a href="cleaning.html#cb34-23" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb34-24"><a href="cleaning.html#cb34-24" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">ifelse</span>(<span class="fu">is.infinite</span>(value) <span class="sc">|</span> <span class="fu">is.nan</span>(value), <span class="cn">NA</span>, value))</span>
<span id="cb34-25"><a href="cleaning.html#cb34-25" tabindex="-1"></a>}</span>
<span id="cb34-26"><a href="cleaning.html#cb34-26" tabindex="-1"></a></span>
<span id="cb34-27"><a href="cleaning.html#cb34-27" tabindex="-1"></a><span class="co"># create composites</span></span>
<span id="cb34-28"><a href="cleaning.html#cb34-28" tabindex="-1"></a>eas_pers <span class="ot">&lt;-</span> eas_pers <span class="sc">%&gt;%</span></span>
<span id="cb34-29"><a href="cleaning.html#cb34-29" tabindex="-1"></a>  <span class="fu">group_by</span>(name, comp_rule, year) <span class="sc">%&gt;%</span></span>
<span id="cb34-30"><a href="cleaning.html#cb34-30" tabindex="-1"></a>  <span class="fu">nest</span>() <span class="sc">%&gt;%</span></span>
<span id="cb34-31"><a href="cleaning.html#cb34-31" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb34-32"><a href="cleaning.html#cb34-32" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">map2</span>(data, comp_rule, comp_fun)) <span class="sc">%&gt;%</span></span>
<span id="cb34-33"><a href="cleaning.html#cb34-33" tabindex="-1"></a>  <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb34-34"><a href="cleaning.html#cb34-34" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>comp_rule)</span></code></pre></div>
</div>
<div id="outcome-variables-1" class="section level3 hasAnchor" number="2.2.5">
<h3><span class="header-section-number">2.2.5</span> Outcome Variables<a href="cleaning.html#outcome-variables-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="cleaning.html#cb35-1" tabindex="-1"></a><span class="co"># composite within years</span></span>
<span id="cb35-2"><a href="cleaning.html#cb35-2" tabindex="-1"></a>eas_out <span class="ot">&lt;-</span> eas_recode <span class="sc">%&gt;%</span></span>
<span id="cb35-3"><a href="cleaning.html#cb35-3" tabindex="-1"></a>  <span class="fu">filter</span>(category <span class="sc">==</span> <span class="st">&quot;outcome&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb35-4"><a href="cleaning.html#cb35-4" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>category) <span class="sc">%&gt;%</span></span>
<span id="cb35-5"><a href="cleaning.html#cb35-5" tabindex="-1"></a>  <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb35-6"><a href="cleaning.html#cb35-6" tabindex="-1"></a>  <span class="fu">group_by</span>(SID, name) <span class="sc">%&gt;%</span></span>
<span id="cb35-7"><a href="cleaning.html#cb35-7" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> <span class="fu">max</span>(year)) <span class="sc">%&gt;%</span></span>
<span id="cb35-8"><a href="cleaning.html#cb35-8" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(value)) <span class="sc">%&gt;%</span></span>
<span id="cb35-9"><a href="cleaning.html#cb35-9" tabindex="-1"></a>  <span class="fu">group_by</span>(name, itemname, year) <span class="sc">%&gt;%</span></span>
<span id="cb35-10"><a href="cleaning.html#cb35-10" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">pomp</span>(value)) <span class="sc">%&gt;%</span></span>
<span id="cb35-11"><a href="cleaning.html#cb35-11" tabindex="-1"></a>  <span class="fu">group_by</span>(name, year, SID) <span class="sc">%&gt;%</span></span>
<span id="cb35-12"><a href="cleaning.html#cb35-12" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">value =</span> <span class="fu">mean</span>(value, <span class="at">na.rm =</span> T)) <span class="sc">%&gt;%</span></span>
<span id="cb35-13"><a href="cleaning.html#cb35-13" tabindex="-1"></a>  <span class="fu">ungroup</span>() </span></code></pre></div>
</div>
<div id="combine-data-1" class="section level3 hasAnchor" number="2.2.6">
<h3><span class="header-section-number">2.2.6</span> Combine Data<a href="cleaning.html#combine-data-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="cleaning.html#cb36-1" tabindex="-1"></a>eas_combined <span class="ot">&lt;-</span> eas_pers <span class="sc">%&gt;%</span> </span>
<span id="cb36-2"><a href="cleaning.html#cb36-2" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Trait =</span> name, <span class="at">p_value =</span> value, <span class="at">p_year =</span> year) <span class="sc">%&gt;%</span></span>
<span id="cb36-3"><a href="cleaning.html#cb36-3" tabindex="-1"></a>  <span class="fu">full_join</span>(eas_out <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">Outcome =</span> name, <span class="at">o_value =</span> value, <span class="at">o_year =</span> year)) <span class="sc">%&gt;%</span></span>
<span id="cb36-4"><a href="cleaning.html#cb36-4" tabindex="-1"></a>  <span class="fu">full_join</span>(eas_cov) <span class="sc">%&gt;%</span></span>
<span id="cb36-5"><a href="cleaning.html#cb36-5" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(p_value) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(o_value))</span></code></pre></div>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="cleaning.html#cb37-1" tabindex="-1"></a><span class="fu">save</span>(eas_cov, eas_alpha, eas_pers, eas_out, eas_combined,</span>
<span id="cb37-2"><a href="cleaning.html#cb37-2" tabindex="-1"></a>     <span class="at">file =</span> <span class="fu">sprintf</span>(<span class="st">&quot;%s/data/clean/eas_cleaned.RData&quot;</span>, local_path))</span></code></pre></div>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="cleaning.html#cb38-1" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span><span class="fu">ls</span>()[<span class="fu">grepl</span>(<span class="st">&quot;eas&quot;</span>, <span class="fu">ls</span>())])</span></code></pre></div>
</div>
</div>
<div id="german-socioeconomic-panel-gsoep" class="section level2 hasAnchor" number="2.3">
<h2><span class="header-section-number">2.3</span> German Socioeconomic Panel (GSOEP)<a href="cleaning.html#german-socioeconomic-panel-gsoep" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The German Socioeconomic Panel Study (GSOEP; Socio-Economic Panel, 2017) is an ongoing longitudinal study of Germans collected by the German Institute of Economic Research (DIW Berlin). The data are freely available at <a href="https://www.diw.de/soep" class="uri">https://www.diw.de/soep</a> by application.</p>
<p>Data have been collected annually since 1984 (the latest data release includes data up to 2017). Participants have been recruited from more than 11,000 households, which are nationally representative of private German households. 20,000 individuals are sampled each year, on average. It is critical to note that the GSOEP samples households, not individuals, and the households consist of individuals living in both the “old” and “new” federal states (the former West and East Germany), foreigners, and recent immigrants to Germany.</p>
<p>Sample size varies by year, ranging from approximately 10,000 (1989) to 31,000 (2013). This provides 99% power to detect a zero-order correlation effect size of ~.06, two-tailed at alpha &lt; .05.</p>
<div id="load-data-2" class="section level3 hasAnchor" number="2.3.1">
<h3><span class="header-section-number">2.3.1</span> Load Data<a href="cleaning.html#load-data-2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="cleaning.html#cb39-1" tabindex="-1"></a>gsoep_read_fun <span class="ot">&lt;-</span> <span class="cf">function</span>(Year, WL){</span>
<span id="cb39-2"><a href="cleaning.html#cb39-2" tabindex="-1"></a>  old.names <span class="ot">&lt;-</span> (gsoep_codebook <span class="sc">%&gt;%</span> <span class="fu">filter</span>(year <span class="sc">==</span> Year <span class="sc">|</span> category <span class="sc">==</span> <span class="st">&quot;proc&quot;</span>))<span class="sc">$</span>orig_itemname </span>
<span id="cb39-3"><a href="cleaning.html#cb39-3" tabindex="-1"></a>  p <span class="ot">&lt;-</span> <span class="fu">sprintf</span>(<span class="st">&quot;%s/gsoep/%sp.sav&quot;</span>, data_path, WL) <span class="sc">%&gt;%</span> haven<span class="sc">::</span><span class="fu">read_sav</span>(.) <span class="sc">%&gt;%</span></span>
<span id="cb39-4"><a href="cleaning.html#cb39-4" tabindex="-1"></a>    <span class="fu">full_join</span>(<span class="fu">sprintf</span>(<span class="st">&quot;%s/gsoep/%skind.sav&quot;</span>, data_path, WL) <span class="sc">%&gt;%</span> haven<span class="sc">::</span><span class="fu">read_sav</span>(.)) <span class="sc">%&gt;%</span></span>
<span id="cb39-5"><a href="cleaning.html#cb39-5" tabindex="-1"></a>    <span class="fu">full_join</span>(<span class="fu">sprintf</span>(<span class="st">&quot;%s/gsoep/%spequiv.sav&quot;</span>, data_path, WL) <span class="sc">%&gt;%</span> haven<span class="sc">::</span><span class="fu">read_sav</span>(.)) <span class="sc">%&gt;%</span></span>
<span id="cb39-6"><a href="cleaning.html#cb39-6" tabindex="-1"></a>    <span class="fu">full_join</span>(<span class="fu">sprintf</span>(<span class="st">&quot;%s/gsoep/%spgen.sav&quot;</span>, data_path, WL) <span class="sc">%&gt;%</span> haven<span class="sc">::</span><span class="fu">read_sav</span>(.)) <span class="sc">%&gt;%</span></span>
<span id="cb39-7"><a href="cleaning.html#cb39-7" tabindex="-1"></a>    <span class="fu">full_join</span>(<span class="fu">sprintf</span>(<span class="st">&quot;%s/gsoep/%spkal.sav&quot;</span>, data_path, WL) <span class="sc">%&gt;%</span> haven<span class="sc">::</span><span class="fu">read_sav</span>(.)) <span class="sc">%&gt;%</span></span>
<span id="cb39-8"><a href="cleaning.html#cb39-8" tabindex="-1"></a>    <span class="fu">select</span>(<span class="fu">one_of</span>(old.names)) <span class="sc">%&gt;%</span></span>
<span id="cb39-9"><a href="cleaning.html#cb39-9" tabindex="-1"></a>    <span class="fu">gather</span>(<span class="at">key =</span> orig_itemname, <span class="at">value =</span> value, <span class="sc">-</span>persnr, <span class="sc">-</span>hhnr, <span class="at">na.rm =</span> T)</span>
<span id="cb39-10"><a href="cleaning.html#cb39-10" tabindex="-1"></a>  </span>
<span id="cb39-11"><a href="cleaning.html#cb39-11" tabindex="-1"></a> <span class="fu">sprintf</span>(<span class="st">&quot;%s/gsoep/%shbrutto.sav&quot;</span>, data_path, WL) <span class="sc">%&gt;%</span> haven<span class="sc">::</span><span class="fu">read_sav</span>(.) <span class="sc">%&gt;%</span></span>
<span id="cb39-12"><a href="cleaning.html#cb39-12" tabindex="-1"></a>    <span class="fu">full_join</span>(<span class="fu">sprintf</span>(<span class="st">&quot;%s/gsoep/%sh.sav&quot;</span>, data_path, WL) <span class="sc">%&gt;%</span> haven<span class="sc">::</span><span class="fu">read_sav</span>(.)) <span class="sc">%&gt;%</span></span>
<span id="cb39-13"><a href="cleaning.html#cb39-13" tabindex="-1"></a>    <span class="fu">select</span>(<span class="fu">one_of</span>(old.names)) <span class="sc">%&gt;%</span></span>
<span id="cb39-14"><a href="cleaning.html#cb39-14" tabindex="-1"></a>    <span class="fu">gather</span>(<span class="at">key =</span> orig_itemname, <span class="at">value =</span> value, <span class="sc">-</span>hhnr, <span class="at">na.rm =</span> T) <span class="sc">%&gt;%</span></span>
<span id="cb39-15"><a href="cleaning.html#cb39-15" tabindex="-1"></a>    <span class="fu">full_join</span>(p <span class="sc">%&gt;%</span> <span class="fu">select</span>(persnr, hhnr) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb39-16"><a href="cleaning.html#cb39-16" tabindex="-1"></a>    <span class="fu">full_join</span>(p) </span>
<span id="cb39-17"><a href="cleaning.html#cb39-17" tabindex="-1"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="cleaning.html#cb40-1" tabindex="-1"></a>gsoep_codebook <span class="ot">&lt;-</span> (codebook <span class="sc">%&gt;%</span> <span class="fu">filter</span>(study <span class="sc">==</span> <span class="st">&quot;GSOEP&quot;</span>))<span class="sc">$</span>codebook[[<span class="dv">1</span>]] <span class="sc">%&gt;%</span></span>
<span id="cb40-2"><a href="cleaning.html#cb40-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">orig_itemname =</span> <span class="fu">str_to_lower</span>(orig_itemname))</span>
<span id="cb40-3"><a href="cleaning.html#cb40-3" tabindex="-1"></a>gsoep_codebook</span></code></pre></div>
<pre><code>## # A tibble: 250 × 17
##    study dataset category   name  itemname  wave waveletter  year orig_itemname description   scale reverse_code recode  mini
##    &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;      &lt;chr&gt; &lt;chr&gt;    &lt;dbl&gt; &lt;chr&gt;      &lt;dbl&gt; &lt;chr&gt;         &lt;chr&gt;         &lt;chr&gt; &lt;chr&gt;        &lt;chr&gt;  &lt;dbl&gt;
##  1 gsoep apequiv covariates age   age          1 a           1984 d1110184      Age of Indiv… &lt;NA&gt;  &lt;NA&gt;         ifels…    NA
##  2 gsoep bpequiv covariates age   age          2 b           1985 d1110185      Age of Indiv… &lt;NA&gt;  &lt;NA&gt;         ifels…    NA
##  3 gsoep cpequiv covariates age   age          3 c           1986 d1110186      Age of Indiv… &lt;NA&gt;  &lt;NA&gt;         ifels…    NA
##  4 gsoep dpequiv covariates age   age          4 d           1987 d1110187      Age of Indiv… &lt;NA&gt;  &lt;NA&gt;         ifels…    NA
##  5 gsoep epequiv covariates age   age          5 e           1988 d1110188      Age of Indiv… &lt;NA&gt;  &lt;NA&gt;         ifels…    NA
##  6 gsoep fpequiv covariates age   age          6 f           1989 d1110189      Age of Indiv… &lt;NA&gt;  &lt;NA&gt;         ifels…    NA
##  7 gsoep gpequiv covariates age   age          7 g           1990 d1110190      Age of Indiv… &lt;NA&gt;  &lt;NA&gt;         ifels…    NA
##  8 gsoep hpequiv covariates age   age          8 h           1991 d1110191      Age of Indiv… &lt;NA&gt;  &lt;NA&gt;         ifels…    NA
##  9 gsoep ipequiv covariates age   age          9 i           1992 d1110192      Age of Indiv… &lt;NA&gt;  &lt;NA&gt;         ifels…    NA
## 10 gsoep jpequiv covariates age   age         10 j           1993 d1110193      Age of Indiv… &lt;NA&gt;  &lt;NA&gt;         ifels…    NA
## # ℹ 240 more rows
## # ℹ 3 more variables: maxi &lt;dbl&gt;, comp_rule &lt;chr&gt;, long_rule &lt;chr&gt;</code></pre>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="cleaning.html#cb42-1" tabindex="-1"></a>gsoep <span class="ot">&lt;-</span> gsoep_codebook <span class="sc">%&gt;%</span> </span>
<span id="cb42-2"><a href="cleaning.html#cb42-2" tabindex="-1"></a>  <span class="fu">select</span>(wave, waveletter, year) <span class="sc">%&gt;%</span></span>
<span id="cb42-3"><a href="cleaning.html#cb42-3" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">complete.cases</span>(.)) <span class="sc">%&gt;%</span></span>
<span id="cb42-4"><a href="cleaning.html#cb42-4" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">%&gt;%</span></span>
<span id="cb42-5"><a href="cleaning.html#cb42-5" tabindex="-1"></a>  <span class="fu">arrange</span>(year) <span class="sc">%&gt;%</span></span>
<span id="cb42-6"><a href="cleaning.html#cb42-6" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">!=</span> <span class="st">&quot;2018&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb42-7"><a href="cleaning.html#cb42-7" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">map2</span>(year, waveletter, gsoep_read_fun)) </span>
<span id="cb42-8"><a href="cleaning.html#cb42-8" tabindex="-1"></a></span>
<span id="cb42-9"><a href="cleaning.html#cb42-9" tabindex="-1"></a>old.names <span class="ot">&lt;-</span> <span class="fu">unique</span>(gsoep_codebook<span class="sc">$</span>orig_itemname)</span>
<span id="cb42-10"><a href="cleaning.html#cb42-10" tabindex="-1"></a>gsoep_cog <span class="ot">&lt;-</span> <span class="fu">sprintf</span>(<span class="st">&quot;%s/gsoep/cognit.sav&quot;</span>, data_path) <span class="sc">%&gt;%</span> haven<span class="sc">::</span><span class="fu">read_sav</span>(.) <span class="sc">%&gt;%</span></span>
<span id="cb42-11"><a href="cleaning.html#cb42-11" tabindex="-1"></a>  <span class="fu">select</span>(persnr, hhnr, <span class="at">year =</span> syear, <span class="fu">one_of</span>(old.names)) <span class="sc">%&gt;%</span></span>
<span id="cb42-12"><a href="cleaning.html#cb42-12" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2012</span>) <span class="sc">%&gt;%</span></span>
<span id="cb42-13"><a href="cleaning.html#cb42-13" tabindex="-1"></a>  haven<span class="sc">::</span><span class="fu">zap_labels</span>(.) <span class="sc">%&gt;%</span></span>
<span id="cb42-14"><a href="cleaning.html#cb42-14" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>hhnr) <span class="sc">%&gt;%</span></span>
<span id="cb42-15"><a href="cleaning.html#cb42-15" tabindex="-1"></a>  <span class="fu">gather</span>(<span class="at">key =</span> orig_itemname, <span class="at">value =</span> value, <span class="sc">-</span>persnr, <span class="sc">-</span>year, <span class="at">na.rm =</span> T)</span>
<span id="cb42-16"><a href="cleaning.html#cb42-16" tabindex="-1"></a></span>
<span id="cb42-17"><a href="cleaning.html#cb42-17" tabindex="-1"></a>gsoep_cog_subs <span class="ot">&lt;-</span> <span class="fu">unique</span>(gsoep_cog<span class="sc">$</span>persnr)</span>
<span id="cb42-18"><a href="cleaning.html#cb42-18" tabindex="-1"></a></span>
<span id="cb42-19"><a href="cleaning.html#cb42-19" tabindex="-1"></a>gsoep_long <span class="ot">&lt;-</span> gsoep <span class="sc">%&gt;%</span> <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb42-20"><a href="cleaning.html#cb42-20" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>hhnr) <span class="sc">%&gt;%</span></span>
<span id="cb42-21"><a href="cleaning.html#cb42-21" tabindex="-1"></a>  <span class="fu">filter</span>(persnr <span class="sc">%in%</span> gsoep_cog_subs) <span class="sc">%&gt;%</span></span>
<span id="cb42-22"><a href="cleaning.html#cb42-22" tabindex="-1"></a>  <span class="fu">full_join</span>(gsoep_cog) <span class="sc">%&gt;%</span></span>
<span id="cb42-23"><a href="cleaning.html#cb42-23" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>wave, <span class="sc">-</span>waveletter) <span class="sc">%&gt;%</span></span>
<span id="cb42-24"><a href="cleaning.html#cb42-24" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">SID =</span> persnr)</span>
<span id="cb42-25"><a href="cleaning.html#cb42-25" tabindex="-1"></a></span>
<span id="cb42-26"><a href="cleaning.html#cb42-26" tabindex="-1"></a><span class="fu">save</span>(gsoep, <span class="at">file =</span> <span class="fu">sprintf</span>(<span class="st">&quot;%s/data/clean/gsoep_raw.RData&quot;</span>, local_path))</span>
<span id="cb42-27"><a href="cleaning.html#cb42-27" tabindex="-1"></a><span class="fu">rm</span>(gsoep)</span></code></pre></div>
</div>
<div id="recoding-reverse-scoring-2" class="section level3 hasAnchor" number="2.3.2">
<h3><span class="header-section-number">2.3.2</span> Recoding &amp; Reverse Scoring<a href="cleaning.html#recoding-reverse-scoring-2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="cleaning.html#cb43-1" tabindex="-1"></a>gsoep_waves <span class="ot">&lt;-</span> p_waves <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Study <span class="sc">==</span> <span class="st">&quot;GSOEP&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(Used) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>()</span>
<span id="cb43-2"><a href="cleaning.html#cb43-2" tabindex="-1"></a></span>
<span id="cb43-3"><a href="cleaning.html#cb43-3" tabindex="-1"></a><span class="co"># join data with recoding info </span></span>
<span id="cb43-4"><a href="cleaning.html#cb43-4" tabindex="-1"></a>gsoep_recode <span class="ot">&lt;-</span> gsoep_codebook <span class="sc">%&gt;%</span></span>
<span id="cb43-5"><a href="cleaning.html#cb43-5" tabindex="-1"></a>  <span class="fu">filter</span>(category <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;pers&quot;</span>, <span class="st">&quot;outcome&quot;</span>, <span class="st">&quot;covariates&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb43-6"><a href="cleaning.html#cb43-6" tabindex="-1"></a>  <span class="fu">select</span>(category, name, itemname, wave, year, orig_itemname, reverse_code<span class="sc">:</span>long_rule) <span class="sc">%&gt;%</span></span>
<span id="cb43-7"><a href="cleaning.html#cb43-7" tabindex="-1"></a>  <span class="fu">group_by</span>(category, name) <span class="sc">%&gt;%</span> </span>
<span id="cb43-8"><a href="cleaning.html#cb43-8" tabindex="-1"></a>  <span class="fu">nest</span>() <span class="sc">%&gt;%</span></span>
<span id="cb43-9"><a href="cleaning.html#cb43-9" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb43-10"><a href="cleaning.html#cb43-10" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">map</span>(data, <span class="sc">~</span>(.) <span class="sc">%&gt;%</span> <span class="fu">left_join</span>(gsoep_long))) </span>
<span id="cb43-11"><a href="cleaning.html#cb43-11" tabindex="-1"></a></span>
<span id="cb43-12"><a href="cleaning.html#cb43-12" tabindex="-1"></a><span class="co"># recode </span></span>
<span id="cb43-13"><a href="cleaning.html#cb43-13" tabindex="-1"></a>recode_fun <span class="ot">&lt;-</span> <span class="cf">function</span>(rule, y, year, p_year){</span>
<span id="cb43-14"><a href="cleaning.html#cb43-14" tabindex="-1"></a>  x <span class="ot">&lt;-</span> y<span class="sc">$</span>value</span>
<span id="cb43-15"><a href="cleaning.html#cb43-15" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.na</span>(rule)){y<span class="sc">$</span>value <span class="ot">&lt;-</span> <span class="fu">eval</span>(<span class="fu">parse</span>(<span class="at">text =</span> rule))}</span>
<span id="cb43-16"><a href="cleaning.html#cb43-16" tabindex="-1"></a>  <span class="fu">return</span>(y)</span>
<span id="cb43-17"><a href="cleaning.html#cb43-17" tabindex="-1"></a>}</span>
<span id="cb43-18"><a href="cleaning.html#cb43-18" tabindex="-1"></a></span>
<span id="cb43-19"><a href="cleaning.html#cb43-19" tabindex="-1"></a>gsoep_recode <span class="ot">&lt;-</span> gsoep_recode <span class="sc">%&gt;%</span> </span>
<span id="cb43-20"><a href="cleaning.html#cb43-20" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">map</span>(data, <span class="sc">~</span>(.) <span class="sc">%&gt;%</span> </span>
<span id="cb43-21"><a href="cleaning.html#cb43-21" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">p_year =</span> <span class="dv">2005</span>) <span class="sc">%&gt;%</span></span>
<span id="cb43-22"><a href="cleaning.html#cb43-22" tabindex="-1"></a>    <span class="fu">group_by</span>(recode, year, p_year) <span class="sc">%&gt;%</span></span>
<span id="cb43-23"><a href="cleaning.html#cb43-23" tabindex="-1"></a>    <span class="fu">nest</span>() <span class="sc">%&gt;%</span></span>
<span id="cb43-24"><a href="cleaning.html#cb43-24" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb43-25"><a href="cleaning.html#cb43-25" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">pmap</span>(<span class="fu">list</span>(recode, data, year, p_year), recode_fun)) <span class="sc">%&gt;%</span></span>
<span id="cb43-26"><a href="cleaning.html#cb43-26" tabindex="-1"></a>    <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb43-27"><a href="cleaning.html#cb43-27" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">ifelse</span>(value <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">|</span> <span class="fu">is.nan</span>(value) <span class="sc">|</span> <span class="fu">is.infinite</span>(value), <span class="cn">NA</span>, value))))</span>
<span id="cb43-28"><a href="cleaning.html#cb43-28" tabindex="-1"></a></span>
<span id="cb43-29"><a href="cleaning.html#cb43-29" tabindex="-1"></a></span>
<span id="cb43-30"><a href="cleaning.html#cb43-30" tabindex="-1"></a><span class="co"># reverse code </span></span>
<span id="cb43-31"><a href="cleaning.html#cb43-31" tabindex="-1"></a>gsoep_recode <span class="ot">&lt;-</span> gsoep_recode <span class="sc">%&gt;%</span></span>
<span id="cb43-32"><a href="cleaning.html#cb43-32" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">map</span>(data, <span class="sc">~</span>(.) <span class="sc">%&gt;%</span></span>
<span id="cb43-33"><a href="cleaning.html#cb43-33" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">ifelse</span>(reverse_code <span class="sc">==</span> <span class="st">&quot;no&quot;</span> <span class="sc">|</span> <span class="fu">is.na</span>(reverse_code), value, </span>
<span id="cb43-34"><a href="cleaning.html#cb43-34" tabindex="-1"></a>                        <span class="fu">reverse.code</span>(<span class="sc">-</span><span class="dv">1</span>, value, <span class="at">mini =</span> mini, <span class="at">maxi =</span> maxi)))))</span>
<span id="cb43-35"><a href="cleaning.html#cb43-35" tabindex="-1"></a></span>
<span id="cb43-36"><a href="cleaning.html#cb43-36" tabindex="-1"></a>fun_call <span class="ot">&lt;-</span> <span class="cf">function</span>(x, rule){</span>
<span id="cb43-37"><a href="cleaning.html#cb43-37" tabindex="-1"></a>    <span class="cf">switch</span>(rule,</span>
<span id="cb43-38"><a href="cleaning.html#cb43-38" tabindex="-1"></a>           <span class="at">average =</span> <span class="fu">mean</span>(x, <span class="at">na.rm =</span> T),</span>
<span id="cb43-39"><a href="cleaning.html#cb43-39" tabindex="-1"></a>           <span class="at">mode =</span> <span class="fu">Mode</span>(x)[<span class="dv">1</span>],</span>
<span id="cb43-40"><a href="cleaning.html#cb43-40" tabindex="-1"></a>           <span class="at">sum =</span> <span class="fu">sum</span>(x, <span class="at">na.rm =</span> T),</span>
<span id="cb43-41"><a href="cleaning.html#cb43-41" tabindex="-1"></a>           <span class="at">skip =</span> <span class="fu">unique</span>(x)[<span class="dv">1</span>],</span>
<span id="cb43-42"><a href="cleaning.html#cb43-42" tabindex="-1"></a>           <span class="at">select =</span> <span class="fu">unique</span>(x)[<span class="dv">1</span>],</span>
<span id="cb43-43"><a href="cleaning.html#cb43-43" tabindex="-1"></a>           <span class="at">max =</span> <span class="fu">max</span>(x, <span class="at">na.rm =</span> T),</span>
<span id="cb43-44"><a href="cleaning.html#cb43-44" tabindex="-1"></a>           <span class="at">min =</span> <span class="fu">min</span>(x, <span class="at">na.rm =</span> T))</span>
<span id="cb43-45"><a href="cleaning.html#cb43-45" tabindex="-1"></a>  }</span></code></pre></div>
</div>
<div id="covariates-2" class="section level3 hasAnchor" number="2.3.3">
<h3><span class="header-section-number">2.3.3</span> Covariates<a href="cleaning.html#covariates-2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="cleaning.html#cb44-1" tabindex="-1"></a><span class="co"># composite WITHIN years </span></span>
<span id="cb44-2"><a href="cleaning.html#cb44-2" tabindex="-1"></a>gsoep_cov <span class="ot">&lt;-</span> gsoep_recode <span class="sc">%&gt;%</span></span>
<span id="cb44-3"><a href="cleaning.html#cb44-3" tabindex="-1"></a>  <span class="fu">filter</span>(category <span class="sc">==</span> <span class="st">&quot;covariates&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb44-4"><a href="cleaning.html#cb44-4" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>category) <span class="sc">%&gt;%</span></span>
<span id="cb44-5"><a href="cleaning.html#cb44-5" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">map</span>(data, <span class="sc">~</span>(.) <span class="sc">%&gt;%</span> </span>
<span id="cb44-6"><a href="cleaning.html#cb44-6" tabindex="-1"></a>      <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(value)) <span class="sc">%&gt;%</span></span>
<span id="cb44-7"><a href="cleaning.html#cb44-7" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">comp_rule =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(comp_rule), <span class="st">&quot;skip&quot;</span>, comp_rule)) <span class="sc">%&gt;%</span></span>
<span id="cb44-8"><a href="cleaning.html#cb44-8" tabindex="-1"></a>      <span class="fu">group_by</span>(comp_rule, SID, year, p_year, long_rule) <span class="sc">%&gt;%</span></span>
<span id="cb44-9"><a href="cleaning.html#cb44-9" tabindex="-1"></a>      <span class="fu">nest</span>() <span class="sc">%&gt;%</span></span>
<span id="cb44-10"><a href="cleaning.html#cb44-10" tabindex="-1"></a>      <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb44-11"><a href="cleaning.html#cb44-11" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">map2</span>(data, comp_rule, <span class="sc">~</span><span class="fu">fun_call</span>((.x)<span class="sc">$</span>value, .y))) <span class="sc">%&gt;%</span></span>
<span id="cb44-12"><a href="cleaning.html#cb44-12" tabindex="-1"></a>      <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb44-13"><a href="cleaning.html#cb44-13" tabindex="-1"></a>      <span class="fu">filter</span>(year <span class="sc">&lt;=</span> p_year)</span>
<span id="cb44-14"><a href="cleaning.html#cb44-14" tabindex="-1"></a>      <span class="co"># summarize(value = fun_call(value, comp_rule)) %&gt;%</span></span>
<span id="cb44-15"><a href="cleaning.html#cb44-15" tabindex="-1"></a>      <span class="co"># ungroup() %&gt;% </span></span>
<span id="cb44-16"><a href="cleaning.html#cb44-16" tabindex="-1"></a>      <span class="co"># mutate(value = ifelse(is.infinite(value) | is.nan(value), NA, value))</span></span>
<span id="cb44-17"><a href="cleaning.html#cb44-17" tabindex="-1"></a>      ))</span>
<span id="cb44-18"><a href="cleaning.html#cb44-18" tabindex="-1"></a></span>
<span id="cb44-19"><a href="cleaning.html#cb44-19" tabindex="-1"></a>comp_fun <span class="ot">&lt;-</span> <span class="cf">function</span>(d, rule, p_year){</span>
<span id="cb44-20"><a href="cleaning.html#cb44-20" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">paste</span>(rule, p_year))</span>
<span id="cb44-21"><a href="cleaning.html#cb44-21" tabindex="-1"></a>  d <span class="sc">%&gt;%</span></span>
<span id="cb44-22"><a href="cleaning.html#cb44-22" tabindex="-1"></a>    <span class="fu">group_by</span>(SID, name) <span class="sc">%&gt;%</span></span>
<span id="cb44-23"><a href="cleaning.html#cb44-23" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">value =</span> <span class="fu">fun_call</span>(data, rule)) <span class="sc">%&gt;%</span></span>
<span id="cb44-24"><a href="cleaning.html#cb44-24" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb44-25"><a href="cleaning.html#cb44-25" tabindex="-1"></a>    <span class="fu">distinct</span>()</span>
<span id="cb44-26"><a href="cleaning.html#cb44-26" tabindex="-1"></a>}</span>
<span id="cb44-27"><a href="cleaning.html#cb44-27" tabindex="-1"></a></span>
<span id="cb44-28"><a href="cleaning.html#cb44-28" tabindex="-1"></a><span class="co"># composite ACROSS years</span></span>
<span id="cb44-29"><a href="cleaning.html#cb44-29" tabindex="-1"></a>gsoep_cov <span class="ot">&lt;-</span> gsoep_cov <span class="sc">%&gt;%</span></span>
<span id="cb44-30"><a href="cleaning.html#cb44-30" tabindex="-1"></a>  <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb44-31"><a href="cleaning.html#cb44-31" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">long_rule =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(long_rule), <span class="st">&quot;skip&quot;</span>, long_rule)) <span class="sc">%&gt;%</span></span>
<span id="cb44-32"><a href="cleaning.html#cb44-32" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">&lt;=</span> p_year) <span class="sc">%&gt;%</span></span>
<span id="cb44-33"><a href="cleaning.html#cb44-33" tabindex="-1"></a>  <span class="fu">group_by</span>(p_year, long_rule) <span class="sc">%&gt;%</span></span>
<span id="cb44-34"><a href="cleaning.html#cb44-34" tabindex="-1"></a>  <span class="fu">nest</span>() <span class="sc">%&gt;%</span></span>
<span id="cb44-35"><a href="cleaning.html#cb44-35" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb44-36"><a href="cleaning.html#cb44-36" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">pmap</span>(<span class="fu">list</span>(data, long_rule, p_year), comp_fun)) <span class="sc">%&gt;%</span></span>
<span id="cb44-37"><a href="cleaning.html#cb44-37" tabindex="-1"></a>  <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb44-38"><a href="cleaning.html#cb44-38" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">ifelse</span>(<span class="fu">is.infinite</span>(value) <span class="sc">|</span> <span class="fu">is.nan</span>(value), <span class="cn">NA</span>, value)) <span class="sc">%&gt;%</span></span>
<span id="cb44-39"><a href="cleaning.html#cb44-39" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>long_rule) <span class="sc">%&gt;%</span></span>
<span id="cb44-40"><a href="cleaning.html#cb44-40" tabindex="-1"></a>  <span class="fu">spread</span>(name, value) <span class="sc">%&gt;%</span></span>
<span id="cb44-41"><a href="cleaning.html#cb44-41" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(SID))</span></code></pre></div>
</div>
<div id="personality-variables-2" class="section level3 hasAnchor" number="2.3.4">
<h3><span class="header-section-number">2.3.4</span> Personality Variables<a href="cleaning.html#personality-variables-2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="cleaning.html#cb45-1" tabindex="-1"></a>gsoep_pers <span class="ot">&lt;-</span> gsoep_recode <span class="sc">%&gt;%</span></span>
<span id="cb45-2"><a href="cleaning.html#cb45-2" tabindex="-1"></a>  <span class="fu">filter</span>(category <span class="sc">==</span> <span class="st">&quot;pers&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb45-3"><a href="cleaning.html#cb45-3" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>category) <span class="sc">%&gt;%</span> </span>
<span id="cb45-4"><a href="cleaning.html#cb45-4" tabindex="-1"></a>  <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb45-5"><a href="cleaning.html#cb45-5" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> <span class="st">&quot;2005&quot;</span> <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(value)) <span class="sc">%&gt;%</span></span>
<span id="cb45-6"><a href="cleaning.html#cb45-6" tabindex="-1"></a>  <span class="fu">group_by</span>(SID, p_year, year, name, itemname, comp_rule) <span class="sc">%&gt;%</span></span>
<span id="cb45-7"><a href="cleaning.html#cb45-7" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">value =</span> <span class="fu">mean</span>(value, <span class="at">na.rm =</span> T)) <span class="sc">%&gt;%</span></span>
<span id="cb45-8"><a href="cleaning.html#cb45-8" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb45-9"><a href="cleaning.html#cb45-9" tabindex="-1"></a></span>
<span id="cb45-10"><a href="cleaning.html#cb45-10" tabindex="-1"></a><span class="co"># alpha&#39;s</span></span>
<span id="cb45-11"><a href="cleaning.html#cb45-11" tabindex="-1"></a>gsoep_alpha <span class="ot">&lt;-</span> gsoep_pers <span class="sc">%&gt;%</span></span>
<span id="cb45-12"><a href="cleaning.html#cb45-12" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(value)) <span class="sc">%&gt;%</span></span>
<span id="cb45-13"><a href="cleaning.html#cb45-13" tabindex="-1"></a>  <span class="fu">select</span>(name, itemname, year, SID, value) <span class="sc">%&gt;%</span></span>
<span id="cb45-14"><a href="cleaning.html#cb45-14" tabindex="-1"></a>  <span class="fu">group_by</span>(name, year) <span class="sc">%&gt;%</span></span>
<span id="cb45-15"><a href="cleaning.html#cb45-15" tabindex="-1"></a>  <span class="fu">nest</span>() <span class="sc">%&gt;%</span></span>
<span id="cb45-16"><a href="cleaning.html#cb45-16" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">map</span>(data, <span class="sc">~</span>(.) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>() <span class="sc">%&gt;%</span> <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> itemname, <span class="at">values_from =</span> value, <span class="at">values_fn =</span> <span class="fu">list</span>(mean))),</span>
<span id="cb45-17"><a href="cleaning.html#cb45-17" tabindex="-1"></a>         <span class="at">alpha =</span> <span class="fu">map</span>(data, <span class="fu">possibly</span>(<span class="sc">~</span>psych<span class="sc">::</span><span class="fu">alpha</span>((.) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>SID)), <span class="cn">NA_real_</span>)))</span>
<span id="cb45-18"><a href="cleaning.html#cb45-18" tabindex="-1"></a></span>
<span id="cb45-19"><a href="cleaning.html#cb45-19" tabindex="-1"></a>comp_fun <span class="ot">&lt;-</span> <span class="cf">function</span>(df, rule){</span>
<span id="cb45-20"><a href="cleaning.html#cb45-20" tabindex="-1"></a>  df <span class="sc">%&gt;%</span></span>
<span id="cb45-21"><a href="cleaning.html#cb45-21" tabindex="-1"></a>    <span class="fu">group_by</span>(SID) <span class="sc">%&gt;%</span></span>
<span id="cb45-22"><a href="cleaning.html#cb45-22" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">value =</span> <span class="fu">fun_call</span>(value, rule)) <span class="sc">%&gt;%</span></span>
<span id="cb45-23"><a href="cleaning.html#cb45-23" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb45-24"><a href="cleaning.html#cb45-24" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">ifelse</span>(<span class="fu">is.infinite</span>(value) <span class="sc">|</span> <span class="fu">is.nan</span>(value), <span class="cn">NA</span>, value))</span>
<span id="cb45-25"><a href="cleaning.html#cb45-25" tabindex="-1"></a>}</span>
<span id="cb45-26"><a href="cleaning.html#cb45-26" tabindex="-1"></a></span>
<span id="cb45-27"><a href="cleaning.html#cb45-27" tabindex="-1"></a><span class="co"># create composites</span></span>
<span id="cb45-28"><a href="cleaning.html#cb45-28" tabindex="-1"></a>gsoep_pers <span class="ot">&lt;-</span> gsoep_pers <span class="sc">%&gt;%</span></span>
<span id="cb45-29"><a href="cleaning.html#cb45-29" tabindex="-1"></a>  <span class="fu">group_by</span>(name, comp_rule, year) <span class="sc">%&gt;%</span></span>
<span id="cb45-30"><a href="cleaning.html#cb45-30" tabindex="-1"></a>  <span class="fu">nest</span>() <span class="sc">%&gt;%</span></span>
<span id="cb45-31"><a href="cleaning.html#cb45-31" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb45-32"><a href="cleaning.html#cb45-32" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">map2</span>(data, comp_rule, comp_fun)) <span class="sc">%&gt;%</span></span>
<span id="cb45-33"><a href="cleaning.html#cb45-33" tabindex="-1"></a>  <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb45-34"><a href="cleaning.html#cb45-34" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>comp_rule)</span></code></pre></div>
</div>
<div id="outcome-variables-2" class="section level3 hasAnchor" number="2.3.5">
<h3><span class="header-section-number">2.3.5</span> Outcome Variables<a href="cleaning.html#outcome-variables-2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="cleaning.html#cb46-1" tabindex="-1"></a><span class="co"># composite within years</span></span>
<span id="cb46-2"><a href="cleaning.html#cb46-2" tabindex="-1"></a>gsoep_out <span class="ot">&lt;-</span> gsoep_recode <span class="sc">%&gt;%</span></span>
<span id="cb46-3"><a href="cleaning.html#cb46-3" tabindex="-1"></a>  <span class="fu">filter</span>(category <span class="sc">==</span> <span class="st">&quot;outcome&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb46-4"><a href="cleaning.html#cb46-4" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>category) <span class="sc">%&gt;%</span></span>
<span id="cb46-5"><a href="cleaning.html#cb46-5" tabindex="-1"></a>  <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb46-6"><a href="cleaning.html#cb46-6" tabindex="-1"></a>  <span class="fu">group_by</span>(name, year, SID) <span class="sc">%&gt;%</span></span>
<span id="cb46-7"><a href="cleaning.html#cb46-7" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">value =</span> <span class="fu">sum</span>(value, <span class="at">na.rm =</span> T)) <span class="sc">%&gt;%</span></span>
<span id="cb46-8"><a href="cleaning.html#cb46-8" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code></pre></div>
</div>
<div id="combine-data-2" class="section level3 hasAnchor" number="2.3.6">
<h3><span class="header-section-number">2.3.6</span> Combine Data<a href="cleaning.html#combine-data-2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="cleaning.html#cb47-1" tabindex="-1"></a>gsoep_combined <span class="ot">&lt;-</span> gsoep_pers <span class="sc">%&gt;%</span> </span>
<span id="cb47-2"><a href="cleaning.html#cb47-2" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Trait =</span> name, <span class="at">p_value =</span> value, <span class="at">p_year =</span> year) <span class="sc">%&gt;%</span></span>
<span id="cb47-3"><a href="cleaning.html#cb47-3" tabindex="-1"></a>  <span class="fu">full_join</span>(gsoep_out <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">Outcome =</span> name, <span class="at">o_value =</span> value, <span class="at">o_year =</span> year)) <span class="sc">%&gt;%</span></span>
<span id="cb47-4"><a href="cleaning.html#cb47-4" tabindex="-1"></a>  <span class="fu">full_join</span>(gsoep_cov) <span class="sc">%&gt;%</span></span>
<span id="cb47-5"><a href="cleaning.html#cb47-5" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(p_value) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(o_value))</span></code></pre></div>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="cleaning.html#cb48-1" tabindex="-1"></a><span class="fu">save</span>(gsoep_cov, gsoep_alpha, gsoep_pers, gsoep_out, gsoep_combined,</span>
<span id="cb48-2"><a href="cleaning.html#cb48-2" tabindex="-1"></a>     <span class="at">file =</span> <span class="fu">sprintf</span>(<span class="st">&quot;%s/data/clean/gsoep_cleaned.RData&quot;</span>, local_path))</span></code></pre></div>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="cleaning.html#cb49-1" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span><span class="fu">ls</span>()[<span class="fu">grepl</span>(<span class="st">&quot;gsoep&quot;</span>, <span class="fu">ls</span>())])</span></code></pre></div>
</div>
</div>
<div id="household-income-and-labour-dynamics-in-australia-hilda" class="section level2 hasAnchor" number="2.4">
<h2><span class="header-section-number">2.4</span> Household, Income, and Labour Dynamics in Australia (HILDA)<a href="cleaning.html#household-income-and-labour-dynamics-in-australia-hilda" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The Household Income and Labour Dynamics in Australia (HILDA; Wilkins, Laß, Butterworth, &amp; Vera-Toscano, 2019) study is an ongoing longitudinal study of Australian households. These data are available through application from <a href="https://melbourneinstitute.unimelb.edu.au/hilda/for-data-users" class="uri">https://melbourneinstitute.unimelb.edu.au/hilda/for-data-users</a>.</p>
<p>Participants were recruited from more than 17,000 individuals. Data have been collected annually since 2001. The latest data release includes 17 waves of data from 2001 to 2017. More documentation can be found in the HILDA data dictionary at <a href="https://www.online.fbe.unimelb.edu.au/HILDAodd/srchSubjectAreas.aspx" class="uri">https://www.online.fbe.unimelb.edu.au/HILDAodd/srchSubjectAreas.aspx</a>.</p>
<p>Sample sizes vary by year, ranging from 12,408 (2004) to 17,693 (2016). This provides 99% power to detect a zero-order correlation effect size of ~.03, two tailed at alpha .05.</p>
<div id="load-data-3" class="section level3 hasAnchor" number="2.4.1">
<h3><span class="header-section-number">2.4.1</span> Load Data<a href="cleaning.html#load-data-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="cleaning.html#cb50-1" tabindex="-1"></a>hilda_read_fun <span class="ot">&lt;-</span> <span class="cf">function</span>(Year, WL){</span>
<span id="cb50-2"><a href="cleaning.html#cb50-2" tabindex="-1"></a>  old.names <span class="ot">&lt;-</span> (hilda_codebook <span class="sc">%&gt;%</span> <span class="fu">filter</span>(year <span class="sc">==</span> Year <span class="sc">|</span> year <span class="sc">==</span> <span class="dv">0</span>))<span class="sc">$</span>orig_itemname</span>
<span id="cb50-3"><a href="cleaning.html#cb50-3" tabindex="-1"></a>  <span class="fu">sprintf</span>(<span class="st">&quot;%s/hilda/Combined %s180c.sav&quot;</span>, data_path, WL) <span class="sc">%&gt;%</span> haven<span class="sc">::</span><span class="fu">read_sav</span>(.) <span class="sc">%&gt;%</span></span>
<span id="cb50-4"><a href="cleaning.html#cb50-4" tabindex="-1"></a>    <span class="fu">select</span>(<span class="fu">one_of</span>(old.names)) </span>
<span id="cb50-5"><a href="cleaning.html#cb50-5" tabindex="-1"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="cleaning.html#cb51-1" tabindex="-1"></a>hilda_codebook <span class="ot">&lt;-</span> (codebook <span class="sc">%&gt;%</span> <span class="fu">filter</span>(study <span class="sc">==</span> <span class="st">&quot;HILDA&quot;</span>))<span class="sc">$</span>codebook[[<span class="dv">1</span>]]</span>
<span id="cb51-2"><a href="cleaning.html#cb51-2" tabindex="-1"></a>hilda_codebook</span></code></pre></div>
<pre><code>## # A tibble: 217 × 17
##    study dataset category   name   itemname wave_letter ...7   year orig_itemname description scale reverse_code recode  mini
##    &lt;chr&gt; &lt;lgl&gt;   &lt;chr&gt;      &lt;chr&gt;  &lt;chr&gt;    &lt;chr&gt;       &lt;chr&gt; &lt;dbl&gt; &lt;chr&gt;         &lt;chr&gt;       &lt;chr&gt; &lt;chr&gt;        &lt;chr&gt;  &lt;dbl&gt;
##  1 hilda NA      covariates educa… educati… A           01     2001 aedhigh1      Highest ed… 1=po… &lt;NA&gt;         ifels…    NA
##  2 hilda NA      covariates educa… educati… B           02     2002 bedhigh1      Highest ed… 1=po… &lt;NA&gt;         ifels…    NA
##  3 hilda NA      covariates educa… educati… C           03     2003 cedhigh1      Highest ed… 1=po… &lt;NA&gt;         ifels…    NA
##  4 hilda NA      covariates educa… educati… D           04     2004 dedhigh1      Highest ed… 1=po… &lt;NA&gt;         ifels…    NA
##  5 hilda NA      covariates educa… educati… E           05     2005 eedhigh1      Highest ed… 1=po… &lt;NA&gt;         ifels…    NA
##  6 hilda NA      covariates educa… educati… F           06     2006 fedhigh1      Highest ed… 1=po… &lt;NA&gt;         ifels…    NA
##  7 hilda NA      covariates educa… educati… G           07     2007 gedhigh1      Highest ed… 1=po… &lt;NA&gt;         ifels…    NA
##  8 hilda NA      covariates educa… educati… H           08     2008 hedhigh1      Highest ed… 1=po… &lt;NA&gt;         ifels…    NA
##  9 hilda NA      covariates educa… educati… I           09     2009 iedhigh1      Highest ed… 1=po… &lt;NA&gt;         ifels…    NA
## 10 hilda NA      covariates educa… educati… J           10     2010 jedhigh1      Highest ed… 1=po… &lt;NA&gt;         ifels…    NA
## # ℹ 207 more rows
## # ℹ 3 more variables: maxi &lt;dbl&gt;, comp_rule &lt;chr&gt;, long_rule &lt;chr&gt;</code></pre>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="cleaning.html#cb53-1" tabindex="-1"></a>hilda <span class="ot">&lt;-</span> hilda_codebook <span class="sc">%&gt;%</span> </span>
<span id="cb53-2"><a href="cleaning.html#cb53-2" tabindex="-1"></a>  <span class="fu">select</span>(year, wave_letter) <span class="sc">%&gt;%</span></span>
<span id="cb53-3"><a href="cleaning.html#cb53-3" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(wave_letter)) <span class="sc">%&gt;%</span></span>
<span id="cb53-4"><a href="cleaning.html#cb53-4" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">%&gt;%</span></span>
<span id="cb53-5"><a href="cleaning.html#cb53-5" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">wave_letter =</span> <span class="fu">tolower</span>(wave_letter), </span>
<span id="cb53-6"><a href="cleaning.html#cb53-6" tabindex="-1"></a>         <span class="at">data =</span> <span class="fu">map2</span>(year, wave_letter, hilda_read_fun)) </span>
<span id="cb53-7"><a href="cleaning.html#cb53-7" tabindex="-1"></a></span>
<span id="cb53-8"><a href="cleaning.html#cb53-8" tabindex="-1"></a><span class="fu">save</span>(hilda, <span class="at">file =</span> <span class="fu">sprintf</span>(<span class="st">&quot;%s/data/clean/hilda_raw.RData&quot;</span>, local_path))</span></code></pre></div>
</div>
<div id="recoding-reverse-scoring-3" class="section level3 hasAnchor" number="2.4.2">
<h3><span class="header-section-number">2.4.2</span> Recoding &amp; Reverse Scoring<a href="cleaning.html#recoding-reverse-scoring-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="cleaning.html#cb54-1" tabindex="-1"></a>hilda_waves <span class="ot">&lt;-</span> p_waves <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Study <span class="sc">==</span> <span class="st">&quot;HILDA&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(Used) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>()</span>
<span id="cb54-2"><a href="cleaning.html#cb54-2" tabindex="-1"></a></span>
<span id="cb54-3"><a href="cleaning.html#cb54-3" tabindex="-1"></a>rename_fun <span class="ot">&lt;-</span> <span class="cf">function</span>(df, Year){</span>
<span id="cb54-4"><a href="cleaning.html#cb54-4" tabindex="-1"></a>  df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb54-5"><a href="cleaning.html#cb54-5" tabindex="-1"></a>    haven<span class="sc">::</span><span class="fu">zap_labels</span>(.) <span class="sc">%&gt;%</span></span>
<span id="cb54-6"><a href="cleaning.html#cb54-6" tabindex="-1"></a>    <span class="fu">gather</span>(<span class="at">key =</span> orig_itemname, <span class="at">value =</span> value, <span class="sc">-</span>xwaveid, <span class="at">na.rm=</span>T) <span class="sc">%&gt;%</span></span>
<span id="cb54-7"><a href="cleaning.html#cb54-7" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">value=</span><span class="fu">as.numeric</span>(value))</span>
<span id="cb54-8"><a href="cleaning.html#cb54-8" tabindex="-1"></a>  hilda_codebook <span class="sc">%&gt;%</span> </span>
<span id="cb54-9"><a href="cleaning.html#cb54-9" tabindex="-1"></a>    <span class="fu">select</span>(category, name, itemname, year, orig_itemname, reverse_code<span class="sc">:</span>long_rule) <span class="sc">%&gt;%</span></span>
<span id="cb54-10"><a href="cleaning.html#cb54-10" tabindex="-1"></a>    <span class="fu">filter</span>(year <span class="sc">==</span> Year <span class="sc">&amp;</span> category <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;pers&quot;</span>, <span class="st">&quot;outcome&quot;</span>, <span class="st">&quot;covariates&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb54-11"><a href="cleaning.html#cb54-11" tabindex="-1"></a>    <span class="fu">full_join</span>(df)</span>
<span id="cb54-12"><a href="cleaning.html#cb54-12" tabindex="-1"></a>}</span>
<span id="cb54-13"><a href="cleaning.html#cb54-13" tabindex="-1"></a></span>
<span id="cb54-14"><a href="cleaning.html#cb54-14" tabindex="-1"></a><span class="co"># join data with recoding info </span></span>
<span id="cb54-15"><a href="cleaning.html#cb54-15" tabindex="-1"></a>hilda_recode <span class="ot">&lt;-</span> hilda <span class="sc">%&gt;%</span></span>
<span id="cb54-16"><a href="cleaning.html#cb54-16" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">map2</span>(data, year, rename_fun)) <span class="sc">%&gt;%</span> </span>
<span id="cb54-17"><a href="cleaning.html#cb54-17" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>year, <span class="sc">-</span>wave_letter) <span class="sc">%&gt;%</span></span>
<span id="cb54-18"><a href="cleaning.html#cb54-18" tabindex="-1"></a>  <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb54-19"><a href="cleaning.html#cb54-19" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">%&gt;%</span></span>
<span id="cb54-20"><a href="cleaning.html#cb54-20" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">SID =</span> xwaveid) <span class="sc">%&gt;%</span></span>
<span id="cb54-21"><a href="cleaning.html#cb54-21" tabindex="-1"></a>  <span class="fu">group_by</span>(category, name) <span class="sc">%&gt;%</span></span>
<span id="cb54-22"><a href="cleaning.html#cb54-22" tabindex="-1"></a>  <span class="fu">nest</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb54-23"><a href="cleaning.html#cb54-23" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb54-24"><a href="cleaning.html#cb54-24" tabindex="-1"></a></span>
<span id="cb54-25"><a href="cleaning.html#cb54-25" tabindex="-1"></a><span class="co"># recode </span></span>
<span id="cb54-26"><a href="cleaning.html#cb54-26" tabindex="-1"></a>recode_fun <span class="ot">&lt;-</span> <span class="cf">function</span>(rule, y, year, p_year){</span>
<span id="cb54-27"><a href="cleaning.html#cb54-27" tabindex="-1"></a>  x <span class="ot">&lt;-</span> y<span class="sc">$</span>value</span>
<span id="cb54-28"><a href="cleaning.html#cb54-28" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.na</span>(rule)){y<span class="sc">$</span>value <span class="ot">&lt;-</span> <span class="fu">eval</span>(<span class="fu">parse</span>(<span class="at">text =</span> rule))}</span>
<span id="cb54-29"><a href="cleaning.html#cb54-29" tabindex="-1"></a>  <span class="fu">return</span>(y)</span>
<span id="cb54-30"><a href="cleaning.html#cb54-30" tabindex="-1"></a>}</span>
<span id="cb54-31"><a href="cleaning.html#cb54-31" tabindex="-1"></a></span>
<span id="cb54-32"><a href="cleaning.html#cb54-32" tabindex="-1"></a>hilda_recode <span class="ot">&lt;-</span> hilda_recode <span class="sc">%&gt;%</span> </span>
<span id="cb54-33"><a href="cleaning.html#cb54-33" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">map</span>(data, <span class="sc">~</span>(.) <span class="sc">%&gt;%</span> </span>
<span id="cb54-34"><a href="cleaning.html#cb54-34" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">p_year =</span> <span class="dv">2005</span>) <span class="sc">%&gt;%</span></span>
<span id="cb54-35"><a href="cleaning.html#cb54-35" tabindex="-1"></a>    <span class="fu">group_by</span>(recode, year, p_year) <span class="sc">%&gt;%</span></span>
<span id="cb54-36"><a href="cleaning.html#cb54-36" tabindex="-1"></a>    <span class="fu">nest</span>() <span class="sc">%&gt;%</span></span>
<span id="cb54-37"><a href="cleaning.html#cb54-37" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb54-38"><a href="cleaning.html#cb54-38" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">pmap</span>(<span class="fu">list</span>(recode, data, year, p_year), recode_fun)) <span class="sc">%&gt;%</span></span>
<span id="cb54-39"><a href="cleaning.html#cb54-39" tabindex="-1"></a>    <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb54-40"><a href="cleaning.html#cb54-40" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">ifelse</span>(value <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">|</span> <span class="fu">is.nan</span>(value) <span class="sc">|</span> <span class="fu">is.infinite</span>(value), <span class="cn">NA</span>, value))))</span>
<span id="cb54-41"><a href="cleaning.html#cb54-41" tabindex="-1"></a></span>
<span id="cb54-42"><a href="cleaning.html#cb54-42" tabindex="-1"></a></span>
<span id="cb54-43"><a href="cleaning.html#cb54-43" tabindex="-1"></a><span class="co"># reverse code </span></span>
<span id="cb54-44"><a href="cleaning.html#cb54-44" tabindex="-1"></a>hilda_recode <span class="ot">&lt;-</span> hilda_recode <span class="sc">%&gt;%</span></span>
<span id="cb54-45"><a href="cleaning.html#cb54-45" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">map</span>(data, <span class="sc">~</span>(.) <span class="sc">%&gt;%</span></span>
<span id="cb54-46"><a href="cleaning.html#cb54-46" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">ifelse</span>(reverse_code <span class="sc">==</span> <span class="st">&quot;no&quot;</span> <span class="sc">|</span> <span class="fu">is.na</span>(reverse_code), value, </span>
<span id="cb54-47"><a href="cleaning.html#cb54-47" tabindex="-1"></a>                        <span class="fu">reverse.code</span>(<span class="sc">-</span><span class="dv">1</span>, value, <span class="at">mini =</span> mini, <span class="at">maxi =</span> maxi)))))</span>
<span id="cb54-48"><a href="cleaning.html#cb54-48" tabindex="-1"></a></span>
<span id="cb54-49"><a href="cleaning.html#cb54-49" tabindex="-1"></a>fun_call <span class="ot">&lt;-</span> <span class="cf">function</span>(x, rule){</span>
<span id="cb54-50"><a href="cleaning.html#cb54-50" tabindex="-1"></a>    <span class="cf">switch</span>(rule,</span>
<span id="cb54-51"><a href="cleaning.html#cb54-51" tabindex="-1"></a>           <span class="at">average =</span> <span class="fu">mean</span>(x, <span class="at">na.rm =</span> T),</span>
<span id="cb54-52"><a href="cleaning.html#cb54-52" tabindex="-1"></a>           <span class="at">mode =</span> <span class="fu">Mode</span>(x)[<span class="dv">1</span>],</span>
<span id="cb54-53"><a href="cleaning.html#cb54-53" tabindex="-1"></a>           <span class="at">sum =</span> <span class="fu">sum</span>(x, <span class="at">na.rm =</span> T),</span>
<span id="cb54-54"><a href="cleaning.html#cb54-54" tabindex="-1"></a>           <span class="at">skip =</span> <span class="fu">unique</span>(x)[<span class="dv">1</span>],</span>
<span id="cb54-55"><a href="cleaning.html#cb54-55" tabindex="-1"></a>           <span class="at">select =</span> <span class="fu">unique</span>(x)[<span class="dv">1</span>],</span>
<span id="cb54-56"><a href="cleaning.html#cb54-56" tabindex="-1"></a>           <span class="at">max =</span> <span class="fu">max</span>(x, <span class="at">na.rm =</span> T),</span>
<span id="cb54-57"><a href="cleaning.html#cb54-57" tabindex="-1"></a>           <span class="at">min =</span> <span class="fu">min</span>(x, <span class="at">na.rm =</span> T))</span>
<span id="cb54-58"><a href="cleaning.html#cb54-58" tabindex="-1"></a>  }</span></code></pre></div>
</div>
<div id="covariates-3" class="section level3 hasAnchor" number="2.4.3">
<h3><span class="header-section-number">2.4.3</span> Covariates<a href="cleaning.html#covariates-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="cleaning.html#cb55-1" tabindex="-1"></a><span class="co"># composite WITHIN years </span></span>
<span id="cb55-2"><a href="cleaning.html#cb55-2" tabindex="-1"></a>hilda_cov <span class="ot">&lt;-</span> hilda_recode <span class="sc">%&gt;%</span></span>
<span id="cb55-3"><a href="cleaning.html#cb55-3" tabindex="-1"></a>  <span class="fu">filter</span>(category <span class="sc">==</span> <span class="st">&quot;covariates&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb55-4"><a href="cleaning.html#cb55-4" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>category) <span class="sc">%&gt;%</span></span>
<span id="cb55-5"><a href="cleaning.html#cb55-5" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">map</span>(data, <span class="sc">~</span>(.) <span class="sc">%&gt;%</span> </span>
<span id="cb55-6"><a href="cleaning.html#cb55-6" tabindex="-1"></a>      <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(value)) <span class="sc">%&gt;%</span></span>
<span id="cb55-7"><a href="cleaning.html#cb55-7" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">comp_rule =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(comp_rule), <span class="st">&quot;skip&quot;</span>, comp_rule)) <span class="sc">%&gt;%</span></span>
<span id="cb55-8"><a href="cleaning.html#cb55-8" tabindex="-1"></a>      <span class="fu">group_by</span>(comp_rule, SID, year, p_year, long_rule) <span class="sc">%&gt;%</span></span>
<span id="cb55-9"><a href="cleaning.html#cb55-9" tabindex="-1"></a>      <span class="fu">nest</span>() <span class="sc">%&gt;%</span></span>
<span id="cb55-10"><a href="cleaning.html#cb55-10" tabindex="-1"></a>      <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb55-11"><a href="cleaning.html#cb55-11" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">map2</span>(data, comp_rule, <span class="sc">~</span><span class="fu">fun_call</span>((.x)<span class="sc">$</span>value, .y))) <span class="sc">%&gt;%</span></span>
<span id="cb55-12"><a href="cleaning.html#cb55-12" tabindex="-1"></a>      <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb55-13"><a href="cleaning.html#cb55-13" tabindex="-1"></a>      <span class="fu">filter</span>(year <span class="sc">&lt;=</span> p_year)</span>
<span id="cb55-14"><a href="cleaning.html#cb55-14" tabindex="-1"></a>      <span class="co"># summarize(value = fun_call(value, comp_rule)) %&gt;%</span></span>
<span id="cb55-15"><a href="cleaning.html#cb55-15" tabindex="-1"></a>      <span class="co"># ungroup() %&gt;% </span></span>
<span id="cb55-16"><a href="cleaning.html#cb55-16" tabindex="-1"></a>      <span class="co"># mutate(value = ifelse(is.infinite(value) | is.nan(value), NA, value))</span></span>
<span id="cb55-17"><a href="cleaning.html#cb55-17" tabindex="-1"></a>      ))</span>
<span id="cb55-18"><a href="cleaning.html#cb55-18" tabindex="-1"></a></span>
<span id="cb55-19"><a href="cleaning.html#cb55-19" tabindex="-1"></a>comp_fun <span class="ot">&lt;-</span> <span class="cf">function</span>(d, rule, p_year){</span>
<span id="cb55-20"><a href="cleaning.html#cb55-20" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">paste</span>(rule, p_year))</span>
<span id="cb55-21"><a href="cleaning.html#cb55-21" tabindex="-1"></a>  d <span class="sc">%&gt;%</span></span>
<span id="cb55-22"><a href="cleaning.html#cb55-22" tabindex="-1"></a>    <span class="fu">group_by</span>(SID, name) <span class="sc">%&gt;%</span></span>
<span id="cb55-23"><a href="cleaning.html#cb55-23" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">value =</span> <span class="fu">fun_call</span>(data, rule)) <span class="sc">%&gt;%</span></span>
<span id="cb55-24"><a href="cleaning.html#cb55-24" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb55-25"><a href="cleaning.html#cb55-25" tabindex="-1"></a>    <span class="fu">distinct</span>()</span>
<span id="cb55-26"><a href="cleaning.html#cb55-26" tabindex="-1"></a>}</span>
<span id="cb55-27"><a href="cleaning.html#cb55-27" tabindex="-1"></a></span>
<span id="cb55-28"><a href="cleaning.html#cb55-28" tabindex="-1"></a><span class="co"># composite ACROSS years</span></span>
<span id="cb55-29"><a href="cleaning.html#cb55-29" tabindex="-1"></a>hilda_cov <span class="ot">&lt;-</span> hilda_cov <span class="sc">%&gt;%</span></span>
<span id="cb55-30"><a href="cleaning.html#cb55-30" tabindex="-1"></a>  <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb55-31"><a href="cleaning.html#cb55-31" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">long_rule =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(long_rule), <span class="st">&quot;skip&quot;</span>, long_rule)) <span class="sc">%&gt;%</span></span>
<span id="cb55-32"><a href="cleaning.html#cb55-32" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">&lt;=</span> p_year) <span class="sc">%&gt;%</span></span>
<span id="cb55-33"><a href="cleaning.html#cb55-33" tabindex="-1"></a>  <span class="fu">group_by</span>(p_year, long_rule) <span class="sc">%&gt;%</span></span>
<span id="cb55-34"><a href="cleaning.html#cb55-34" tabindex="-1"></a>  <span class="fu">nest</span>() <span class="sc">%&gt;%</span></span>
<span id="cb55-35"><a href="cleaning.html#cb55-35" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb55-36"><a href="cleaning.html#cb55-36" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">pmap</span>(<span class="fu">list</span>(data, long_rule, p_year), comp_fun)) <span class="sc">%&gt;%</span></span>
<span id="cb55-37"><a href="cleaning.html#cb55-37" tabindex="-1"></a>  <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb55-38"><a href="cleaning.html#cb55-38" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">ifelse</span>(<span class="fu">is.infinite</span>(value) <span class="sc">|</span> <span class="fu">is.nan</span>(value), <span class="cn">NA</span>, value)) <span class="sc">%&gt;%</span></span>
<span id="cb55-39"><a href="cleaning.html#cb55-39" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>long_rule) <span class="sc">%&gt;%</span></span>
<span id="cb55-40"><a href="cleaning.html#cb55-40" tabindex="-1"></a>  <span class="fu">spread</span>(name, value) <span class="sc">%&gt;%</span></span>
<span id="cb55-41"><a href="cleaning.html#cb55-41" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(SID))</span></code></pre></div>
</div>
<div id="personality-variables-3" class="section level3 hasAnchor" number="2.4.4">
<h3><span class="header-section-number">2.4.4</span> Personality Variables<a href="cleaning.html#personality-variables-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="cleaning.html#cb56-1" tabindex="-1"></a>hilda_pers <span class="ot">&lt;-</span> hilda_recode <span class="sc">%&gt;%</span></span>
<span id="cb56-2"><a href="cleaning.html#cb56-2" tabindex="-1"></a>  <span class="fu">filter</span>(category <span class="sc">==</span> <span class="st">&quot;pers&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb56-3"><a href="cleaning.html#cb56-3" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>category) <span class="sc">%&gt;%</span> </span>
<span id="cb56-4"><a href="cleaning.html#cb56-4" tabindex="-1"></a>  <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb56-5"><a href="cleaning.html#cb56-5" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> <span class="st">&quot;2005&quot;</span> <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(value)) <span class="sc">%&gt;%</span></span>
<span id="cb56-6"><a href="cleaning.html#cb56-6" tabindex="-1"></a>  <span class="fu">group_by</span>(SID, p_year, year, name, itemname, comp_rule) <span class="sc">%&gt;%</span></span>
<span id="cb56-7"><a href="cleaning.html#cb56-7" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">value =</span> <span class="fu">mean</span>(value, <span class="at">na.rm =</span> T)) <span class="sc">%&gt;%</span></span>
<span id="cb56-8"><a href="cleaning.html#cb56-8" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb56-9"><a href="cleaning.html#cb56-9" tabindex="-1"></a></span>
<span id="cb56-10"><a href="cleaning.html#cb56-10" tabindex="-1"></a><span class="co"># alpha&#39;s</span></span>
<span id="cb56-11"><a href="cleaning.html#cb56-11" tabindex="-1"></a>hilda_alpha <span class="ot">&lt;-</span> hilda_pers <span class="sc">%&gt;%</span></span>
<span id="cb56-12"><a href="cleaning.html#cb56-12" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(value)) <span class="sc">%&gt;%</span></span>
<span id="cb56-13"><a href="cleaning.html#cb56-13" tabindex="-1"></a>  <span class="fu">select</span>(name, itemname, year, SID, value) <span class="sc">%&gt;%</span></span>
<span id="cb56-14"><a href="cleaning.html#cb56-14" tabindex="-1"></a>  <span class="fu">group_by</span>(name, year) <span class="sc">%&gt;%</span></span>
<span id="cb56-15"><a href="cleaning.html#cb56-15" tabindex="-1"></a>  <span class="fu">nest</span>() <span class="sc">%&gt;%</span></span>
<span id="cb56-16"><a href="cleaning.html#cb56-16" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">map</span>(data, <span class="sc">~</span>(.) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>() <span class="sc">%&gt;%</span> <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> itemname, <span class="at">values_from =</span> value, <span class="at">values_fn =</span> <span class="fu">list</span>(mean))),</span>
<span id="cb56-17"><a href="cleaning.html#cb56-17" tabindex="-1"></a>         <span class="at">alpha =</span> <span class="fu">map</span>(data, <span class="fu">possibly</span>(<span class="sc">~</span>psych<span class="sc">::</span><span class="fu">alpha</span>((.) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>SID)), <span class="cn">NA_real_</span>)))</span>
<span id="cb56-18"><a href="cleaning.html#cb56-18" tabindex="-1"></a></span>
<span id="cb56-19"><a href="cleaning.html#cb56-19" tabindex="-1"></a>comp_fun <span class="ot">&lt;-</span> <span class="cf">function</span>(df, rule){</span>
<span id="cb56-20"><a href="cleaning.html#cb56-20" tabindex="-1"></a>  df <span class="sc">%&gt;%</span></span>
<span id="cb56-21"><a href="cleaning.html#cb56-21" tabindex="-1"></a>    <span class="fu">group_by</span>(SID) <span class="sc">%&gt;%</span></span>
<span id="cb56-22"><a href="cleaning.html#cb56-22" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">value =</span> <span class="fu">fun_call</span>(value, rule)) <span class="sc">%&gt;%</span></span>
<span id="cb56-23"><a href="cleaning.html#cb56-23" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb56-24"><a href="cleaning.html#cb56-24" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">ifelse</span>(<span class="fu">is.infinite</span>(value) <span class="sc">|</span> <span class="fu">is.nan</span>(value), <span class="cn">NA</span>, value))</span>
<span id="cb56-25"><a href="cleaning.html#cb56-25" tabindex="-1"></a>}</span>
<span id="cb56-26"><a href="cleaning.html#cb56-26" tabindex="-1"></a></span>
<span id="cb56-27"><a href="cleaning.html#cb56-27" tabindex="-1"></a><span class="co"># create composites</span></span>
<span id="cb56-28"><a href="cleaning.html#cb56-28" tabindex="-1"></a>hilda_pers <span class="ot">&lt;-</span> hilda_pers <span class="sc">%&gt;%</span></span>
<span id="cb56-29"><a href="cleaning.html#cb56-29" tabindex="-1"></a>  <span class="fu">group_by</span>(name, comp_rule, year) <span class="sc">%&gt;%</span></span>
<span id="cb56-30"><a href="cleaning.html#cb56-30" tabindex="-1"></a>  <span class="fu">nest</span>() <span class="sc">%&gt;%</span></span>
<span id="cb56-31"><a href="cleaning.html#cb56-31" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb56-32"><a href="cleaning.html#cb56-32" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">map2</span>(data, comp_rule, comp_fun)) <span class="sc">%&gt;%</span></span>
<span id="cb56-33"><a href="cleaning.html#cb56-33" tabindex="-1"></a>  <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb56-34"><a href="cleaning.html#cb56-34" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>comp_rule)</span></code></pre></div>
</div>
<div id="outcome-variables-3" class="section level3 hasAnchor" number="2.4.5">
<h3><span class="header-section-number">2.4.5</span> Outcome Variables<a href="cleaning.html#outcome-variables-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="cleaning.html#cb57-1" tabindex="-1"></a><span class="co"># composite within years</span></span>
<span id="cb57-2"><a href="cleaning.html#cb57-2" tabindex="-1"></a>hilda_out <span class="ot">&lt;-</span> hilda_recode <span class="sc">%&gt;%</span></span>
<span id="cb57-3"><a href="cleaning.html#cb57-3" tabindex="-1"></a>  <span class="fu">filter</span>(category <span class="sc">==</span> <span class="st">&quot;outcome&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb57-4"><a href="cleaning.html#cb57-4" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>category) <span class="sc">%&gt;%</span></span>
<span id="cb57-5"><a href="cleaning.html#cb57-5" tabindex="-1"></a>  <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb57-6"><a href="cleaning.html#cb57-6" tabindex="-1"></a>  <span class="fu">group_by</span>(name, year, SID) <span class="sc">%&gt;%</span></span>
<span id="cb57-7"><a href="cleaning.html#cb57-7" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">value =</span> <span class="fu">sum</span>(value, <span class="at">na.rm =</span> T)) <span class="sc">%&gt;%</span></span>
<span id="cb57-8"><a href="cleaning.html#cb57-8" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code></pre></div>
</div>
<div id="combine-data-3" class="section level3 hasAnchor" number="2.4.6">
<h3><span class="header-section-number">2.4.6</span> Combine Data<a href="cleaning.html#combine-data-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="cleaning.html#cb58-1" tabindex="-1"></a>hilda_combined <span class="ot">&lt;-</span> hilda_pers <span class="sc">%&gt;%</span> </span>
<span id="cb58-2"><a href="cleaning.html#cb58-2" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Trait =</span> name, <span class="at">p_value =</span> value, <span class="at">p_year =</span> year) <span class="sc">%&gt;%</span></span>
<span id="cb58-3"><a href="cleaning.html#cb58-3" tabindex="-1"></a>  <span class="fu">full_join</span>(hilda_out <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">Outcome =</span> name, <span class="at">o_value =</span> value, <span class="at">o_year =</span> year)) <span class="sc">%&gt;%</span></span>
<span id="cb58-4"><a href="cleaning.html#cb58-4" tabindex="-1"></a>  <span class="fu">full_join</span>(hilda_cov) <span class="sc">%&gt;%</span></span>
<span id="cb58-5"><a href="cleaning.html#cb58-5" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(p_value) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(o_value))</span></code></pre></div>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="cleaning.html#cb59-1" tabindex="-1"></a><span class="fu">save</span>(hilda_cov, hilda_alpha, hilda_pers, hilda_out, hilda_combined,</span>
<span id="cb59-2"><a href="cleaning.html#cb59-2" tabindex="-1"></a>     <span class="at">file =</span> <span class="fu">sprintf</span>(<span class="st">&quot;%s/data/clean/hilda_cleaned.RData&quot;</span>, local_path))</span></code></pre></div>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="cleaning.html#cb60-1" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span><span class="fu">ls</span>()[<span class="fu">grepl</span>(<span class="st">&quot;hilda&quot;</span>, <span class="fu">ls</span>())])</span></code></pre></div>
</div>
</div>
<div id="health-and-retirement-study-hrs" class="section level2 hasAnchor" number="2.5">
<h2><span class="header-section-number">2.5</span> Health and Retirement Study (HRS)<a href="cleaning.html#health-and-retirement-study-hrs" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The Health and Retirement Study [HRS; <span class="citation">(<a href="#ref-juster1995overview"><strong>juster1995overview?</strong></a>)</span>] is an ongoing longitudinal study of households in the United States. These data are available at <a href="https://hrs.isr.umich.edu" class="uri">https://hrs.isr.umich.edu</a> by creating a free account.</p>
<p>Participants were recruited from more than 35,000 individuals from the financial households of individuals born between 1931 and 1941 in the US. Data have been collected biannually since 1992. The latest data release includes data up to 2016. On average, 10,000 individuals are sampled each wave More information on the HRS can be found at <a href="https://hrs.isr.umich.edu/documentation/survey-design" class="uri">https://hrs.isr.umich.edu/documentation/survey-design</a>, but, in short, the HRS is a nationally representative sample of adults over 50 in the US. It is critical to note that the HRS samples households of the original cohort and follows individuals and their spouses or partners until their death.</p>
<p>Sample size varies by year, ranging from approximately 7,500 (2014) to 15,500 (1992). (<a href="https://hrs.isr.umich.edu/sites/default/files/biblio/ResponseRates_2017.pdf" class="uri">https://hrs.isr.umich.edu/sites/default/files/biblio/ResponseRates_2017.pdf</a>). This provides 99% power to detect a zero-order correlation effect size of ~.04, two-tailed at alpha .05.</p>
<div id="load-data-4" class="section level3 hasAnchor" number="2.5.1">
<h3><span class="header-section-number">2.5.1</span> Load Data<a href="cleaning.html#load-data-4" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="cleaning.html#cb61-1" tabindex="-1"></a>hrs_read_fun <span class="ot">&lt;-</span> <span class="cf">function</span>(year) {</span>
<span id="cb61-2"><a href="cleaning.html#cb61-2" tabindex="-1"></a>  read_da <span class="ot">&lt;-</span> <span class="cf">function</span>(da, dct, Year){</span>
<span id="cb61-3"><a href="cleaning.html#cb61-3" tabindex="-1"></a>    <span class="fu">print</span>(<span class="fu">paste</span>(da, dct, year, <span class="at">sep =</span> <span class="st">&quot; &quot;</span>))</span>
<span id="cb61-4"><a href="cleaning.html#cb61-4" tabindex="-1"></a>    data.file <span class="ot">&lt;-</span> <span class="fu">sprintf</span>(<span class="st">&quot;%s/hrs/%s/%s&quot;</span>, data_path, Year, da)</span>
<span id="cb61-5"><a href="cleaning.html#cb61-5" tabindex="-1"></a>    <span class="co"># Set path to the dictionary file &quot;*.DCT&quot;</span></span>
<span id="cb61-6"><a href="cleaning.html#cb61-6" tabindex="-1"></a>    dict.file <span class="ot">&lt;-</span> <span class="fu">sprintf</span>(<span class="st">&quot;%s/hrs/%s/%s&quot;</span>, data_path, Year, dct)</span>
<span id="cb61-7"><a href="cleaning.html#cb61-7" tabindex="-1"></a>    <span class="co"># Read the dictionary file</span></span>
<span id="cb61-8"><a href="cleaning.html#cb61-8" tabindex="-1"></a>    df.dict <span class="ot">&lt;-</span> <span class="fu">read.table</span>(dict.file, <span class="at">skip =</span> <span class="dv">1</span>, <span class="at">fill =</span> <span class="cn">TRUE</span>, <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb61-9"><a href="cleaning.html#cb61-9" tabindex="-1"></a>    <span class="co"># Set column names for dictionary dataframe</span></span>
<span id="cb61-10"><a href="cleaning.html#cb61-10" tabindex="-1"></a>    <span class="fu">colnames</span>(df.dict) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;col.num&quot;</span>,<span class="st">&quot;col.type&quot;</span>,<span class="st">&quot;col.name&quot;</span>,<span class="st">&quot;col.width&quot;</span>,<span class="st">&quot;col.lbl&quot;</span>)</span>
<span id="cb61-11"><a href="cleaning.html#cb61-11" tabindex="-1"></a>    <span class="co"># Remove last row which only contains a closing }</span></span>
<span id="cb61-12"><a href="cleaning.html#cb61-12" tabindex="-1"></a>    row <span class="ot">&lt;-</span> <span class="fu">which</span>(df.dict<span class="sc">$</span>col.name <span class="sc">==</span> <span class="st">&quot;HHID&quot;</span>)</span>
<span id="cb61-13"><a href="cleaning.html#cb61-13" tabindex="-1"></a>    df.dict <span class="ot">&lt;-</span> df.dict[<span class="sc">-</span><span class="fu">nrow</span>(df.dict),]</span>
<span id="cb61-14"><a href="cleaning.html#cb61-14" tabindex="-1"></a>    <span class="cf">if</span>(row <span class="sc">==</span> <span class="dv">2</span>){df.dict <span class="ot">&lt;-</span> df.dict[<span class="sc">-</span><span class="dv">1</span>,]}</span>
<span id="cb61-15"><a href="cleaning.html#cb61-15" tabindex="-1"></a>    <span class="co"># Extract numeric value from column width field</span></span>
<span id="cb61-16"><a href="cleaning.html#cb61-16" tabindex="-1"></a>    df.dict<span class="sc">$</span>col.width <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(<span class="fu">sapply</span>(df.dict<span class="sc">$</span>col.width, gsub, <span class="at">pattern =</span> <span class="st">&quot;[^0-9</span><span class="sc">\\</span><span class="st">.]&quot;</span>, <span class="at">replacement =</span> <span class="st">&quot;&quot;</span>))</span>
<span id="cb61-17"><a href="cleaning.html#cb61-17" tabindex="-1"></a>    <span class="co"># Convert column types to format to be used with read_fwf function</span></span>
<span id="cb61-18"><a href="cleaning.html#cb61-18" tabindex="-1"></a>    df.dict<span class="sc">$</span>col.type <span class="ot">&lt;-</span> <span class="fu">sapply</span>(df.dict<span class="sc">$</span>col.type, <span class="cf">function</span>(x) <span class="fu">ifelse</span>(x <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;int&quot;</span>,<span class="st">&quot;byte&quot;</span>,<span class="st">&quot;long&quot;</span>), <span class="st">&quot;i&quot;</span>, <span class="fu">ifelse</span>(x <span class="sc">==</span> <span class="st">&quot;float&quot;</span>, <span class="st">&quot;n&quot;</span>, <span class="fu">ifelse</span>(x <span class="sc">==</span> <span class="st">&quot;double&quot;</span>, <span class="st">&quot;d&quot;</span>, <span class="st">&quot;c&quot;</span>))))</span>
<span id="cb61-19"><a href="cleaning.html#cb61-19" tabindex="-1"></a>    <span class="co"># Read the data file into a dataframe</span></span>
<span id="cb61-20"><a href="cleaning.html#cb61-20" tabindex="-1"></a>    df <span class="ot">&lt;-</span> <span class="fu">read_fwf</span>(<span class="at">file =</span> data.file, <span class="fu">fwf_widths</span>(<span class="at">widths =</span> df.dict<span class="sc">$</span>col.width, <span class="at">col_names =</span> df.dict<span class="sc">$</span>col.name), <span class="at">col_types =</span> <span class="fu">paste</span>(df.dict<span class="sc">$</span>col.type, <span class="at">collapse =</span> <span class="st">&quot;&quot;</span>))</span>
<span id="cb61-21"><a href="cleaning.html#cb61-21" tabindex="-1"></a>    <span class="co"># Add column labels to headers</span></span>
<span id="cb61-22"><a href="cleaning.html#cb61-22" tabindex="-1"></a>    <span class="fu">attributes</span>(df)<span class="sc">$</span>variable.labels <span class="ot">&lt;-</span> df.dict<span class="sc">$</span>col.lbl</span>
<span id="cb61-23"><a href="cleaning.html#cb61-23" tabindex="-1"></a>    old.names <span class="ot">&lt;-</span> (hrs_codebook <span class="sc">%&gt;%</span> <span class="fu">filter</span>(year <span class="sc">==</span> Year))<span class="sc">$</span>orig_itemname</span>
<span id="cb61-24"><a href="cleaning.html#cb61-24" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">any</span>(<span class="fu">c</span>(<span class="st">&quot;PN&quot;</span>, <span class="st">&quot;HHID&quot;</span>) <span class="sc">%in%</span> <span class="fu">colnames</span>(df)) <span class="sc">&amp;</span> <span class="fu">any</span>(old.names <span class="sc">%in%</span> <span class="fu">colnames</span>(df))){</span>
<span id="cb61-25"><a href="cleaning.html#cb61-25" tabindex="-1"></a>    <span class="co"># if(any(c(&quot;PN&quot;, &quot;HHID&quot;) %in% colnames(df))){</span></span>
<span id="cb61-26"><a href="cleaning.html#cb61-26" tabindex="-1"></a>      df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb61-27"><a href="cleaning.html#cb61-27" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">hhidpn =</span> <span class="dv">1000</span><span class="sc">*</span><span class="fu">as.numeric</span>(HHID) <span class="sc">+</span> <span class="fu">as.numeric</span>(PN)) <span class="sc">%&gt;%</span></span>
<span id="cb61-28"><a href="cleaning.html#cb61-28" tabindex="-1"></a>      <span class="fu">select</span>(<span class="fu">one_of</span>(<span class="fu">c</span>(<span class="st">&quot;PN&quot;</span>, <span class="st">&quot;HHID&quot;</span>)), <span class="fu">one_of</span>(old.names)) <span class="sc">%&gt;%</span></span>
<span id="cb61-29"><a href="cleaning.html#cb61-29" tabindex="-1"></a>        <span class="fu">distinct</span>()</span>
<span id="cb61-30"><a href="cleaning.html#cb61-30" tabindex="-1"></a>      <span class="co"># gather(key = item, value = value, -hhidpn)</span></span>
<span id="cb61-31"><a href="cleaning.html#cb61-31" tabindex="-1"></a>    } <span class="cf">else</span> {df <span class="ot">&lt;-</span> <span class="cn">NA</span>}</span>
<span id="cb61-32"><a href="cleaning.html#cb61-32" tabindex="-1"></a>    <span class="fu">return</span>(df)</span>
<span id="cb61-33"><a href="cleaning.html#cb61-33" tabindex="-1"></a>  }</span>
<span id="cb61-34"><a href="cleaning.html#cb61-34" tabindex="-1"></a>    <span class="co"># Set path to the data file &quot;*.DA&quot;</span></span>
<span id="cb61-35"><a href="cleaning.html#cb61-35" tabindex="-1"></a>  files <span class="ot">&lt;-</span> <span class="fu">list.files</span>(<span class="fu">sprintf</span>(<span class="st">&quot;%s/hrs/%s&quot;</span>, data_path, year))</span>
<span id="cb61-36"><a href="cleaning.html#cb61-36" tabindex="-1"></a>  df2 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb61-37"><a href="cleaning.html#cb61-37" tabindex="-1"></a>    <span class="at">da =</span> files[<span class="fu">grepl</span>(<span class="st">&quot;.da&quot;</span>,  files) <span class="sc">|</span> <span class="fu">grepl</span>(<span class="st">&quot;.DA&quot;</span>, files)],</span>
<span id="cb61-38"><a href="cleaning.html#cb61-38" tabindex="-1"></a>    <span class="at">dct =</span> files[<span class="fu">grepl</span>(<span class="st">&quot;.dct&quot;</span>, files) <span class="sc">|</span> <span class="fu">grepl</span>(<span class="st">&quot;.DCT&quot;</span>, files)]</span>
<span id="cb61-39"><a href="cleaning.html#cb61-39" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb61-40"><a href="cleaning.html#cb61-40" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">map2</span>(da, dct, <span class="fu">possibly</span>(<span class="sc">~</span><span class="fu">read_da</span>(.x, .y, year), <span class="cn">NA_real_</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb61-41"><a href="cleaning.html#cb61-41" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(data)) <span class="sc">%&gt;%</span></span>
<span id="cb61-42"><a href="cleaning.html#cb61-42" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>da, <span class="sc">-</span>dct) </span>
<span id="cb61-43"><a href="cleaning.html#cb61-43" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">nrow</span>(df2) <span class="sc">!=</span> <span class="dv">0</span>){df2<span class="sc">$</span>data <span class="sc">%&gt;%</span> <span class="fu">reduce</span>(full_join) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>()} <span class="cf">else</span> {<span class="cn">NA</span>}</span>
<span id="cb61-44"><a href="cleaning.html#cb61-44" tabindex="-1"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="cleaning.html#cb62-1" tabindex="-1"></a>hrs_codebook <span class="ot">&lt;-</span> (codebook <span class="sc">%&gt;%</span> <span class="fu">filter</span>(study <span class="sc">==</span> <span class="st">&quot;HRS&quot;</span>))<span class="sc">$</span>codebook[[<span class="dv">1</span>]] <span class="sc">%&gt;%</span> </span>
<span id="cb62-2"><a href="cleaning.html#cb62-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">orig_itemname =</span> <span class="fu">str_to_upper</span>(orig_itemname)) <span class="sc">%&gt;%</span></span>
<span id="cb62-3"><a href="cleaning.html#cb62-3" tabindex="-1"></a>  <span class="fu">mutate_at</span>(<span class="fu">vars</span>(orig_itemname, name, itemname), <span class="sc">~</span><span class="fu">str_remove_all</span>(., <span class="st">&quot;[[:space:]]&quot;</span>))</span>
<span id="cb62-4"><a href="cleaning.html#cb62-4" tabindex="-1"></a>hrs_codebook</span></code></pre></div>
<pre><code>## # A tibble: 183 × 17
##    study dataset category   name    itemname  wave waveletter  year orig_itemname description scale reverse_code recode  mini
##    &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;      &lt;chr&gt;   &lt;chr&gt;    &lt;dbl&gt; &lt;lgl&gt;      &lt;dbl&gt; &lt;chr&gt;         &lt;chr&gt;       &lt;chr&gt; &lt;chr&gt;        &lt;chr&gt;  &lt;dbl&gt;
##  1 hrs   Rand    covariates educat… eduYears     1 NA          1992 RAEDYRS       R Years of… &quot;.M=… &lt;NA&gt;         ifels…    NA
##  2 hrs   Rand    covariates gender  demgend…     1 NA          1992 RAGENDER      R Gender    &quot;.M=… &lt;NA&gt;         ifels…    NA
##  3 hrs   Rand    covariates SRheal… rHlthSR      1 NA          1992 R1SHLT        W1 Self-re… &quot;1.E… yes          ifels…     1
##  4 hrs   Rand    covariates SRheal… rHlthSR      2 NA          1994 R2SHLT        W2 Self-re… &quot;1.E… yes          ifels…     1
##  5 hrs   Rand    covariates SRheal… rHlthSR      3 NA          1996 R3SHLT        W3 Self-re… &quot;1.E… yes          ifels…     1
##  6 hrs   Rand    covariates SRheal… rHlthSR      4 NA          1998 R4SHLT        W4 Self-re… &quot;1.E… yes          ifels…     1
##  7 hrs   Rand    covariates SRheal… rHlthSR      5 NA          2000 R5SHLT        W5 Self-re… &quot;1.E… yes          ifels…     1
##  8 hrs   Rand    covariates SRheal… rHlthSR      6 NA          2002 R6SHLT        W6 Self-re… &quot;1.E… yes          ifels…     1
##  9 hrs   Rand    covariates SRheal… rHlthSR      7 NA          2004 R7SHLT        W7 Self-re… &quot;1.E… yes          ifels…     1
## 10 hrs   Rand    covariates SRheal… rHlthSR      8 NA          2006 R8SHLT        W8 Self-re… &quot;1.E… yes          ifels…     1
## # ℹ 173 more rows
## # ℹ 3 more variables: maxi &lt;dbl&gt;, comp_rule &lt;chr&gt;, long_rule &lt;chr&gt;</code></pre>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="cleaning.html#cb64-1" tabindex="-1"></a>old.names <span class="ot">&lt;-</span> <span class="fu">unique</span>(hrs_codebook<span class="sc">$</span>orig_itemname)</span>
<span id="cb64-2"><a href="cleaning.html#cb64-2" tabindex="-1"></a>hrs.paq <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb64-3"><a href="cleaning.html#cb64-3" tabindex="-1"></a>  <span class="at">year =</span> <span class="fu">sprintf</span>(<span class="st">&quot;%s/hrs&quot;</span>, data_path) <span class="sc">%&gt;%</span> <span class="fu">list.files</span>(., <span class="at">pattern =</span> <span class="st">&quot;^[0-9]&quot;</span>)</span>
<span id="cb64-4"><a href="cleaning.html#cb64-4" tabindex="-1"></a>  , <span class="at">data =</span> <span class="fu">map</span>(year, hrs_read_fun)</span>
<span id="cb64-5"><a href="cleaning.html#cb64-5" tabindex="-1"></a>  , <span class="at">names =</span> <span class="fu">map</span>(data, colnames)</span>
<span id="cb64-6"><a href="cleaning.html#cb64-6" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb64-7"><a href="cleaning.html#cb64-7" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(data))</span>
<span id="cb64-8"><a href="cleaning.html#cb64-8" tabindex="-1"></a></span>
<span id="cb64-9"><a href="cleaning.html#cb64-9" tabindex="-1"></a>old.names <span class="ot">&lt;-</span> <span class="fu">unique</span>((hrs_codebook <span class="sc">%&gt;%</span> <span class="fu">filter</span>(dataset <span class="sc">==</span> <span class="st">&quot;Rand&quot;</span>))<span class="sc">$</span>orig_itemname)</span>
<span id="cb64-10"><a href="cleaning.html#cb64-10" tabindex="-1"></a>hrs.rand <span class="ot">&lt;-</span> <span class="fu">sprintf</span>(<span class="st">&quot;%s/hrs/randhrs1992_2016v1.sav&quot;</span>, data_path) <span class="sc">%&gt;%</span> </span>
<span id="cb64-11"><a href="cleaning.html#cb64-11" tabindex="-1"></a>  haven<span class="sc">::</span><span class="fu">read_sav</span>(.) <span class="sc">%&gt;%</span></span>
<span id="cb64-12"><a href="cleaning.html#cb64-12" tabindex="-1"></a>  haven<span class="sc">::</span><span class="fu">zap_labels</span>(.) <span class="sc">%&gt;%</span></span>
<span id="cb64-13"><a href="cleaning.html#cb64-13" tabindex="-1"></a>  <span class="fu">select</span>(<span class="at">SID =</span> HHIDPN, <span class="fu">one_of</span>(old.names)) <span class="sc">%&gt;%</span></span>
<span id="cb64-14"><a href="cleaning.html#cb64-14" tabindex="-1"></a>  <span class="fu">gather</span>(<span class="at">key =</span> orig_itemname, <span class="at">value =</span> value, <span class="sc">-</span>SID, <span class="at">na.rm =</span> T)</span>
<span id="cb64-15"><a href="cleaning.html#cb64-15" tabindex="-1"></a></span>
<span id="cb64-16"><a href="cleaning.html#cb64-16" tabindex="-1"></a></span>
<span id="cb64-17"><a href="cleaning.html#cb64-17" tabindex="-1"></a>hrs_long <span class="ot">&lt;-</span> hrs.paq <span class="sc">%&gt;%</span></span>
<span id="cb64-18"><a href="cleaning.html#cb64-18" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">map</span>(data, <span class="sc">~</span>(.) <span class="sc">%&gt;%</span> </span>
<span id="cb64-19"><a href="cleaning.html#cb64-19" tabindex="-1"></a>      <span class="fu">gather</span>(<span class="at">key =</span> orig_itemname, <span class="at">value =</span> value, <span class="sc">-</span>HHID, <span class="sc">-</span>PN))) <span class="sc">%&gt;%</span></span>
<span id="cb64-20"><a href="cleaning.html#cb64-20" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>names, <span class="sc">-</span>year) <span class="sc">%&gt;%</span></span>
<span id="cb64-21"><a href="cleaning.html#cb64-21" tabindex="-1"></a>  <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb64-22"><a href="cleaning.html#cb64-22" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">SID =</span> <span class="dv">1000</span><span class="sc">*</span><span class="fu">as.numeric</span>(HHID) <span class="sc">+</span> <span class="fu">as.numeric</span>(PN)) <span class="sc">%&gt;%</span></span>
<span id="cb64-23"><a href="cleaning.html#cb64-23" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>PN, <span class="sc">-</span>HHID) </span>
<span id="cb64-24"><a href="cleaning.html#cb64-24" tabindex="-1"></a></span>
<span id="cb64-25"><a href="cleaning.html#cb64-25" tabindex="-1"></a>hrs.subs <span class="ot">&lt;-</span> <span class="fu">unique</span>(hrs_long<span class="sc">$</span>SID)[<span class="fu">unique</span>(hrs_long<span class="sc">$</span>SID) <span class="sc">%in%</span> <span class="fu">unique</span>(hrs.rand<span class="sc">$</span>SID)]</span>
<span id="cb64-26"><a href="cleaning.html#cb64-26" tabindex="-1"></a>hrs_long <span class="ot">&lt;-</span> hrs_long <span class="sc">%&gt;%</span></span>
<span id="cb64-27"><a href="cleaning.html#cb64-27" tabindex="-1"></a>  <span class="fu">bind_rows</span>(hrs.rand <span class="sc">%&gt;%</span> <span class="fu">select</span>(orig_itemname, value, SID)) <span class="sc">%&gt;%</span></span>
<span id="cb64-28"><a href="cleaning.html#cb64-28" tabindex="-1"></a>  <span class="fu">filter</span>(SID <span class="sc">%in%</span> hrs.subs)</span>
<span id="cb64-29"><a href="cleaning.html#cb64-29" tabindex="-1"></a></span>
<span id="cb64-30"><a href="cleaning.html#cb64-30" tabindex="-1"></a><span class="fu">save</span>(hrs.rand, hrs.paq, <span class="at">file =</span> <span class="fu">sprintf</span>(<span class="st">&quot;%s/data/clean/hrs_raw.RData&quot;</span>, local_path))</span>
<span id="cb64-31"><a href="cleaning.html#cb64-31" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">c</span>(<span class="st">&quot;hrs.paq&quot;</span>, <span class="st">&quot;hrs.rand&quot;</span>))</span></code></pre></div>
</div>
<div id="recoding-reverse-scoring-4" class="section level3 hasAnchor" number="2.5.2">
<h3><span class="header-section-number">2.5.2</span> Recoding &amp; Reverse Scoring<a href="cleaning.html#recoding-reverse-scoring-4" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="cleaning.html#cb65-1" tabindex="-1"></a>hrs_waves <span class="ot">&lt;-</span> p_waves <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Study <span class="sc">==</span> <span class="st">&quot;HRS&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(Used) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>()</span>
<span id="cb65-2"><a href="cleaning.html#cb65-2" tabindex="-1"></a></span>
<span id="cb65-3"><a href="cleaning.html#cb65-3" tabindex="-1"></a><span class="co"># join data with recoding info </span></span>
<span id="cb65-4"><a href="cleaning.html#cb65-4" tabindex="-1"></a>hrs_recode <span class="ot">&lt;-</span> hrs_codebook <span class="sc">%&gt;%</span></span>
<span id="cb65-5"><a href="cleaning.html#cb65-5" tabindex="-1"></a>  <span class="fu">filter</span>(category <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;pers&quot;</span>, <span class="st">&quot;outcome&quot;</span>, <span class="st">&quot;covariates&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb65-6"><a href="cleaning.html#cb65-6" tabindex="-1"></a>  <span class="fu">select</span>(category, name, itemname, wave, year, orig_itemname, reverse_code<span class="sc">:</span>long_rule) <span class="sc">%&gt;%</span></span>
<span id="cb65-7"><a href="cleaning.html#cb65-7" tabindex="-1"></a>  <span class="fu">group_by</span>(category, name) <span class="sc">%&gt;%</span> </span>
<span id="cb65-8"><a href="cleaning.html#cb65-8" tabindex="-1"></a>  <span class="fu">nest</span>() <span class="sc">%&gt;%</span></span>
<span id="cb65-9"><a href="cleaning.html#cb65-9" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb65-10"><a href="cleaning.html#cb65-10" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">map</span>(data, <span class="sc">~</span>(.) <span class="sc">%&gt;%</span> <span class="fu">left_join</span>(hrs_long))) </span>
<span id="cb65-11"><a href="cleaning.html#cb65-11" tabindex="-1"></a></span>
<span id="cb65-12"><a href="cleaning.html#cb65-12" tabindex="-1"></a><span class="co"># recode </span></span>
<span id="cb65-13"><a href="cleaning.html#cb65-13" tabindex="-1"></a>recode_fun <span class="ot">&lt;-</span> <span class="cf">function</span>(rule, y, year, p_year){</span>
<span id="cb65-14"><a href="cleaning.html#cb65-14" tabindex="-1"></a>  x <span class="ot">&lt;-</span> y<span class="sc">$</span>value</span>
<span id="cb65-15"><a href="cleaning.html#cb65-15" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.na</span>(rule)){y<span class="sc">$</span>value <span class="ot">&lt;-</span> <span class="fu">eval</span>(<span class="fu">parse</span>(<span class="at">text =</span> rule))}</span>
<span id="cb65-16"><a href="cleaning.html#cb65-16" tabindex="-1"></a>  <span class="fu">return</span>(y)</span>
<span id="cb65-17"><a href="cleaning.html#cb65-17" tabindex="-1"></a>}</span>
<span id="cb65-18"><a href="cleaning.html#cb65-18" tabindex="-1"></a></span>
<span id="cb65-19"><a href="cleaning.html#cb65-19" tabindex="-1"></a>hrs_recode <span class="ot">&lt;-</span> hrs_recode <span class="sc">%&gt;%</span> </span>
<span id="cb65-20"><a href="cleaning.html#cb65-20" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">map</span>(data, <span class="sc">~</span>(.) <span class="sc">%&gt;%</span> </span>
<span id="cb65-21"><a href="cleaning.html#cb65-21" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">mapvalues</span>(year, <span class="fu">seq</span>(<span class="dv">2006</span>, <span class="dv">2016</span>, <span class="dv">2</span>), <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">2006</span>, <span class="dv">2010</span>, <span class="dv">2014</span>), <span class="at">each =</span> <span class="dv">2</span>)),</span>
<span id="cb65-22"><a href="cleaning.html#cb65-22" tabindex="-1"></a>           <span class="at">p_year =</span> <span class="dv">2006</span>) <span class="sc">%&gt;%</span></span>
<span id="cb65-23"><a href="cleaning.html#cb65-23" tabindex="-1"></a>    <span class="fu">group_by</span>(recode, year, p_year) <span class="sc">%&gt;%</span></span>
<span id="cb65-24"><a href="cleaning.html#cb65-24" tabindex="-1"></a>    <span class="fu">nest</span>() <span class="sc">%&gt;%</span></span>
<span id="cb65-25"><a href="cleaning.html#cb65-25" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb65-26"><a href="cleaning.html#cb65-26" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">pmap</span>(<span class="fu">list</span>(recode, data, year, p_year), recode_fun)) <span class="sc">%&gt;%</span></span>
<span id="cb65-27"><a href="cleaning.html#cb65-27" tabindex="-1"></a>    <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb65-28"><a href="cleaning.html#cb65-28" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">ifelse</span>(value <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">|</span> <span class="fu">is.nan</span>(value) <span class="sc">|</span> <span class="fu">is.infinite</span>(value), <span class="cn">NA</span>, value))))</span>
<span id="cb65-29"><a href="cleaning.html#cb65-29" tabindex="-1"></a></span>
<span id="cb65-30"><a href="cleaning.html#cb65-30" tabindex="-1"></a></span>
<span id="cb65-31"><a href="cleaning.html#cb65-31" tabindex="-1"></a><span class="co"># reverse code </span></span>
<span id="cb65-32"><a href="cleaning.html#cb65-32" tabindex="-1"></a>hrs_recode <span class="ot">&lt;-</span> hrs_recode <span class="sc">%&gt;%</span></span>
<span id="cb65-33"><a href="cleaning.html#cb65-33" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">map</span>(data, <span class="sc">~</span>(.) <span class="sc">%&gt;%</span></span>
<span id="cb65-34"><a href="cleaning.html#cb65-34" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">ifelse</span>(reverse_code <span class="sc">==</span> <span class="st">&quot;no&quot;</span> <span class="sc">|</span> <span class="fu">is.na</span>(reverse_code), value, </span>
<span id="cb65-35"><a href="cleaning.html#cb65-35" tabindex="-1"></a>                        <span class="fu">reverse.code</span>(<span class="sc">-</span><span class="dv">1</span>, value, <span class="at">mini =</span> mini, <span class="at">maxi =</span> maxi)))))</span>
<span id="cb65-36"><a href="cleaning.html#cb65-36" tabindex="-1"></a></span>
<span id="cb65-37"><a href="cleaning.html#cb65-37" tabindex="-1"></a>fun_call <span class="ot">&lt;-</span> <span class="cf">function</span>(x, rule){</span>
<span id="cb65-38"><a href="cleaning.html#cb65-38" tabindex="-1"></a>    <span class="cf">switch</span>(rule,</span>
<span id="cb65-39"><a href="cleaning.html#cb65-39" tabindex="-1"></a>           <span class="at">average =</span> <span class="fu">mean</span>(x, <span class="at">na.rm =</span> T),</span>
<span id="cb65-40"><a href="cleaning.html#cb65-40" tabindex="-1"></a>           <span class="at">mode =</span> <span class="fu">Mode</span>(x)[<span class="dv">1</span>],</span>
<span id="cb65-41"><a href="cleaning.html#cb65-41" tabindex="-1"></a>           <span class="at">sum =</span> <span class="fu">sum</span>(x, <span class="at">na.rm =</span> T),</span>
<span id="cb65-42"><a href="cleaning.html#cb65-42" tabindex="-1"></a>           <span class="at">skip =</span> <span class="fu">unique</span>(x)[<span class="dv">1</span>],</span>
<span id="cb65-43"><a href="cleaning.html#cb65-43" tabindex="-1"></a>           <span class="at">select =</span> <span class="fu">unique</span>(x)[<span class="dv">1</span>],</span>
<span id="cb65-44"><a href="cleaning.html#cb65-44" tabindex="-1"></a>           <span class="at">max =</span> <span class="fu">max</span>(x, <span class="at">na.rm =</span> T),</span>
<span id="cb65-45"><a href="cleaning.html#cb65-45" tabindex="-1"></a>           <span class="at">min =</span> <span class="fu">min</span>(x, <span class="at">na.rm =</span> T))</span>
<span id="cb65-46"><a href="cleaning.html#cb65-46" tabindex="-1"></a>  }</span></code></pre></div>
</div>
<div id="covariates-4" class="section level3 hasAnchor" number="2.5.3">
<h3><span class="header-section-number">2.5.3</span> Covariates<a href="cleaning.html#covariates-4" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="cleaning.html#cb66-1" tabindex="-1"></a><span class="co"># compositing within years</span></span>
<span id="cb66-2"><a href="cleaning.html#cb66-2" tabindex="-1"></a>year_comp_fun <span class="ot">&lt;-</span> <span class="cf">function</span>(df, rule){</span>
<span id="cb66-3"><a href="cleaning.html#cb66-3" tabindex="-1"></a>  df <span class="sc">%&gt;%</span></span>
<span id="cb66-4"><a href="cleaning.html#cb66-4" tabindex="-1"></a>    <span class="co"># group by person and item (collapse across age)</span></span>
<span id="cb66-5"><a href="cleaning.html#cb66-5" tabindex="-1"></a>    <span class="fu">group_by</span>(SID, name, year, p_year, long_rule) <span class="sc">%&gt;%</span> </span>
<span id="cb66-6"><a href="cleaning.html#cb66-6" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">value =</span> <span class="fu">fun_call</span>(value, rule)) <span class="sc">%&gt;%</span></span>
<span id="cb66-7"><a href="cleaning.html#cb66-7" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb66-8"><a href="cleaning.html#cb66-8" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">ifelse</span>(<span class="fu">is.infinite</span>(value) <span class="sc">|</span> <span class="fu">is.nan</span>(value), <span class="cn">NA</span>, value))</span>
<span id="cb66-9"><a href="cleaning.html#cb66-9" tabindex="-1"></a>}</span>
<span id="cb66-10"><a href="cleaning.html#cb66-10" tabindex="-1"></a></span>
<span id="cb66-11"><a href="cleaning.html#cb66-11" tabindex="-1"></a><span class="co"># composite WITHIN years </span></span>
<span id="cb66-12"><a href="cleaning.html#cb66-12" tabindex="-1"></a>hrs_cov <span class="ot">&lt;-</span> hrs_recode <span class="sc">%&gt;%</span></span>
<span id="cb66-13"><a href="cleaning.html#cb66-13" tabindex="-1"></a>  <span class="fu">filter</span>(category <span class="sc">==</span> <span class="st">&quot;covariates&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb66-14"><a href="cleaning.html#cb66-14" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>category) <span class="sc">%&gt;%</span></span>
<span id="cb66-15"><a href="cleaning.html#cb66-15" tabindex="-1"></a>  <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb66-16"><a href="cleaning.html#cb66-16" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">comp_rule =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(comp_rule), <span class="st">&quot;skip&quot;</span>, comp_rule)) <span class="sc">%&gt;%</span></span>
<span id="cb66-17"><a href="cleaning.html#cb66-17" tabindex="-1"></a>  <span class="fu">group_by</span>(comp_rule) <span class="sc">%&gt;%</span></span>
<span id="cb66-18"><a href="cleaning.html#cb66-18" tabindex="-1"></a>  <span class="fu">nest</span>() <span class="sc">%&gt;%</span></span>
<span id="cb66-19"><a href="cleaning.html#cb66-19" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb66-20"><a href="cleaning.html#cb66-20" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">map2</span>(data, comp_rule, year_comp_fun)) <span class="sc">%&gt;%</span></span>
<span id="cb66-21"><a href="cleaning.html#cb66-21" tabindex="-1"></a>  <span class="fu">unnest</span>(data)</span>
<span id="cb66-22"><a href="cleaning.html#cb66-22" tabindex="-1"></a></span>
<span id="cb66-23"><a href="cleaning.html#cb66-23" tabindex="-1"></a>comp_fun <span class="ot">&lt;-</span> <span class="cf">function</span>(d, rule, p_year){</span>
<span id="cb66-24"><a href="cleaning.html#cb66-24" tabindex="-1"></a>  d <span class="sc">%&gt;%</span></span>
<span id="cb66-25"><a href="cleaning.html#cb66-25" tabindex="-1"></a>    <span class="fu">filter</span>(year <span class="sc">&lt;=</span> p_year) <span class="sc">%&gt;%</span></span>
<span id="cb66-26"><a href="cleaning.html#cb66-26" tabindex="-1"></a>    <span class="fu">group_by</span>(SID, name) <span class="sc">%&gt;%</span></span>
<span id="cb66-27"><a href="cleaning.html#cb66-27" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">value =</span> <span class="fu">fun_call</span>(value, rule)) <span class="sc">%&gt;%</span></span>
<span id="cb66-28"><a href="cleaning.html#cb66-28" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb66-29"><a href="cleaning.html#cb66-29" tabindex="-1"></a>    <span class="fu">distinct</span>()</span>
<span id="cb66-30"><a href="cleaning.html#cb66-30" tabindex="-1"></a>}</span>
<span id="cb66-31"><a href="cleaning.html#cb66-31" tabindex="-1"></a></span>
<span id="cb66-32"><a href="cleaning.html#cb66-32" tabindex="-1"></a><span class="co"># composite ACROSS years</span></span>
<span id="cb66-33"><a href="cleaning.html#cb66-33" tabindex="-1"></a>hrs_cov <span class="ot">&lt;-</span> hrs_cov <span class="sc">%&gt;%</span></span>
<span id="cb66-34"><a href="cleaning.html#cb66-34" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">long_rule =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(long_rule), <span class="st">&quot;skip&quot;</span>, long_rule)) <span class="sc">%&gt;%</span></span>
<span id="cb66-35"><a href="cleaning.html#cb66-35" tabindex="-1"></a>  <span class="fu">group_by</span>(p_year, long_rule) <span class="sc">%&gt;%</span></span>
<span id="cb66-36"><a href="cleaning.html#cb66-36" tabindex="-1"></a>  <span class="fu">nest</span>() <span class="sc">%&gt;%</span></span>
<span id="cb66-37"><a href="cleaning.html#cb66-37" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb66-38"><a href="cleaning.html#cb66-38" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">pmap</span>(<span class="fu">list</span>(data, long_rule, p_year), comp_fun)) <span class="sc">%&gt;%</span></span>
<span id="cb66-39"><a href="cleaning.html#cb66-39" tabindex="-1"></a>  <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb66-40"><a href="cleaning.html#cb66-40" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">ifelse</span>(<span class="fu">is.infinite</span>(value) <span class="sc">|</span> <span class="fu">is.nan</span>(value), <span class="cn">NA</span>, value)) <span class="sc">%&gt;%</span></span>
<span id="cb66-41"><a href="cleaning.html#cb66-41" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>long_rule) <span class="sc">%&gt;%</span></span>
<span id="cb66-42"><a href="cleaning.html#cb66-42" tabindex="-1"></a>  <span class="fu">spread</span>(name, value) <span class="sc">%&gt;%</span></span>
<span id="cb66-43"><a href="cleaning.html#cb66-43" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(SID))</span></code></pre></div>
</div>
<div id="personality-variables-4" class="section level3 hasAnchor" number="2.5.4">
<h3><span class="header-section-number">2.5.4</span> Personality Variables<a href="cleaning.html#personality-variables-4" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="cleaning.html#cb67-1" tabindex="-1"></a>hrs_pers <span class="ot">&lt;-</span> hrs_recode <span class="sc">%&gt;%</span></span>
<span id="cb67-2"><a href="cleaning.html#cb67-2" tabindex="-1"></a>  <span class="fu">filter</span>(category <span class="sc">==</span> <span class="st">&quot;pers&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb67-3"><a href="cleaning.html#cb67-3" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>category) <span class="sc">%&gt;%</span> </span>
<span id="cb67-4"><a href="cleaning.html#cb67-4" tabindex="-1"></a>  <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb67-5"><a href="cleaning.html#cb67-5" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> <span class="st">&quot;2006&quot;</span> <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(value)) <span class="sc">%&gt;%</span></span>
<span id="cb67-6"><a href="cleaning.html#cb67-6" tabindex="-1"></a>  <span class="fu">group_by</span>(SID, p_year, year, name, itemname, comp_rule) <span class="sc">%&gt;%</span></span>
<span id="cb67-7"><a href="cleaning.html#cb67-7" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">value =</span> <span class="fu">mean</span>(value, <span class="at">na.rm =</span> T)) <span class="sc">%&gt;%</span></span>
<span id="cb67-8"><a href="cleaning.html#cb67-8" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb67-9"><a href="cleaning.html#cb67-9" tabindex="-1"></a></span>
<span id="cb67-10"><a href="cleaning.html#cb67-10" tabindex="-1"></a><span class="co"># alpha&#39;s</span></span>
<span id="cb67-11"><a href="cleaning.html#cb67-11" tabindex="-1"></a>hrs_alpha <span class="ot">&lt;-</span> hrs_pers <span class="sc">%&gt;%</span></span>
<span id="cb67-12"><a href="cleaning.html#cb67-12" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(value)) <span class="sc">%&gt;%</span></span>
<span id="cb67-13"><a href="cleaning.html#cb67-13" tabindex="-1"></a>  <span class="fu">select</span>(name, itemname, year, SID, value) <span class="sc">%&gt;%</span></span>
<span id="cb67-14"><a href="cleaning.html#cb67-14" tabindex="-1"></a>  <span class="fu">group_by</span>(name, year) <span class="sc">%&gt;%</span></span>
<span id="cb67-15"><a href="cleaning.html#cb67-15" tabindex="-1"></a>  <span class="fu">nest</span>() <span class="sc">%&gt;%</span></span>
<span id="cb67-16"><a href="cleaning.html#cb67-16" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">map</span>(data, <span class="sc">~</span>(.) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>() <span class="sc">%&gt;%</span> <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> itemname, <span class="at">values_from =</span> value, <span class="at">values_fn =</span> <span class="fu">list</span>(mean))),</span>
<span id="cb67-17"><a href="cleaning.html#cb67-17" tabindex="-1"></a>         <span class="at">alpha =</span> <span class="fu">map</span>(data, <span class="fu">possibly</span>(<span class="sc">~</span>psych<span class="sc">::</span><span class="fu">alpha</span>((.) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>SID)), <span class="cn">NA_real_</span>)))</span>
<span id="cb67-18"><a href="cleaning.html#cb67-18" tabindex="-1"></a></span>
<span id="cb67-19"><a href="cleaning.html#cb67-19" tabindex="-1"></a>comp_fun <span class="ot">&lt;-</span> <span class="cf">function</span>(df, rule){</span>
<span id="cb67-20"><a href="cleaning.html#cb67-20" tabindex="-1"></a>  df <span class="sc">%&gt;%</span></span>
<span id="cb67-21"><a href="cleaning.html#cb67-21" tabindex="-1"></a>    <span class="fu">group_by</span>(SID) <span class="sc">%&gt;%</span></span>
<span id="cb67-22"><a href="cleaning.html#cb67-22" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">value =</span> <span class="fu">fun_call</span>(value, rule)) <span class="sc">%&gt;%</span></span>
<span id="cb67-23"><a href="cleaning.html#cb67-23" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb67-24"><a href="cleaning.html#cb67-24" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">ifelse</span>(<span class="fu">is.infinite</span>(value) <span class="sc">|</span> <span class="fu">is.nan</span>(value), <span class="cn">NA</span>, value))</span>
<span id="cb67-25"><a href="cleaning.html#cb67-25" tabindex="-1"></a>}</span>
<span id="cb67-26"><a href="cleaning.html#cb67-26" tabindex="-1"></a></span>
<span id="cb67-27"><a href="cleaning.html#cb67-27" tabindex="-1"></a><span class="co"># create composites</span></span>
<span id="cb67-28"><a href="cleaning.html#cb67-28" tabindex="-1"></a>hrs_pers <span class="ot">&lt;-</span> hrs_pers <span class="sc">%&gt;%</span></span>
<span id="cb67-29"><a href="cleaning.html#cb67-29" tabindex="-1"></a>  <span class="fu">group_by</span>(name, comp_rule, year) <span class="sc">%&gt;%</span></span>
<span id="cb67-30"><a href="cleaning.html#cb67-30" tabindex="-1"></a>  <span class="fu">nest</span>() <span class="sc">%&gt;%</span></span>
<span id="cb67-31"><a href="cleaning.html#cb67-31" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb67-32"><a href="cleaning.html#cb67-32" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">map2</span>(data, comp_rule, comp_fun)) <span class="sc">%&gt;%</span></span>
<span id="cb67-33"><a href="cleaning.html#cb67-33" tabindex="-1"></a>  <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb67-34"><a href="cleaning.html#cb67-34" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>comp_rule)</span></code></pre></div>
</div>
<div id="outcome-variables-4" class="section level3 hasAnchor" number="2.5.5">
<h3><span class="header-section-number">2.5.5</span> Outcome Variables<a href="cleaning.html#outcome-variables-4" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="cleaning.html#cb68-1" tabindex="-1"></a><span class="co"># composite within years</span></span>
<span id="cb68-2"><a href="cleaning.html#cb68-2" tabindex="-1"></a>hrs_out <span class="ot">&lt;-</span> hrs_recode <span class="sc">%&gt;%</span></span>
<span id="cb68-3"><a href="cleaning.html#cb68-3" tabindex="-1"></a>  <span class="fu">filter</span>(category <span class="sc">==</span> <span class="st">&quot;outcome&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb68-4"><a href="cleaning.html#cb68-4" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>category) <span class="sc">%&gt;%</span></span>
<span id="cb68-5"><a href="cleaning.html#cb68-5" tabindex="-1"></a>  <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb68-6"><a href="cleaning.html#cb68-6" tabindex="-1"></a>  <span class="fu">group_by</span>(name, year, SID, long_rule) <span class="sc">%&gt;%</span></span>
<span id="cb68-7"><a href="cleaning.html#cb68-7" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">value =</span> <span class="fu">sum</span>(value, <span class="at">na.rm =</span> T)) <span class="sc">%&gt;%</span></span>
<span id="cb68-8"><a href="cleaning.html#cb68-8" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2010</span>) <span class="sc">%&gt;%</span></span>
<span id="cb68-9"><a href="cleaning.html#cb68-9" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb68-10"><a href="cleaning.html#cb68-10" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>long_rule)</span></code></pre></div>
</div>
<div id="combine-data-4" class="section level3 hasAnchor" number="2.5.6">
<h3><span class="header-section-number">2.5.6</span> Combine Data<a href="cleaning.html#combine-data-4" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="cleaning.html#cb69-1" tabindex="-1"></a>hrs_combined <span class="ot">&lt;-</span> hrs_pers <span class="sc">%&gt;%</span> </span>
<span id="cb69-2"><a href="cleaning.html#cb69-2" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Trait =</span> name, <span class="at">p_value =</span> value, <span class="at">p_year =</span> year) <span class="sc">%&gt;%</span></span>
<span id="cb69-3"><a href="cleaning.html#cb69-3" tabindex="-1"></a>  <span class="fu">full_join</span>(hrs_out <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">Outcome =</span> name, <span class="at">o_value =</span> value, <span class="at">o_year =</span> year)) <span class="sc">%&gt;%</span></span>
<span id="cb69-4"><a href="cleaning.html#cb69-4" tabindex="-1"></a>  <span class="fu">full_join</span>(hrs_cov) <span class="sc">%&gt;%</span></span>
<span id="cb69-5"><a href="cleaning.html#cb69-5" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(p_value) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(o_value))</span></code></pre></div>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="cleaning.html#cb70-1" tabindex="-1"></a><span class="fu">save</span>(hrs_cov, hrs_alpha, hrs_pers, hrs_out, hrs_combined,</span>
<span id="cb70-2"><a href="cleaning.html#cb70-2" tabindex="-1"></a>     <span class="at">file =</span> <span class="fu">sprintf</span>(<span class="st">&quot;%s/data/clean/hrs_cleaned.RData&quot;</span>, local_path))</span></code></pre></div>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="cleaning.html#cb71-1" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span><span class="fu">ls</span>()[<span class="fu">grepl</span>(<span class="st">&quot;hrs&quot;</span>, <span class="fu">ls</span>())])</span></code></pre></div>
</div>
</div>
<div id="longitudinal-aging-study-amsterdam-lasa" class="section level2 hasAnchor" number="2.6">
<h2><span class="header-section-number">2.6</span> Longitudinal Aging Study Amsterdam (LASA)<a href="cleaning.html#longitudinal-aging-study-amsterdam-lasa" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The Longitudinal Aging Study Amsterdam is an ongoing longitudinal study that began in 1992. These data are available, through application at <a href="https://www.lasa-vu.nl/data/availability_data/availability_data.htm" class="uri">https://www.lasa-vu.nl/data/availability_data/availability_data.htm</a>.</p>
<p>Participants who were between 55 and 84 years at the start of the study were recruited from the NESTOR study on Living Arrangements and Social Networks of older adults, which was randomly selected from municipality registers in 1992, with an oversampling of the oldest old and men. Data are collected approximately every three years (1992, 1995, 1998, 2001, 2005, 2008, 2011, 2015, 2018). Additional cohorts are introduced every 10 years, with additional participants (Cohorts 2 and 3) recruited in 2002 and 2012. Additional information and documentation are available at <a href="https://www.lasa-vu.nl/index.htm" class="uri">https://www.lasa-vu.nl/index.htm</a>.</p>
<p>Sample sizes vary by year, ranging from 1522 (Wave H; 763 Cohort 1, 759 Cohort 2) to 3107 (Wave B, Cohort 1). This provides 99% power to detect a zero-order correlation effect size of ~.10, two-tailed at alpha .05.</p>
<div id="load-data-5" class="section level3 hasAnchor" number="2.6.1">
<h3><span class="header-section-number">2.6.1</span> Load Data<a href="cleaning.html#load-data-5" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="cleaning.html#cb72-1" tabindex="-1"></a>lasa_read_fun <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb72-2"><a href="cleaning.html#cb72-2" tabindex="-1"></a>  d <span class="ot">&lt;-</span> <span class="fu">sprintf</span>(<span class="st">&quot;%s/lasa/%s&quot;</span>, data_path, x) <span class="sc">%&gt;%</span> </span>
<span id="cb72-3"><a href="cleaning.html#cb72-3" tabindex="-1"></a>    <span class="fu">read_sav</span>(.) <span class="sc">%&gt;%</span> </span>
<span id="cb72-4"><a href="cleaning.html#cb72-4" tabindex="-1"></a>    <span class="fu">select</span>(<span class="fu">one_of</span>(lasa_sids),</span>
<span id="cb72-5"><a href="cleaning.html#cb72-5" tabindex="-1"></a>           <span class="fu">one_of</span>(old.names), </span>
<span id="cb72-6"><a href="cleaning.html#cb72-6" tabindex="-1"></a>           <span class="fu">one_of</span>(<span class="fu">str_to_lower</span>(old.names)),</span>
<span id="cb72-7"><a href="cleaning.html#cb72-7" tabindex="-1"></a>           <span class="fu">one_of</span>(<span class="fu">str_to_upper</span>(old.names))) <span class="sc">%&gt;%</span></span>
<span id="cb72-8"><a href="cleaning.html#cb72-8" tabindex="-1"></a>    <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb72-9"><a href="cleaning.html#cb72-9" tabindex="-1"></a>    haven<span class="sc">::</span><span class="fu">zap_labels</span>(.)</span>
<span id="cb72-10"><a href="cleaning.html#cb72-10" tabindex="-1"></a>  <span class="fu">colnames</span>(d) <span class="ot">&lt;-</span> <span class="fu">str_to_lower</span>(<span class="fu">colnames</span>(d))</span>
<span id="cb72-11"><a href="cleaning.html#cb72-11" tabindex="-1"></a>  <span class="fu">return</span>(d)</span>
<span id="cb72-12"><a href="cleaning.html#cb72-12" tabindex="-1"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="cleaning.html#cb73-1" tabindex="-1"></a>lasa_codebook <span class="ot">&lt;-</span> (codebook <span class="sc">%&gt;%</span> <span class="fu">filter</span>(study <span class="sc">==</span> <span class="st">&quot;LASA&quot;</span>))<span class="sc">$</span>codebook[[<span class="dv">1</span>]] <span class="sc">%&gt;%</span></span>
<span id="cb73-2"><a href="cleaning.html#cb73-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">orig_itemname =</span> orig_itemname)</span>
<span id="cb73-3"><a href="cleaning.html#cb73-3" tabindex="-1"></a>lasa_codebook</span></code></pre></div>
<pre><code>## # A tibble: 105 × 17
##    study dataset  category   name  itemname wave  wave_letter  year orig_itemname description scale reverse_code recode  mini
##    &lt;chr&gt; &lt;chr&gt;    &lt;chr&gt;      &lt;chr&gt; &lt;chr&gt;    &lt;lgl&gt; &lt;chr&gt;       &lt;dbl&gt; &lt;chr&gt;         &lt;chr&gt;       &lt;chr&gt; &lt;chr&gt;        &lt;chr&gt;  &lt;dbl&gt;
##  1 LASA  LASAz004 covariates educ… eduYears NA    b            1992 aedu          education … &quot;no … &lt;NA&gt;         ifels…    NA
##  2 LASA  LASAz004 covariates gend… sex      NA    b            1992 sex           sex respon… &quot;mal… &lt;NA&gt;         ifels…    NA
##  3 LASA  LASAb036 covariates SRhe… SRhealth NA    b            1992 bsubhea1      Self-perce… &quot;na,… yes          ifels…     1
##  4 LASA  LASAc036 covariates SRhe… SRhealth NA    c            1995 csubhea1      Self-perce… &quot;na,… yes          ifels…     1
##  5 LASA  LASAd036 covariates SRhe… SRhealth NA    d            1998 dsubhea1      Self-perce… &quot;na,… yes          ifels…     1
##  6 LASA  LASAe036 covariates SRhe… SRhealth NA    e            2001 esubhea1      Self-perce… &quot;na,… yes          ifels…     1
##  7 LASA  LASAf036 covariates SRhe… SRhealth NA    f            2005 fsubhea1      Self-perce… &quot;na,… yes          ifels…     1
##  8 LASA  LASAg036 covariates SRhe… SRhealth NA    g            2008 gsubhea1      Self-perce… &quot;na,… yes          ifels…     1
##  9 LASA  LASAh036 covariates SRhe… SRhealth NA    h            2011 hsubhea1      Self-perce… &quot;na,… yes          ifels…     1
## 10 LASA  LASAi036 covariates SRhe… SRhealth NA    i            2015 isubhea1      Self-perce… &quot;na,… yes          ifels…     1
## # ℹ 95 more rows
## # ℹ 3 more variables: maxi &lt;dbl&gt;, comp_rule &lt;chr&gt;, long_rule &lt;chr&gt;</code></pre>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="cleaning.html#cb75-1" tabindex="-1"></a>lasa_sids <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;respnr&quot;</span>, <span class="st">&quot;RESPNR&quot;</span>, <span class="st">&quot;RespNr&quot;</span>, <span class="st">&quot;Respnr&quot;</span>)</span>
<span id="cb75-2"><a href="cleaning.html#cb75-2" tabindex="-1"></a>old.names <span class="ot">&lt;-</span> <span class="fu">unique</span>(lasa_codebook<span class="sc">$</span>orig_itemname)</span>
<span id="cb75-3"><a href="cleaning.html#cb75-3" tabindex="-1"></a>datasets <span class="ot">&lt;-</span> <span class="fu">sprintf</span>(<span class="st">&quot;%s/lasa&quot;</span>, data_path) <span class="sc">%&gt;%</span> <span class="fu">list.files</span>(., <span class="at">pattern =</span> <span class="st">&quot;SAV&quot;</span>)</span>
<span id="cb75-4"><a href="cleaning.html#cb75-4" tabindex="-1"></a>lasa <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">datasets =</span> datasets) <span class="sc">%&gt;%</span></span>
<span id="cb75-5"><a href="cleaning.html#cb75-5" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">map</span>(datasets, lasa_read_fun),</span>
<span id="cb75-6"><a href="cleaning.html#cb75-6" tabindex="-1"></a>         <span class="at">ncol =</span> <span class="fu">map_dbl</span>(data, ncol)) <span class="sc">%&gt;%</span></span>
<span id="cb75-7"><a href="cleaning.html#cb75-7" tabindex="-1"></a>  <span class="fu">filter</span>(ncol <span class="sc">&gt;</span> <span class="dv">1</span>)</span>
<span id="cb75-8"><a href="cleaning.html#cb75-8" tabindex="-1"></a></span>
<span id="cb75-9"><a href="cleaning.html#cb75-9" tabindex="-1"></a>lasa <span class="ot">&lt;-</span> <span class="fu">reduce</span>(lasa<span class="sc">$</span>data, full_join) <span class="sc">%&gt;%</span> </span>
<span id="cb75-10"><a href="cleaning.html#cb75-10" tabindex="-1"></a>  haven<span class="sc">::</span><span class="fu">zap_labels</span>(.) </span>
<span id="cb75-11"><a href="cleaning.html#cb75-11" tabindex="-1"></a></span>
<span id="cb75-12"><a href="cleaning.html#cb75-12" tabindex="-1"></a>lasa_long <span class="ot">&lt;-</span> lasa <span class="sc">%&gt;%</span></span>
<span id="cb75-13"><a href="cleaning.html#cb75-13" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">SID =</span> respnr) <span class="sc">%&gt;%</span></span>
<span id="cb75-14"><a href="cleaning.html#cb75-14" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>SID</span>
<span id="cb75-15"><a href="cleaning.html#cb75-15" tabindex="-1"></a>               , <span class="at">names_to =</span> <span class="st">&quot;orig_itemname&quot;</span></span>
<span id="cb75-16"><a href="cleaning.html#cb75-16" tabindex="-1"></a>               , <span class="at">values_to =</span> <span class="st">&quot;value&quot;</span></span>
<span id="cb75-17"><a href="cleaning.html#cb75-17" tabindex="-1"></a>               , <span class="at">values_drop_na =</span> T)</span>
<span id="cb75-18"><a href="cleaning.html#cb75-18" tabindex="-1"></a></span>
<span id="cb75-19"><a href="cleaning.html#cb75-19" tabindex="-1"></a><span class="fu">save</span>(lasa, <span class="at">file =</span> <span class="fu">sprintf</span>(<span class="st">&quot;%s/data/clean/lasa_raw.RData&quot;</span>, local_path))</span></code></pre></div>
</div>
<div id="recoding-reverse-scoring-5" class="section level3 hasAnchor" number="2.6.2">
<h3><span class="header-section-number">2.6.2</span> Recoding &amp; Reverse Scoring<a href="cleaning.html#recoding-reverse-scoring-5" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="cleaning.html#cb76-1" tabindex="-1"></a><span class="co"># join data with recoding info </span></span>
<span id="cb76-2"><a href="cleaning.html#cb76-2" tabindex="-1"></a>lasa_recode <span class="ot">&lt;-</span> lasa_codebook <span class="sc">%&gt;%</span></span>
<span id="cb76-3"><a href="cleaning.html#cb76-3" tabindex="-1"></a>  <span class="fu">select</span>(category, name, itemname, year, orig_itemname, reverse_code<span class="sc">:</span>long_rule) <span class="sc">%&gt;%</span></span>
<span id="cb76-4"><a href="cleaning.html#cb76-4" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">orig_itemname =</span> <span class="fu">str_to_lower</span>(orig_itemname)) <span class="sc">%&gt;%</span></span>
<span id="cb76-5"><a href="cleaning.html#cb76-5" tabindex="-1"></a>  <span class="fu">filter</span>(category <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;pers&quot;</span>, <span class="st">&quot;outcome&quot;</span>, <span class="st">&quot;covariates&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb76-6"><a href="cleaning.html#cb76-6" tabindex="-1"></a>  <span class="fu">group_by</span>(category, name) <span class="sc">%&gt;%</span></span>
<span id="cb76-7"><a href="cleaning.html#cb76-7" tabindex="-1"></a>  <span class="fu">nest</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb76-8"><a href="cleaning.html#cb76-8" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb76-9"><a href="cleaning.html#cb76-9" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">map</span>(data, <span class="sc">~</span>(.) <span class="sc">%&gt;%</span> <span class="fu">left_join</span>(lasa_long)))</span>
<span id="cb76-10"><a href="cleaning.html#cb76-10" tabindex="-1"></a></span>
<span id="cb76-11"><a href="cleaning.html#cb76-11" tabindex="-1"></a><span class="co"># recode </span></span>
<span id="cb76-12"><a href="cleaning.html#cb76-12" tabindex="-1"></a>recode_fun <span class="ot">&lt;-</span> <span class="cf">function</span>(rule, y, year){</span>
<span id="cb76-13"><a href="cleaning.html#cb76-13" tabindex="-1"></a>  x <span class="ot">&lt;-</span> y<span class="sc">$</span>value</span>
<span id="cb76-14"><a href="cleaning.html#cb76-14" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.na</span>(rule)){y<span class="sc">$</span>value <span class="ot">&lt;-</span> <span class="fu">eval</span>(<span class="fu">parse</span>(<span class="at">text =</span> rule))}</span>
<span id="cb76-15"><a href="cleaning.html#cb76-15" tabindex="-1"></a>  <span class="fu">return</span>(y)</span>
<span id="cb76-16"><a href="cleaning.html#cb76-16" tabindex="-1"></a>}</span>
<span id="cb76-17"><a href="cleaning.html#cb76-17" tabindex="-1"></a></span>
<span id="cb76-18"><a href="cleaning.html#cb76-18" tabindex="-1"></a>lasa_recode <span class="ot">&lt;-</span> lasa_recode <span class="sc">%&gt;%</span> </span>
<span id="cb76-19"><a href="cleaning.html#cb76-19" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">map</span>(data, <span class="sc">~</span>(.) <span class="sc">%&gt;%</span> </span>
<span id="cb76-20"><a href="cleaning.html#cb76-20" tabindex="-1"></a>    <span class="fu">group_by</span>(recode, year) <span class="sc">%&gt;%</span></span>
<span id="cb76-21"><a href="cleaning.html#cb76-21" tabindex="-1"></a>    <span class="fu">nest</span>() <span class="sc">%&gt;%</span></span>
<span id="cb76-22"><a href="cleaning.html#cb76-22" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb76-23"><a href="cleaning.html#cb76-23" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">pmap</span>(<span class="fu">list</span>(recode, data, year), recode_fun)) <span class="sc">%&gt;%</span></span>
<span id="cb76-24"><a href="cleaning.html#cb76-24" tabindex="-1"></a>    <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb76-25"><a href="cleaning.html#cb76-25" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">ifelse</span>(value <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">|</span> <span class="fu">is.nan</span>(value) <span class="sc">|</span> <span class="fu">is.infinite</span>(value), <span class="cn">NA</span>, value))))</span>
<span id="cb76-26"><a href="cleaning.html#cb76-26" tabindex="-1"></a></span>
<span id="cb76-27"><a href="cleaning.html#cb76-27" tabindex="-1"></a></span>
<span id="cb76-28"><a href="cleaning.html#cb76-28" tabindex="-1"></a><span class="co"># reverse code </span></span>
<span id="cb76-29"><a href="cleaning.html#cb76-29" tabindex="-1"></a>lasa_recode <span class="ot">&lt;-</span> lasa_recode <span class="sc">%&gt;%</span></span>
<span id="cb76-30"><a href="cleaning.html#cb76-30" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">map</span>(data, <span class="sc">~</span>(.) <span class="sc">%&gt;%</span></span>
<span id="cb76-31"><a href="cleaning.html#cb76-31" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">ifelse</span>(reverse_code <span class="sc">==</span> <span class="st">&quot;no&quot;</span> <span class="sc">|</span> <span class="fu">is.na</span>(reverse_code), value, </span>
<span id="cb76-32"><a href="cleaning.html#cb76-32" tabindex="-1"></a>                        <span class="fu">reverse.code</span>(<span class="sc">-</span><span class="dv">1</span>, value, <span class="at">mini =</span> mini, <span class="at">maxi =</span> maxi)))))</span>
<span id="cb76-33"><a href="cleaning.html#cb76-33" tabindex="-1"></a></span>
<span id="cb76-34"><a href="cleaning.html#cb76-34" tabindex="-1"></a>fun_call <span class="ot">&lt;-</span> <span class="cf">function</span>(x, rule){</span>
<span id="cb76-35"><a href="cleaning.html#cb76-35" tabindex="-1"></a>    <span class="cf">switch</span>(rule,</span>
<span id="cb76-36"><a href="cleaning.html#cb76-36" tabindex="-1"></a>           <span class="at">average =</span> <span class="fu">mean</span>(x, <span class="at">na.rm =</span> T),</span>
<span id="cb76-37"><a href="cleaning.html#cb76-37" tabindex="-1"></a>           <span class="at">mode =</span> <span class="fu">Mode</span>(x)[<span class="dv">1</span>],</span>
<span id="cb76-38"><a href="cleaning.html#cb76-38" tabindex="-1"></a>           <span class="at">sum =</span> <span class="fu">sum</span>(x, <span class="at">na.rm =</span> T),</span>
<span id="cb76-39"><a href="cleaning.html#cb76-39" tabindex="-1"></a>           <span class="at">skip =</span> <span class="fu">unique</span>(x)[<span class="dv">1</span>],</span>
<span id="cb76-40"><a href="cleaning.html#cb76-40" tabindex="-1"></a>           <span class="at">select =</span> <span class="fu">unique</span>(x)[<span class="dv">1</span>],</span>
<span id="cb76-41"><a href="cleaning.html#cb76-41" tabindex="-1"></a>           <span class="at">max =</span> <span class="fu">max</span>(x, <span class="at">na.rm =</span> T),</span>
<span id="cb76-42"><a href="cleaning.html#cb76-42" tabindex="-1"></a>           <span class="at">min =</span> <span class="fu">min</span>(x, <span class="at">na.rm =</span> T))</span>
<span id="cb76-43"><a href="cleaning.html#cb76-43" tabindex="-1"></a>}</span>
<span id="cb76-44"><a href="cleaning.html#cb76-44" tabindex="-1"></a></span>
<span id="cb76-45"><a href="cleaning.html#cb76-45" tabindex="-1"></a>lasa_waves <span class="ot">&lt;-</span> lasa_recode <span class="sc">%&gt;%</span></span>
<span id="cb76-46"><a href="cleaning.html#cb76-46" tabindex="-1"></a>  <span class="fu">filter</span>(category <span class="sc">==</span> <span class="st">&quot;pers&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb76-47"><a href="cleaning.html#cb76-47" tabindex="-1"></a>  <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb76-48"><a href="cleaning.html#cb76-48" tabindex="-1"></a>  <span class="fu">group_by</span>(SID) <span class="sc">%&gt;%</span></span>
<span id="cb76-49"><a href="cleaning.html#cb76-49" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">p_year =</span> <span class="fu">min</span>(year)) <span class="sc">%&gt;%</span></span>
<span id="cb76-50"><a href="cleaning.html#cb76-50" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code></pre></div>
</div>
<div id="covariates-5" class="section level3 hasAnchor" number="2.6.3">
<h3><span class="header-section-number">2.6.3</span> Covariates<a href="cleaning.html#covariates-5" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="cleaning.html#cb77-1" tabindex="-1"></a><span class="co"># composite WITHIN years </span></span>
<span id="cb77-2"><a href="cleaning.html#cb77-2" tabindex="-1"></a>lasa_cov <span class="ot">&lt;-</span> lasa_recode <span class="sc">%&gt;%</span></span>
<span id="cb77-3"><a href="cleaning.html#cb77-3" tabindex="-1"></a>  <span class="fu">filter</span>(category <span class="sc">==</span> <span class="st">&quot;covariates&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb77-4"><a href="cleaning.html#cb77-4" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>category) <span class="sc">%&gt;%</span></span>
<span id="cb77-5"><a href="cleaning.html#cb77-5" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">map</span>(data, <span class="sc">~</span>(.) <span class="sc">%&gt;%</span> </span>
<span id="cb77-6"><a href="cleaning.html#cb77-6" tabindex="-1"></a>      <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(value)) <span class="sc">%&gt;%</span></span>
<span id="cb77-7"><a href="cleaning.html#cb77-7" tabindex="-1"></a>      <span class="fu">left_join</span>(lasa_waves) <span class="sc">%&gt;%</span></span>
<span id="cb77-8"><a href="cleaning.html#cb77-8" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">comp_rule =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(comp_rule), <span class="st">&quot;skip&quot;</span>, comp_rule)) <span class="sc">%&gt;%</span></span>
<span id="cb77-9"><a href="cleaning.html#cb77-9" tabindex="-1"></a>      <span class="fu">group_by</span>(comp_rule, SID, year, p_year, long_rule) <span class="sc">%&gt;%</span></span>
<span id="cb77-10"><a href="cleaning.html#cb77-10" tabindex="-1"></a>      <span class="fu">nest</span>() <span class="sc">%&gt;%</span></span>
<span id="cb77-11"><a href="cleaning.html#cb77-11" tabindex="-1"></a>      <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb77-12"><a href="cleaning.html#cb77-12" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">map2</span>(data, comp_rule, <span class="sc">~</span><span class="fu">fun_call</span>((.x)<span class="sc">$</span>value, .y))) <span class="sc">%&gt;%</span></span>
<span id="cb77-13"><a href="cleaning.html#cb77-13" tabindex="-1"></a>      <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb77-14"><a href="cleaning.html#cb77-14" tabindex="-1"></a>      <span class="fu">filter</span>(year <span class="sc">&lt;=</span> p_year)</span>
<span id="cb77-15"><a href="cleaning.html#cb77-15" tabindex="-1"></a>      ))</span>
<span id="cb77-16"><a href="cleaning.html#cb77-16" tabindex="-1"></a></span>
<span id="cb77-17"><a href="cleaning.html#cb77-17" tabindex="-1"></a>comp_fun <span class="ot">&lt;-</span> <span class="cf">function</span>(d, rule, p_year){</span>
<span id="cb77-18"><a href="cleaning.html#cb77-18" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">paste</span>(rule, p_year))</span>
<span id="cb77-19"><a href="cleaning.html#cb77-19" tabindex="-1"></a>  d <span class="sc">%&gt;%</span></span>
<span id="cb77-20"><a href="cleaning.html#cb77-20" tabindex="-1"></a>    <span class="fu">group_by</span>(SID, name) <span class="sc">%&gt;%</span></span>
<span id="cb77-21"><a href="cleaning.html#cb77-21" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">value =</span> <span class="fu">fun_call</span>(data, rule)) <span class="sc">%&gt;%</span></span>
<span id="cb77-22"><a href="cleaning.html#cb77-22" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb77-23"><a href="cleaning.html#cb77-23" tabindex="-1"></a>    <span class="fu">distinct</span>()</span>
<span id="cb77-24"><a href="cleaning.html#cb77-24" tabindex="-1"></a>}</span>
<span id="cb77-25"><a href="cleaning.html#cb77-25" tabindex="-1"></a></span>
<span id="cb77-26"><a href="cleaning.html#cb77-26" tabindex="-1"></a><span class="co"># composite ACROSS years</span></span>
<span id="cb77-27"><a href="cleaning.html#cb77-27" tabindex="-1"></a>lasa_cov <span class="ot">&lt;-</span> lasa_cov <span class="sc">%&gt;%</span></span>
<span id="cb77-28"><a href="cleaning.html#cb77-28" tabindex="-1"></a>  <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb77-29"><a href="cleaning.html#cb77-29" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">long_rule =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(long_rule), <span class="st">&quot;skip&quot;</span>, long_rule)) <span class="sc">%&gt;%</span></span>
<span id="cb77-30"><a href="cleaning.html#cb77-30" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">&lt;=</span> p_year) <span class="sc">%&gt;%</span></span>
<span id="cb77-31"><a href="cleaning.html#cb77-31" tabindex="-1"></a>  <span class="fu">group_by</span>(p_year, long_rule) <span class="sc">%&gt;%</span></span>
<span id="cb77-32"><a href="cleaning.html#cb77-32" tabindex="-1"></a>  <span class="fu">nest</span>() <span class="sc">%&gt;%</span></span>
<span id="cb77-33"><a href="cleaning.html#cb77-33" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb77-34"><a href="cleaning.html#cb77-34" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">pmap</span>(<span class="fu">list</span>(data, long_rule, p_year), comp_fun)) <span class="sc">%&gt;%</span></span>
<span id="cb77-35"><a href="cleaning.html#cb77-35" tabindex="-1"></a>  <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb77-36"><a href="cleaning.html#cb77-36" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">ifelse</span>(<span class="fu">is.infinite</span>(value) <span class="sc">|</span> <span class="fu">is.nan</span>(value), <span class="cn">NA</span>, value)) <span class="sc">%&gt;%</span></span>
<span id="cb77-37"><a href="cleaning.html#cb77-37" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>long_rule) <span class="sc">%&gt;%</span></span>
<span id="cb77-38"><a href="cleaning.html#cb77-38" tabindex="-1"></a>  <span class="fu">spread</span>(name, value) <span class="sc">%&gt;%</span></span>
<span id="cb77-39"><a href="cleaning.html#cb77-39" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(SID))</span></code></pre></div>
</div>
<div id="personality-variables-5" class="section level3 hasAnchor" number="2.6.4">
<h3><span class="header-section-number">2.6.4</span> Personality Variables<a href="cleaning.html#personality-variables-5" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="cleaning.html#cb78-1" tabindex="-1"></a>lasa_pers <span class="ot">&lt;-</span> lasa_recode <span class="sc">%&gt;%</span></span>
<span id="cb78-2"><a href="cleaning.html#cb78-2" tabindex="-1"></a>  <span class="fu">filter</span>(category <span class="sc">==</span> <span class="st">&quot;pers&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb78-3"><a href="cleaning.html#cb78-3" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>category) <span class="sc">%&gt;%</span> </span>
<span id="cb78-4"><a href="cleaning.html#cb78-4" tabindex="-1"></a>  <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb78-5"><a href="cleaning.html#cb78-5" tabindex="-1"></a>  <span class="fu">left_join</span>(lasa_waves) <span class="sc">%&gt;%</span></span>
<span id="cb78-6"><a href="cleaning.html#cb78-6" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> p_year) <span class="sc">%&gt;%</span></span>
<span id="cb78-7"><a href="cleaning.html#cb78-7" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(value)) <span class="sc">%&gt;%</span></span>
<span id="cb78-8"><a href="cleaning.html#cb78-8" tabindex="-1"></a>  <span class="fu">group_by</span>(SID, year, p_year, name, itemname, comp_rule) <span class="sc">%&gt;%</span></span>
<span id="cb78-9"><a href="cleaning.html#cb78-9" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">value =</span> <span class="fu">mean</span>(value, <span class="at">na.rm =</span> T)) <span class="sc">%&gt;%</span></span>
<span id="cb78-10"><a href="cleaning.html#cb78-10" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb78-11"><a href="cleaning.html#cb78-11" tabindex="-1"></a></span>
<span id="cb78-12"><a href="cleaning.html#cb78-12" tabindex="-1"></a><span class="co"># alpha&#39;s</span></span>
<span id="cb78-13"><a href="cleaning.html#cb78-13" tabindex="-1"></a>lasa_alpha <span class="ot">&lt;-</span> lasa_pers <span class="sc">%&gt;%</span></span>
<span id="cb78-14"><a href="cleaning.html#cb78-14" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(value)) <span class="sc">%&gt;%</span></span>
<span id="cb78-15"><a href="cleaning.html#cb78-15" tabindex="-1"></a>  <span class="fu">select</span>(name, itemname, year, SID, value) <span class="sc">%&gt;%</span></span>
<span id="cb78-16"><a href="cleaning.html#cb78-16" tabindex="-1"></a>  <span class="fu">group_by</span>(name) <span class="sc">%&gt;%</span></span>
<span id="cb78-17"><a href="cleaning.html#cb78-17" tabindex="-1"></a>  <span class="fu">nest</span>() <span class="sc">%&gt;%</span></span>
<span id="cb78-18"><a href="cleaning.html#cb78-18" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">map</span>(data, <span class="sc">~</span>(.) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>() <span class="sc">%&gt;%</span> <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> itemname, <span class="at">values_from =</span> value, <span class="at">values_fn =</span> <span class="fu">list</span>(mean))),</span>
<span id="cb78-19"><a href="cleaning.html#cb78-19" tabindex="-1"></a>         <span class="at">alpha =</span> <span class="fu">map</span>(data, <span class="fu">possibly</span>(<span class="sc">~</span>psych<span class="sc">::</span><span class="fu">alpha</span>((.) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>SID)), <span class="cn">NA_real_</span>)))</span>
<span id="cb78-20"><a href="cleaning.html#cb78-20" tabindex="-1"></a></span>
<span id="cb78-21"><a href="cleaning.html#cb78-21" tabindex="-1"></a>comp_fun <span class="ot">&lt;-</span> <span class="cf">function</span>(df, rule){</span>
<span id="cb78-22"><a href="cleaning.html#cb78-22" tabindex="-1"></a>  df <span class="sc">%&gt;%</span></span>
<span id="cb78-23"><a href="cleaning.html#cb78-23" tabindex="-1"></a>    <span class="fu">group_by</span>(SID) <span class="sc">%&gt;%</span></span>
<span id="cb78-24"><a href="cleaning.html#cb78-24" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">value =</span> <span class="fu">fun_call</span>(value, rule)) <span class="sc">%&gt;%</span></span>
<span id="cb78-25"><a href="cleaning.html#cb78-25" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb78-26"><a href="cleaning.html#cb78-26" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">ifelse</span>(<span class="fu">is.infinite</span>(value) <span class="sc">|</span> <span class="fu">is.nan</span>(value), <span class="cn">NA</span>, value))</span>
<span id="cb78-27"><a href="cleaning.html#cb78-27" tabindex="-1"></a>}</span>
<span id="cb78-28"><a href="cleaning.html#cb78-28" tabindex="-1"></a></span>
<span id="cb78-29"><a href="cleaning.html#cb78-29" tabindex="-1"></a><span class="co"># create composites</span></span>
<span id="cb78-30"><a href="cleaning.html#cb78-30" tabindex="-1"></a>lasa_pers <span class="ot">&lt;-</span> lasa_pers <span class="sc">%&gt;%</span></span>
<span id="cb78-31"><a href="cleaning.html#cb78-31" tabindex="-1"></a>  <span class="fu">group_by</span>(name, comp_rule, year) <span class="sc">%&gt;%</span></span>
<span id="cb78-32"><a href="cleaning.html#cb78-32" tabindex="-1"></a>  <span class="fu">nest</span>() <span class="sc">%&gt;%</span></span>
<span id="cb78-33"><a href="cleaning.html#cb78-33" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb78-34"><a href="cleaning.html#cb78-34" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">map2</span>(data, comp_rule, comp_fun)) <span class="sc">%&gt;%</span></span>
<span id="cb78-35"><a href="cleaning.html#cb78-35" tabindex="-1"></a>  <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb78-36"><a href="cleaning.html#cb78-36" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>comp_rule)</span></code></pre></div>
</div>
<div id="outcome-variables-5" class="section level3 hasAnchor" number="2.6.5">
<h3><span class="header-section-number">2.6.5</span> Outcome Variables<a href="cleaning.html#outcome-variables-5" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="cleaning.html#cb79-1" tabindex="-1"></a>lasa_cog_waves <span class="ot">&lt;-</span> lasa_recode <span class="sc">%&gt;%</span></span>
<span id="cb79-2"><a href="cleaning.html#cb79-2" tabindex="-1"></a>  <span class="fu">filter</span>(category <span class="sc">==</span> <span class="st">&quot;outcome&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb79-3"><a href="cleaning.html#cb79-3" tabindex="-1"></a>  <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb79-4"><a href="cleaning.html#cb79-4" tabindex="-1"></a>  <span class="fu">group_by</span>(name, SID) <span class="sc">%&gt;%</span></span>
<span id="cb79-5"><a href="cleaning.html#cb79-5" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">o_year =</span> <span class="fu">max</span>(year)) <span class="sc">%&gt;%</span></span>
<span id="cb79-6"><a href="cleaning.html#cb79-6" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb79-7"><a href="cleaning.html#cb79-7" tabindex="-1"></a><span class="co"># composite within years</span></span>
<span id="cb79-8"><a href="cleaning.html#cb79-8" tabindex="-1"></a>lasa_out <span class="ot">&lt;-</span> lasa_recode <span class="sc">%&gt;%</span></span>
<span id="cb79-9"><a href="cleaning.html#cb79-9" tabindex="-1"></a>  <span class="fu">filter</span>(category <span class="sc">==</span> <span class="st">&quot;outcome&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb79-10"><a href="cleaning.html#cb79-10" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>category) <span class="sc">%&gt;%</span></span>
<span id="cb79-11"><a href="cleaning.html#cb79-11" tabindex="-1"></a>  <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb79-12"><a href="cleaning.html#cb79-12" tabindex="-1"></a>  <span class="fu">right_join</span>(lasa_cog_waves) <span class="sc">%&gt;%</span></span>
<span id="cb79-13"><a href="cleaning.html#cb79-13" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> o_year) <span class="sc">%&gt;%</span></span>
<span id="cb79-14"><a href="cleaning.html#cb79-14" tabindex="-1"></a>  <span class="fu">group_by</span>(name, year, SID) <span class="sc">%&gt;%</span></span>
<span id="cb79-15"><a href="cleaning.html#cb79-15" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">value =</span> <span class="fu">sum</span>(value, <span class="at">na.rm =</span> T)) <span class="sc">%&gt;%</span></span>
<span id="cb79-16"><a href="cleaning.html#cb79-16" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code></pre></div>
</div>
<div id="combine-data-5" class="section level3 hasAnchor" number="2.6.6">
<h3><span class="header-section-number">2.6.6</span> Combine Data<a href="cleaning.html#combine-data-5" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="cleaning.html#cb80-1" tabindex="-1"></a>lasa_combined <span class="ot">&lt;-</span> lasa_pers <span class="sc">%&gt;%</span> </span>
<span id="cb80-2"><a href="cleaning.html#cb80-2" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Trait =</span> name, <span class="at">p_value =</span> value, <span class="at">p_year =</span> year) <span class="sc">%&gt;%</span></span>
<span id="cb80-3"><a href="cleaning.html#cb80-3" tabindex="-1"></a>  <span class="fu">full_join</span>(</span>
<span id="cb80-4"><a href="cleaning.html#cb80-4" tabindex="-1"></a>    lasa_out <span class="sc">%&gt;%</span> </span>
<span id="cb80-5"><a href="cleaning.html#cb80-5" tabindex="-1"></a>      <span class="fu">rename</span>(<span class="at">Outcome =</span> name, <span class="at">o_value =</span> value, <span class="at">o_year =</span> year)</span>
<span id="cb80-6"><a href="cleaning.html#cb80-6" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> <span class="fu">full_join</span>(lasa_cov) <span class="sc">%&gt;%</span></span>
<span id="cb80-7"><a href="cleaning.html#cb80-7" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(p_value) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(o_value))</span></code></pre></div>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="cleaning.html#cb81-1" tabindex="-1"></a><span class="fu">save</span>(lasa_cov, lasa_alpha, lasa_pers, lasa_out, lasa_combined,</span>
<span id="cb81-2"><a href="cleaning.html#cb81-2" tabindex="-1"></a>     <span class="at">file =</span> <span class="fu">sprintf</span>(<span class="st">&quot;%s/data/clean/lasa_cleaned.RData&quot;</span>, local_path))</span></code></pre></div>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="cleaning.html#cb82-1" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span><span class="fu">ls</span>()[<span class="fu">grepl</span>(<span class="st">&quot;lasa&quot;</span>, <span class="fu">ls</span>())])</span></code></pre></div>
</div>
</div>
<div id="map" class="section level2 hasAnchor" number="2.7">
<h2><span class="header-section-number">2.7</span> MAP<a href="cleaning.html#map" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The RUSH Memory and Aging Project (MAP) is an ongoing longitudinal study that began in 1997 <span class="citation">(<a href="#ref-a2012overview"><strong>a2012overview?</strong></a>)</span>. These data are available, through application from <a href="https://www.radc.rush.edu/requests.htm" class="uri">https://www.radc.rush.edu/requests.htm</a>.</p>
<p>Participants who were 65 and older were recruited from retirement communities and subsidized senior housing facilities throughout Chicagoland and northeastern Illinois beginning in 1997. Data are collected annually, and all participants are organ donors. Additional participants are recuited each year. Additional information and documentation on the data can be found at <a href="https://www.radc.rush.edu/docs/var/variables.htm" class="uri">https://www.radc.rush.edu/docs/var/variables.htm</a>.</p>
<p>Sample sizes vary by year, ranging from 52 (1997) to 2205 participants. This provides 99% power to detect a zero-order correlation effect size of ~.09, two-tailed at alpha .05.</p>
<div id="load-data-6" class="section level3 hasAnchor" number="2.7.1">
<h3><span class="header-section-number">2.7.1</span> Load Data<a href="cleaning.html#load-data-6" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="cleaning.html#cb83-1" tabindex="-1"></a>(map_codebook <span class="ot">&lt;-</span> (codebook <span class="sc">%&gt;%</span> <span class="fu">filter</span>(study <span class="sc">==</span> <span class="st">&quot;RADC-MAP&quot;</span>))<span class="sc">$</span>codebook[[<span class="dv">1</span>]] <span class="sc">%&gt;%</span></span>
<span id="cb83-2"><a href="cleaning.html#cb83-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">orig_itemname =</span> <span class="fu">str_to_lower</span>(orig_itemname)))</span></code></pre></div>
<pre><code>## # A tibble: 7 × 15
##   study    dataset category   name   itemname year  orig_itemname description scale reverse_code recode mini  maxi  comp_rule
##   &lt;chr&gt;    &lt;lgl&gt;   &lt;chr&gt;      &lt;chr&gt;  &lt;chr&gt;    &lt;chr&gt; &lt;chr&gt;         &lt;chr&gt;       &lt;chr&gt; &lt;chr&gt;        &lt;chr&gt;  &lt;lgl&gt; &lt;lgl&gt; &lt;chr&gt;    
## 1 RADC-MAP NA      outcome    cryst… bosNami… long… cts_bname     Boston nam…  &lt;NA&gt; no           ifels… NA    NA    sum      
## 2 RADC-MAP NA      covariates age    ageBase… 0     age_bl        The age at…  &lt;NA&gt; no           ifels… NA    NA    skip     
## 3 RADC-MAP NA      covariates educa… eduYears 0     educ          The years …  &lt;NA&gt; no           ifels… NA    NA    skip     
## 4 RADC-MAP NA      covariates gender sex      0     msex          Self-repor… &quot;1 =… no           ifels… NA    NA    skip     
## 5 RADC-MAP NA      pers       C      C        0     conscientiou… The variab… &quot;Res… no           ifels… NA    NA    average  
## 6 RADC-MAP NA      pers       E      E        0     extraversion… The variab… &quot;Res… no           ifels… NA    NA    average  
## 7 RADC-MAP NA      pers       N      N        0     neuroticism_… The variab… &quot;Res… no           ifels… NA    NA    average  
## # ℹ 1 more variable: long_rule &lt;chr&gt;</code></pre>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="cleaning.html#cb85-1" tabindex="-1"></a>map <span class="ot">&lt;-</span> <span class="fu">sprintf</span>(<span class="st">&quot;%s/rush-radc/dataset_1034_long_03-25-2021.xlsx&quot;</span>, data_path) <span class="sc">%&gt;%</span> <span class="fu">read_excel</span>() <span class="sc">%&gt;%</span></span>
<span id="cb85-2"><a href="cleaning.html#cb85-2" tabindex="-1"></a>  <span class="fu">full_join</span>(<span class="fu">sprintf</span>(<span class="st">&quot;%s/rush-radc/dataset_1034_basic_03-25-2021.xlsx&quot;</span>, data_path) <span class="sc">%&gt;%</span> <span class="fu">read_excel</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb85-3"><a href="cleaning.html#cb85-3" tabindex="-1"></a>  <span class="fu">filter</span>(study <span class="sc">==</span> <span class="st">&quot;MAP&quot;</span>)</span></code></pre></div>
</div>
<div id="recoding-reverse-scoring-6" class="section level3 hasAnchor" number="2.7.2">
<h3><span class="header-section-number">2.7.2</span> Recoding &amp; Reverse Scoring<a href="cleaning.html#recoding-reverse-scoring-6" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="cleaning.html#cb86-1" tabindex="-1"></a>rename_fun <span class="ot">&lt;-</span> <span class="cf">function</span>(cb, var){</span>
<span id="cb86-2"><a href="cleaning.html#cb86-2" tabindex="-1"></a>  old.names <span class="ot">&lt;-</span> <span class="fu">unique</span>((map_codebook <span class="sc">%&gt;%</span> <span class="fu">filter</span>(name <span class="sc">==</span> var))<span class="sc">$</span>orig_itemname)</span>
<span id="cb86-3"><a href="cleaning.html#cb86-3" tabindex="-1"></a>  df <span class="ot">&lt;-</span> map <span class="sc">%&gt;%</span> </span>
<span id="cb86-4"><a href="cleaning.html#cb86-4" tabindex="-1"></a>    <span class="fu">select</span>(<span class="at">SID =</span> projid, <span class="at">wave =</span> fu_year, <span class="fu">one_of</span>(old.names)) <span class="sc">%&gt;%</span></span>
<span id="cb86-5"><a href="cleaning.html#cb86-5" tabindex="-1"></a>    <span class="fu">gather</span>(<span class="at">key =</span> orig_itemname, <span class="at">value =</span> value, <span class="sc">-</span>SID, <span class="sc">-</span>wave, <span class="at">na.rm =</span> T) <span class="sc">%&gt;%</span></span>
<span id="cb86-6"><a href="cleaning.html#cb86-6" tabindex="-1"></a>    <span class="fu">left_join</span>(cb <span class="sc">%&gt;%</span> <span class="fu">select</span>(itemname, orig_itemname, reverse_code<span class="sc">:</span>long_rule))</span>
<span id="cb86-7"><a href="cleaning.html#cb86-7" tabindex="-1"></a>}</span>
<span id="cb86-8"><a href="cleaning.html#cb86-8" tabindex="-1"></a></span>
<span id="cb86-9"><a href="cleaning.html#cb86-9" tabindex="-1"></a><span class="co"># join data with recoding info </span></span>
<span id="cb86-10"><a href="cleaning.html#cb86-10" tabindex="-1"></a>map_recode <span class="ot">&lt;-</span> map_codebook <span class="sc">%&gt;%</span></span>
<span id="cb86-11"><a href="cleaning.html#cb86-11" tabindex="-1"></a>  <span class="fu">select</span>(category, name, itemname, year, orig_itemname, reverse_code<span class="sc">:</span>long_rule) <span class="sc">%&gt;%</span></span>
<span id="cb86-12"><a href="cleaning.html#cb86-12" tabindex="-1"></a>  <span class="fu">filter</span>(category <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;pers&quot;</span>, <span class="st">&quot;outcome&quot;</span>, <span class="st">&quot;covariates&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb86-13"><a href="cleaning.html#cb86-13" tabindex="-1"></a>  <span class="fu">group_by</span>(category, name) <span class="sc">%&gt;%</span></span>
<span id="cb86-14"><a href="cleaning.html#cb86-14" tabindex="-1"></a>  <span class="fu">nest</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb86-15"><a href="cleaning.html#cb86-15" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb86-16"><a href="cleaning.html#cb86-16" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">map2</span>(data, name, rename_fun))</span>
<span id="cb86-17"><a href="cleaning.html#cb86-17" tabindex="-1"></a></span>
<span id="cb86-18"><a href="cleaning.html#cb86-18" tabindex="-1"></a><span class="co"># recode </span></span>
<span id="cb86-19"><a href="cleaning.html#cb86-19" tabindex="-1"></a>recode_fun <span class="ot">&lt;-</span> <span class="cf">function</span>(rule, y, year){</span>
<span id="cb86-20"><a href="cleaning.html#cb86-20" tabindex="-1"></a>  x <span class="ot">&lt;-</span> y<span class="sc">$</span>value</span>
<span id="cb86-21"><a href="cleaning.html#cb86-21" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.na</span>(rule)){y<span class="sc">$</span>value <span class="ot">&lt;-</span> <span class="fu">eval</span>(<span class="fu">parse</span>(<span class="at">text =</span> rule))}</span>
<span id="cb86-22"><a href="cleaning.html#cb86-22" tabindex="-1"></a>  <span class="fu">return</span>(y)</span>
<span id="cb86-23"><a href="cleaning.html#cb86-23" tabindex="-1"></a>}</span>
<span id="cb86-24"><a href="cleaning.html#cb86-24" tabindex="-1"></a></span>
<span id="cb86-25"><a href="cleaning.html#cb86-25" tabindex="-1"></a>map_recode <span class="ot">&lt;-</span> map_recode <span class="sc">%&gt;%</span> </span>
<span id="cb86-26"><a href="cleaning.html#cb86-26" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">map</span>(data, <span class="sc">~</span>(.) <span class="sc">%&gt;%</span> </span>
<span id="cb86-27"><a href="cleaning.html#cb86-27" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">wave =</span> <span class="fu">as.numeric</span>(wave)) <span class="sc">%&gt;%</span></span>
<span id="cb86-28"><a href="cleaning.html#cb86-28" tabindex="-1"></a>    <span class="fu">group_by</span>(recode, wave) <span class="sc">%&gt;%</span></span>
<span id="cb86-29"><a href="cleaning.html#cb86-29" tabindex="-1"></a>    <span class="fu">nest</span>() <span class="sc">%&gt;%</span></span>
<span id="cb86-30"><a href="cleaning.html#cb86-30" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb86-31"><a href="cleaning.html#cb86-31" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">pmap</span>(<span class="fu">list</span>(recode, data, wave), recode_fun)) <span class="sc">%&gt;%</span></span>
<span id="cb86-32"><a href="cleaning.html#cb86-32" tabindex="-1"></a>    <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb86-33"><a href="cleaning.html#cb86-33" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">ifelse</span>(value <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">|</span> <span class="fu">is.nan</span>(value) <span class="sc">|</span> <span class="fu">is.infinite</span>(value), <span class="cn">NA</span>, value))))</span>
<span id="cb86-34"><a href="cleaning.html#cb86-34" tabindex="-1"></a></span>
<span id="cb86-35"><a href="cleaning.html#cb86-35" tabindex="-1"></a><span class="co"># reverse code </span></span>
<span id="cb86-36"><a href="cleaning.html#cb86-36" tabindex="-1"></a>map_recode <span class="ot">&lt;-</span> map_recode <span class="sc">%&gt;%</span></span>
<span id="cb86-37"><a href="cleaning.html#cb86-37" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">map</span>(data, <span class="sc">~</span>(.) <span class="sc">%&gt;%</span></span>
<span id="cb86-38"><a href="cleaning.html#cb86-38" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">ifelse</span>(reverse_code <span class="sc">==</span> <span class="st">&quot;no&quot;</span> <span class="sc">|</span> <span class="fu">is.na</span>(reverse_code), value, </span>
<span id="cb86-39"><a href="cleaning.html#cb86-39" tabindex="-1"></a>                        <span class="fu">reverse.code</span>(<span class="sc">-</span><span class="dv">1</span>, value, <span class="at">mini =</span> mini, <span class="at">maxi =</span> maxi)))))</span>
<span id="cb86-40"><a href="cleaning.html#cb86-40" tabindex="-1"></a></span>
<span id="cb86-41"><a href="cleaning.html#cb86-41" tabindex="-1"></a>fun_call <span class="ot">&lt;-</span> <span class="cf">function</span>(x, rule){</span>
<span id="cb86-42"><a href="cleaning.html#cb86-42" tabindex="-1"></a>    <span class="cf">switch</span>(rule,</span>
<span id="cb86-43"><a href="cleaning.html#cb86-43" tabindex="-1"></a>           <span class="at">average =</span> <span class="fu">mean</span>(x, <span class="at">na.rm =</span> T),</span>
<span id="cb86-44"><a href="cleaning.html#cb86-44" tabindex="-1"></a>           <span class="at">mode =</span> <span class="fu">Mode</span>(x)[<span class="dv">1</span>],</span>
<span id="cb86-45"><a href="cleaning.html#cb86-45" tabindex="-1"></a>           <span class="at">sum =</span> <span class="fu">sum</span>(x, <span class="at">na.rm =</span> T),</span>
<span id="cb86-46"><a href="cleaning.html#cb86-46" tabindex="-1"></a>           <span class="at">skip =</span> <span class="fu">unique</span>(x)[<span class="dv">1</span>],</span>
<span id="cb86-47"><a href="cleaning.html#cb86-47" tabindex="-1"></a>           <span class="at">select =</span> <span class="fu">unique</span>(x)[<span class="dv">1</span>],</span>
<span id="cb86-48"><a href="cleaning.html#cb86-48" tabindex="-1"></a>           <span class="at">max =</span> <span class="fu">max</span>(x, <span class="at">na.rm =</span> T),</span>
<span id="cb86-49"><a href="cleaning.html#cb86-49" tabindex="-1"></a>           <span class="at">min =</span> <span class="fu">min</span>(x, <span class="at">na.rm =</span> T))</span>
<span id="cb86-50"><a href="cleaning.html#cb86-50" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="covariates-6" class="section level3 hasAnchor" number="2.7.3">
<h3><span class="header-section-number">2.7.3</span> Covariates<a href="cleaning.html#covariates-6" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="cleaning.html#cb87-1" tabindex="-1"></a><span class="co"># composite WITHIN years </span></span>
<span id="cb87-2"><a href="cleaning.html#cb87-2" tabindex="-1"></a>map_cov <span class="ot">&lt;-</span> map_recode <span class="sc">%&gt;%</span></span>
<span id="cb87-3"><a href="cleaning.html#cb87-3" tabindex="-1"></a>  <span class="fu">filter</span>(category <span class="sc">==</span> <span class="st">&quot;covariates&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb87-4"><a href="cleaning.html#cb87-4" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>category) <span class="sc">%&gt;%</span></span>
<span id="cb87-5"><a href="cleaning.html#cb87-5" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">map</span>(data, <span class="sc">~</span>(.) <span class="sc">%&gt;%</span> </span>
<span id="cb87-6"><a href="cleaning.html#cb87-6" tabindex="-1"></a>      <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(value)) <span class="sc">%&gt;%</span></span>
<span id="cb87-7"><a href="cleaning.html#cb87-7" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">comp_rule =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(comp_rule), <span class="st">&quot;skip&quot;</span>, comp_rule)) <span class="sc">%&gt;%</span></span>
<span id="cb87-8"><a href="cleaning.html#cb87-8" tabindex="-1"></a>      <span class="fu">group_by</span>(comp_rule, SID, wave, long_rule) <span class="sc">%&gt;%</span></span>
<span id="cb87-9"><a href="cleaning.html#cb87-9" tabindex="-1"></a>      <span class="fu">nest</span>() <span class="sc">%&gt;%</span></span>
<span id="cb87-10"><a href="cleaning.html#cb87-10" tabindex="-1"></a>      <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb87-11"><a href="cleaning.html#cb87-11" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">map2</span>(data, comp_rule, <span class="sc">~</span><span class="fu">fun_call</span>((.x)<span class="sc">$</span>value, .y))) <span class="sc">%&gt;%</span></span>
<span id="cb87-12"><a href="cleaning.html#cb87-12" tabindex="-1"></a>      <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb87-13"><a href="cleaning.html#cb87-13" tabindex="-1"></a>      <span class="fu">filter</span>(wave <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb87-14"><a href="cleaning.html#cb87-14" tabindex="-1"></a>      ))</span>
<span id="cb87-15"><a href="cleaning.html#cb87-15" tabindex="-1"></a></span>
<span id="cb87-16"><a href="cleaning.html#cb87-16" tabindex="-1"></a>comp_fun <span class="ot">&lt;-</span> <span class="cf">function</span>(d, rule){</span>
<span id="cb87-17"><a href="cleaning.html#cb87-17" tabindex="-1"></a>  d <span class="sc">%&gt;%</span></span>
<span id="cb87-18"><a href="cleaning.html#cb87-18" tabindex="-1"></a>    <span class="fu">group_by</span>(SID, name) <span class="sc">%&gt;%</span></span>
<span id="cb87-19"><a href="cleaning.html#cb87-19" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">value =</span> <span class="fu">fun_call</span>(data, rule)) <span class="sc">%&gt;%</span></span>
<span id="cb87-20"><a href="cleaning.html#cb87-20" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb87-21"><a href="cleaning.html#cb87-21" tabindex="-1"></a>    <span class="fu">distinct</span>()</span>
<span id="cb87-22"><a href="cleaning.html#cb87-22" tabindex="-1"></a>}</span>
<span id="cb87-23"><a href="cleaning.html#cb87-23" tabindex="-1"></a></span>
<span id="cb87-24"><a href="cleaning.html#cb87-24" tabindex="-1"></a><span class="co"># composite ACROSS years</span></span>
<span id="cb87-25"><a href="cleaning.html#cb87-25" tabindex="-1"></a>map_cov <span class="ot">&lt;-</span> map_cov <span class="sc">%&gt;%</span></span>
<span id="cb87-26"><a href="cleaning.html#cb87-26" tabindex="-1"></a>  <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb87-27"><a href="cleaning.html#cb87-27" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">long_rule =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(long_rule), <span class="st">&quot;skip&quot;</span>, long_rule)) <span class="sc">%&gt;%</span></span>
<span id="cb87-28"><a href="cleaning.html#cb87-28" tabindex="-1"></a>  <span class="fu">group_by</span>(long_rule) <span class="sc">%&gt;%</span></span>
<span id="cb87-29"><a href="cleaning.html#cb87-29" tabindex="-1"></a>  <span class="fu">nest</span>() <span class="sc">%&gt;%</span></span>
<span id="cb87-30"><a href="cleaning.html#cb87-30" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb87-31"><a href="cleaning.html#cb87-31" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">pmap</span>(<span class="fu">list</span>(data, long_rule), comp_fun)) <span class="sc">%&gt;%</span></span>
<span id="cb87-32"><a href="cleaning.html#cb87-32" tabindex="-1"></a>  <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb87-33"><a href="cleaning.html#cb87-33" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">ifelse</span>(<span class="fu">is.infinite</span>(value) <span class="sc">|</span> <span class="fu">is.nan</span>(value), <span class="cn">NA</span>, value)) <span class="sc">%&gt;%</span></span>
<span id="cb87-34"><a href="cleaning.html#cb87-34" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>long_rule) <span class="sc">%&gt;%</span></span>
<span id="cb87-35"><a href="cleaning.html#cb87-35" tabindex="-1"></a>  <span class="fu">spread</span>(name, value) <span class="sc">%&gt;%</span></span>
<span id="cb87-36"><a href="cleaning.html#cb87-36" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(SID))</span></code></pre></div>
</div>
<div id="personality-variables-6" class="section level3 hasAnchor" number="2.7.4">
<h3><span class="header-section-number">2.7.4</span> Personality Variables<a href="cleaning.html#personality-variables-6" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="cleaning.html#cb88-1" tabindex="-1"></a>map_pers <span class="ot">&lt;-</span> map_recode <span class="sc">%&gt;%</span></span>
<span id="cb88-2"><a href="cleaning.html#cb88-2" tabindex="-1"></a>  <span class="fu">filter</span>(category <span class="sc">==</span> <span class="st">&quot;pers&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb88-3"><a href="cleaning.html#cb88-3" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>category) <span class="sc">%&gt;%</span> </span>
<span id="cb88-4"><a href="cleaning.html#cb88-4" tabindex="-1"></a>  <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span> </span>
<span id="cb88-5"><a href="cleaning.html#cb88-5" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">%&gt;%</span></span>
<span id="cb88-6"><a href="cleaning.html#cb88-6" tabindex="-1"></a>  <span class="fu">group_by</span>(SID, name) <span class="sc">%&gt;%</span></span>
<span id="cb88-7"><a href="cleaning.html#cb88-7" tabindex="-1"></a>  <span class="fu">filter</span>(wave <span class="sc">==</span> <span class="fu">min</span>(wave)) <span class="sc">%&gt;%</span></span>
<span id="cb88-8"><a href="cleaning.html#cb88-8" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb88-9"><a href="cleaning.html#cb88-9" tabindex="-1"></a>  <span class="fu">select</span>(SID, name, wave, value)</span></code></pre></div>
</div>
<div id="outcome-variables-6" class="section level3 hasAnchor" number="2.7.5">
<h3><span class="header-section-number">2.7.5</span> Outcome Variables<a href="cleaning.html#outcome-variables-6" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="cleaning.html#cb89-1" tabindex="-1"></a>map_cog_waves <span class="ot">&lt;-</span> map_recode <span class="sc">%&gt;%</span></span>
<span id="cb89-2"><a href="cleaning.html#cb89-2" tabindex="-1"></a>  <span class="fu">filter</span>(category <span class="sc">==</span> <span class="st">&quot;outcome&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb89-3"><a href="cleaning.html#cb89-3" tabindex="-1"></a>  <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb89-4"><a href="cleaning.html#cb89-4" tabindex="-1"></a>  <span class="fu">group_by</span>(SID, name) <span class="sc">%&gt;%</span></span>
<span id="cb89-5"><a href="cleaning.html#cb89-5" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">o_year =</span> <span class="fu">max</span>(wave)) <span class="sc">%&gt;%</span></span>
<span id="cb89-6"><a href="cleaning.html#cb89-6" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb89-7"><a href="cleaning.html#cb89-7" tabindex="-1"></a></span>
<span id="cb89-8"><a href="cleaning.html#cb89-8" tabindex="-1"></a><span class="co"># composite within years</span></span>
<span id="cb89-9"><a href="cleaning.html#cb89-9" tabindex="-1"></a>map_out <span class="ot">&lt;-</span> map_recode <span class="sc">%&gt;%</span></span>
<span id="cb89-10"><a href="cleaning.html#cb89-10" tabindex="-1"></a>  <span class="fu">filter</span>(category <span class="sc">==</span> <span class="st">&quot;outcome&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb89-11"><a href="cleaning.html#cb89-11" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>category) <span class="sc">%&gt;%</span></span>
<span id="cb89-12"><a href="cleaning.html#cb89-12" tabindex="-1"></a>  <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb89-13"><a href="cleaning.html#cb89-13" tabindex="-1"></a>  <span class="fu">right_join</span>(map_cog_waves) <span class="sc">%&gt;%</span></span>
<span id="cb89-14"><a href="cleaning.html#cb89-14" tabindex="-1"></a>  <span class="fu">filter</span>(wave <span class="sc">==</span> o_year <span class="sc">&amp;</span> wave <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb89-15"><a href="cleaning.html#cb89-15" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(value)) <span class="sc">%&gt;%</span></span>
<span id="cb89-16"><a href="cleaning.html#cb89-16" tabindex="-1"></a>  <span class="fu">group_by</span>(name, itemname, wave) <span class="sc">%&gt;%</span></span>
<span id="cb89-17"><a href="cleaning.html#cb89-17" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">pomp</span>(value)) <span class="sc">%&gt;%</span></span>
<span id="cb89-18"><a href="cleaning.html#cb89-18" tabindex="-1"></a>  <span class="fu">group_by</span>(name, wave, SID) <span class="sc">%&gt;%</span></span>
<span id="cb89-19"><a href="cleaning.html#cb89-19" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">value =</span> <span class="fu">mean</span>(value, <span class="at">na.rm =</span> T)) <span class="sc">%&gt;%</span></span>
<span id="cb89-20"><a href="cleaning.html#cb89-20" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code></pre></div>
</div>
<div id="combine-data-6" class="section level3 hasAnchor" number="2.7.6">
<h3><span class="header-section-number">2.7.6</span> Combine Data<a href="cleaning.html#combine-data-6" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="cleaning.html#cb90-1" tabindex="-1"></a>map_combined <span class="ot">&lt;-</span> map_pers <span class="sc">%&gt;%</span> </span>
<span id="cb90-2"><a href="cleaning.html#cb90-2" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Trait =</span> name, <span class="at">p_value =</span> value, <span class="at">p_year =</span> wave) <span class="sc">%&gt;%</span></span>
<span id="cb90-3"><a href="cleaning.html#cb90-3" tabindex="-1"></a>  <span class="fu">full_join</span>(</span>
<span id="cb90-4"><a href="cleaning.html#cb90-4" tabindex="-1"></a>    map_out <span class="sc">%&gt;%</span> </span>
<span id="cb90-5"><a href="cleaning.html#cb90-5" tabindex="-1"></a>      <span class="fu">rename</span>(<span class="at">Outcome =</span> name, <span class="at">o_value =</span> value, <span class="at">o_year =</span> wave)</span>
<span id="cb90-6"><a href="cleaning.html#cb90-6" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> <span class="fu">full_join</span>(map_cov) <span class="sc">%&gt;%</span></span>
<span id="cb90-7"><a href="cleaning.html#cb90-7" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(p_value) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(o_value))</span></code></pre></div>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="cleaning.html#cb91-1" tabindex="-1"></a><span class="fu">save</span>(map_cov, map_pers, map_out, map_combined,</span>
<span id="cb91-2"><a href="cleaning.html#cb91-2" tabindex="-1"></a>     <span class="at">file =</span> <span class="fu">sprintf</span>(<span class="st">&quot;%s/data/clean/map_cleaned.RData&quot;</span>, local_path))</span></code></pre></div>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="cleaning.html#cb92-1" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span><span class="fu">ls</span>()[<span class="fu">grepl</span>(<span class="st">&quot;map&quot;</span>, <span class="fu">ls</span>())])</span></code></pre></div>
</div>
</div>
<div id="mars" class="section level2 hasAnchor" number="2.8">
<h2><span class="header-section-number">2.8</span> MARS<a href="cleaning.html#mars" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The RUSH Minority Aging Research Study (MARS) is an ongoing longitudinal study that began in 2004. These data are available, through application, from <a href="https://www.radc.rush.edu/requests.htm" class="uri">https://www.radc.rush.edu/requests.htm</a>.</p>
<p>Participants were Black individuals 65 and older who were recruited from community locations in the Chicago Metropolitan area and suburbs beginning in 2004. Data are collected annually. Additional participants are recruited each year. Additional information and documentation on the data can be found at <a href="https://www.radc.rush.edu/docs/var/variables.htm" class="uri">https://www.radc.rush.edu/docs/var/variables.htm</a>.</p>
<p>Sample sizes vary by year, ranging from 80 (2004) to 790 (2020). This provides 99% power to detect a zero-order correlation effect size of ~.17, two-tailed at alpha .05.</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="cleaning.html#cb93-1" tabindex="-1"></a>(mars_codebook <span class="ot">&lt;-</span> (codebook <span class="sc">%&gt;%</span> <span class="fu">filter</span>(study <span class="sc">==</span> <span class="st">&quot;MARS&quot;</span>))<span class="sc">$</span>codebook[[<span class="dv">1</span>]] <span class="sc">%&gt;%</span></span>
<span id="cb93-2"><a href="cleaning.html#cb93-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">orig_itemname =</span> <span class="fu">str_to_lower</span>(orig_itemname)))</span></code></pre></div>
<pre><code>## # A tibble: 5 × 15
##   study dataset category   name      itemname year  orig_itemname description scale reverse_code recode mini  maxi  comp_rule
##   &lt;chr&gt; &lt;lgl&gt;   &lt;chr&gt;      &lt;chr&gt;     &lt;chr&gt;    &lt;chr&gt; &lt;chr&gt;         &lt;chr&gt;       &lt;chr&gt; &lt;chr&gt;        &lt;chr&gt;  &lt;lgl&gt; &lt;lgl&gt; &lt;chr&gt;    
## 1 MARS  NA      outcome    crystall… bosNami… long… cts_bname     Boston nam…  &lt;NA&gt; no           ifels… NA    NA    sum      
## 2 MARS  NA      covariates age       ageBase… base… age_bl        The age at…  &lt;NA&gt; no           ifels… NA    NA    skip     
## 3 MARS  NA      covariates education eduYears base… educ          The years …  &lt;NA&gt; no           ifels… NA    NA    skip     
## 4 MARS  NA      covariates gender    sex      base… msex          Self-repor… &quot;1 =… no           ifels… NA    NA    skip     
## 5 MARS  NA      pers       N         N        base… neuroticism_… The variab… &quot;Res… no           ifels… NA    NA    average  
## # ℹ 1 more variable: long_rule &lt;chr&gt;</code></pre>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="cleaning.html#cb95-1" tabindex="-1"></a>mars <span class="ot">&lt;-</span> <span class="fu">sprintf</span>(<span class="st">&quot;%s/rush-radc/dataset_1034_long_03-26-2021.xlsx&quot;</span>, data_path) <span class="sc">%&gt;%</span> <span class="fu">read_excel</span>() <span class="sc">%&gt;%</span></span>
<span id="cb95-2"><a href="cleaning.html#cb95-2" tabindex="-1"></a>  <span class="fu">full_join</span>(<span class="fu">sprintf</span>(<span class="st">&quot;%s/rush-radc/dataset_1034_basic_03-26-2021.xlsx&quot;</span>, data_path) <span class="sc">%&gt;%</span> <span class="fu">read_excel</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb95-3"><a href="cleaning.html#cb95-3" tabindex="-1"></a>  <span class="fu">filter</span>(study <span class="sc">==</span> <span class="st">&quot;MARS&quot;</span>)</span></code></pre></div>
<div id="recoding-reverse-scoring-7" class="section level3 hasAnchor" number="2.8.1">
<h3><span class="header-section-number">2.8.1</span> Recoding &amp; Reverse Scoring<a href="cleaning.html#recoding-reverse-scoring-7" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="cleaning.html#cb96-1" tabindex="-1"></a>rename_fun <span class="ot">&lt;-</span> <span class="cf">function</span>(cb, var){</span>
<span id="cb96-2"><a href="cleaning.html#cb96-2" tabindex="-1"></a>  old.names <span class="ot">&lt;-</span> <span class="fu">unique</span>((mars_codebook <span class="sc">%&gt;%</span> <span class="fu">filter</span>(name <span class="sc">==</span> var))<span class="sc">$</span>orig_itemname)</span>
<span id="cb96-3"><a href="cleaning.html#cb96-3" tabindex="-1"></a>  df <span class="ot">&lt;-</span> mars <span class="sc">%&gt;%</span> </span>
<span id="cb96-4"><a href="cleaning.html#cb96-4" tabindex="-1"></a>    <span class="fu">select</span>(<span class="at">SID =</span> projid, <span class="at">wave =</span> fu_year, <span class="fu">one_of</span>(old.names)) <span class="sc">%&gt;%</span></span>
<span id="cb96-5"><a href="cleaning.html#cb96-5" tabindex="-1"></a>    <span class="fu">gather</span>(<span class="at">key =</span> orig_itemname, <span class="at">value =</span> value, <span class="sc">-</span>SID, <span class="sc">-</span>wave, <span class="at">na.rm =</span> T) <span class="sc">%&gt;%</span></span>
<span id="cb96-6"><a href="cleaning.html#cb96-6" tabindex="-1"></a>    <span class="fu">left_join</span>(cb <span class="sc">%&gt;%</span> <span class="fu">select</span>(itemname, orig_itemname, reverse_code<span class="sc">:</span>long_rule))</span>
<span id="cb96-7"><a href="cleaning.html#cb96-7" tabindex="-1"></a>}</span>
<span id="cb96-8"><a href="cleaning.html#cb96-8" tabindex="-1"></a></span>
<span id="cb96-9"><a href="cleaning.html#cb96-9" tabindex="-1"></a><span class="co"># join data with recoding info </span></span>
<span id="cb96-10"><a href="cleaning.html#cb96-10" tabindex="-1"></a>mars_recode <span class="ot">&lt;-</span> mars_codebook <span class="sc">%&gt;%</span></span>
<span id="cb96-11"><a href="cleaning.html#cb96-11" tabindex="-1"></a>  <span class="fu">select</span>(category, name, itemname, year, orig_itemname, reverse_code<span class="sc">:</span>long_rule) <span class="sc">%&gt;%</span></span>
<span id="cb96-12"><a href="cleaning.html#cb96-12" tabindex="-1"></a>  <span class="fu">filter</span>(category <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;pers&quot;</span>, <span class="st">&quot;outcome&quot;</span>, <span class="st">&quot;covariates&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb96-13"><a href="cleaning.html#cb96-13" tabindex="-1"></a>  <span class="fu">group_by</span>(category, name) <span class="sc">%&gt;%</span></span>
<span id="cb96-14"><a href="cleaning.html#cb96-14" tabindex="-1"></a>  <span class="fu">nest</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb96-15"><a href="cleaning.html#cb96-15" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb96-16"><a href="cleaning.html#cb96-16" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">map2</span>(data, name, rename_fun))</span>
<span id="cb96-17"><a href="cleaning.html#cb96-17" tabindex="-1"></a></span>
<span id="cb96-18"><a href="cleaning.html#cb96-18" tabindex="-1"></a><span class="co"># recode </span></span>
<span id="cb96-19"><a href="cleaning.html#cb96-19" tabindex="-1"></a>recode_fun <span class="ot">&lt;-</span> <span class="cf">function</span>(rule, y, year){</span>
<span id="cb96-20"><a href="cleaning.html#cb96-20" tabindex="-1"></a>  x <span class="ot">&lt;-</span> y<span class="sc">$</span>value</span>
<span id="cb96-21"><a href="cleaning.html#cb96-21" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.na</span>(rule)){y<span class="sc">$</span>value <span class="ot">&lt;-</span> <span class="fu">eval</span>(<span class="fu">parse</span>(<span class="at">text =</span> rule))}</span>
<span id="cb96-22"><a href="cleaning.html#cb96-22" tabindex="-1"></a>  <span class="fu">return</span>(y)</span>
<span id="cb96-23"><a href="cleaning.html#cb96-23" tabindex="-1"></a>}</span>
<span id="cb96-24"><a href="cleaning.html#cb96-24" tabindex="-1"></a></span>
<span id="cb96-25"><a href="cleaning.html#cb96-25" tabindex="-1"></a>mars_recode <span class="ot">&lt;-</span> mars_recode <span class="sc">%&gt;%</span> </span>
<span id="cb96-26"><a href="cleaning.html#cb96-26" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">map</span>(data, <span class="sc">~</span>(.) <span class="sc">%&gt;%</span> </span>
<span id="cb96-27"><a href="cleaning.html#cb96-27" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">wave =</span> <span class="fu">as.numeric</span>(wave)) <span class="sc">%&gt;%</span></span>
<span id="cb96-28"><a href="cleaning.html#cb96-28" tabindex="-1"></a>    <span class="fu">group_by</span>(recode, wave) <span class="sc">%&gt;%</span></span>
<span id="cb96-29"><a href="cleaning.html#cb96-29" tabindex="-1"></a>    <span class="fu">nest</span>() <span class="sc">%&gt;%</span></span>
<span id="cb96-30"><a href="cleaning.html#cb96-30" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb96-31"><a href="cleaning.html#cb96-31" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">pmap</span>(<span class="fu">list</span>(recode, data, wave), recode_fun)) <span class="sc">%&gt;%</span></span>
<span id="cb96-32"><a href="cleaning.html#cb96-32" tabindex="-1"></a>    <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb96-33"><a href="cleaning.html#cb96-33" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">ifelse</span>(value <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">|</span> <span class="fu">is.nan</span>(value) <span class="sc">|</span> <span class="fu">is.infinite</span>(value), <span class="cn">NA</span>, value))))</span>
<span id="cb96-34"><a href="cleaning.html#cb96-34" tabindex="-1"></a></span>
<span id="cb96-35"><a href="cleaning.html#cb96-35" tabindex="-1"></a><span class="co"># reverse code </span></span>
<span id="cb96-36"><a href="cleaning.html#cb96-36" tabindex="-1"></a>mars_recode <span class="ot">&lt;-</span> mars_recode <span class="sc">%&gt;%</span></span>
<span id="cb96-37"><a href="cleaning.html#cb96-37" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">map</span>(data, <span class="sc">~</span>(.) <span class="sc">%&gt;%</span></span>
<span id="cb96-38"><a href="cleaning.html#cb96-38" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">ifelse</span>(reverse_code <span class="sc">==</span> <span class="st">&quot;no&quot;</span> <span class="sc">|</span> <span class="fu">is.na</span>(reverse_code), value, </span>
<span id="cb96-39"><a href="cleaning.html#cb96-39" tabindex="-1"></a>                        <span class="fu">reverse.code</span>(<span class="sc">-</span><span class="dv">1</span>, value, <span class="at">mini =</span> mini, <span class="at">maxi =</span> maxi)))))</span>
<span id="cb96-40"><a href="cleaning.html#cb96-40" tabindex="-1"></a></span>
<span id="cb96-41"><a href="cleaning.html#cb96-41" tabindex="-1"></a>fun_call <span class="ot">&lt;-</span> <span class="cf">function</span>(x, rule){</span>
<span id="cb96-42"><a href="cleaning.html#cb96-42" tabindex="-1"></a>    <span class="cf">switch</span>(rule,</span>
<span id="cb96-43"><a href="cleaning.html#cb96-43" tabindex="-1"></a>           <span class="at">average =</span> <span class="fu">mean</span>(x, <span class="at">na.rm =</span> T),</span>
<span id="cb96-44"><a href="cleaning.html#cb96-44" tabindex="-1"></a>           <span class="at">mode =</span> <span class="fu">Mode</span>(x)[<span class="dv">1</span>],</span>
<span id="cb96-45"><a href="cleaning.html#cb96-45" tabindex="-1"></a>           <span class="at">sum =</span> <span class="fu">sum</span>(x, <span class="at">na.rm =</span> T),</span>
<span id="cb96-46"><a href="cleaning.html#cb96-46" tabindex="-1"></a>           <span class="at">skip =</span> <span class="fu">unique</span>(x)[<span class="dv">1</span>],</span>
<span id="cb96-47"><a href="cleaning.html#cb96-47" tabindex="-1"></a>           <span class="at">select =</span> <span class="fu">unique</span>(x)[<span class="dv">1</span>],</span>
<span id="cb96-48"><a href="cleaning.html#cb96-48" tabindex="-1"></a>           <span class="at">max =</span> <span class="fu">max</span>(x, <span class="at">na.rm =</span> T),</span>
<span id="cb96-49"><a href="cleaning.html#cb96-49" tabindex="-1"></a>           <span class="at">min =</span> <span class="fu">min</span>(x, <span class="at">na.rm =</span> T))</span>
<span id="cb96-50"><a href="cleaning.html#cb96-50" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="covariates-7" class="section level3 hasAnchor" number="2.8.2">
<h3><span class="header-section-number">2.8.2</span> Covariates<a href="cleaning.html#covariates-7" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="cleaning.html#cb97-1" tabindex="-1"></a><span class="co"># composite WITHIN years </span></span>
<span id="cb97-2"><a href="cleaning.html#cb97-2" tabindex="-1"></a>mars_cov <span class="ot">&lt;-</span> mars_recode <span class="sc">%&gt;%</span></span>
<span id="cb97-3"><a href="cleaning.html#cb97-3" tabindex="-1"></a>  <span class="fu">filter</span>(category <span class="sc">==</span> <span class="st">&quot;covariates&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb97-4"><a href="cleaning.html#cb97-4" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>category) <span class="sc">%&gt;%</span></span>
<span id="cb97-5"><a href="cleaning.html#cb97-5" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">map</span>(data, <span class="sc">~</span>(.) <span class="sc">%&gt;%</span> </span>
<span id="cb97-6"><a href="cleaning.html#cb97-6" tabindex="-1"></a>      <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(value)) <span class="sc">%&gt;%</span></span>
<span id="cb97-7"><a href="cleaning.html#cb97-7" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">comp_rule =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(comp_rule), <span class="st">&quot;skip&quot;</span>, comp_rule)) <span class="sc">%&gt;%</span></span>
<span id="cb97-8"><a href="cleaning.html#cb97-8" tabindex="-1"></a>      <span class="fu">group_by</span>(comp_rule, SID, wave, long_rule) <span class="sc">%&gt;%</span></span>
<span id="cb97-9"><a href="cleaning.html#cb97-9" tabindex="-1"></a>      <span class="fu">nest</span>() <span class="sc">%&gt;%</span></span>
<span id="cb97-10"><a href="cleaning.html#cb97-10" tabindex="-1"></a>      <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb97-11"><a href="cleaning.html#cb97-11" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">map2</span>(data, comp_rule, <span class="sc">~</span><span class="fu">fun_call</span>((.x)<span class="sc">$</span>value, .y))) <span class="sc">%&gt;%</span></span>
<span id="cb97-12"><a href="cleaning.html#cb97-12" tabindex="-1"></a>      <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb97-13"><a href="cleaning.html#cb97-13" tabindex="-1"></a>      <span class="fu">filter</span>(wave <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb97-14"><a href="cleaning.html#cb97-14" tabindex="-1"></a>      ))</span>
<span id="cb97-15"><a href="cleaning.html#cb97-15" tabindex="-1"></a></span>
<span id="cb97-16"><a href="cleaning.html#cb97-16" tabindex="-1"></a>comp_fun <span class="ot">&lt;-</span> <span class="cf">function</span>(d, rule){</span>
<span id="cb97-17"><a href="cleaning.html#cb97-17" tabindex="-1"></a>  d <span class="sc">%&gt;%</span></span>
<span id="cb97-18"><a href="cleaning.html#cb97-18" tabindex="-1"></a>    <span class="fu">group_by</span>(SID, name) <span class="sc">%&gt;%</span></span>
<span id="cb97-19"><a href="cleaning.html#cb97-19" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">value =</span> <span class="fu">fun_call</span>(data, rule)) <span class="sc">%&gt;%</span></span>
<span id="cb97-20"><a href="cleaning.html#cb97-20" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb97-21"><a href="cleaning.html#cb97-21" tabindex="-1"></a>    <span class="fu">distinct</span>()</span>
<span id="cb97-22"><a href="cleaning.html#cb97-22" tabindex="-1"></a>}</span>
<span id="cb97-23"><a href="cleaning.html#cb97-23" tabindex="-1"></a></span>
<span id="cb97-24"><a href="cleaning.html#cb97-24" tabindex="-1"></a><span class="co"># composite ACROSS years</span></span>
<span id="cb97-25"><a href="cleaning.html#cb97-25" tabindex="-1"></a>mars_cov <span class="ot">&lt;-</span> mars_cov <span class="sc">%&gt;%</span></span>
<span id="cb97-26"><a href="cleaning.html#cb97-26" tabindex="-1"></a>  <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb97-27"><a href="cleaning.html#cb97-27" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">long_rule =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(long_rule), <span class="st">&quot;skip&quot;</span>, long_rule)) <span class="sc">%&gt;%</span></span>
<span id="cb97-28"><a href="cleaning.html#cb97-28" tabindex="-1"></a>  <span class="fu">group_by</span>(long_rule) <span class="sc">%&gt;%</span></span>
<span id="cb97-29"><a href="cleaning.html#cb97-29" tabindex="-1"></a>  <span class="fu">nest</span>() <span class="sc">%&gt;%</span></span>
<span id="cb97-30"><a href="cleaning.html#cb97-30" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb97-31"><a href="cleaning.html#cb97-31" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">pmap</span>(<span class="fu">list</span>(data, long_rule), comp_fun)) <span class="sc">%&gt;%</span></span>
<span id="cb97-32"><a href="cleaning.html#cb97-32" tabindex="-1"></a>  <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb97-33"><a href="cleaning.html#cb97-33" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">ifelse</span>(<span class="fu">is.infinite</span>(value) <span class="sc">|</span> <span class="fu">is.nan</span>(value), <span class="cn">NA</span>, value)) <span class="sc">%&gt;%</span></span>
<span id="cb97-34"><a href="cleaning.html#cb97-34" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>long_rule) <span class="sc">%&gt;%</span></span>
<span id="cb97-35"><a href="cleaning.html#cb97-35" tabindex="-1"></a>  <span class="fu">spread</span>(name, value) <span class="sc">%&gt;%</span></span>
<span id="cb97-36"><a href="cleaning.html#cb97-36" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(SID))</span></code></pre></div>
</div>
<div id="personality-variables-7" class="section level3 hasAnchor" number="2.8.3">
<h3><span class="header-section-number">2.8.3</span> Personality Variables<a href="cleaning.html#personality-variables-7" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="cleaning.html#cb98-1" tabindex="-1"></a>mars_pers <span class="ot">&lt;-</span> mars_recode <span class="sc">%&gt;%</span></span>
<span id="cb98-2"><a href="cleaning.html#cb98-2" tabindex="-1"></a>  <span class="fu">filter</span>(category <span class="sc">==</span> <span class="st">&quot;pers&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb98-3"><a href="cleaning.html#cb98-3" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>category) <span class="sc">%&gt;%</span> </span>
<span id="cb98-4"><a href="cleaning.html#cb98-4" tabindex="-1"></a>  <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span> </span>
<span id="cb98-5"><a href="cleaning.html#cb98-5" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">%&gt;%</span></span>
<span id="cb98-6"><a href="cleaning.html#cb98-6" tabindex="-1"></a>  <span class="fu">group_by</span>(SID, name) <span class="sc">%&gt;%</span></span>
<span id="cb98-7"><a href="cleaning.html#cb98-7" tabindex="-1"></a>  <span class="fu">filter</span>(wave <span class="sc">==</span> <span class="fu">min</span>(wave)) <span class="sc">%&gt;%</span></span>
<span id="cb98-8"><a href="cleaning.html#cb98-8" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb98-9"><a href="cleaning.html#cb98-9" tabindex="-1"></a>  <span class="fu">select</span>(SID, name, wave, value)</span></code></pre></div>
</div>
<div id="outcome-variables-7" class="section level3 hasAnchor" number="2.8.4">
<h3><span class="header-section-number">2.8.4</span> Outcome Variables<a href="cleaning.html#outcome-variables-7" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="cleaning.html#cb99-1" tabindex="-1"></a>mars_cog_waves <span class="ot">&lt;-</span> mars_recode <span class="sc">%&gt;%</span></span>
<span id="cb99-2"><a href="cleaning.html#cb99-2" tabindex="-1"></a>  <span class="fu">filter</span>(category <span class="sc">==</span> <span class="st">&quot;outcome&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb99-3"><a href="cleaning.html#cb99-3" tabindex="-1"></a>  <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb99-4"><a href="cleaning.html#cb99-4" tabindex="-1"></a>  <span class="fu">group_by</span>(SID, name) <span class="sc">%&gt;%</span></span>
<span id="cb99-5"><a href="cleaning.html#cb99-5" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">o_year =</span> <span class="fu">max</span>(wave)) <span class="sc">%&gt;%</span></span>
<span id="cb99-6"><a href="cleaning.html#cb99-6" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb99-7"><a href="cleaning.html#cb99-7" tabindex="-1"></a></span>
<span id="cb99-8"><a href="cleaning.html#cb99-8" tabindex="-1"></a><span class="co"># composite within years</span></span>
<span id="cb99-9"><a href="cleaning.html#cb99-9" tabindex="-1"></a>mars_out <span class="ot">&lt;-</span> mars_recode <span class="sc">%&gt;%</span></span>
<span id="cb99-10"><a href="cleaning.html#cb99-10" tabindex="-1"></a>  <span class="fu">filter</span>(category <span class="sc">==</span> <span class="st">&quot;outcome&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb99-11"><a href="cleaning.html#cb99-11" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>category) <span class="sc">%&gt;%</span></span>
<span id="cb99-12"><a href="cleaning.html#cb99-12" tabindex="-1"></a>  <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb99-13"><a href="cleaning.html#cb99-13" tabindex="-1"></a>  <span class="fu">right_join</span>(mars_cog_waves) <span class="sc">%&gt;%</span></span>
<span id="cb99-14"><a href="cleaning.html#cb99-14" tabindex="-1"></a>  <span class="fu">filter</span>(wave <span class="sc">==</span> o_year <span class="sc">&amp;</span> wave <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb99-15"><a href="cleaning.html#cb99-15" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(value)) <span class="sc">%&gt;%</span></span>
<span id="cb99-16"><a href="cleaning.html#cb99-16" tabindex="-1"></a>  <span class="fu">group_by</span>(name, itemname, wave) <span class="sc">%&gt;%</span></span>
<span id="cb99-17"><a href="cleaning.html#cb99-17" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">pomp</span>(value)) <span class="sc">%&gt;%</span></span>
<span id="cb99-18"><a href="cleaning.html#cb99-18" tabindex="-1"></a>  <span class="fu">group_by</span>(name, wave, SID) <span class="sc">%&gt;%</span></span>
<span id="cb99-19"><a href="cleaning.html#cb99-19" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">value =</span> <span class="fu">mean</span>(value, <span class="at">na.rm =</span> T)) <span class="sc">%&gt;%</span></span>
<span id="cb99-20"><a href="cleaning.html#cb99-20" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code></pre></div>
</div>
<div id="combine-data-7" class="section level3 hasAnchor" number="2.8.5">
<h3><span class="header-section-number">2.8.5</span> Combine Data<a href="cleaning.html#combine-data-7" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb100-1"><a href="cleaning.html#cb100-1" tabindex="-1"></a>mars_combined <span class="ot">&lt;-</span> mars_pers <span class="sc">%&gt;%</span> </span>
<span id="cb100-2"><a href="cleaning.html#cb100-2" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Trait =</span> name, <span class="at">p_value =</span> value, <span class="at">p_year =</span> wave) <span class="sc">%&gt;%</span></span>
<span id="cb100-3"><a href="cleaning.html#cb100-3" tabindex="-1"></a>  <span class="fu">full_join</span>(</span>
<span id="cb100-4"><a href="cleaning.html#cb100-4" tabindex="-1"></a>    mars_out <span class="sc">%&gt;%</span> </span>
<span id="cb100-5"><a href="cleaning.html#cb100-5" tabindex="-1"></a>      <span class="fu">rename</span>(<span class="at">Outcome =</span> name, <span class="at">o_value =</span> value, <span class="at">o_year =</span> wave)</span>
<span id="cb100-6"><a href="cleaning.html#cb100-6" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> <span class="fu">full_join</span>(mars_cov) <span class="sc">%&gt;%</span></span>
<span id="cb100-7"><a href="cleaning.html#cb100-7" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(p_value) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(o_value))</span></code></pre></div>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb101-1"><a href="cleaning.html#cb101-1" tabindex="-1"></a><span class="fu">save</span>(mars_cov, mars_pers, mars_out, mars_combined,</span>
<span id="cb101-2"><a href="cleaning.html#cb101-2" tabindex="-1"></a>     <span class="at">file =</span> <span class="fu">sprintf</span>(<span class="st">&quot;%s/data/clean/mars_cleaned.RData&quot;</span>, local_path))</span></code></pre></div>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb102-1"><a href="cleaning.html#cb102-1" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span><span class="fu">ls</span>()[<span class="fu">grepl</span>(<span class="st">&quot;mars&quot;</span>, <span class="fu">ls</span>())])</span></code></pre></div>
</div>
</div>
<div id="ros" class="section level2 hasAnchor" number="2.9">
<h2><span class="header-section-number">2.9</span> ROS<a href="cleaning.html#ros" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The RUSH Religious Orders Study (ROS) is an ongoing longitudinal study that began in 1994 <span class="citation">(<a href="#ref-a2012overview"><strong>a2012overview?</strong></a>)</span>. These data are available, through application from <a href="https://www.radc.rush.edu/requests.htm" class="uri">https://www.radc.rush.edu/requests.htm</a>.</p>
<p>Older (65 and above) Catholic nuns, priests, and brothers with no prior dementia diagnosis and who agreed to annual evaluations and eventual organ donation were recruited from more than 40 groups across the United States. Additional participants are recuited each year. Additional information and documentation on the data can be found at <a href="https://www.radc.rush.edu/docs/var/variables.htm" class="uri">https://www.radc.rush.edu/docs/var/variables.htm</a>.</p>
<p>Sample sizes vary bt year from 353 participants (1994) to 1487 participants, including 797 deceased participants with autopsy data (2019, 2020). This provides 99% power to detect a zero-order correlation effect size of ~.11, two-tailed at alpha .05.</p>
<div id="load-data-7" class="section level3 hasAnchor" number="2.9.1">
<h3><span class="header-section-number">2.9.1</span> Load Data<a href="cleaning.html#load-data-7" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb103-1"><a href="cleaning.html#cb103-1" tabindex="-1"></a>(ros_codebook <span class="ot">&lt;-</span> (codebook <span class="sc">%&gt;%</span> <span class="fu">filter</span>(study <span class="sc">==</span> <span class="st">&quot;ROS&quot;</span>))<span class="sc">$</span>codebook[[<span class="dv">1</span>]] <span class="sc">%&gt;%</span></span>
<span id="cb103-2"><a href="cleaning.html#cb103-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">orig_itemname =</span> <span class="fu">str_to_lower</span>(orig_itemname)))</span></code></pre></div>
<pre><code>## # A tibble: 9 × 15
##   study dataset category   name      itemname year  orig_itemname description scale reverse_code recode mini  maxi  comp_rule
##   &lt;chr&gt; &lt;lgl&gt;   &lt;chr&gt;      &lt;chr&gt;     &lt;chr&gt;    &lt;chr&gt; &lt;chr&gt;         &lt;chr&gt;       &lt;chr&gt; &lt;chr&gt;        &lt;chr&gt;  &lt;lgl&gt; &lt;lgl&gt; &lt;chr&gt;    
## 1 ROS   NA      outcome    crystall… bosNami… long… cts_bname     Boston nam…  &lt;NA&gt; no           ifels… NA    NA    sum      
## 2 ROS   NA      covariates age       ageBase… base… age_bl        The age at…  &lt;NA&gt; no           ifels… NA    NA    skip     
## 3 ROS   NA      covariates education eduYears base… educ          The years …  &lt;NA&gt; no           ifels… NA    NA    skip     
## 4 ROS   NA      covariates gender    sex      base… msex          Self-repor… &quot;1 =… no           ifels… NA    NA    skip     
## 5 ROS   NA      pers       A         A        base… agreeableness The variab… &quot;Res… no           ifels… NA    NA    average  
## 6 ROS   NA      pers       C         C        base… conscientiou… The variab… &quot;Res… no           ifels… NA    NA    average  
## 7 ROS   NA      pers       E         E        base… extraversion… The variab… &quot;Res… no           ifels… NA    NA    average  
## 8 ROS   NA      pers       N         N        base… neuroticism_… The variab… &quot;Res… no           ifels… NA    NA    average  
## 9 ROS   NA      pers       O         O        base… openness      The variab… &quot;Res… no           ifels… NA    NA    average  
## # ℹ 1 more variable: long_rule &lt;chr&gt;</code></pre>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb105-1"><a href="cleaning.html#cb105-1" tabindex="-1"></a>ros <span class="ot">&lt;-</span> <span class="fu">sprintf</span>(<span class="st">&quot;%s/rush-radc/dataset_1034_long_03-25-2021.xlsx&quot;</span>, data_path) <span class="sc">%&gt;%</span> <span class="fu">read_excel</span>() <span class="sc">%&gt;%</span></span>
<span id="cb105-2"><a href="cleaning.html#cb105-2" tabindex="-1"></a>  <span class="fu">full_join</span>(<span class="fu">sprintf</span>(<span class="st">&quot;%s/rush-radc/dataset_1034_basic_03-25-2021.xlsx&quot;</span>, data_path) <span class="sc">%&gt;%</span> <span class="fu">read_excel</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb105-3"><a href="cleaning.html#cb105-3" tabindex="-1"></a>  <span class="fu">filter</span>(study <span class="sc">==</span> <span class="st">&quot;ROS&quot;</span>)</span></code></pre></div>
</div>
<div id="recoding-reverse-scoring-8" class="section level3 hasAnchor" number="2.9.2">
<h3><span class="header-section-number">2.9.2</span> Recoding &amp; Reverse Scoring<a href="cleaning.html#recoding-reverse-scoring-8" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb106-1"><a href="cleaning.html#cb106-1" tabindex="-1"></a>rename_fun <span class="ot">&lt;-</span> <span class="cf">function</span>(cb, var){</span>
<span id="cb106-2"><a href="cleaning.html#cb106-2" tabindex="-1"></a>  old.names <span class="ot">&lt;-</span> <span class="fu">unique</span>((ros_codebook <span class="sc">%&gt;%</span> <span class="fu">filter</span>(name <span class="sc">==</span> var))<span class="sc">$</span>orig_itemname)</span>
<span id="cb106-3"><a href="cleaning.html#cb106-3" tabindex="-1"></a>  df <span class="ot">&lt;-</span> ros <span class="sc">%&gt;%</span> </span>
<span id="cb106-4"><a href="cleaning.html#cb106-4" tabindex="-1"></a>    <span class="fu">select</span>(<span class="at">SID =</span> projid, <span class="at">wave =</span> fu_year, <span class="fu">one_of</span>(old.names)) <span class="sc">%&gt;%</span></span>
<span id="cb106-5"><a href="cleaning.html#cb106-5" tabindex="-1"></a>    <span class="fu">gather</span>(<span class="at">key =</span> orig_itemname, <span class="at">value =</span> value, <span class="sc">-</span>SID, <span class="sc">-</span>wave, <span class="at">na.rm =</span> T) <span class="sc">%&gt;%</span></span>
<span id="cb106-6"><a href="cleaning.html#cb106-6" tabindex="-1"></a>    <span class="fu">left_join</span>(cb <span class="sc">%&gt;%</span> <span class="fu">select</span>(itemname, orig_itemname, reverse_code<span class="sc">:</span>long_rule))</span>
<span id="cb106-7"><a href="cleaning.html#cb106-7" tabindex="-1"></a>}</span>
<span id="cb106-8"><a href="cleaning.html#cb106-8" tabindex="-1"></a></span>
<span id="cb106-9"><a href="cleaning.html#cb106-9" tabindex="-1"></a><span class="co"># join data with recoding info </span></span>
<span id="cb106-10"><a href="cleaning.html#cb106-10" tabindex="-1"></a>ros_recode <span class="ot">&lt;-</span> ros_codebook <span class="sc">%&gt;%</span></span>
<span id="cb106-11"><a href="cleaning.html#cb106-11" tabindex="-1"></a>  <span class="fu">select</span>(category, name, itemname, year, orig_itemname, reverse_code<span class="sc">:</span>long_rule) <span class="sc">%&gt;%</span></span>
<span id="cb106-12"><a href="cleaning.html#cb106-12" tabindex="-1"></a>  <span class="fu">filter</span>(category <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;pers&quot;</span>, <span class="st">&quot;outcome&quot;</span>, <span class="st">&quot;covariates&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb106-13"><a href="cleaning.html#cb106-13" tabindex="-1"></a>  <span class="fu">group_by</span>(category, name) <span class="sc">%&gt;%</span></span>
<span id="cb106-14"><a href="cleaning.html#cb106-14" tabindex="-1"></a>  <span class="fu">nest</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb106-15"><a href="cleaning.html#cb106-15" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb106-16"><a href="cleaning.html#cb106-16" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">map2</span>(data, name, rename_fun))</span>
<span id="cb106-17"><a href="cleaning.html#cb106-17" tabindex="-1"></a></span>
<span id="cb106-18"><a href="cleaning.html#cb106-18" tabindex="-1"></a><span class="co"># recode </span></span>
<span id="cb106-19"><a href="cleaning.html#cb106-19" tabindex="-1"></a>recode_fun <span class="ot">&lt;-</span> <span class="cf">function</span>(rule, y, year){</span>
<span id="cb106-20"><a href="cleaning.html#cb106-20" tabindex="-1"></a>  x <span class="ot">&lt;-</span> y<span class="sc">$</span>value</span>
<span id="cb106-21"><a href="cleaning.html#cb106-21" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.na</span>(rule)){y<span class="sc">$</span>value <span class="ot">&lt;-</span> <span class="fu">eval</span>(<span class="fu">parse</span>(<span class="at">text =</span> rule))}</span>
<span id="cb106-22"><a href="cleaning.html#cb106-22" tabindex="-1"></a>  <span class="fu">return</span>(y)</span>
<span id="cb106-23"><a href="cleaning.html#cb106-23" tabindex="-1"></a>}</span>
<span id="cb106-24"><a href="cleaning.html#cb106-24" tabindex="-1"></a></span>
<span id="cb106-25"><a href="cleaning.html#cb106-25" tabindex="-1"></a>ros_recode <span class="ot">&lt;-</span> ros_recode <span class="sc">%&gt;%</span> </span>
<span id="cb106-26"><a href="cleaning.html#cb106-26" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">map</span>(data, <span class="sc">~</span>(.) <span class="sc">%&gt;%</span> </span>
<span id="cb106-27"><a href="cleaning.html#cb106-27" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">wave =</span> <span class="fu">as.numeric</span>(wave)) <span class="sc">%&gt;%</span></span>
<span id="cb106-28"><a href="cleaning.html#cb106-28" tabindex="-1"></a>    <span class="fu">group_by</span>(recode, wave) <span class="sc">%&gt;%</span></span>
<span id="cb106-29"><a href="cleaning.html#cb106-29" tabindex="-1"></a>    <span class="fu">nest</span>() <span class="sc">%&gt;%</span></span>
<span id="cb106-30"><a href="cleaning.html#cb106-30" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb106-31"><a href="cleaning.html#cb106-31" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">pmap</span>(<span class="fu">list</span>(recode, data, wave), recode_fun)) <span class="sc">%&gt;%</span></span>
<span id="cb106-32"><a href="cleaning.html#cb106-32" tabindex="-1"></a>    <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb106-33"><a href="cleaning.html#cb106-33" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">ifelse</span>(value <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">|</span> <span class="fu">is.nan</span>(value) <span class="sc">|</span> <span class="fu">is.infinite</span>(value), <span class="cn">NA</span>, value))))</span>
<span id="cb106-34"><a href="cleaning.html#cb106-34" tabindex="-1"></a></span>
<span id="cb106-35"><a href="cleaning.html#cb106-35" tabindex="-1"></a><span class="co"># reverse code </span></span>
<span id="cb106-36"><a href="cleaning.html#cb106-36" tabindex="-1"></a>ros_recode <span class="ot">&lt;-</span> ros_recode <span class="sc">%&gt;%</span></span>
<span id="cb106-37"><a href="cleaning.html#cb106-37" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">map</span>(data, <span class="sc">~</span>(.) <span class="sc">%&gt;%</span></span>
<span id="cb106-38"><a href="cleaning.html#cb106-38" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">ifelse</span>(reverse_code <span class="sc">==</span> <span class="st">&quot;no&quot;</span> <span class="sc">|</span> <span class="fu">is.na</span>(reverse_code), value, </span>
<span id="cb106-39"><a href="cleaning.html#cb106-39" tabindex="-1"></a>                        <span class="fu">reverse.code</span>(<span class="sc">-</span><span class="dv">1</span>, value, <span class="at">mini =</span> mini, <span class="at">maxi =</span> maxi)))))</span>
<span id="cb106-40"><a href="cleaning.html#cb106-40" tabindex="-1"></a></span>
<span id="cb106-41"><a href="cleaning.html#cb106-41" tabindex="-1"></a>fun_call <span class="ot">&lt;-</span> <span class="cf">function</span>(x, rule){</span>
<span id="cb106-42"><a href="cleaning.html#cb106-42" tabindex="-1"></a>    <span class="cf">switch</span>(rule,</span>
<span id="cb106-43"><a href="cleaning.html#cb106-43" tabindex="-1"></a>           <span class="at">average =</span> <span class="fu">mean</span>(x, <span class="at">na.rm =</span> T),</span>
<span id="cb106-44"><a href="cleaning.html#cb106-44" tabindex="-1"></a>           <span class="at">mode =</span> <span class="fu">Mode</span>(x)[<span class="dv">1</span>],</span>
<span id="cb106-45"><a href="cleaning.html#cb106-45" tabindex="-1"></a>           <span class="at">sum =</span> <span class="fu">sum</span>(x, <span class="at">na.rm =</span> T),</span>
<span id="cb106-46"><a href="cleaning.html#cb106-46" tabindex="-1"></a>           <span class="at">skip =</span> <span class="fu">unique</span>(x)[<span class="dv">1</span>],</span>
<span id="cb106-47"><a href="cleaning.html#cb106-47" tabindex="-1"></a>           <span class="at">select =</span> <span class="fu">unique</span>(x)[<span class="dv">1</span>],</span>
<span id="cb106-48"><a href="cleaning.html#cb106-48" tabindex="-1"></a>           <span class="at">max =</span> <span class="fu">max</span>(x, <span class="at">na.rm =</span> T),</span>
<span id="cb106-49"><a href="cleaning.html#cb106-49" tabindex="-1"></a>           <span class="at">min =</span> <span class="fu">min</span>(x, <span class="at">na.rm =</span> T))</span>
<span id="cb106-50"><a href="cleaning.html#cb106-50" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="covariates-8" class="section level3 hasAnchor" number="2.9.3">
<h3><span class="header-section-number">2.9.3</span> Covariates<a href="cleaning.html#covariates-8" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb107-1"><a href="cleaning.html#cb107-1" tabindex="-1"></a><span class="co"># composite WITHIN years </span></span>
<span id="cb107-2"><a href="cleaning.html#cb107-2" tabindex="-1"></a>ros_cov <span class="ot">&lt;-</span> ros_recode <span class="sc">%&gt;%</span></span>
<span id="cb107-3"><a href="cleaning.html#cb107-3" tabindex="-1"></a>  <span class="fu">filter</span>(category <span class="sc">==</span> <span class="st">&quot;covariates&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb107-4"><a href="cleaning.html#cb107-4" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>category) <span class="sc">%&gt;%</span></span>
<span id="cb107-5"><a href="cleaning.html#cb107-5" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">map</span>(data, <span class="sc">~</span>(.) <span class="sc">%&gt;%</span> </span>
<span id="cb107-6"><a href="cleaning.html#cb107-6" tabindex="-1"></a>      <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(value)) <span class="sc">%&gt;%</span></span>
<span id="cb107-7"><a href="cleaning.html#cb107-7" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">comp_rule =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(comp_rule), <span class="st">&quot;skip&quot;</span>, comp_rule)) <span class="sc">%&gt;%</span></span>
<span id="cb107-8"><a href="cleaning.html#cb107-8" tabindex="-1"></a>      <span class="fu">group_by</span>(comp_rule, SID, wave, long_rule) <span class="sc">%&gt;%</span></span>
<span id="cb107-9"><a href="cleaning.html#cb107-9" tabindex="-1"></a>      <span class="fu">nest</span>() <span class="sc">%&gt;%</span></span>
<span id="cb107-10"><a href="cleaning.html#cb107-10" tabindex="-1"></a>      <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb107-11"><a href="cleaning.html#cb107-11" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">map2</span>(data, comp_rule, <span class="sc">~</span><span class="fu">fun_call</span>((.x)<span class="sc">$</span>value, .y))) <span class="sc">%&gt;%</span></span>
<span id="cb107-12"><a href="cleaning.html#cb107-12" tabindex="-1"></a>      <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb107-13"><a href="cleaning.html#cb107-13" tabindex="-1"></a>      <span class="fu">filter</span>(wave <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb107-14"><a href="cleaning.html#cb107-14" tabindex="-1"></a>      ))</span>
<span id="cb107-15"><a href="cleaning.html#cb107-15" tabindex="-1"></a></span>
<span id="cb107-16"><a href="cleaning.html#cb107-16" tabindex="-1"></a>comp_fun <span class="ot">&lt;-</span> <span class="cf">function</span>(d, rule){</span>
<span id="cb107-17"><a href="cleaning.html#cb107-17" tabindex="-1"></a>  d <span class="sc">%&gt;%</span></span>
<span id="cb107-18"><a href="cleaning.html#cb107-18" tabindex="-1"></a>    <span class="fu">group_by</span>(SID, name) <span class="sc">%&gt;%</span></span>
<span id="cb107-19"><a href="cleaning.html#cb107-19" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">value =</span> <span class="fu">fun_call</span>(data, rule)) <span class="sc">%&gt;%</span></span>
<span id="cb107-20"><a href="cleaning.html#cb107-20" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb107-21"><a href="cleaning.html#cb107-21" tabindex="-1"></a>    <span class="fu">distinct</span>()</span>
<span id="cb107-22"><a href="cleaning.html#cb107-22" tabindex="-1"></a>}</span>
<span id="cb107-23"><a href="cleaning.html#cb107-23" tabindex="-1"></a></span>
<span id="cb107-24"><a href="cleaning.html#cb107-24" tabindex="-1"></a><span class="co"># composite ACROSS years</span></span>
<span id="cb107-25"><a href="cleaning.html#cb107-25" tabindex="-1"></a>ros_cov <span class="ot">&lt;-</span> ros_cov <span class="sc">%&gt;%</span></span>
<span id="cb107-26"><a href="cleaning.html#cb107-26" tabindex="-1"></a>  <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb107-27"><a href="cleaning.html#cb107-27" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">long_rule =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(long_rule), <span class="st">&quot;skip&quot;</span>, long_rule)) <span class="sc">%&gt;%</span></span>
<span id="cb107-28"><a href="cleaning.html#cb107-28" tabindex="-1"></a>  <span class="fu">group_by</span>(long_rule) <span class="sc">%&gt;%</span></span>
<span id="cb107-29"><a href="cleaning.html#cb107-29" tabindex="-1"></a>  <span class="fu">nest</span>() <span class="sc">%&gt;%</span></span>
<span id="cb107-30"><a href="cleaning.html#cb107-30" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb107-31"><a href="cleaning.html#cb107-31" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">pmap</span>(<span class="fu">list</span>(data, long_rule), comp_fun)) <span class="sc">%&gt;%</span></span>
<span id="cb107-32"><a href="cleaning.html#cb107-32" tabindex="-1"></a>  <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb107-33"><a href="cleaning.html#cb107-33" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">ifelse</span>(<span class="fu">is.infinite</span>(value) <span class="sc">|</span> <span class="fu">is.nan</span>(value), <span class="cn">NA</span>, value)) <span class="sc">%&gt;%</span></span>
<span id="cb107-34"><a href="cleaning.html#cb107-34" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>long_rule) <span class="sc">%&gt;%</span></span>
<span id="cb107-35"><a href="cleaning.html#cb107-35" tabindex="-1"></a>  <span class="fu">spread</span>(name, value) <span class="sc">%&gt;%</span></span>
<span id="cb107-36"><a href="cleaning.html#cb107-36" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(SID))</span></code></pre></div>
</div>
<div id="personality-variables-8" class="section level3 hasAnchor" number="2.9.4">
<h3><span class="header-section-number">2.9.4</span> Personality Variables<a href="cleaning.html#personality-variables-8" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb108"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb108-1"><a href="cleaning.html#cb108-1" tabindex="-1"></a>ros_pers <span class="ot">&lt;-</span> ros_recode <span class="sc">%&gt;%</span></span>
<span id="cb108-2"><a href="cleaning.html#cb108-2" tabindex="-1"></a>  <span class="fu">filter</span>(category <span class="sc">==</span> <span class="st">&quot;pers&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb108-3"><a href="cleaning.html#cb108-3" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>category) <span class="sc">%&gt;%</span> </span>
<span id="cb108-4"><a href="cleaning.html#cb108-4" tabindex="-1"></a>  <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span> </span>
<span id="cb108-5"><a href="cleaning.html#cb108-5" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">%&gt;%</span></span>
<span id="cb108-6"><a href="cleaning.html#cb108-6" tabindex="-1"></a>  <span class="fu">group_by</span>(SID, name) <span class="sc">%&gt;%</span></span>
<span id="cb108-7"><a href="cleaning.html#cb108-7" tabindex="-1"></a>  <span class="fu">filter</span>(wave <span class="sc">==</span> <span class="fu">min</span>(wave)) <span class="sc">%&gt;%</span></span>
<span id="cb108-8"><a href="cleaning.html#cb108-8" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb108-9"><a href="cleaning.html#cb108-9" tabindex="-1"></a>  <span class="fu">select</span>(SID, name, wave, value)</span></code></pre></div>
</div>
<div id="outcome-variables-8" class="section level3 hasAnchor" number="2.9.5">
<h3><span class="header-section-number">2.9.5</span> Outcome Variables<a href="cleaning.html#outcome-variables-8" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb109-1"><a href="cleaning.html#cb109-1" tabindex="-1"></a>ros_cog_waves <span class="ot">&lt;-</span> ros_recode <span class="sc">%&gt;%</span></span>
<span id="cb109-2"><a href="cleaning.html#cb109-2" tabindex="-1"></a>  <span class="fu">filter</span>(category <span class="sc">==</span> <span class="st">&quot;outcome&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb109-3"><a href="cleaning.html#cb109-3" tabindex="-1"></a>  <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb109-4"><a href="cleaning.html#cb109-4" tabindex="-1"></a>  <span class="fu">group_by</span>(SID, name) <span class="sc">%&gt;%</span></span>
<span id="cb109-5"><a href="cleaning.html#cb109-5" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">o_year =</span> <span class="fu">max</span>(wave)) <span class="sc">%&gt;%</span></span>
<span id="cb109-6"><a href="cleaning.html#cb109-6" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb109-7"><a href="cleaning.html#cb109-7" tabindex="-1"></a></span>
<span id="cb109-8"><a href="cleaning.html#cb109-8" tabindex="-1"></a><span class="co"># composite within years</span></span>
<span id="cb109-9"><a href="cleaning.html#cb109-9" tabindex="-1"></a>ros_out <span class="ot">&lt;-</span> ros_recode <span class="sc">%&gt;%</span></span>
<span id="cb109-10"><a href="cleaning.html#cb109-10" tabindex="-1"></a>  <span class="fu">filter</span>(category <span class="sc">==</span> <span class="st">&quot;outcome&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb109-11"><a href="cleaning.html#cb109-11" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>category) <span class="sc">%&gt;%</span></span>
<span id="cb109-12"><a href="cleaning.html#cb109-12" tabindex="-1"></a>  <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb109-13"><a href="cleaning.html#cb109-13" tabindex="-1"></a>  <span class="fu">right_join</span>(ros_cog_waves) <span class="sc">%&gt;%</span></span>
<span id="cb109-14"><a href="cleaning.html#cb109-14" tabindex="-1"></a>  <span class="fu">filter</span>(wave <span class="sc">==</span> o_year <span class="sc">&amp;</span> wave <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb109-15"><a href="cleaning.html#cb109-15" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(value)) <span class="sc">%&gt;%</span></span>
<span id="cb109-16"><a href="cleaning.html#cb109-16" tabindex="-1"></a>  <span class="fu">group_by</span>(name, itemname, wave) <span class="sc">%&gt;%</span></span>
<span id="cb109-17"><a href="cleaning.html#cb109-17" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">pomp</span>(value)) <span class="sc">%&gt;%</span></span>
<span id="cb109-18"><a href="cleaning.html#cb109-18" tabindex="-1"></a>  <span class="fu">group_by</span>(name, wave, SID) <span class="sc">%&gt;%</span></span>
<span id="cb109-19"><a href="cleaning.html#cb109-19" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">value =</span> <span class="fu">mean</span>(value, <span class="at">na.rm =</span> T)) <span class="sc">%&gt;%</span></span>
<span id="cb109-20"><a href="cleaning.html#cb109-20" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code></pre></div>
</div>
<div id="combine-data-8" class="section level3 hasAnchor" number="2.9.6">
<h3><span class="header-section-number">2.9.6</span> Combine Data<a href="cleaning.html#combine-data-8" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb110-1"><a href="cleaning.html#cb110-1" tabindex="-1"></a>ros_combined <span class="ot">&lt;-</span> ros_pers <span class="sc">%&gt;%</span> </span>
<span id="cb110-2"><a href="cleaning.html#cb110-2" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Trait =</span> name, <span class="at">p_value =</span> value, <span class="at">p_year =</span> wave) <span class="sc">%&gt;%</span></span>
<span id="cb110-3"><a href="cleaning.html#cb110-3" tabindex="-1"></a>  <span class="fu">full_join</span>(</span>
<span id="cb110-4"><a href="cleaning.html#cb110-4" tabindex="-1"></a>    ros_out <span class="sc">%&gt;%</span> </span>
<span id="cb110-5"><a href="cleaning.html#cb110-5" tabindex="-1"></a>      <span class="fu">rename</span>(<span class="at">Outcome =</span> name, <span class="at">o_value =</span> value, <span class="at">o_year =</span> wave)</span>
<span id="cb110-6"><a href="cleaning.html#cb110-6" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> <span class="fu">full_join</span>(ros_cov) <span class="sc">%&gt;%</span></span>
<span id="cb110-7"><a href="cleaning.html#cb110-7" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(p_value) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(o_value))</span></code></pre></div>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb111-1"><a href="cleaning.html#cb111-1" tabindex="-1"></a><span class="fu">save</span>(ros_cov, ros_pers, ros_out, ros_combined,</span>
<span id="cb111-2"><a href="cleaning.html#cb111-2" tabindex="-1"></a>     <span class="at">file =</span> <span class="fu">sprintf</span>(<span class="st">&quot;%s/data/clean/ros_cleaned.RData&quot;</span>, local_path))</span></code></pre></div>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb112-1"><a href="cleaning.html#cb112-1" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span><span class="fu">ls</span>()[<span class="fu">grepl</span>(<span class="st">&quot;ros&quot;</span>, <span class="fu">ls</span>())])</span></code></pre></div>
</div>
</div>
<div id="origins-of-the-variances-of-the-oldest-old-octogenarian-twins-octo-twin" class="section level2 hasAnchor" number="2.10">
<h2><span class="header-section-number">2.10</span> Origins of the Variances of the Oldest-Old: Octogenarian Twins (OCTO-TWIN)<a href="cleaning.html#origins-of-the-variances-of-the-oldest-old-octogenarian-twins-octo-twin" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The Origins of the Variances of the Oldest-Old: Octogenarian Twins (OCTO-TWIN) study was a longitudinal study of twin-pairs in Sweden born before 1913 that began in 1991. Data are available, by application, from the study leaders at the Karolinska Institute.</p>
<p>Twin-pairs from the Swedish Twin registry who were born before 1913 were invited to be part of the study in 1991. Additional follow-ups were collected in 1993, 1995, 1997, and 1999 on all surviving twins. The initial sample included 351 twin pairs (149 monozygotic and 202 same-sex dizygotic pairs). More information on the study can be found at <a href="https://webcache.googleusercontent.com/search?q=cache:HcheF2l9zc0J:https://psy.gu.se/digitalAssets/1469/1469717_octo-twin-brief-presentation.pdf+&amp;cd=1&amp;hl=en&amp;ct=clnk&amp;gl=us&amp;client=safari" class="uri">https://webcache.googleusercontent.com/search?q=cache:HcheF2l9zc0J:https://psy.gu.se/digitalAssets/1469/1469717_octo-twin-brief-presentation.pdf+&amp;cd=1&amp;hl=en&amp;ct=clnk&amp;gl=us&amp;client=safari</a>.</p>
<p>Sample sizes vary by year, from 222 (wave 5; 43 pairs) to 702 (wave 1; 351 pairs), which yields 99% power to detect a correlation effect size of ~.19, two-tailed at alpha .05.</p>
<div id="load-data-8" class="section level3 hasAnchor" number="2.10.1">
<h3><span class="header-section-number">2.10.1</span> Load Data<a href="cleaning.html#load-data-8" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb113-1"><a href="cleaning.html#cb113-1" tabindex="-1"></a>(octotwin_codebook <span class="ot">&lt;-</span> (codebook <span class="sc">%&gt;%</span> <span class="fu">filter</span>(study <span class="sc">==</span> <span class="st">&quot;OCTO-TWIN&quot;</span>))<span class="sc">$</span>codebook[[<span class="dv">1</span>]] <span class="sc">%&gt;%</span></span>
<span id="cb113-2"><a href="cleaning.html#cb113-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">orig_itemname =</span> <span class="fu">str_to_lower</span>(orig_itemname)))</span></code></pre></div>
<pre><code>## # A tibble: 99 × 16
##    study     dataset    category   name  itemname  wave  year orig_itemname description scale reverse_code recode  mini  maxi
##    &lt;chr&gt;     &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt; &lt;chr&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;         &lt;chr&gt;       &lt;chr&gt; &lt;chr&gt;        &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt;
##  1 octo-twin OCTO_Wave1 covariates educ… eduYears     1  1991 v130          years scho… &quot;int… &lt;NA&gt;         ifels…    NA    NA
##  2 octo-twin OCTO_Wave1 covariates gend… sex          1  1991 sex           Respondent…  &lt;NA&gt; &lt;NA&gt;         ifels…    NA    NA
##  3 octo-twin OCTO_Wave1 covariates gend… sex2         1  1991 medrec_sex    Sex          &lt;NA&gt; &lt;NA&gt;         ifels…    NA    NA
##  4 octo-twin OCTO_Wave2 covariates gend… sex2         2  1993 medrec_sex    Sex          &lt;NA&gt; &lt;NA&gt;         ifels…    NA    NA
##  5 octo-twin OCTO_Wave3 covariates gend… sex2         3  1995 medrec_sex    Sex          &lt;NA&gt; &lt;NA&gt;         ifels…    NA    NA
##  6 octo-twin OCTO_Wave4 covariates gend… sex2         4  1997 medrec_sex    Sex          &lt;NA&gt; &lt;NA&gt;         ifels…    NA    NA
##  7 octo-twin OCTO_Wave5 covariates gend… sex2         5  2000 medrec_sex    Sex          &lt;NA&gt; &lt;NA&gt;         ifels…    NA    NA
##  8 octo-twin OCTO_Wave1 covariates SRhe… overall…     1  1991 v201          overall he… &quot;Nam… yes          ifels…     1     3
##  9 octo-twin OCTO_Wave2 covariates SRhe… overall…     2  1993 b201          overall he… &quot;Nam… yes          ifels…     1     3
## 10 octo-twin OCTO_Wave3 covariates SRhe… overall…     3  1995 c201          overall he… &quot;Nam… yes          ifels…     1     3
## # ℹ 89 more rows
## # ℹ 2 more variables: comp_rule &lt;chr&gt;, long_rule &lt;chr&gt;</code></pre>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb115-1"><a href="cleaning.html#cb115-1" tabindex="-1"></a>octotwin <span class="ot">&lt;-</span> <span class="fu">sprintf</span>(<span class="st">&quot;%s/octo-twin/OCTO_Twin_Emorie.sav&quot;</span>, data_path) <span class="sc">%&gt;%</span> </span>
<span id="cb115-2"><a href="cleaning.html#cb115-2" tabindex="-1"></a>  <span class="fu">read_sav</span>() <span class="sc">%&gt;%</span></span>
<span id="cb115-3"><a href="cleaning.html#cb115-3" tabindex="-1"></a>  haven<span class="sc">::</span><span class="fu">zap_labels</span>(.)</span></code></pre></div>
</div>
<div id="recoding-reverse-scoring-9" class="section level3 hasAnchor" number="2.10.2">
<h3><span class="header-section-number">2.10.2</span> Recoding &amp; Reverse Scoring<a href="cleaning.html#recoding-reverse-scoring-9" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb116"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb116-1"><a href="cleaning.html#cb116-1" tabindex="-1"></a>rename_fun <span class="ot">&lt;-</span> <span class="cf">function</span>(cb, var){</span>
<span id="cb116-2"><a href="cleaning.html#cb116-2" tabindex="-1"></a>  old.names <span class="ot">&lt;-</span> <span class="fu">unique</span>((octotwin_codebook <span class="sc">%&gt;%</span> <span class="fu">filter</span>(name <span class="sc">==</span> var))<span class="sc">$</span>orig_itemname)</span>
<span id="cb116-3"><a href="cleaning.html#cb116-3" tabindex="-1"></a>  df <span class="ot">&lt;-</span> octotwin <span class="sc">%&gt;%</span> </span>
<span id="cb116-4"><a href="cleaning.html#cb116-4" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">SID =</span> <span class="fu">paste0</span>(v1, v2)) <span class="sc">%&gt;%</span></span>
<span id="cb116-5"><a href="cleaning.html#cb116-5" tabindex="-1"></a>    <span class="fu">select</span>(SID, <span class="fu">one_of</span>(old.names)) <span class="sc">%&gt;%</span></span>
<span id="cb116-6"><a href="cleaning.html#cb116-6" tabindex="-1"></a>    <span class="fu">gather</span>(<span class="at">key =</span> orig_itemname, <span class="at">value =</span> value, <span class="sc">-</span>SID, <span class="at">na.rm=</span>T)</span>
<span id="cb116-7"><a href="cleaning.html#cb116-7" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">length</span>(old.names) <span class="sc">&gt;</span> <span class="dv">1</span>){</span>
<span id="cb116-8"><a href="cleaning.html#cb116-8" tabindex="-1"></a>      df <span class="sc">%&gt;%</span> <span class="fu">left_join</span>(cb <span class="sc">%&gt;%</span> <span class="fu">select</span>(itemname, wave, orig_itemname, reverse_code<span class="sc">:</span>long_rule))</span>
<span id="cb116-9"><a href="cleaning.html#cb116-9" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb116-10"><a href="cleaning.html#cb116-10" tabindex="-1"></a>    df <span class="sc">%&gt;%</span> <span class="fu">left_join</span>(cb <span class="sc">%&gt;%</span> <span class="fu">select</span>(itemname, orig_itemname, reverse_code<span class="sc">:</span>long_rule) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>()) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">wave =</span> <span class="st">&quot;0&quot;</span>)</span>
<span id="cb116-11"><a href="cleaning.html#cb116-11" tabindex="-1"></a>  }</span>
<span id="cb116-12"><a href="cleaning.html#cb116-12" tabindex="-1"></a>}</span>
<span id="cb116-13"><a href="cleaning.html#cb116-13" tabindex="-1"></a></span>
<span id="cb116-14"><a href="cleaning.html#cb116-14" tabindex="-1"></a><span class="st">`</span></span>
<span id="cb116-15"><a href="cleaning.html#cb116-15" tabindex="-1"></a><span class="at"># join data with recoding info </span></span>
<span id="cb116-16"><a href="cleaning.html#cb116-16" tabindex="-1"></a><span class="at">octotwin_recode &lt;- octotwin_codebook %&gt;%</span></span>
<span id="cb116-17"><a href="cleaning.html#cb116-17" tabindex="-1"></a><span class="at">  select(category, name, itemname, wave, orig_itemname, reverse_code:long_rule) %&gt;%</span></span>
<span id="cb116-18"><a href="cleaning.html#cb116-18" tabindex="-1"></a><span class="at">  filter(category %in% c(&quot;pers&quot;, &quot;outcome&quot;, &quot;covariates&quot;)) %&gt;%</span></span>
<span id="cb116-19"><a href="cleaning.html#cb116-19" tabindex="-1"></a><span class="at">  group_by(category, name) %&gt;%</span></span>
<span id="cb116-20"><a href="cleaning.html#cb116-20" tabindex="-1"></a><span class="at">  nest() %&gt;% </span></span>
<span id="cb116-21"><a href="cleaning.html#cb116-21" tabindex="-1"></a><span class="at">  ungroup() %&gt;%</span></span>
<span id="cb116-22"><a href="cleaning.html#cb116-22" tabindex="-1"></a><span class="at">  mutate(data = map2(data, name, possibly(rename_fun, NA_real_)))</span></span>
<span id="cb116-23"><a href="cleaning.html#cb116-23" tabindex="-1"></a></span>
<span id="cb116-24"><a href="cleaning.html#cb116-24" tabindex="-1"></a><span class="at"># recode </span></span>
<span id="cb116-25"><a href="cleaning.html#cb116-25" tabindex="-1"></a><span class="at">recode_fun &lt;- function(rule, y, year){</span></span>
<span id="cb116-26"><a href="cleaning.html#cb116-26" tabindex="-1"></a><span class="at">  x &lt;- y$value</span></span>
<span id="cb116-27"><a href="cleaning.html#cb116-27" tabindex="-1"></a><span class="at">  if(!is.na(rule)){y$value &lt;- eval(parse(text = rule))}</span></span>
<span id="cb116-28"><a href="cleaning.html#cb116-28" tabindex="-1"></a><span class="at">  return(y)</span></span>
<span id="cb116-29"><a href="cleaning.html#cb116-29" tabindex="-1"></a><span class="at">}</span></span>
<span id="cb116-30"><a href="cleaning.html#cb116-30" tabindex="-1"></a></span>
<span id="cb116-31"><a href="cleaning.html#cb116-31" tabindex="-1"></a><span class="at">octotwin_recode &lt;- octotwin_recode %&gt;% </span></span>
<span id="cb116-32"><a href="cleaning.html#cb116-32" tabindex="-1"></a><span class="at">  mutate(data = map(data, ~(.) %&gt;% </span></span>
<span id="cb116-33"><a href="cleaning.html#cb116-33" tabindex="-1"></a><span class="at">    mutate(wave = as.numeric(wave)) %&gt;%</span></span>
<span id="cb116-34"><a href="cleaning.html#cb116-34" tabindex="-1"></a><span class="at">    group_by(recode, wave) %&gt;%</span></span>
<span id="cb116-35"><a href="cleaning.html#cb116-35" tabindex="-1"></a><span class="at">    nest() %&gt;%</span></span>
<span id="cb116-36"><a href="cleaning.html#cb116-36" tabindex="-1"></a><span class="at">    ungroup() %&gt;%</span></span>
<span id="cb116-37"><a href="cleaning.html#cb116-37" tabindex="-1"></a><span class="at">    mutate(data = pmap(list(recode, data, wave), recode_fun)) %&gt;%</span></span>
<span id="cb116-38"><a href="cleaning.html#cb116-38" tabindex="-1"></a><span class="at">    unnest(data) %&gt;%</span></span>
<span id="cb116-39"><a href="cleaning.html#cb116-39" tabindex="-1"></a><span class="at">    mutate(value = ifelse(value &lt; 0 | is.nan(value) | is.infinite(value), NA, value))))</span></span>
<span id="cb116-40"><a href="cleaning.html#cb116-40" tabindex="-1"></a></span>
<span id="cb116-41"><a href="cleaning.html#cb116-41" tabindex="-1"></a></span>
<span id="cb116-42"><a href="cleaning.html#cb116-42" tabindex="-1"></a><span class="at"># reverse code </span></span>
<span id="cb116-43"><a href="cleaning.html#cb116-43" tabindex="-1"></a><span class="at">octotwin_recode &lt;- octotwin_recode %&gt;%</span></span>
<span id="cb116-44"><a href="cleaning.html#cb116-44" tabindex="-1"></a><span class="at">  mutate(data = map(data, ~(.) %&gt;%</span></span>
<span id="cb116-45"><a href="cleaning.html#cb116-45" tabindex="-1"></a><span class="at">    mutate(value = ifelse(reverse_code == &quot;no&quot; | is.na(reverse_code), value, </span></span>
<span id="cb116-46"><a href="cleaning.html#cb116-46" tabindex="-1"></a><span class="at">                        reverse.code(-1, value, mini = mini, maxi = maxi)))))</span></span>
<span id="cb116-47"><a href="cleaning.html#cb116-47" tabindex="-1"></a></span>
<span id="cb116-48"><a href="cleaning.html#cb116-48" tabindex="-1"></a><span class="at">fun_call &lt;- function(x, rule){</span></span>
<span id="cb116-49"><a href="cleaning.html#cb116-49" tabindex="-1"></a><span class="at">    switch(rule,</span></span>
<span id="cb116-50"><a href="cleaning.html#cb116-50" tabindex="-1"></a><span class="at">           average = mean(x, na.rm = T),</span></span>
<span id="cb116-51"><a href="cleaning.html#cb116-51" tabindex="-1"></a><span class="at">           mode = Mode(x)[1],</span></span>
<span id="cb116-52"><a href="cleaning.html#cb116-52" tabindex="-1"></a><span class="at">           sum = sum(x, na.rm = T),</span></span>
<span id="cb116-53"><a href="cleaning.html#cb116-53" tabindex="-1"></a><span class="at">           skip = unique(x)[1],</span></span>
<span id="cb116-54"><a href="cleaning.html#cb116-54" tabindex="-1"></a><span class="at">           select = unique(x)[1],</span></span>
<span id="cb116-55"><a href="cleaning.html#cb116-55" tabindex="-1"></a><span class="at">           max = max(x, na.rm = T),</span></span>
<span id="cb116-56"><a href="cleaning.html#cb116-56" tabindex="-1"></a><span class="at">           min = min(x, na.rm = T))</span></span>
<span id="cb116-57"><a href="cleaning.html#cb116-57" tabindex="-1"></a><span class="at">}</span></span></code></pre></div>
</div>
<div id="covariates-9" class="section level3 hasAnchor" number="2.10.3">
<h3><span class="header-section-number">2.10.3</span> Covariates<a href="cleaning.html#covariates-9" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb117-1"><a href="cleaning.html#cb117-1" tabindex="-1"></a><span class="co"># composite WITHIN years </span></span>
<span id="cb117-2"><a href="cleaning.html#cb117-2" tabindex="-1"></a>octotwin_cov <span class="ot">&lt;-</span> octotwin_recode <span class="sc">%&gt;%</span></span>
<span id="cb117-3"><a href="cleaning.html#cb117-3" tabindex="-1"></a>  <span class="fu">filter</span>(category <span class="sc">==</span> <span class="st">&quot;covariates&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb117-4"><a href="cleaning.html#cb117-4" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>category) <span class="sc">%&gt;%</span></span>
<span id="cb117-5"><a href="cleaning.html#cb117-5" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">map</span>(data, <span class="sc">~</span>(.) <span class="sc">%&gt;%</span> </span>
<span id="cb117-6"><a href="cleaning.html#cb117-6" tabindex="-1"></a>      <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(value)) <span class="sc">%&gt;%</span></span>
<span id="cb117-7"><a href="cleaning.html#cb117-7" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">comp_rule =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(comp_rule), <span class="st">&quot;skip&quot;</span>, comp_rule)) <span class="sc">%&gt;%</span></span>
<span id="cb117-8"><a href="cleaning.html#cb117-8" tabindex="-1"></a>      <span class="fu">group_by</span>(comp_rule, SID, wave, long_rule) <span class="sc">%&gt;%</span></span>
<span id="cb117-9"><a href="cleaning.html#cb117-9" tabindex="-1"></a>      <span class="fu">nest</span>() <span class="sc">%&gt;%</span></span>
<span id="cb117-10"><a href="cleaning.html#cb117-10" tabindex="-1"></a>      <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb117-11"><a href="cleaning.html#cb117-11" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">map2</span>(data, comp_rule, <span class="sc">~</span><span class="fu">fun_call</span>((.x)<span class="sc">$</span>value, .y))) <span class="sc">%&gt;%</span></span>
<span id="cb117-12"><a href="cleaning.html#cb117-12" tabindex="-1"></a>      <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb117-13"><a href="cleaning.html#cb117-13" tabindex="-1"></a>      <span class="fu">filter</span>(wave <span class="sc">&lt;=</span> <span class="dv">1</span>)</span>
<span id="cb117-14"><a href="cleaning.html#cb117-14" tabindex="-1"></a>      ))</span>
<span id="cb117-15"><a href="cleaning.html#cb117-15" tabindex="-1"></a></span>
<span id="cb117-16"><a href="cleaning.html#cb117-16" tabindex="-1"></a>comp_fun <span class="ot">&lt;-</span> <span class="cf">function</span>(d, rule){</span>
<span id="cb117-17"><a href="cleaning.html#cb117-17" tabindex="-1"></a>  d <span class="sc">%&gt;%</span></span>
<span id="cb117-18"><a href="cleaning.html#cb117-18" tabindex="-1"></a>    <span class="fu">group_by</span>(SID, name) <span class="sc">%&gt;%</span></span>
<span id="cb117-19"><a href="cleaning.html#cb117-19" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">value =</span> <span class="fu">fun_call</span>(data, rule)) <span class="sc">%&gt;%</span></span>
<span id="cb117-20"><a href="cleaning.html#cb117-20" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb117-21"><a href="cleaning.html#cb117-21" tabindex="-1"></a>    <span class="fu">distinct</span>()</span>
<span id="cb117-22"><a href="cleaning.html#cb117-22" tabindex="-1"></a>}</span>
<span id="cb117-23"><a href="cleaning.html#cb117-23" tabindex="-1"></a></span>
<span id="cb117-24"><a href="cleaning.html#cb117-24" tabindex="-1"></a><span class="co"># composite ACROSS years</span></span>
<span id="cb117-25"><a href="cleaning.html#cb117-25" tabindex="-1"></a>octotwin_cov <span class="ot">&lt;-</span> octotwin_cov <span class="sc">%&gt;%</span></span>
<span id="cb117-26"><a href="cleaning.html#cb117-26" tabindex="-1"></a>  <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb117-27"><a href="cleaning.html#cb117-27" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">long_rule =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(long_rule), <span class="st">&quot;skip&quot;</span>, long_rule)) <span class="sc">%&gt;%</span></span>
<span id="cb117-28"><a href="cleaning.html#cb117-28" tabindex="-1"></a>  <span class="fu">group_by</span>(long_rule) <span class="sc">%&gt;%</span></span>
<span id="cb117-29"><a href="cleaning.html#cb117-29" tabindex="-1"></a>  <span class="fu">nest</span>() <span class="sc">%&gt;%</span></span>
<span id="cb117-30"><a href="cleaning.html#cb117-30" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb117-31"><a href="cleaning.html#cb117-31" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">pmap</span>(<span class="fu">list</span>(data, long_rule), comp_fun)) <span class="sc">%&gt;%</span></span>
<span id="cb117-32"><a href="cleaning.html#cb117-32" tabindex="-1"></a>  <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb117-33"><a href="cleaning.html#cb117-33" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">ifelse</span>(<span class="fu">is.infinite</span>(value) <span class="sc">|</span> <span class="fu">is.nan</span>(value), <span class="cn">NA</span>, value)) <span class="sc">%&gt;%</span></span>
<span id="cb117-34"><a href="cleaning.html#cb117-34" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>long_rule) <span class="sc">%&gt;%</span></span>
<span id="cb117-35"><a href="cleaning.html#cb117-35" tabindex="-1"></a>  <span class="fu">spread</span>(name, value) <span class="sc">%&gt;%</span></span>
<span id="cb117-36"><a href="cleaning.html#cb117-36" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(SID))</span></code></pre></div>
</div>
<div id="personality-variables-9" class="section level3 hasAnchor" number="2.10.4">
<h3><span class="header-section-number">2.10.4</span> Personality Variables<a href="cleaning.html#personality-variables-9" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb118"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb118-1"><a href="cleaning.html#cb118-1" tabindex="-1"></a>octotwin_pers <span class="ot">&lt;-</span> octotwin_recode <span class="sc">%&gt;%</span></span>
<span id="cb118-2"><a href="cleaning.html#cb118-2" tabindex="-1"></a>  <span class="fu">filter</span>(category <span class="sc">==</span> <span class="st">&quot;pers&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb118-3"><a href="cleaning.html#cb118-3" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>category) <span class="sc">%&gt;%</span> </span>
<span id="cb118-4"><a href="cleaning.html#cb118-4" tabindex="-1"></a>  <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb118-5"><a href="cleaning.html#cb118-5" tabindex="-1"></a>  <span class="fu">filter</span>(wave <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(value)) <span class="sc">%&gt;%</span></span>
<span id="cb118-6"><a href="cleaning.html#cb118-6" tabindex="-1"></a>  <span class="fu">group_by</span>(SID, wave, name, itemname, comp_rule) <span class="sc">%&gt;%</span></span>
<span id="cb118-7"><a href="cleaning.html#cb118-7" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">value =</span> <span class="fu">mean</span>(value, <span class="at">na.rm =</span> T)) <span class="sc">%&gt;%</span></span>
<span id="cb118-8"><a href="cleaning.html#cb118-8" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb118-9"><a href="cleaning.html#cb118-9" tabindex="-1"></a></span>
<span id="cb118-10"><a href="cleaning.html#cb118-10" tabindex="-1"></a><span class="co"># alpha&#39;s</span></span>
<span id="cb118-11"><a href="cleaning.html#cb118-11" tabindex="-1"></a>octotwin_alpha <span class="ot">&lt;-</span> octotwin_pers <span class="sc">%&gt;%</span></span>
<span id="cb118-12"><a href="cleaning.html#cb118-12" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(value)) <span class="sc">%&gt;%</span></span>
<span id="cb118-13"><a href="cleaning.html#cb118-13" tabindex="-1"></a>  <span class="fu">select</span>(name, itemname, wave, SID, value) <span class="sc">%&gt;%</span></span>
<span id="cb118-14"><a href="cleaning.html#cb118-14" tabindex="-1"></a>  <span class="fu">group_by</span>(name, wave) <span class="sc">%&gt;%</span></span>
<span id="cb118-15"><a href="cleaning.html#cb118-15" tabindex="-1"></a>  <span class="fu">nest</span>() <span class="sc">%&gt;%</span></span>
<span id="cb118-16"><a href="cleaning.html#cb118-16" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">map</span>(data, <span class="sc">~</span>(.) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>() <span class="sc">%&gt;%</span> <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> itemname, <span class="at">values_from =</span> value, <span class="at">values_fn =</span> <span class="fu">list</span>(mean))),</span>
<span id="cb118-17"><a href="cleaning.html#cb118-17" tabindex="-1"></a>         <span class="at">alpha =</span> <span class="fu">map</span>(data, <span class="fu">possibly</span>(<span class="sc">~</span>psych<span class="sc">::</span><span class="fu">alpha</span>((.) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>SID), <span class="at">check.keys =</span> T), <span class="cn">NA_real_</span>)))</span>
<span id="cb118-18"><a href="cleaning.html#cb118-18" tabindex="-1"></a></span>
<span id="cb118-19"><a href="cleaning.html#cb118-19" tabindex="-1"></a>comp_fun <span class="ot">&lt;-</span> <span class="cf">function</span>(df, rule){</span>
<span id="cb118-20"><a href="cleaning.html#cb118-20" tabindex="-1"></a>  df <span class="sc">%&gt;%</span></span>
<span id="cb118-21"><a href="cleaning.html#cb118-21" tabindex="-1"></a>    <span class="fu">group_by</span>(SID) <span class="sc">%&gt;%</span></span>
<span id="cb118-22"><a href="cleaning.html#cb118-22" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">value =</span> <span class="fu">fun_call</span>(value, rule)) <span class="sc">%&gt;%</span></span>
<span id="cb118-23"><a href="cleaning.html#cb118-23" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb118-24"><a href="cleaning.html#cb118-24" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">ifelse</span>(<span class="fu">is.infinite</span>(value) <span class="sc">|</span> <span class="fu">is.nan</span>(value), <span class="cn">NA</span>, value))</span>
<span id="cb118-25"><a href="cleaning.html#cb118-25" tabindex="-1"></a>}</span>
<span id="cb118-26"><a href="cleaning.html#cb118-26" tabindex="-1"></a></span>
<span id="cb118-27"><a href="cleaning.html#cb118-27" tabindex="-1"></a><span class="co"># create composites</span></span>
<span id="cb118-28"><a href="cleaning.html#cb118-28" tabindex="-1"></a>octotwin_pers <span class="ot">&lt;-</span> octotwin_pers <span class="sc">%&gt;%</span></span>
<span id="cb118-29"><a href="cleaning.html#cb118-29" tabindex="-1"></a>  <span class="fu">group_by</span>(name, comp_rule, wave) <span class="sc">%&gt;%</span></span>
<span id="cb118-30"><a href="cleaning.html#cb118-30" tabindex="-1"></a>  <span class="fu">nest</span>() <span class="sc">%&gt;%</span></span>
<span id="cb118-31"><a href="cleaning.html#cb118-31" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb118-32"><a href="cleaning.html#cb118-32" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">map2</span>(data, comp_rule, comp_fun)) <span class="sc">%&gt;%</span></span>
<span id="cb118-33"><a href="cleaning.html#cb118-33" tabindex="-1"></a>  <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb118-34"><a href="cleaning.html#cb118-34" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>comp_rule)</span></code></pre></div>
</div>
<div id="outcome-variables-9" class="section level3 hasAnchor" number="2.10.5">
<h3><span class="header-section-number">2.10.5</span> Outcome Variables<a href="cleaning.html#outcome-variables-9" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb119-1"><a href="cleaning.html#cb119-1" tabindex="-1"></a>octotwin_cog_waves <span class="ot">&lt;-</span> octotwin_recode <span class="sc">%&gt;%</span></span>
<span id="cb119-2"><a href="cleaning.html#cb119-2" tabindex="-1"></a>  <span class="fu">filter</span>(category <span class="sc">==</span> <span class="st">&quot;outcome&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb119-3"><a href="cleaning.html#cb119-3" tabindex="-1"></a>  <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb119-4"><a href="cleaning.html#cb119-4" tabindex="-1"></a>  <span class="fu">group_by</span>(SID, name) <span class="sc">%&gt;%</span></span>
<span id="cb119-5"><a href="cleaning.html#cb119-5" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">o_year =</span> <span class="fu">max</span>(wave)) <span class="sc">%&gt;%</span></span>
<span id="cb119-6"><a href="cleaning.html#cb119-6" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb119-7"><a href="cleaning.html#cb119-7" tabindex="-1"></a></span>
<span id="cb119-8"><a href="cleaning.html#cb119-8" tabindex="-1"></a><span class="co"># composite within years</span></span>
<span id="cb119-9"><a href="cleaning.html#cb119-9" tabindex="-1"></a>octotwin_out <span class="ot">&lt;-</span> octotwin_recode <span class="sc">%&gt;%</span></span>
<span id="cb119-10"><a href="cleaning.html#cb119-10" tabindex="-1"></a>  <span class="fu">filter</span>(category <span class="sc">==</span> <span class="st">&quot;outcome&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb119-11"><a href="cleaning.html#cb119-11" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>category) <span class="sc">%&gt;%</span></span>
<span id="cb119-12"><a href="cleaning.html#cb119-12" tabindex="-1"></a>  <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb119-13"><a href="cleaning.html#cb119-13" tabindex="-1"></a>  <span class="fu">right_join</span>(octotwin_cog_waves) <span class="sc">%&gt;%</span></span>
<span id="cb119-14"><a href="cleaning.html#cb119-14" tabindex="-1"></a>  <span class="fu">filter</span>(wave <span class="sc">==</span> o_year <span class="sc">&amp;</span> wave <span class="sc">&gt;</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb119-15"><a href="cleaning.html#cb119-15" tabindex="-1"></a>  <span class="fu">group_by</span>(name, wave, SID) <span class="sc">%&gt;%</span></span>
<span id="cb119-16"><a href="cleaning.html#cb119-16" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">value =</span> <span class="fu">sum</span>(value, <span class="at">na.rm =</span> T)) <span class="sc">%&gt;%</span></span>
<span id="cb119-17"><a href="cleaning.html#cb119-17" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code></pre></div>
</div>
<div id="combine-data-9" class="section level3 hasAnchor" number="2.10.6">
<h3><span class="header-section-number">2.10.6</span> Combine Data<a href="cleaning.html#combine-data-9" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb120"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb120-1"><a href="cleaning.html#cb120-1" tabindex="-1"></a>octotwin_combined <span class="ot">&lt;-</span> octotwin_pers <span class="sc">%&gt;%</span> </span>
<span id="cb120-2"><a href="cleaning.html#cb120-2" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Trait =</span> name, <span class="at">p_value =</span> value, <span class="at">p_year =</span> wave) <span class="sc">%&gt;%</span></span>
<span id="cb120-3"><a href="cleaning.html#cb120-3" tabindex="-1"></a>  <span class="fu">full_join</span>(</span>
<span id="cb120-4"><a href="cleaning.html#cb120-4" tabindex="-1"></a>    octotwin_out <span class="sc">%&gt;%</span> </span>
<span id="cb120-5"><a href="cleaning.html#cb120-5" tabindex="-1"></a>      <span class="fu">rename</span>(<span class="at">Outcome =</span> name, <span class="at">o_value =</span> value, <span class="at">o_year =</span> wave)</span>
<span id="cb120-6"><a href="cleaning.html#cb120-6" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> <span class="fu">full_join</span>(octotwin_cov) <span class="sc">%&gt;%</span></span>
<span id="cb120-7"><a href="cleaning.html#cb120-7" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(p_value) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(o_value))</span></code></pre></div>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb121-1"><a href="cleaning.html#cb121-1" tabindex="-1"></a><span class="fu">save</span>(octotwin_cov, octotwin_alpha, octotwin_pers, octotwin_out, octotwin_combined,</span>
<span id="cb121-2"><a href="cleaning.html#cb121-2" tabindex="-1"></a>     <span class="at">file =</span> <span class="fu">sprintf</span>(<span class="st">&quot;%s/data/clean/octo-twin_cleaned.RData&quot;</span>, local_path))</span></code></pre></div>
<div class="sourceCode" id="cb122"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb122-1"><a href="cleaning.html#cb122-1" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span><span class="fu">ls</span>()[<span class="fu">grepl</span>(<span class="st">&quot;octotwin&quot;</span>, <span class="fu">ls</span>())])</span></code></pre></div>
</div>
</div>
<div id="swedish-adoption-twin-study-of-aging-satsa" class="section level2 hasAnchor" number="2.11">
<h2><span class="header-section-number">2.11</span> Swedish Adoption Twin Study of Aging (SATSA)<a href="cleaning.html#swedish-adoption-twin-study-of-aging-satsa" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The Swedish Adoption Twin Study of Aging (SATSA) is a longitudinal study of twin pairs from the Swedish Twin Registry that began in 1984. Data are available through the ICPSR database at <a href="https://www.icpsr.umich.edu/web/ICPSR/studies/3843" class="uri">https://www.icpsr.umich.edu/web/ICPSR/studies/3843</a>.</p>
<p>All twin-pairs on the Swedish Twin Registry who were separated at an early age were invited to be a part of the study in 1984. A control sample of twins reared together were also included. Additional waves of all participants were collected in 1987, 1990, 1993, 2004, 2007, 2010, 2012, and 2014. More information, including codebooks, scales, and variable search functions can be found at <a href="https://www.maelstrom-research.org/mica/individual-study/satsa/#" class="uri">https://www.maelstrom-research.org/mica/individual-study/satsa/#</a>.</p>
<p>Sample sizes vary by wave, ranging from 2018 participants at baseline (1984) to 379 participants (IPT7). Given that the target measures were collected at baseline, this provides 99% power to detect a zero-order correlation effect size of ~.10, two-tailed at alpha .05.</p>
<div id="load-data-9" class="section level3 hasAnchor" number="2.11.1">
<h3><span class="header-section-number">2.11.1</span> Load Data<a href="cleaning.html#load-data-9" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb123-1"><a href="cleaning.html#cb123-1" tabindex="-1"></a>loadRData <span class="ot">&lt;-</span> <span class="cf">function</span>(fileName){</span>
<span id="cb123-2"><a href="cleaning.html#cb123-2" tabindex="-1"></a><span class="co">#loads an RData file, and returns it</span></span>
<span id="cb123-3"><a href="cleaning.html#cb123-3" tabindex="-1"></a>    <span class="fu">load</span>(fileName)</span>
<span id="cb123-4"><a href="cleaning.html#cb123-4" tabindex="-1"></a>    <span class="fu">get</span>(<span class="fu">ls</span>()[<span class="fu">ls</span>() <span class="sc">!=</span> <span class="st">&quot;fileName&quot;</span>])</span>
<span id="cb123-5"><a href="cleaning.html#cb123-5" tabindex="-1"></a>}</span>
<span id="cb123-6"><a href="cleaning.html#cb123-6" tabindex="-1"></a></span>
<span id="cb123-7"><a href="cleaning.html#cb123-7" tabindex="-1"></a>satsa_read_fun <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb123-8"><a href="cleaning.html#cb123-8" tabindex="-1"></a>  <span class="co"># prob_vars &lt;- c(&quot;FHEART&quot;, &quot;FPARKIN&quot;, &quot;FSTROKE&quot;)</span></span>
<span id="cb123-9"><a href="cleaning.html#cb123-9" tabindex="-1"></a>  y <span class="ot">&lt;-</span> <span class="fu">sprintf</span>(<span class="st">&quot;%s/satsa/%s&quot;</span>, data_path, x) <span class="sc">%&gt;%</span> <span class="fu">loadRData</span>(.) <span class="sc">%&gt;%</span> </span>
<span id="cb123-10"><a href="cleaning.html#cb123-10" tabindex="-1"></a>    <span class="fu">select</span>(<span class="at">SID =</span> TWINNR, <span class="fu">one_of</span>(old.names)) <span class="sc">%&gt;%</span></span>
<span id="cb123-11"><a href="cleaning.html#cb123-11" tabindex="-1"></a>    <span class="fu">as_tibble</span>()</span>
<span id="cb123-12"><a href="cleaning.html#cb123-12" tabindex="-1"></a>  <span class="co"># if(any(prob_vars %in% colnames(y))){</span></span>
<span id="cb123-13"><a href="cleaning.html#cb123-13" tabindex="-1"></a>  <span class="co">#   y &lt;- y %&gt;% mutate_at(vars(one_of(prob_vars)), ~as.numeric(as.character(.)))</span></span>
<span id="cb123-14"><a href="cleaning.html#cb123-14" tabindex="-1"></a>  <span class="co">#   }</span></span>
<span id="cb123-15"><a href="cleaning.html#cb123-15" tabindex="-1"></a>  <span class="fu">return</span>(y)</span>
<span id="cb123-16"><a href="cleaning.html#cb123-16" tabindex="-1"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb124"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb124-1"><a href="cleaning.html#cb124-1" tabindex="-1"></a>satsa_codebook <span class="ot">&lt;-</span> (codebook <span class="sc">%&gt;%</span> <span class="fu">filter</span>(study <span class="sc">==</span> <span class="st">&quot;SATSA&quot;</span>))<span class="sc">$</span>codebook[[<span class="dv">1</span>]] <span class="sc">%&gt;%</span></span>
<span id="cb124-2"><a href="cleaning.html#cb124-2" tabindex="-1"></a>  <span class="fu">mutate_at</span>(<span class="fu">vars</span>(orig_itemname), str_to_upper)</span>
<span id="cb124-3"><a href="cleaning.html#cb124-3" tabindex="-1"></a>satsa_codebook</span></code></pre></div>
<pre><code>## # A tibble: 302 × 18
##    study dataset    category   name   itemname wave  wave_letter  year item_stem orig_itemname description scale reverse_code
##    &lt;chr&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;  &lt;chr&gt;    &lt;lgl&gt; &lt;chr&gt;       &lt;dbl&gt; &lt;chr&gt;     &lt;chr&gt;         &lt;chr&gt;       &lt;chr&gt; &lt;chr&gt;       
##  1 satsa SATSA_Q1   covariates educa… educati… NA    &lt;NA&gt;         1984 EDUC      EDUC          Education   &quot;1\t… &lt;NA&gt;        
##  2 satsa SATSA_Q1   covariates gender sex      NA    &lt;NA&gt;         1984 &lt;NA&gt;      SEX           SEX         &quot;1 =… &lt;NA&gt;        
##  3 satsa SATSA_IPT1 covariates gender sex      NA    &lt;NA&gt;         1985 &lt;NA&gt;      SEX           SEX         &quot;1 =… &lt;NA&gt;        
##  4 satsa SATSA_Q2   covariates gender sex      NA    &lt;NA&gt;         1987 &lt;NA&gt;      SEX           SEX         &quot;1 =… &lt;NA&gt;        
##  5 satsa SATSA_IPT2 covariates gender sex      NA    &lt;NA&gt;         1989 &lt;NA&gt;      SEX           SEX         &quot;1 =… &lt;NA&gt;        
##  6 satsa SATSA_Q3   covariates gender sex      NA    &lt;NA&gt;         1990 &lt;NA&gt;      SEX           SEX         &quot;1 =… &lt;NA&gt;        
##  7 satsa SATSA_IPT3 covariates gender sex      NA    &lt;NA&gt;         1992 &lt;NA&gt;      SEX           SEX         &quot;1 =… &lt;NA&gt;        
##  8 satsa SATSA_Q4   covariates gender sex      NA    &lt;NA&gt;         1993 &lt;NA&gt;      SEX           SEX         &quot;1 =… &lt;NA&gt;        
##  9 satsa SATSA_IPT4 covariates gender sex      NA    &lt;NA&gt;         1995 &lt;NA&gt;      SEX           SEX         &quot;1 =… &lt;NA&gt;        
## 10 satsa SATSA_IPT5 covariates gender sex      NA    &lt;NA&gt;         1999 &lt;NA&gt;      SEX           SEX         &quot;1 =… &lt;NA&gt;        
## # ℹ 292 more rows
## # ℹ 5 more variables: recode &lt;chr&gt;, mini &lt;dbl&gt;, maxi &lt;dbl&gt;, comp_rule &lt;chr&gt;, long_rule &lt;chr&gt;</code></pre>
<div class="sourceCode" id="cb126"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb126-1"><a href="cleaning.html#cb126-1" tabindex="-1"></a>old.names <span class="ot">&lt;-</span> <span class="fu">unique</span>(satsa_codebook<span class="sc">$</span>orig_itemname) <span class="sc">%&gt;%</span> str_to_upper</span>
<span id="cb126-2"><a href="cleaning.html#cb126-2" tabindex="-1"></a>datasets <span class="ot">&lt;-</span> <span class="fu">sprintf</span>(<span class="st">&quot;%s/satsa&quot;</span>, data_path) <span class="sc">%&gt;%</span> <span class="fu">list.files</span>(., <span class="at">pattern =</span> <span class="st">&quot;.rda&quot;</span>)</span>
<span id="cb126-3"><a href="cleaning.html#cb126-3" tabindex="-1"></a>satsa <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">datasets =</span> datasets) <span class="sc">%&gt;%</span></span>
<span id="cb126-4"><a href="cleaning.html#cb126-4" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">map</span>(datasets, satsa_read_fun),</span>
<span id="cb126-5"><a href="cleaning.html#cb126-5" tabindex="-1"></a>         <span class="at">ncol =</span> <span class="fu">map_dbl</span>(data, ncol)) <span class="sc">%&gt;%</span></span>
<span id="cb126-6"><a href="cleaning.html#cb126-6" tabindex="-1"></a>  <span class="fu">filter</span>(ncol <span class="sc">!=</span> <span class="dv">0</span>)</span>
<span id="cb126-7"><a href="cleaning.html#cb126-7" tabindex="-1"></a></span>
<span id="cb126-8"><a href="cleaning.html#cb126-8" tabindex="-1"></a>satsa <span class="ot">&lt;-</span> <span class="fu">reduce</span>(satsa<span class="sc">$</span>data, full_join) <span class="sc">%&gt;%</span> haven<span class="sc">::</span><span class="fu">zap_labels</span>(.)</span>
<span id="cb126-9"><a href="cleaning.html#cb126-9" tabindex="-1"></a>satsa <span class="ot">&lt;-</span> satsa <span class="sc">%&gt;%</span></span>
<span id="cb126-10"><a href="cleaning.html#cb126-10" tabindex="-1"></a>  <span class="fu">mutate_if</span>(is.factor, <span class="sc">~</span><span class="fu">as.numeric</span>(<span class="fu">sub</span>(<span class="st">&quot;^</span><span class="sc">\\</span><span class="st">(0*([0-9]+)</span><span class="sc">\\</span><span class="st">).+$&quot;</span>, <span class="st">&quot;</span><span class="sc">\\</span><span class="st">1&quot;</span>, .))) </span>
<span id="cb126-11"><a href="cleaning.html#cb126-11" tabindex="-1"></a>satsa_long <span class="ot">&lt;-</span> satsa <span class="sc">%&gt;%</span> </span>
<span id="cb126-12"><a href="cleaning.html#cb126-12" tabindex="-1"></a>  <span class="fu">gather</span>(<span class="at">key =</span> orig_itemname, <span class="at">value =</span> value, <span class="sc">-</span>SID, <span class="at">na.rm =</span> T)</span>
<span id="cb126-13"><a href="cleaning.html#cb126-13" tabindex="-1"></a><span class="fu">save</span>(satsa, <span class="at">file =</span> <span class="fu">sprintf</span>(<span class="st">&quot;%s/data/clean/satsa_raw.RData&quot;</span>, local_path))</span></code></pre></div>
</div>
<div id="recoding-reverse-scoring-10" class="section level3 hasAnchor" number="2.11.2">
<h3><span class="header-section-number">2.11.2</span> Recoding &amp; Reverse Scoring<a href="cleaning.html#recoding-reverse-scoring-10" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb127-1"><a href="cleaning.html#cb127-1" tabindex="-1"></a>satsa_waves <span class="ot">&lt;-</span> p_waves <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Study <span class="sc">==</span> <span class="st">&quot;SATSA&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(Used) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>()</span>
<span id="cb127-2"><a href="cleaning.html#cb127-2" tabindex="-1"></a></span>
<span id="cb127-3"><a href="cleaning.html#cb127-3" tabindex="-1"></a><span class="co"># join data with recoding info </span></span>
<span id="cb127-4"><a href="cleaning.html#cb127-4" tabindex="-1"></a>satsa_recode <span class="ot">&lt;-</span> satsa_codebook <span class="sc">%&gt;%</span></span>
<span id="cb127-5"><a href="cleaning.html#cb127-5" tabindex="-1"></a>  <span class="fu">select</span>(category, name, itemname, year, orig_itemname, reverse_code<span class="sc">:</span>long_rule) <span class="sc">%&gt;%</span></span>
<span id="cb127-6"><a href="cleaning.html#cb127-6" tabindex="-1"></a>  <span class="fu">filter</span>(category <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;pers&quot;</span>, <span class="st">&quot;outcome&quot;</span>, <span class="st">&quot;covariates&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb127-7"><a href="cleaning.html#cb127-7" tabindex="-1"></a>  <span class="fu">group_by</span>(category, name) <span class="sc">%&gt;%</span></span>
<span id="cb127-8"><a href="cleaning.html#cb127-8" tabindex="-1"></a>  <span class="fu">nest</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb127-9"><a href="cleaning.html#cb127-9" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb127-10"><a href="cleaning.html#cb127-10" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">map</span>(data, <span class="sc">~</span>(.) <span class="sc">%&gt;%</span> <span class="fu">left_join</span>(satsa_long)))</span>
<span id="cb127-11"><a href="cleaning.html#cb127-11" tabindex="-1"></a></span>
<span id="cb127-12"><a href="cleaning.html#cb127-12" tabindex="-1"></a><span class="co"># recode </span></span>
<span id="cb127-13"><a href="cleaning.html#cb127-13" tabindex="-1"></a>recode_fun <span class="ot">&lt;-</span> <span class="cf">function</span>(rule, y, year, p_year){</span>
<span id="cb127-14"><a href="cleaning.html#cb127-14" tabindex="-1"></a>  x <span class="ot">&lt;-</span> y<span class="sc">$</span>value</span>
<span id="cb127-15"><a href="cleaning.html#cb127-15" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.na</span>(rule)){y<span class="sc">$</span>value <span class="ot">&lt;-</span> <span class="fu">eval</span>(<span class="fu">parse</span>(<span class="at">text =</span> rule))}</span>
<span id="cb127-16"><a href="cleaning.html#cb127-16" tabindex="-1"></a>  <span class="fu">return</span>(y)</span>
<span id="cb127-17"><a href="cleaning.html#cb127-17" tabindex="-1"></a>}</span>
<span id="cb127-18"><a href="cleaning.html#cb127-18" tabindex="-1"></a></span>
<span id="cb127-19"><a href="cleaning.html#cb127-19" tabindex="-1"></a>satsa_recode <span class="ot">&lt;-</span> satsa_recode <span class="sc">%&gt;%</span> </span>
<span id="cb127-20"><a href="cleaning.html#cb127-20" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">map</span>(data, <span class="sc">~</span>(.) <span class="sc">%&gt;%</span> </span>
<span id="cb127-21"><a href="cleaning.html#cb127-21" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">p_year =</span> <span class="dv">1984</span>) <span class="sc">%&gt;%</span></span>
<span id="cb127-22"><a href="cleaning.html#cb127-22" tabindex="-1"></a>    <span class="fu">group_by</span>(recode, year, p_year) <span class="sc">%&gt;%</span></span>
<span id="cb127-23"><a href="cleaning.html#cb127-23" tabindex="-1"></a>    <span class="fu">nest</span>() <span class="sc">%&gt;%</span></span>
<span id="cb127-24"><a href="cleaning.html#cb127-24" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb127-25"><a href="cleaning.html#cb127-25" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">pmap</span>(<span class="fu">list</span>(recode, data, year, p_year), recode_fun)) <span class="sc">%&gt;%</span></span>
<span id="cb127-26"><a href="cleaning.html#cb127-26" tabindex="-1"></a>    <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb127-27"><a href="cleaning.html#cb127-27" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">ifelse</span>(value <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">|</span> <span class="fu">is.nan</span>(value) <span class="sc">|</span> <span class="fu">is.infinite</span>(value), <span class="cn">NA</span>, value))))</span>
<span id="cb127-28"><a href="cleaning.html#cb127-28" tabindex="-1"></a></span>
<span id="cb127-29"><a href="cleaning.html#cb127-29" tabindex="-1"></a></span>
<span id="cb127-30"><a href="cleaning.html#cb127-30" tabindex="-1"></a><span class="co"># reverse code </span></span>
<span id="cb127-31"><a href="cleaning.html#cb127-31" tabindex="-1"></a>satsa_recode <span class="ot">&lt;-</span> satsa_recode <span class="sc">%&gt;%</span></span>
<span id="cb127-32"><a href="cleaning.html#cb127-32" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">map</span>(data, <span class="sc">~</span>(.) <span class="sc">%&gt;%</span></span>
<span id="cb127-33"><a href="cleaning.html#cb127-33" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">ifelse</span>(reverse_code <span class="sc">==</span> <span class="st">&quot;no&quot;</span> <span class="sc">|</span> <span class="fu">is.na</span>(reverse_code), value, </span>
<span id="cb127-34"><a href="cleaning.html#cb127-34" tabindex="-1"></a>                        <span class="fu">reverse.code</span>(<span class="sc">-</span><span class="dv">1</span>, value, <span class="at">mini =</span> mini, <span class="at">maxi =</span> maxi)))))</span>
<span id="cb127-35"><a href="cleaning.html#cb127-35" tabindex="-1"></a></span>
<span id="cb127-36"><a href="cleaning.html#cb127-36" tabindex="-1"></a>fun_call <span class="ot">&lt;-</span> <span class="cf">function</span>(x, rule){</span>
<span id="cb127-37"><a href="cleaning.html#cb127-37" tabindex="-1"></a>    <span class="cf">switch</span>(rule,</span>
<span id="cb127-38"><a href="cleaning.html#cb127-38" tabindex="-1"></a>           <span class="at">average =</span> <span class="fu">mean</span>(x, <span class="at">na.rm =</span> T),</span>
<span id="cb127-39"><a href="cleaning.html#cb127-39" tabindex="-1"></a>           <span class="at">mode =</span> <span class="fu">Mode</span>(x)[<span class="dv">1</span>],</span>
<span id="cb127-40"><a href="cleaning.html#cb127-40" tabindex="-1"></a>           <span class="at">sum =</span> <span class="fu">sum</span>(x, <span class="at">na.rm =</span> T),</span>
<span id="cb127-41"><a href="cleaning.html#cb127-41" tabindex="-1"></a>           <span class="at">skip =</span> <span class="fu">unique</span>(x)[<span class="dv">1</span>],</span>
<span id="cb127-42"><a href="cleaning.html#cb127-42" tabindex="-1"></a>           <span class="at">select =</span> <span class="fu">unique</span>(x)[<span class="dv">1</span>],</span>
<span id="cb127-43"><a href="cleaning.html#cb127-43" tabindex="-1"></a>           <span class="at">max =</span> <span class="fu">max</span>(x, <span class="at">na.rm =</span> T),</span>
<span id="cb127-44"><a href="cleaning.html#cb127-44" tabindex="-1"></a>           <span class="at">min =</span> <span class="fu">min</span>(x, <span class="at">na.rm =</span> T))</span>
<span id="cb127-45"><a href="cleaning.html#cb127-45" tabindex="-1"></a>  }</span></code></pre></div>
</div>
<div id="covariates-10" class="section level3 hasAnchor" number="2.11.3">
<h3><span class="header-section-number">2.11.3</span> Covariates<a href="cleaning.html#covariates-10" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb128"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb128-1"><a href="cleaning.html#cb128-1" tabindex="-1"></a><span class="co"># composite WITHIN years </span></span>
<span id="cb128-2"><a href="cleaning.html#cb128-2" tabindex="-1"></a>satsa_cov <span class="ot">&lt;-</span> satsa_recode <span class="sc">%&gt;%</span></span>
<span id="cb128-3"><a href="cleaning.html#cb128-3" tabindex="-1"></a>  <span class="fu">filter</span>(category <span class="sc">==</span> <span class="st">&quot;covariates&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb128-4"><a href="cleaning.html#cb128-4" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>category) <span class="sc">%&gt;%</span></span>
<span id="cb128-5"><a href="cleaning.html#cb128-5" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">map</span>(data, <span class="sc">~</span>(.) <span class="sc">%&gt;%</span> </span>
<span id="cb128-6"><a href="cleaning.html#cb128-6" tabindex="-1"></a>      <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(value)) <span class="sc">%&gt;%</span></span>
<span id="cb128-7"><a href="cleaning.html#cb128-7" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">comp_rule =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(comp_rule), <span class="st">&quot;skip&quot;</span>, comp_rule)) <span class="sc">%&gt;%</span></span>
<span id="cb128-8"><a href="cleaning.html#cb128-8" tabindex="-1"></a>      <span class="fu">group_by</span>(comp_rule, SID, year, p_year, long_rule) <span class="sc">%&gt;%</span></span>
<span id="cb128-9"><a href="cleaning.html#cb128-9" tabindex="-1"></a>      <span class="fu">nest</span>() <span class="sc">%&gt;%</span></span>
<span id="cb128-10"><a href="cleaning.html#cb128-10" tabindex="-1"></a>      <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb128-11"><a href="cleaning.html#cb128-11" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">map2</span>(data, comp_rule, <span class="sc">~</span><span class="fu">fun_call</span>((.x)<span class="sc">$</span>value, .y))) <span class="sc">%&gt;%</span></span>
<span id="cb128-12"><a href="cleaning.html#cb128-12" tabindex="-1"></a>      <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb128-13"><a href="cleaning.html#cb128-13" tabindex="-1"></a>      <span class="fu">filter</span>(year <span class="sc">&lt;=</span> p_year)</span>
<span id="cb128-14"><a href="cleaning.html#cb128-14" tabindex="-1"></a>      ))</span>
<span id="cb128-15"><a href="cleaning.html#cb128-15" tabindex="-1"></a></span>
<span id="cb128-16"><a href="cleaning.html#cb128-16" tabindex="-1"></a>comp_fun <span class="ot">&lt;-</span> <span class="cf">function</span>(d, rule, p_year){</span>
<span id="cb128-17"><a href="cleaning.html#cb128-17" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">paste</span>(rule, p_year))</span>
<span id="cb128-18"><a href="cleaning.html#cb128-18" tabindex="-1"></a>  d <span class="sc">%&gt;%</span></span>
<span id="cb128-19"><a href="cleaning.html#cb128-19" tabindex="-1"></a>    <span class="fu">group_by</span>(SID, name) <span class="sc">%&gt;%</span></span>
<span id="cb128-20"><a href="cleaning.html#cb128-20" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">value =</span> <span class="fu">fun_call</span>(data, rule)) <span class="sc">%&gt;%</span></span>
<span id="cb128-21"><a href="cleaning.html#cb128-21" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb128-22"><a href="cleaning.html#cb128-22" tabindex="-1"></a>    <span class="fu">distinct</span>()</span>
<span id="cb128-23"><a href="cleaning.html#cb128-23" tabindex="-1"></a>}</span>
<span id="cb128-24"><a href="cleaning.html#cb128-24" tabindex="-1"></a></span>
<span id="cb128-25"><a href="cleaning.html#cb128-25" tabindex="-1"></a><span class="co"># composite ACROSS years</span></span>
<span id="cb128-26"><a href="cleaning.html#cb128-26" tabindex="-1"></a>satsa_cov <span class="ot">&lt;-</span> satsa_cov <span class="sc">%&gt;%</span></span>
<span id="cb128-27"><a href="cleaning.html#cb128-27" tabindex="-1"></a>  <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb128-28"><a href="cleaning.html#cb128-28" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">long_rule =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(long_rule), <span class="st">&quot;skip&quot;</span>, long_rule)) <span class="sc">%&gt;%</span></span>
<span id="cb128-29"><a href="cleaning.html#cb128-29" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">&lt;=</span> p_year) <span class="sc">%&gt;%</span></span>
<span id="cb128-30"><a href="cleaning.html#cb128-30" tabindex="-1"></a>  <span class="fu">group_by</span>(p_year, long_rule) <span class="sc">%&gt;%</span></span>
<span id="cb128-31"><a href="cleaning.html#cb128-31" tabindex="-1"></a>  <span class="fu">nest</span>() <span class="sc">%&gt;%</span></span>
<span id="cb128-32"><a href="cleaning.html#cb128-32" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb128-33"><a href="cleaning.html#cb128-33" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">pmap</span>(<span class="fu">list</span>(data, long_rule, p_year), comp_fun)) <span class="sc">%&gt;%</span></span>
<span id="cb128-34"><a href="cleaning.html#cb128-34" tabindex="-1"></a>  <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb128-35"><a href="cleaning.html#cb128-35" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">ifelse</span>(<span class="fu">is.infinite</span>(value) <span class="sc">|</span> <span class="fu">is.nan</span>(value), <span class="cn">NA</span>, value)) <span class="sc">%&gt;%</span></span>
<span id="cb128-36"><a href="cleaning.html#cb128-36" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>long_rule) <span class="sc">%&gt;%</span></span>
<span id="cb128-37"><a href="cleaning.html#cb128-37" tabindex="-1"></a>  <span class="fu">spread</span>(name, value) <span class="sc">%&gt;%</span></span>
<span id="cb128-38"><a href="cleaning.html#cb128-38" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(SID))</span></code></pre></div>
</div>
<div id="personality-variables-10" class="section level3 hasAnchor" number="2.11.4">
<h3><span class="header-section-number">2.11.4</span> Personality Variables<a href="cleaning.html#personality-variables-10" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb129-1"><a href="cleaning.html#cb129-1" tabindex="-1"></a>satsa_pers <span class="ot">&lt;-</span> satsa_recode <span class="sc">%&gt;%</span></span>
<span id="cb129-2"><a href="cleaning.html#cb129-2" tabindex="-1"></a>  <span class="fu">filter</span>(category <span class="sc">==</span> <span class="st">&quot;pers&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb129-3"><a href="cleaning.html#cb129-3" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>category) <span class="sc">%&gt;%</span> </span>
<span id="cb129-4"><a href="cleaning.html#cb129-4" tabindex="-1"></a>  <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb129-5"><a href="cleaning.html#cb129-5" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">1984</span> <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(value)) <span class="sc">%&gt;%</span></span>
<span id="cb129-6"><a href="cleaning.html#cb129-6" tabindex="-1"></a>  <span class="fu">group_by</span>(SID, p_year, year, name, itemname, comp_rule) <span class="sc">%&gt;%</span></span>
<span id="cb129-7"><a href="cleaning.html#cb129-7" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">value =</span> <span class="fu">mean</span>(value, <span class="at">na.rm =</span> T)) <span class="sc">%&gt;%</span></span>
<span id="cb129-8"><a href="cleaning.html#cb129-8" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb129-9"><a href="cleaning.html#cb129-9" tabindex="-1"></a></span>
<span id="cb129-10"><a href="cleaning.html#cb129-10" tabindex="-1"></a><span class="co"># alpha&#39;s</span></span>
<span id="cb129-11"><a href="cleaning.html#cb129-11" tabindex="-1"></a>satsa_alpha <span class="ot">&lt;-</span> satsa_pers <span class="sc">%&gt;%</span></span>
<span id="cb129-12"><a href="cleaning.html#cb129-12" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(value)) <span class="sc">%&gt;%</span></span>
<span id="cb129-13"><a href="cleaning.html#cb129-13" tabindex="-1"></a>  <span class="fu">select</span>(name, itemname, year, SID, value) <span class="sc">%&gt;%</span></span>
<span id="cb129-14"><a href="cleaning.html#cb129-14" tabindex="-1"></a>  <span class="fu">group_by</span>(name, year) <span class="sc">%&gt;%</span></span>
<span id="cb129-15"><a href="cleaning.html#cb129-15" tabindex="-1"></a>  <span class="fu">nest</span>() <span class="sc">%&gt;%</span></span>
<span id="cb129-16"><a href="cleaning.html#cb129-16" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">map</span>(data, <span class="sc">~</span>(.) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>() <span class="sc">%&gt;%</span> <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> itemname, <span class="at">values_from =</span> value, <span class="at">values_fn =</span> <span class="fu">list</span>(mean))),</span>
<span id="cb129-17"><a href="cleaning.html#cb129-17" tabindex="-1"></a>         <span class="at">alpha =</span> <span class="fu">map</span>(data, <span class="fu">possibly</span>(<span class="sc">~</span>psych<span class="sc">::</span><span class="fu">alpha</span>((.) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>SID)), <span class="cn">NA_real_</span>)))</span>
<span id="cb129-18"><a href="cleaning.html#cb129-18" tabindex="-1"></a></span>
<span id="cb129-19"><a href="cleaning.html#cb129-19" tabindex="-1"></a>comp_fun <span class="ot">&lt;-</span> <span class="cf">function</span>(df, rule){</span>
<span id="cb129-20"><a href="cleaning.html#cb129-20" tabindex="-1"></a>  df <span class="sc">%&gt;%</span></span>
<span id="cb129-21"><a href="cleaning.html#cb129-21" tabindex="-1"></a>    <span class="fu">group_by</span>(SID) <span class="sc">%&gt;%</span></span>
<span id="cb129-22"><a href="cleaning.html#cb129-22" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">value =</span> <span class="fu">fun_call</span>(value, rule)) <span class="sc">%&gt;%</span></span>
<span id="cb129-23"><a href="cleaning.html#cb129-23" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb129-24"><a href="cleaning.html#cb129-24" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">ifelse</span>(<span class="fu">is.infinite</span>(value) <span class="sc">|</span> <span class="fu">is.nan</span>(value), <span class="cn">NA</span>, value))</span>
<span id="cb129-25"><a href="cleaning.html#cb129-25" tabindex="-1"></a>}</span>
<span id="cb129-26"><a href="cleaning.html#cb129-26" tabindex="-1"></a></span>
<span id="cb129-27"><a href="cleaning.html#cb129-27" tabindex="-1"></a><span class="co"># create composites</span></span>
<span id="cb129-28"><a href="cleaning.html#cb129-28" tabindex="-1"></a>satsa_pers <span class="ot">&lt;-</span> satsa_pers <span class="sc">%&gt;%</span></span>
<span id="cb129-29"><a href="cleaning.html#cb129-29" tabindex="-1"></a>  <span class="fu">group_by</span>(name, comp_rule, year) <span class="sc">%&gt;%</span></span>
<span id="cb129-30"><a href="cleaning.html#cb129-30" tabindex="-1"></a>  <span class="fu">nest</span>() <span class="sc">%&gt;%</span></span>
<span id="cb129-31"><a href="cleaning.html#cb129-31" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb129-32"><a href="cleaning.html#cb129-32" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">map2</span>(data, comp_rule, comp_fun)) <span class="sc">%&gt;%</span></span>
<span id="cb129-33"><a href="cleaning.html#cb129-33" tabindex="-1"></a>  <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb129-34"><a href="cleaning.html#cb129-34" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>comp_rule)</span></code></pre></div>
</div>
<div id="outcome-variables-10" class="section level3 hasAnchor" number="2.11.5">
<h3><span class="header-section-number">2.11.5</span> Outcome Variables<a href="cleaning.html#outcome-variables-10" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb130-1"><a href="cleaning.html#cb130-1" tabindex="-1"></a><span class="co"># composite within years</span></span>
<span id="cb130-2"><a href="cleaning.html#cb130-2" tabindex="-1"></a>satsa_out <span class="ot">&lt;-</span> satsa_recode <span class="sc">%&gt;%</span></span>
<span id="cb130-3"><a href="cleaning.html#cb130-3" tabindex="-1"></a>  <span class="fu">filter</span>(category <span class="sc">==</span> <span class="st">&quot;outcome&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb130-4"><a href="cleaning.html#cb130-4" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>category) <span class="sc">%&gt;%</span></span>
<span id="cb130-5"><a href="cleaning.html#cb130-5" tabindex="-1"></a>  <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb130-6"><a href="cleaning.html#cb130-6" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">1999</span>) <span class="sc">%&gt;%</span></span>
<span id="cb130-7"><a href="cleaning.html#cb130-7" tabindex="-1"></a>  <span class="fu">group_by</span>(name, year, SID) <span class="sc">%&gt;%</span></span>
<span id="cb130-8"><a href="cleaning.html#cb130-8" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">value =</span> <span class="fu">sum</span>(value, <span class="at">na.rm =</span> T)) <span class="sc">%&gt;%</span></span>
<span id="cb130-9"><a href="cleaning.html#cb130-9" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code></pre></div>
</div>
<div id="combine-data-10" class="section level3 hasAnchor" number="2.11.6">
<h3><span class="header-section-number">2.11.6</span> Combine Data<a href="cleaning.html#combine-data-10" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb131-1"><a href="cleaning.html#cb131-1" tabindex="-1"></a>satsa_combined <span class="ot">&lt;-</span> satsa_pers <span class="sc">%&gt;%</span> </span>
<span id="cb131-2"><a href="cleaning.html#cb131-2" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Trait =</span> name, <span class="at">p_value =</span> value, <span class="at">p_year =</span> year) <span class="sc">%&gt;%</span></span>
<span id="cb131-3"><a href="cleaning.html#cb131-3" tabindex="-1"></a>  <span class="fu">full_join</span>(satsa_out <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">Outcome =</span> name, <span class="at">o_value =</span> value, <span class="at">o_year =</span> year)) <span class="sc">%&gt;%</span></span>
<span id="cb131-4"><a href="cleaning.html#cb131-4" tabindex="-1"></a>  <span class="fu">full_join</span>(satsa_cov) <span class="sc">%&gt;%</span></span>
<span id="cb131-5"><a href="cleaning.html#cb131-5" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(p_value) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(o_value))</span></code></pre></div>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb132-1"><a href="cleaning.html#cb132-1" tabindex="-1"></a><span class="fu">save</span>(satsa_cov, satsa_alpha, satsa_pers, satsa_out, satsa_combined,</span>
<span id="cb132-2"><a href="cleaning.html#cb132-2" tabindex="-1"></a>     <span class="at">file =</span> <span class="fu">sprintf</span>(<span class="st">&quot;%s/data/clean/satsa_cleaned.RData&quot;</span>, local_path))</span></code></pre></div>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb133-1"><a href="cleaning.html#cb133-1" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span><span class="fu">ls</span>()[<span class="fu">grepl</span>(<span class="st">&quot;satsa&quot;</span>, <span class="fu">ls</span>())])</span></code></pre></div>
</div>
</div>
<div id="seattle-longitudinal-study-sls" class="section level2 hasAnchor" number="2.12">
<h2><span class="header-section-number">2.12</span> Seattle Longitudinal Study (SLS)<a href="cleaning.html#seattle-longitudinal-study-sls" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The Seattle Longitudinal Study is an ongoing longitudinal study of adult Seattle residents that began in 1956. Data are available, by request from <a href="https://sls.psychiatry.uw.edu/researchers/public-access-data-sets/" class="uri">https://sls.psychiatry.uw.edu/researchers/public-access-data-sets/</a>.</p>
<p>The first cohort of participants were recruited from HMO plan members of the Group Health Cooperative of Puget Sound in Seattle. Seven years later, the first cohort and a new cohort of similarly aged participants were solicited again. Over the next half century, this procedure was repeated every seven years and is ongoing. More information on the measures collected can be found at <a href="https://sls.psychiatry.uw.edu/researchers/measures/" class="uri">https://sls.psychiatry.uw.edu/researchers/measures/</a>.</p>
<p>Sample sizes vary by year, from 302 (1956) to 421 (2005). This provides 99% power to detect correlation effect sizes of ~.23, two-tailed alpha at .05.</p>
</div>
<div id="descriptives-of-all-studies" class="section level2 hasAnchor" number="2.13">
<h2><span class="header-section-number">2.13</span> Descriptives of All Studies<a href="cleaning.html#descriptives-of-all-studies" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb134-1"><a href="cleaning.html#cb134-1" tabindex="-1"></a>loadRData <span class="ot">&lt;-</span> <span class="cf">function</span>(fileName, type){</span>
<span id="cb134-2"><a href="cleaning.html#cb134-2" tabindex="-1"></a><span class="co">#loads an RData file, and returns it</span></span>
<span id="cb134-3"><a href="cleaning.html#cb134-3" tabindex="-1"></a>    path <span class="ot">&lt;-</span> <span class="fu">sprintf</span>(<span class="st">&quot;%s/data/clean/%s_cleaned.RData&quot;</span>, local_path, fileName)</span>
<span id="cb134-4"><a href="cleaning.html#cb134-4" tabindex="-1"></a>    <span class="fu">load</span>(path)</span>
<span id="cb134-5"><a href="cleaning.html#cb134-5" tabindex="-1"></a>    <span class="fu">get</span>(<span class="fu">ls</span>()[<span class="fu">grepl</span>(type, <span class="fu">ls</span>())])</span>
<span id="cb134-6"><a href="cleaning.html#cb134-6" tabindex="-1"></a>}</span>
<span id="cb134-7"><a href="cleaning.html#cb134-7" tabindex="-1"></a></span>
<span id="cb134-8"><a href="cleaning.html#cb134-8" tabindex="-1"></a>ipd_data <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb134-9"><a href="cleaning.html#cb134-9" tabindex="-1"></a>  <span class="at">study =</span> studies[<span class="sc">!</span>studies <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;CNLSY&quot;</span>, <span class="st">&quot;SLS&quot;</span>)]</span>
<span id="cb134-10"><a href="cleaning.html#cb134-10" tabindex="-1"></a>  , <span class="at">data =</span> <span class="fu">map</span>(<span class="fu">str_to_lower</span>(study), <span class="sc">~</span><span class="fu">loadRData</span>(., <span class="st">&quot;combined&quot;</span>))</span>
<span id="cb134-11"><a href="cleaning.html#cb134-11" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb134-12"><a href="cleaning.html#cb134-12" tabindex="-1"></a>    <span class="at">data =</span> <span class="fu">map</span>(data, <span class="sc">~</span>(.) <span class="sc">%&gt;%</span> </span>
<span id="cb134-13"><a href="cleaning.html#cb134-13" tabindex="-1"></a>                 <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb134-14"><a href="cleaning.html#cb134-14" tabindex="-1"></a>                 <span class="fu">mutate</span>(<span class="at">SID =</span> <span class="fu">as.character</span>(SID)))</span>
<span id="cb134-15"><a href="cleaning.html#cb134-15" tabindex="-1"></a>    , <span class="at">study =</span> <span class="fu">mapvalues</span>(study, studies, studies_long)</span>
<span id="cb134-16"><a href="cleaning.html#cb134-16" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb134-17"><a href="cleaning.html#cb134-17" tabindex="-1"></a>  <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb134-18"><a href="cleaning.html#cb134-18" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">age =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(age), p_year <span class="sc">-</span> yearBrth, age))</span>
<span id="cb134-19"><a href="cleaning.html#cb134-19" tabindex="-1"></a></span>
<span id="cb134-20"><a href="cleaning.html#cb134-20" tabindex="-1"></a>ipd_data <span class="ot">&lt;-</span> ipd_data <span class="sc">%&gt;%</span> </span>
<span id="cb134-21"><a href="cleaning.html#cb134-21" tabindex="-1"></a>  <span class="fu">group_by</span>(study, Trait, SID) <span class="sc">%&gt;%</span></span>
<span id="cb134-22"><a href="cleaning.html#cb134-22" tabindex="-1"></a>  <span class="fu">filter</span>(p_year <span class="sc">==</span> <span class="fu">min</span>(p_year)) <span class="sc">%&gt;%</span></span>
<span id="cb134-23"><a href="cleaning.html#cb134-23" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb134-24"><a href="cleaning.html#cb134-24" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>p_year, <span class="sc">-</span>o_year, <span class="sc">-</span>Outcome) <span class="sc">%&gt;%</span></span>
<span id="cb134-25"><a href="cleaning.html#cb134-25" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">crystallized =</span> o_value) <span class="sc">%&gt;%</span></span>
<span id="cb134-26"><a href="cleaning.html#cb134-26" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">%&gt;%</span></span>
<span id="cb134-27"><a href="cleaning.html#cb134-27" tabindex="-1"></a>  <span class="fu">group_by</span>(study) <span class="sc">%&gt;%</span></span>
<span id="cb134-28"><a href="cleaning.html#cb134-28" tabindex="-1"></a>  <span class="fu">nest</span>() <span class="sc">%&gt;%</span></span>
<span id="cb134-29"><a href="cleaning.html#cb134-29" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb134-30"><a href="cleaning.html#cb134-30" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">wide_data =</span> <span class="fu">map</span>(data, <span class="sc">~</span>(.) <span class="sc">%&gt;%</span> <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> <span class="st">&quot;Trait&quot;</span>, <span class="at">values_from =</span> <span class="st">&quot;p_value&quot;</span>)))</span></code></pre></div>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb135-1"><a href="cleaning.html#cb135-1" tabindex="-1"></a>cln <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Study&quot;</span>, <span class="st">&quot;E&quot;</span>, <span class="st">&quot;A&quot;</span>, <span class="st">&quot;C&quot;</span>, <span class="st">&quot;N&quot;</span>, <span class="st">&quot;O&quot;</span>, <span class="st">&quot;Crystallized / Knowledge&quot;</span>, <span class="st">&quot;Age (Years)&quot;</span>, <span class="st">&quot;Education (Years)&quot;</span>, <span class="st">&quot;% Women&quot;</span>, <span class="st">&quot;Valid N (Range)&quot;</span>)</span>
<span id="cb135-2"><a href="cleaning.html#cb135-2" tabindex="-1"></a></span>
<span id="cb135-3"><a href="cleaning.html#cb135-3" tabindex="-1"></a>desc_tab <span class="ot">&lt;-</span> ipd_data <span class="sc">%&gt;%</span></span>
<span id="cb135-4"><a href="cleaning.html#cb135-4" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>p_year, <span class="sc">-</span>o_year, <span class="sc">-</span>yearBrth, <span class="sc">-</span>SRhealth, <span class="sc">-</span>gender) <span class="sc">%&gt;%</span></span>
<span id="cb135-5"><a href="cleaning.html#cb135-5" tabindex="-1"></a>  <span class="fu">group_by</span>(study, Trait, Outcome) <span class="sc">%&gt;%</span></span>
<span id="cb135-6"><a href="cleaning.html#cb135-6" tabindex="-1"></a>  <span class="fu">mutate_at</span>(<span class="fu">vars</span>(p_value, o_value), </span>
<span id="cb135-7"><a href="cleaning.html#cb135-7" tabindex="-1"></a>            <span class="sc">~</span>((. <span class="sc">-</span> <span class="fu">min</span>(., <span class="at">na.rm =</span> T))<span class="sc">/</span>(<span class="fu">max</span>(., <span class="at">na.rm =</span> T) <span class="sc">-</span> <span class="fu">min</span>(., <span class="at">na.rm =</span> T))<span class="sc">*</span><span class="dv">10</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb135-8"><a href="cleaning.html#cb135-8" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> Outcome, <span class="at">values_from =</span> o_value, <span class="at">values_fn =</span> mean) <span class="sc">%&gt;%</span></span>
<span id="cb135-9"><a href="cleaning.html#cb135-9" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> Trait, <span class="at">values_from =</span> p_value, <span class="at">values_fn =</span> mean) <span class="sc">%&gt;%</span></span>
<span id="cb135-10"><a href="cleaning.html#cb135-10" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(education<span class="sc">:</span>C), <span class="at">values_to =</span> <span class="st">&quot;value&quot;</span>, <span class="at">names_to =</span> <span class="st">&quot;item&quot;</span>, <span class="at">values_drop_na =</span> T) <span class="sc">%&gt;%</span></span>
<span id="cb135-11"><a href="cleaning.html#cb135-11" tabindex="-1"></a>  <span class="fu">group_by</span>(study, item) <span class="sc">%&gt;%</span></span>
<span id="cb135-12"><a href="cleaning.html#cb135-12" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">est =</span> <span class="fu">sprintf</span>(<span class="st">&quot;%.2f (%.2f)&quot;</span>, <span class="fu">mean</span>(value, <span class="at">na.rm =</span> T), <span class="fu">sd</span>(value, <span class="at">na.rm =</span> T))) <span class="sc">%&gt;%</span></span>
<span id="cb135-13"><a href="cleaning.html#cb135-13" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb135-14"><a href="cleaning.html#cb135-14" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> item, <span class="at">values_from =</span> est) <span class="sc">%&gt;%</span></span>
<span id="cb135-15"><a href="cleaning.html#cb135-15" tabindex="-1"></a>  <span class="fu">full_join</span>(</span>
<span id="cb135-16"><a href="cleaning.html#cb135-16" tabindex="-1"></a>    ipd_data <span class="sc">%&gt;%</span> </span>
<span id="cb135-17"><a href="cleaning.html#cb135-17" tabindex="-1"></a>      <span class="fu">select</span>(study, Trait, p_value, Outcome, SID, o_value) <span class="sc">%&gt;%</span></span>
<span id="cb135-18"><a href="cleaning.html#cb135-18" tabindex="-1"></a>      <span class="fu">distinct</span>() <span class="sc">%&gt;%</span></span>
<span id="cb135-19"><a href="cleaning.html#cb135-19" tabindex="-1"></a>      <span class="fu">group_by</span>(study, Trait) <span class="sc">%&gt;%</span> </span>
<span id="cb135-20"><a href="cleaning.html#cb135-20" tabindex="-1"></a>      <span class="fu">tally</span>() <span class="sc">%&gt;%</span></span>
<span id="cb135-21"><a href="cleaning.html#cb135-21" tabindex="-1"></a>      <span class="fu">group_by</span>(study) <span class="sc">%&gt;%</span></span>
<span id="cb135-22"><a href="cleaning.html#cb135-22" tabindex="-1"></a>      <span class="fu">summarize</span>(<span class="at">n =</span> <span class="fu">sprintf</span>(<span class="st">&quot;%i - %i&quot;</span>, <span class="fu">min</span>(n), <span class="fu">max</span>(n)))</span>
<span id="cb135-23"><a href="cleaning.html#cb135-23" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb135-24"><a href="cleaning.html#cb135-24" tabindex="-1"></a>  <span class="fu">full_join</span>(</span>
<span id="cb135-25"><a href="cleaning.html#cb135-25" tabindex="-1"></a>    ipd_data <span class="sc">%&gt;%</span> </span>
<span id="cb135-26"><a href="cleaning.html#cb135-26" tabindex="-1"></a>      <span class="fu">select</span>(study, SID, gender) <span class="sc">%&gt;%</span> </span>
<span id="cb135-27"><a href="cleaning.html#cb135-27" tabindex="-1"></a>      <span class="fu">distinct</span>()  <span class="sc">%&gt;%</span> </span>
<span id="cb135-28"><a href="cleaning.html#cb135-28" tabindex="-1"></a>      <span class="fu">group_by</span>(study) <span class="sc">%&gt;%</span> </span>
<span id="cb135-29"><a href="cleaning.html#cb135-29" tabindex="-1"></a>      <span class="fu">summarize</span>(<span class="at">gender =</span> <span class="fu">mean</span>(gender, <span class="at">na.rm =</span> T)<span class="sc">*</span><span class="dv">100</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb135-30"><a href="cleaning.html#cb135-30" tabindex="-1"></a>      <span class="fu">ungroup</span>()</span>
<span id="cb135-31"><a href="cleaning.html#cb135-31" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb135-32"><a href="cleaning.html#cb135-32" tabindex="-1"></a>  <span class="fu">select</span>(study, E, A, C, N, O, crystallized, age, education, gender, n) <span class="sc">%&gt;%</span></span>
<span id="cb135-33"><a href="cleaning.html#cb135-33" tabindex="-1"></a>  <span class="fu">kable</span>(., <span class="st">&quot;html&quot;</span></span>
<span id="cb135-34"><a href="cleaning.html#cb135-34" tabindex="-1"></a>        , <span class="at">digits =</span> <span class="dv">2</span></span>
<span id="cb135-35"><a href="cleaning.html#cb135-35" tabindex="-1"></a>        , <span class="at">col.names =</span> cln</span>
<span id="cb135-36"><a href="cleaning.html#cb135-36" tabindex="-1"></a>        , <span class="at">caption =</span> <span class="st">&quot;&lt;strong&gt;Table 3&lt;/strong&gt;&lt;br&gt;&lt;em&gt;Descriptive Statistics of All Harmonized Measures Across Samples&quot;</span></span>
<span id="cb135-37"><a href="cleaning.html#cb135-37" tabindex="-1"></a>        , <span class="at">align =</span> <span class="fu">c</span>(<span class="st">&quot;l&quot;</span>, <span class="fu">rep</span>(<span class="st">&quot;c&quot;</span>,<span class="dv">9</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb135-38"><a href="cleaning.html#cb135-38" tabindex="-1"></a>  <span class="fu">kable_classic</span>(<span class="at">full_width =</span> F, <span class="at">html_font =</span> <span class="st">&quot;Times New Roman&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb135-39"><a href="cleaning.html#cb135-39" tabindex="-1"></a>  <span class="fu">add_header_above</span>(<span class="fu">c</span>(<span class="st">&quot; &quot;</span> <span class="ot">=</span> <span class="dv">1</span>, <span class="st">&quot;Personality Characteristics&quot;</span> <span class="ot">=</span> <span class="dv">5</span>, <span class="st">&quot; &quot;</span> <span class="ot">=</span> <span class="dv">5</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb135-40"><a href="cleaning.html#cb135-40" tabindex="-1"></a>  <span class="fu">add_footnote</span>(<span class="at">notation =</span> <span class="st">&quot;none&quot;</span>, <span class="at">label =</span> <span class="st">&quot;&lt;em&gt;Note.&lt;/em&gt; E = Extraversion; A = Agreeableness; C = Conscientiousness; N = Neuroticism; O = Openness; Age, education, and gender were assessed at the first baseline personality assessment. Valid N (Range) indicates the range of valid observations with complete personality trait and outcome data across different trait measures.&quot;</span>, <span class="at">escape =</span> F)</span>
<span id="cb135-41"><a href="cleaning.html#cb135-41" tabindex="-1"></a>desc_tab</span>
<span id="cb135-42"><a href="cleaning.html#cb135-42" tabindex="-1"></a><span class="fu">save_kable</span>(desc_tab, <span class="at">file =</span> <span class="fu">sprintf</span>(<span class="st">&quot;%s/results/tables/tab-3-desc.html&quot;</span>, local_path))</span></code></pre></div>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb136-1"><a href="cleaning.html#cb136-1" tabindex="-1"></a>r_fun <span class="ot">&lt;-</span> <span class="cf">function</span>(d, study){</span>
<span id="cb136-2"><a href="cleaning.html#cb136-2" tabindex="-1"></a>  cols <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;E&quot;</span>, <span class="st">&quot;A&quot;</span>, <span class="st">&quot;C&quot;</span>, <span class="st">&quot;N&quot;</span>, <span class="st">&quot;O&quot;</span>, <span class="st">&quot;crystallized&quot;</span>, <span class="st">&quot;age&quot;</span>, <span class="st">&quot;gender&quot;</span>, <span class="st">&quot;education&quot;</span>)</span>
<span id="cb136-3"><a href="cleaning.html#cb136-3" tabindex="-1"></a>  cols_long <span class="ot">&lt;-</span> <span class="fu">mapvalues</span>(cols, <span class="fu">c</span>(traits<span class="sc">$</span>short_name, outcomes<span class="sc">$</span>short_name, covars<span class="sc">$</span>short_name)</span>
<span id="cb136-4"><a href="cleaning.html#cb136-4" tabindex="-1"></a>                         , <span class="fu">c</span>(traits<span class="sc">$</span>long_name, outcomes<span class="sc">$</span>long_name, covars<span class="sc">$</span>long_name))</span>
<span id="cb136-5"><a href="cleaning.html#cb136-5" tabindex="-1"></a>  colns <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(cols), <span class="st">&quot;. &quot;</span>, cols_long, <span class="at">sep =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb136-6"><a href="cleaning.html#cb136-6" tabindex="-1"></a>  r <span class="ot">&lt;-</span> d <span class="sc">%&gt;%</span> </span>
<span id="cb136-7"><a href="cleaning.html#cb136-7" tabindex="-1"></a>    <span class="fu">select</span>(<span class="fu">all_of</span>(cols)) <span class="sc">%&gt;%</span></span>
<span id="cb136-8"><a href="cleaning.html#cb136-8" tabindex="-1"></a>    <span class="fu">cor</span>(., <span class="at">use =</span> <span class="st">&quot;pairwise&quot;</span>) </span>
<span id="cb136-9"><a href="cleaning.html#cb136-9" tabindex="-1"></a>  r <span class="ot">&lt;-</span> <span class="fu">apply</span>(r, <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>), <span class="cf">function</span>(x) <span class="fu">ifelse</span>(<span class="fu">is.na</span>(x), <span class="st">&quot;&quot;</span>, <span class="fu">ifelse</span>(x <span class="sc">==</span> <span class="dv">1</span>, <span class="st">&quot;--&quot;</span>, <span class="fu">sprintf</span>(<span class="st">&quot;%.2f&quot;</span>, x))))</span>
<span id="cb136-10"><a href="cleaning.html#cb136-10" tabindex="-1"></a>  r[<span class="fu">upper.tri</span>(r)] <span class="ot">&lt;-</span> <span class="st">&quot;&quot;</span></span>
<span id="cb136-11"><a href="cleaning.html#cb136-11" tabindex="-1"></a>  <span class="fu">diag</span>(r) <span class="ot">&lt;-</span> <span class="st">&quot;--&quot;</span></span>
<span id="cb136-12"><a href="cleaning.html#cb136-12" tabindex="-1"></a>  <span class="fu">rownames</span>(r) <span class="ot">&lt;-</span> colns; <span class="fu">colnames</span>(r) <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">1</span>,<span class="fu">length</span>(cols))</span>
<span id="cb136-13"><a href="cleaning.html#cb136-13" tabindex="-1"></a>  tab <span class="ot">&lt;-</span> r <span class="sc">%&gt;%</span> </span>
<span id="cb136-14"><a href="cleaning.html#cb136-14" tabindex="-1"></a>    <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb136-15"><a href="cleaning.html#cb136-15" tabindex="-1"></a>    <span class="fu">rownames_to_column</span>(<span class="st">&quot; &quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb136-16"><a href="cleaning.html#cb136-16" tabindex="-1"></a>    <span class="fu">kable</span>(.</span>
<span id="cb136-17"><a href="cleaning.html#cb136-17" tabindex="-1"></a>          , <span class="st">&quot;html&quot;</span></span>
<span id="cb136-18"><a href="cleaning.html#cb136-18" tabindex="-1"></a>          , <span class="at">escape =</span> F</span>
<span id="cb136-19"><a href="cleaning.html#cb136-19" tabindex="-1"></a>          , <span class="at">align =</span> <span class="fu">c</span>(<span class="st">&quot;l&quot;</span>, <span class="fu">rep</span>(<span class="st">&quot;c&quot;</span>, <span class="fu">length</span>(cols)))</span>
<span id="cb136-20"><a href="cleaning.html#cb136-20" tabindex="-1"></a>          , <span class="at">caption =</span> <span class="fu">sprintf</span>(<span class="st">&quot;&lt;strong&gt;Table SX&lt;/strong&gt;&lt;br&gt;&lt;em&gt;Zero-Order Correlations Between All Study Variables in %s&lt;/em&gt;&quot;</span>, study)</span>
<span id="cb136-21"><a href="cleaning.html#cb136-21" tabindex="-1"></a>          ) <span class="sc">%&gt;%</span></span>
<span id="cb136-22"><a href="cleaning.html#cb136-22" tabindex="-1"></a>    <span class="fu">kable_classic</span>(<span class="at">full_width =</span> F, <span class="at">html_font =</span> <span class="st">&quot;Times New Roman&quot;</span>)</span>
<span id="cb136-23"><a href="cleaning.html#cb136-23" tabindex="-1"></a>  <span class="fu">save_kable</span>(tab, <span class="at">file =</span> <span class="fu">sprintf</span>(<span class="st">&quot;%s/results/tables/zero-order-cors/%s.html&quot;</span>, local_path, study))</span>
<span id="cb136-24"><a href="cleaning.html#cb136-24" tabindex="-1"></a>  <span class="fu">return</span>(tab)</span>
<span id="cb136-25"><a href="cleaning.html#cb136-25" tabindex="-1"></a>}</span>
<span id="cb136-26"><a href="cleaning.html#cb136-26" tabindex="-1"></a></span>
<span id="cb136-27"><a href="cleaning.html#cb136-27" tabindex="-1"></a>loadRData <span class="ot">&lt;-</span> <span class="cf">function</span>(fileName, type){</span>
<span id="cb136-28"><a href="cleaning.html#cb136-28" tabindex="-1"></a><span class="co">#loads an RData file, and returns it</span></span>
<span id="cb136-29"><a href="cleaning.html#cb136-29" tabindex="-1"></a>    path <span class="ot">&lt;-</span> <span class="fu">sprintf</span>(<span class="st">&quot;%s/data/clean/%s_cleaned.RData&quot;</span>, local_path, fileName)</span>
<span id="cb136-30"><a href="cleaning.html#cb136-30" tabindex="-1"></a>    <span class="fu">print</span>(path)</span>
<span id="cb136-31"><a href="cleaning.html#cb136-31" tabindex="-1"></a>    <span class="fu">load</span>(path)</span>
<span id="cb136-32"><a href="cleaning.html#cb136-32" tabindex="-1"></a>    <span class="fu">get</span>(<span class="fu">ls</span>()[<span class="fu">grepl</span>(type, <span class="fu">ls</span>())])</span>
<span id="cb136-33"><a href="cleaning.html#cb136-33" tabindex="-1"></a>}</span>
<span id="cb136-34"><a href="cleaning.html#cb136-34" tabindex="-1"></a></span>
<span id="cb136-35"><a href="cleaning.html#cb136-35" tabindex="-1"></a>ipd3_meta_data <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb136-36"><a href="cleaning.html#cb136-36" tabindex="-1"></a>  <span class="at">study =</span> studies[<span class="sc">!</span>studies <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;CNLSY&quot;</span>, <span class="st">&quot;SLS&quot;</span>)]</span>
<span id="cb136-37"><a href="cleaning.html#cb136-37" tabindex="-1"></a>  , <span class="at">data =</span> <span class="fu">map</span>(<span class="fu">str_to_lower</span>(study), <span class="sc">~</span><span class="fu">loadRData</span>(., <span class="st">&quot;combined&quot;</span>))</span>
<span id="cb136-38"><a href="cleaning.html#cb136-38" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb136-39"><a href="cleaning.html#cb136-39" tabindex="-1"></a>    <span class="at">data =</span> <span class="fu">map</span>(data, <span class="sc">~</span>(.) <span class="sc">%&gt;%</span> </span>
<span id="cb136-40"><a href="cleaning.html#cb136-40" tabindex="-1"></a>                 <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb136-41"><a href="cleaning.html#cb136-41" tabindex="-1"></a>                 <span class="fu">mutate</span>(<span class="at">SID =</span> <span class="fu">as.character</span>(SID)))</span>
<span id="cb136-42"><a href="cleaning.html#cb136-42" tabindex="-1"></a>    , <span class="at">study =</span> <span class="fu">mapvalues</span>(study, studies, studies_long)</span>
<span id="cb136-43"><a href="cleaning.html#cb136-43" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb136-44"><a href="cleaning.html#cb136-44" tabindex="-1"></a>  <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb136-45"><a href="cleaning.html#cb136-45" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">age =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(age), p_year <span class="sc">-</span> yearBrth, age))</span></code></pre></div>
<pre><code>## [1] &quot;~/Documents/projects/data synthesis/crystallized/data/clean/base-i_cleaned.RData&quot;
## [1] &quot;~/Documents/projects/data synthesis/crystallized/data/clean/eas_cleaned.RData&quot;
## [1] &quot;~/Documents/projects/data synthesis/crystallized/data/clean/gsoep_cleaned.RData&quot;
## [1] &quot;~/Documents/projects/data synthesis/crystallized/data/clean/hilda_cleaned.RData&quot;
## [1] &quot;~/Documents/projects/data synthesis/crystallized/data/clean/hrs_cleaned.RData&quot;
## [1] &quot;~/Documents/projects/data synthesis/crystallized/data/clean/lasa_cleaned.RData&quot;
## [1] &quot;~/Documents/projects/data synthesis/crystallized/data/clean/map_cleaned.RData&quot;
## [1] &quot;~/Documents/projects/data synthesis/crystallized/data/clean/mars_cleaned.RData&quot;
## [1] &quot;~/Documents/projects/data synthesis/crystallized/data/clean/octo-twin_cleaned.RData&quot;
## [1] &quot;~/Documents/projects/data synthesis/crystallized/data/clean/ros_cleaned.RData&quot;
## [1] &quot;~/Documents/projects/data synthesis/crystallized/data/clean/satsa_cleaned.RData&quot;</code></pre>
<div class="sourceCode" id="cb138"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb138-1"><a href="cleaning.html#cb138-1" tabindex="-1"></a>ipd3_meta_data</span></code></pre></div>
<pre><code>## # A tibble: 119,597 × 13
##    study Trait p_value p_year SID   Outcome      o_value o_year education gender SRhealth yearBrth   age
##    &lt;chr&gt; &lt;chr&gt;   &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;          &lt;dbl&gt;  &lt;dbl&gt;     &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;
##  1 BASE  E        3.83   1990 10004 crystallized   2.17    2000        17      0        4     1918    72
##  2 BASE  E        3.83   1990 10010 crystallized   3.08    1995        11      0        2     1911    79
##  3 BASE  E        2.5    1990 10033 crystallized   0.909   1997         8      1        5     1910    80
##  4 BASE  E        3      1990 10034 crystallized   6.54    1995        10      0        5     1914    76
##  5 BASE  E        2.5    1990 10111 crystallized   6.54    1995        13      1        4     1901    89
##  6 BASE  E        3.17   1990 10115 crystallized  10       1995        11      0        2     1918    72
##  7 BASE  E        3      1990 10116 crystallized   3.85    1995        10      0        4     1917    73
##  8 BASE  E        3      1990 10145 crystallized   6.36    1997        10      1        5     1897    93
##  9 BASE  E        3.33   1990 10175 crystallized   2.31    1995         8      1        3     1911    79
## 10 BASE  E        3.33   1990 10188 crystallized   5.77    2004        10      1        2     1903    87
## # ℹ 119,587 more rows</code></pre>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb140-1"><a href="cleaning.html#cb140-1" tabindex="-1"></a>ipd_cors <span class="ot">&lt;-</span> ipd3_meta_data <span class="sc">%&gt;%</span></span>
<span id="cb140-2"><a href="cleaning.html#cb140-2" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>p_year, <span class="sc">-</span>o_year, <span class="sc">-</span>yearBrth, <span class="sc">-</span>SRhealth) <span class="sc">%&gt;%</span></span>
<span id="cb140-3"><a href="cleaning.html#cb140-3" tabindex="-1"></a>  <span class="fu">group_by</span>(study, Trait, Outcome) <span class="sc">%&gt;%</span></span>
<span id="cb140-4"><a href="cleaning.html#cb140-4" tabindex="-1"></a>  <span class="fu">mutate_at</span>(<span class="fu">vars</span>(p_value, o_value), </span>
<span id="cb140-5"><a href="cleaning.html#cb140-5" tabindex="-1"></a>            <span class="sc">~</span>((. <span class="sc">-</span> <span class="fu">min</span>(., <span class="at">na.rm =</span> T))<span class="sc">/</span>(<span class="fu">max</span>(., <span class="at">na.rm =</span> T) <span class="sc">-</span> <span class="fu">min</span>(., <span class="at">na.rm =</span> T))<span class="sc">*</span><span class="dv">10</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb140-6"><a href="cleaning.html#cb140-6" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> Outcome, <span class="at">values_from =</span> o_value, <span class="at">values_fn =</span> mean) <span class="sc">%&gt;%</span></span>
<span id="cb140-7"><a href="cleaning.html#cb140-7" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> Trait, <span class="at">values_from =</span> p_value, <span class="at">values_fn =</span> mean) <span class="sc">%&gt;%</span></span>
<span id="cb140-8"><a href="cleaning.html#cb140-8" tabindex="-1"></a>  <span class="fu">group_by</span>(study) <span class="sc">%&gt;%</span> </span>
<span id="cb140-9"><a href="cleaning.html#cb140-9" tabindex="-1"></a>  <span class="fu">nest</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb140-10"><a href="cleaning.html#cb140-10" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb140-11"><a href="cleaning.html#cb140-11" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rtab =</span> <span class="fu">map2</span>(data, study, r_fun))</span></code></pre></div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="runmodels.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio/bookdown-demo/edit/master/01-data-cleaning.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["bookdown-demo.pdf", "bookdown-demo.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
